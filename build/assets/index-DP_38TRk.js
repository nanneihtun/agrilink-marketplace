import{r as d,j as e,S as ya,b as it,T as nt,I as lt,V as ot,P as ct,C as dt,c as mt,d as ut,e as xt,f as ht,g as pt,h as gt,i as ba,k as ft,l as jt,m as vt,n as yt,o as bt,p as Nt,q as wt,s as kt,t as Ct,A as St,u as Na,v as Js,O as wa,w as ka,x as Ca,D as Sa,y as _t,z as Tt,B as Dt,E as Pt,F as At,G as It,H as Lt,J as Rt,K as Mt,L as Ft,M as Et,N as _a,Q as Ta,U as Da,W as Pa,X as qt,Y as Bt,Z as zt,_ as Vt,$ as Ot,a0 as $t,a1 as Ut,a2 as Wt,a3 as Yt,R as Ht}from"./ui-DO7Vv-dT.js";import{a as Kt}from"./vendor-BWX1YzKK.js";import{_ as ls,c as Jt}from"./supabase-BRe8iXyT.js";import{t as Aa,c as Ia,a as Gs}from"./utils--BulIq_u.js";import{B as Je,S as ae,a as Qs,T as We,b as Cs,U as ve,M as de,A as as,L as Oe,C as Z,c as ce,P as qe,d as Ue,e as Zs,H as ys,f as Ye,g as ne,h as bs,i as qs,j as La,k as Ra,l as Ma,F as Ws,X as Pe,m as Ae,D as Ge,n as us,o as Ee,p as Ds,E as ye,q as Is,r as Fa,s as fs,t as Bs,u as Ls,v as le,w as Rs,x as Me,y as Xs,I as Ea,z as He,G as Ns,J as Se,K as Xe,N as ds,O as Gt,Q as qa,R as ia,V as na,W as Ne,Y as la,Z as cs,_ as os,$ as Ys,a0 as ws,a1 as Qt,a2 as Zt,a3 as Xt,a4 as er,a5 as Ms,a6 as Ba,a7 as sr,a8 as ar,a9 as oa,aa as za,ab as ca,ac as Va,ad as tr,ae as rr,af as ir,ag as nr,ah as lr,ai as da,aj as ma,ak as ua}from"./icons-B9yykS_J.js";import{t as ee,z as or,T as cr}from"./components-UokQzgfs.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const g of i.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&r(g)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}})();var Ss={},xa;function dr(){if(xa)return Ss;xa=1;var s=Kt();return Ss.createRoot=s.createRoot,Ss.hydrateRoot=s.hydrateRoot,Ss}var mr=dr();function G(...s){return Aa(Ia(s))}const ur=Gs("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9 rounded-md"}},defaultVariants:{variant:"default",size:"default"}}),u=d.forwardRef(({className:s,variant:a,size:t,asChild:r=!1,...o},i)=>{const g=r?ya:"button";return e.jsx(g,{"data-slot":"button",className:G(ur({variant:a,size:t,className:s})),ref:i,...o})});u.displayName="Button";const xr=Gs("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}}),$=d.forwardRef(({className:s,variant:a,asChild:t=!1,...r},o)=>{const i=t?ya:"span";return e.jsx(i,{ref:o,"data-slot":"badge",className:G(xr({variant:a}),s),...r})});$.displayName="Badge";function xe(...s){return Aa(Ia(s))}const Fs={farmer:{key:"farmer",label:"Farmer",shortLabel:"Farmer",icon:Cs,description:"Grows and harvests agricultural products",color:"text-white dark:text-white",bgColor:"bg-green-600 dark:bg-green-600",borderColor:"border-green-600 dark:border-green-600"},trader:{key:"trader",label:"Trader",shortLabel:"Trader",icon:We,description:"Distributes and trades agricultural products",color:"text-white dark:text-white",bgColor:"bg-orange-600 dark:bg-orange-600",borderColor:"border-orange-600 dark:border-orange-600"},buyer:{key:"buyer",label:"Buyer",shortLabel:"Buyer",icon:Qs,description:"Purchases agricultural products for business or personal use",color:"text-blue-700 dark:text-blue-400",bgColor:"bg-blue-50 dark:bg-blue-900/20",borderColor:"border-blue-200 dark:border-blue-800"},admin:{key:"admin",label:"Admin",shortLabel:"Admin",icon:ae,description:"AgriLink platform administrator",color:"text-gray-700 dark:text-gray-300",bgColor:"bg-gray-50 dark:bg-gray-900/20",borderColor:"border-gray-200 dark:border-gray-800"}},hr={individual:{key:"individual",label:"Individual Account",shortLabel:"Individual",description:"Personal account perfect for small-scale farmers and individual sellers. No business license required - just verify your identity with Myanmar ID/NRC."},business:{key:"business",label:"Business Account",shortLabel:"Business",description:"For formal businesses, cooperatives, and companies. Requires business registration and provides enhanced credibility for larger operations."}},ks={unverified:{key:"unverified",label:"Unverified",shortLabel:"Unverified",icon:Ue,description:"Basic account - verification not started",color:"text-red-600 dark:text-red-400",bgColor:"bg-red-50 dark:bg-red-900/20",borderColor:"border-red-200 dark:border-red-800",level:0,requirements:["Account registration","Email verification"],accountTypes:["individual","business"]},"phone-verified":{key:"phone-verified",label:"Phone Verified",shortLabel:"Phone Verified",icon:qe,description:"Phone verified - ID verification still needed",color:"text-yellow-600 dark:text-yellow-400",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",borderColor:"border-yellow-200 dark:border-yellow-800",level:.3,requirements:["Phone number verification","SMS confirmation"],accountTypes:["individual","business"]},"under-review":{key:"under-review",label:"Under Review",shortLabel:"Under Review",icon:ce,description:"Documents submitted, awaiting verification",color:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-50 dark:bg-blue-900/20",borderColor:"border-blue-200 dark:border-blue-800",level:.5,requirements:["Documents uploaded","Awaiting admin review"],accountTypes:["individual","business"]},"id-verified":{key:"id-verified",label:"Verified",shortLabel:"Verified",icon:Z,description:"Individual verification complete - trusted member",color:"text-green-600 dark:text-green-400",bgColor:"bg-green-50 dark:bg-green-900/20",borderColor:"border-green-200 dark:border-green-800",level:1,requirements:["Valid Myanmar ID/NRC","Identity verification"],accountTypes:["individual"]},"business-verified":{key:"business-verified",label:"Business Verified",shortLabel:"Business ✓",icon:as,description:"Business registration and ID verified - formal business",color:"text-primary dark:text-primary-foreground",bgColor:"bg-primary/10 dark:bg-primary/20",borderColor:"border-primary/30 dark:border-primary/40",level:2,requirements:["Valid Myanmar ID/NRC","Business registration","Business license"],accountTypes:["business"]}},pr={"organic-certified":{label:"Organic Certified",icon:Oe,color:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200"},"export-ready":{label:"Export Quality",icon:as,color:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200"},"local-champion":{label:"Local Champion",icon:de,color:"text-purple-600",bgColor:"bg-purple-50",borderColor:"border-purple-200"},sustainable:{label:"Sustainable Practices",icon:Cs,color:"text-emerald-600",bgColor:"bg-emerald-50",borderColor:"border-emerald-200"}};function Oa({verificationLevel:s="unverified",size:a="xs",className:t}){if(!(s==="id-verified"||s==="business-verified"))return null;const o=ks[s],i={xs:"text-xs px-1.5 py-0.5",sm:"text-xs px-2 py-1"},g={xs:"w-3 h-3",sm:"w-3 h-3"};return e.jsxs($,{variant:"outline",className:xe(i[a],o.color,o.bgColor,o.borderColor,"font-medium flex items-center gap-1 ml-1",t),children:[e.jsx(o.icon,{className:g[a]}),o.shortLabel]})}function gr({verificationLevel:s="unverified",size:a="xs",className:t}){const r=ks[s]||ks.unverified,o={xs:"text-xs px-1.5 py-0.5",sm:"text-xs px-2 py-1"},i={xs:"w-3 h-3",sm:"w-3 h-3"};return e.jsxs($,{variant:"outline",className:xe(o[a],r.color,r.bgColor,r.borderColor,"font-medium flex items-center gap-1 ml-1",t),children:[e.jsx(r.icon,{className:i[a]}),r.shortLabel]})}function xs({userType:s,accountType:a,verificationLevel:t="unverified",specialties:r=[],size:o="md",showDescription:i=!1,className:g}){const b=Fs[s]||Fs.farmer,n=ks[t]||ks.unverified,v=a?hr[a]:null,f={sm:"text-xs px-2 py-1",md:"text-sm px-3 py-1.5",lg:"text-base px-4 py-2"},N={sm:"w-3 h-3",md:"w-4 h-4",lg:"w-5 h-5"},m=()=>o==="sm"?b.shortLabel:b.label,c=s==="farmer"?{className:xe(f[o],"font-medium flex items-center gap-1 bg-green-600 text-white border-green-600"),style:{backgroundColor:"#16a34a",color:"#ffffff",borderColor:"#16a34a"}}:s==="trader"?{className:xe(f[o],"font-medium flex items-center gap-1 bg-orange-600 text-white border-orange-600"),style:{backgroundColor:"#ea580c",color:"#ffffff",borderColor:"#ea580c"}}:{className:xe(f[o],s==="buyer"&&xe(b.color,b.bgColor,b.borderColor),s==="admin"&&xe(b.color,b.bgColor,b.borderColor),"font-medium flex items-center gap-1"),style:void 0},y=e.jsxs($,{variant:"default",className:c.className,style:c.style,children:[a==="business"?e.jsx(Je,{className:xe(N[o],s==="farmer"||s==="trader"?"text-white":b.color)}):e.jsx(ve,{className:xe(N[o],s==="farmer"||s==="trader"?"text-white":b.color)}),m()]});return e.jsxs("div",{className:xe("flex flex-wrap items-center gap-2",g),children:[y,e.jsx(gr,{verificationLevel:t,size:o==="lg"?"sm":"xs"}),r.map(l=>{const p=pr[l];return p?e.jsxs($,{variant:"outline",className:xe(f[o],p.color,p.bgColor,p.borderColor,"font-medium flex items-center gap-1.5"),children:[e.jsx(p.icon,{className:N[o]}),o!=="lg"?"★":p.label]},l):null}),i&&o!=="sm"&&e.jsxs("div",{className:"text-xs text-muted-foreground max-w-xs",children:[b.description,v&&e.jsxs("span",{className:"block mt-1",children:["Account Type: ",v.description]}),t!=="unverified"&&e.jsx("span",{className:"block mt-1",children:n.description})]})]})}function $a({userType:s,accountType:a,size:t="sm",className:r}){const o=Fs[s]||Fs.farmer,i={sm:"text-xs px-2 py-1",md:"text-sm px-3 py-1.5",lg:"text-base px-4 py-2"},g={sm:"w-3 h-3",md:"w-4 h-4",lg:"w-5 h-5"},b=()=>t==="sm"?o.shortLabel:o.label,v=s==="farmer"?{className:xe(i[t],"font-medium flex items-center gap-1 bg-green-600 text-white border-green-600"),style:{backgroundColor:"#16a34a",color:"#ffffff",borderColor:"#16a34a"}}:s==="trader"?{className:xe(i[t],"font-medium flex items-center gap-1 bg-orange-600 text-white border-orange-600"),style:{backgroundColor:"#ea580c",color:"#ffffff",borderColor:"#ea580c"}}:{className:xe(i[t],s==="buyer"&&xe(o.color,o.bgColor,o.borderColor),s==="admin"&&xe(o.color,o.bgColor,o.borderColor),"font-medium flex items-center gap-1"),style:void 0};return e.jsxs($,{variant:"default",className:xe(v.className,r),style:v.style,children:[a==="business"?e.jsx(Je,{className:xe(g[t],s==="farmer"||s==="trader"?"text-white":o.color)}):e.jsx(ve,{className:xe(g[t],s==="farmer"||s==="trader"?"text-white":o.color)}),b()]})}function Ke(s){return s.verificationStatus==="under_review"||s.verificationSubmitted&&s.verificationStatus!=="verified"?"under-review":s.accountType==="business"&&s.verified&&s.businessVerified?"business-verified":s.verified?"id-verified":s.phoneVerified?"phone-verified":"unverified"}function ms(s){return s.accountType||"individual"}function I({className:s,...a}){return e.jsx("div",{"data-slot":"card",className:G("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border",s),...a})}function W({className:s,...a}){return e.jsx("div",{"data-slot":"card-header",className:G("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 pt-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",s),...a})}function Y({className:s,...a}){return e.jsx("h4",{"data-slot":"card-title",className:G("leading-none",s),...a})}function De({className:s,...a}){return e.jsx("p",{"data-slot":"card-description",className:G("text-muted-foreground",s),...a})}function R({className:s,...a}){return e.jsx("div",{"data-slot":"card-content",className:G("px-6 [&:last-child]:pb-6",s),...a})}function Ua({className:s,...a}){return e.jsx("div",{"data-slot":"card-footer",className:G("flex items-center px-6 pb-6 [.border-t]:pt-6",s),...a})}const fr="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODgiIGhlaWdodD0iODgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBvcGFjaXR5PSIuMyIgZmlsbD0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIzLjciPjxyZWN0IHg9IjE2IiB5PSIxNiIgd2lkdGg9IjU2IiBoZWlnaHQ9IjU2IiByeD0iNiIvPjxwYXRoIGQ9Im0xNiA1OCAxNi0xOCAzMiAzMiIvPjxjaXJjbGUgY3g9IjUzIiBjeT0iMzUiIHI9IjciLz48L3N2Zz4KCg==";function Es(s){const[a,t]=d.useState(!1),r=()=>{t(!0)},{src:o,alt:i,style:g,className:b,...n}=s;return a?e.jsx("div",{className:`inline-block bg-gray-100 text-center align-middle ${b??""}`,style:g,children:e.jsx("div",{className:"flex items-center justify-center w-full h-full",children:e.jsx("img",{src:fr,alt:"Error loading image",...n,"data-original-url":o})})}):e.jsx("img",{src:o,alt:i,className:b,style:g,...n,onError:r})}function zs(s){if(!s)return"Recently";if(!s.includes("T")&&!s.includes("-"))return s;try{const a=new Date(s);return isNaN(a.getTime())?"Recently":`${["January","February","March","April","May","June","July","August","September","October","November","December"][a.getMonth()]} ${a.getFullYear()}`}catch(a){return console.warn("Failed to parse date:",s,a),"Recently"}}function ts(s){if(!s)return"Recently";try{let a;if(s.includes("T")||s.includes("Z"))a=new Date(s);else if(s.includes("-"))a=new Date(s+"T00:00:00");else return s;if(isNaN(a.getTime()))return"Recently";const t=new Date,r=t.getTime()-a.getTime();if(r<-6e4)return"Recently";if(r<0)return"Just now";const o=Math.floor(r/1e3),i=Math.floor(r/(1e3*60)),g=Math.floor(r/(1e3*60*60)),b=Math.floor(r/(1e3*60*60*24));if(o<30)return"Just now";if(i<1)return"Just now";if(i<60)return`${i} minute${i===1?"":"s"} ago`;if(g<24)return`${g} hour${g===1?"":"s"} ago`;if(b<30)return`${b} day${b===1?"":"s"} ago`;{const n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],v=a.getDate(),f=n[a.getMonth()],N=a.getFullYear(),m=t.getFullYear();return N===m?`${f} ${v}`:`${f} ${v}, ${N}`}}catch(a){return console.warn("Failed to parse date for relative time:",s,a),"Recently"}}function jr(s,a,t){try{const r=localStorage.getItem("agriconnect-myanmar-current-user");if(r&&a===s){const g=JSON.parse(r);return{name:g.businessName||g.name||"Unknown Seller",location:g.location||"Location not set",lastUpdated:t?ts(t):"Recently"}}const i=JSON.parse(localStorage.getItem("agriconnect-myanmar-users")||"[]").find(g=>g.id===s);if(i)return{name:i.businessName||i.name||"Unknown Seller",location:i.location||"Location not set",lastUpdated:t?ts(t):"Recently"}}catch(r){console.error("Error fetching seller info:",r)}return null}function vr({product:s,onChat:a,onViewDetails:t,onViewStorefront:r,onDelete:o,onSaveProduct:i,currentUserId:g,currentUserType:b,sellerVerified:n=!1,sellerVerificationStatus:v,adminMode:f=!1,savedProductIds:N=[]}){const m=g&&s.sellerId===g,x=N.includes(s.id),c=()=>s.price||0,y=()=>{i&&g&&!m&&i(s.id,c())},l=jr(s.sellerId,g,s.lastUpdated),p=l?.name||s.sellerName,P=l?.location||s.location,w=l?.lastUpdated||ts(s.lastUpdated);return e.jsxs(I,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(R,{className:"p-3",children:[e.jsxs("div",{className:"relative mb-2",children:[e.jsx(Es,{src:s.images?.[0]||s.image,alt:s.name,className:"w-full aspect-[3/2] object-cover rounded-lg cursor-pointer",onClick:()=>t(s.id)}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx($a,{userType:s.sellerType,accountType:"individual",size:"sm"})}),f&&o&&e.jsx(u,{variant:"destructive",size:"sm",className:"absolute top-2 left-2 h-8 w-8 p-0 z-10",onClick:h=>{h.stopPropagation(),window.confirm(`Delete "${s.name}"?`)&&o(s.id)},children:e.jsx(Zs,{className:"w-4 h-4"})}),!m&&i&&g&&e.jsx(u,{variant:"ghost",size:"sm",className:"absolute top-2 left-2 h-8 w-8 p-0 z-10 bg-white/90 hover:bg-white shadow-sm",onClick:h=>{h.stopPropagation(),y()},children:e.jsx(ys,{className:`w-4 h-4 ${x?"fill-red-500 text-red-500":"text-gray-600 hover:text-red-500"}`})})]}),e.jsx("h3",{className:"font-medium mb-1 text-sm line-clamp-2",children:s.name}),e.jsx("div",{className:"flex items-center gap-2 mb-1",children:s.price&&s.price>0?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-lg font-semibold",children:[s.price.toLocaleString()," MMK"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["per ",s.unit]})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-lg font-semibold",children:"Contact"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"for price"})]})}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground mb-1",children:[e.jsx(de,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:P})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(Ye,{className:"w-3 h-3"}),e.jsx("button",{className:"text-primary hover:underline",onClick:()=>r(s.sellerId),children:p}),e.jsx(Oa,{verificationLevel:v?v.level===2?"business-verified":v.level===1?"id-verified":v.trustLevel==="under-review"?"under-review":"unverified":"unverified",size:"xs"})]}),e.jsxs("p",{className:"truncate",children:["Updated: ",w]}),s.availableQuantity&&e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-primary",children:[e.jsx(ne,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs font-medium",children:s.availableQuantity})]})]})]}),e.jsxs(Ua,{className:"p-3 pt-0 flex gap-2",children:[e.jsx(u,{size:"sm",className:`h-8 text-xs ${m?"w-full":"flex-1"}`,onClick:()=>t(s.id),children:"View Details"}),!m&&e.jsxs(u,{variant:"outline",size:"sm",className:"flex-1 h-8 text-xs",onClick:()=>a(s.id),children:[e.jsx(bs,{className:"w-3 h-3 mr-1"}),"Chat"]})]})]})}function J({className:s,type:a,...t}){return e.jsx("input",{type:a,"data-slot":"input",className:G("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",s),...t})}function pe({...s}){return e.jsx(it,{"data-slot":"select",...s})}function ge({...s}){return e.jsx(ot,{"data-slot":"select-value",...s})}function fe({className:s,size:a="default",children:t,...r}){return e.jsxs(nt,{"data-slot":"select-trigger","data-size":a,className:G("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-full items-center justify-between gap-2 rounded-md border bg-input-background px-3 py-2 text-sm whitespace-nowrap transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...r,children:[t,e.jsx(lt,{asChild:!0,children:e.jsx(qs,{className:"size-4 opacity-50"})})]})}function je({className:s,children:a,position:t="popper",...r}){return e.jsx(ct,{children:e.jsxs(dt,{"data-slot":"select-content",className:G("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:t,...r,children:[e.jsx(yr,{}),e.jsx(mt,{className:G("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:a}),e.jsx(br,{})]})})}function B({className:s,children:a,...t}){return e.jsxs(ut,{"data-slot":"select-item",className:G("hover:bg-[rgba(164,131,91,0.15)] hover:text-foreground focus:bg-[rgba(164,131,91,0.2)] focus:text-foreground data-[highlighted]:bg-[rgba(164,131,91,0.2)] data-[highlighted]:text-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2 transition-colors duration-150",s),...t,children:[e.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:e.jsx(xt,{children:e.jsx(La,{className:"size-4"})})}),e.jsx(ht,{children:a})]})}function yr({className:s,...a}){return e.jsx(pt,{"data-slot":"select-scroll-up-button",className:G("flex cursor-default items-center justify-center py-1",s),...a,children:e.jsx(Ra,{className:"size-4"})})}function br({className:s,...a}){return e.jsx(gt,{"data-slot":"select-scroll-down-button",className:G("flex cursor-default items-center justify-center py-1",s),...a,children:e.jsx(qs,{className:"size-4"})})}const Fe={yangon:{name:"Yangon Region",cities:["Yangon","Thanlyin","Mingalardon","Insein","Hmawbi","Hlegu","Taikkyi"]},mandalay:{name:"Mandalay Region",cities:["Mandalay","Meiktila","Pyinoolwin","Kyaukse","Nyaung-U","Myingyan","Yamethin"]},naypyidaw:{name:"Naypyidaw Union Territory",cities:["Naypyidaw","Pyinmana","Lewe","Tatkon"]},ayeyarwady:{name:"Ayeyarwady Region",cities:["Pathein","Myaungmya","Bogalay","Pyapon","Labutta","Hinthada","Maubin"]},bago:{name:"Bago Region",cities:["Bago","Pyay","Taungoo","Thegon","Nyaunglebin","Kawa","Waw"]},magway:{name:"Magway Region",cities:["Magway","Pakokku","Minbu","Chauk","Yenangyaung","Thayet","Aunglan"]},sagaing:{name:"Sagaing Region",cities:["Sagaing","Monywa","Shwebo","Kale","Katha","Mawlaik","Ye-U"]},tanintharyi:{name:"Tanintharyi Region",cities:["Dawei","Myeik","Kawthaung","Bokpyin","Thayetchaung"]},mon:{name:"Mon State",cities:["Mawlamyine","Thaton","Mudon","Ye","Kyaikto","Paung","Chaungzon"]},kayin:{name:"Kayin State",cities:["Hpa-an","Kawkareik","Myawaddy","Kyainseikgyi","Thandaunggyi"]},kayah:{name:"Kayah State",cities:["Loikaw","Demoso","Hpruso","Bawlakhe"]},shan:{name:"Shan State",cities:["Taunggyi","Lashio","Kengtung","Hsipaw","Nyaungshwe","Kalaw","Pinlaung","Muse"]},chin:{name:"Chin State",cities:["Hakha","Falam","Tedim","Tonzang","Mindat"]},rakhine:{name:"Rakhine State",cities:["Sittwe","Kyaukpyu","Mrauk-U","Thandwe","Maungdaw","Buthidaung"]},kachin:{name:"Kachin State",cities:["Myitkyina","Bhamo","Putao","Mohnyin","Injangyang"]}};function Nr(s){for(const[a,t]of Object.entries(Fe))if(t.cities.includes(s))return a;return null}function wr({filters:s,onFiltersChange:a,activeFiltersCount:t}){const[r,o]=d.useState(!1),i=(n,v)=>{a(n==="region"?{...s,[n]:v,city:""}:{...s,[n]:v})},g=()=>{a({search:"",category:"",location:"",region:"",city:"",sellerType:"",verifiedStatus:"",priceRange:"",sortBy:"newest"})},b=()=>!s.region||s.region==="all"?[]:Fe[s.region]?.cities||[];return e.jsx("div",{className:"bg-primary/5 border border-primary/10 rounded-xl p-4 mb-6 shadow-sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ma,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(J,{placeholder:"Search products, categories, or locations...",value:s.search,onChange:n=>i("search",n.target.value),className:"pl-10 h-11 bg-background border-primary/20"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsxs(pe,{value:s.category||"all",onValueChange:n=>i("category",n==="all"?"":n),children:[e.jsx(fe,{className:"h-11 bg-background border-primary/20",children:e.jsx(ge,{placeholder:"All Categories"})}),e.jsxs(je,{position:"popper",side:"bottom",align:"start",sideOffset:4,children:[e.jsx(B,{value:"all",children:"All Categories"}),e.jsx(B,{value:"rice",children:"Rice & Grains"}),e.jsx(B,{value:"pulses",children:"Pulses & Beans"}),e.jsx(B,{value:"oilseeds",children:"Oilseeds"}),e.jsx(B,{value:"vegetables",children:"Vegetables"}),e.jsx(B,{value:"fruits",children:"Fruits"}),e.jsx(B,{value:"spices",children:"Spices & Herbs"}),e.jsx(B,{value:"traditional",children:"Traditional Crops"})]})]}),e.jsxs(pe,{value:s.region||"all",onValueChange:n=>i("region",n==="all"?"":n),children:[e.jsx(fe,{className:"h-11 bg-background border-primary/20",children:e.jsx(ge,{placeholder:"All Regions"})}),e.jsxs(je,{className:"max-h-64 overflow-y-auto",position:"popper",side:"bottom",align:"start",sideOffset:4,children:[e.jsx(B,{value:"all",children:"All Regions"}),Object.entries(Fe).map(([n,v])=>e.jsx(B,{value:n,children:v.name},n))]})]}),e.jsxs(pe,{value:s.city||"all",onValueChange:n=>i("city",n==="all"?"":n),disabled:!s.region||s.region==="all",children:[e.jsx(fe,{className:"h-11 bg-background border-primary/20",children:e.jsx(ge,{placeholder:s.region?"All Cities":"Select Region First"})}),e.jsxs(je,{className:"max-h-64 overflow-y-auto",position:"popper",side:"bottom",align:"start",sideOffset:4,children:[e.jsx(B,{value:"all",children:"All Cities"}),b().map(n=>e.jsx(B,{value:n,children:n},n))]})]}),e.jsxs(pe,{value:s.sortBy,onValueChange:n=>i("sortBy",n),children:[e.jsx(fe,{className:"h-11 bg-background border-primary/20",children:e.jsx(ge,{placeholder:"Sort By"})}),e.jsxs(je,{position:"popper",side:"bottom",align:"start",sideOffset:4,children:[e.jsx(B,{value:"newest",children:"Newest First"}),e.jsx(B,{value:"price-low",children:"Price: Low to High"}),e.jsx(B,{value:"price-high",children:"Price: High to Low"}),e.jsx(B,{value:"location",children:"By Location"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(u,{variant:"ghost",size:"sm",onClick:()=>o(!r),className:"text-muted-foreground hover:text-foreground",children:[e.jsx(Ws,{className:"w-4 h-4 mr-2"}),"Advanced Filters",r?e.jsx(Ra,{className:"w-4 h-4 ml-2"}):e.jsx(qs,{className:"w-4 h-4 ml-2"})]}),t>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs($,{variant:"secondary",className:"text-xs",children:[t," filter",t!==1?"s":""," active"]}),e.jsxs(u,{variant:"outline",size:"sm",onClick:g,className:"h-8 px-3",children:[e.jsx(Pe,{className:"w-3 h-3 mr-1"}),"Clear"]})]})]}),r&&e.jsx("div",{className:"space-y-3 pt-3 border-t border-border/50",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[e.jsxs(pe,{value:s.sellerType||"all",onValueChange:n=>i("sellerType",n==="all"?"":n),children:[e.jsx(fe,{className:"h-10 bg-background border-primary/20",children:e.jsx(ge,{placeholder:"All Sellers"})}),e.jsxs(je,{position:"popper",side:"bottom",align:"start",sideOffset:4,children:[e.jsx(B,{value:"all",children:"All Sellers"}),e.jsx(B,{value:"farmer",children:"Farmers"}),e.jsx(B,{value:"trader",children:"Traders"})]})]}),e.jsxs(pe,{value:s.verifiedStatus||"all",onValueChange:n=>i("verifiedStatus",n==="all"?"":n),children:[e.jsx(fe,{className:"h-10 bg-background border-primary/20",children:e.jsx(ge,{placeholder:"Any Verification"})}),e.jsxs(je,{position:"popper",side:"bottom",align:"start",sideOffset:4,children:[e.jsx(B,{value:"all",children:"Any Verification"}),e.jsx(B,{value:"verified",children:"Verified Sellers"}),e.jsx(B,{value:"business-verified",children:"Business Verified"}),e.jsx(B,{value:"unverified",children:"Unverified"})]})]}),e.jsxs(pe,{value:s.priceRange||"all",onValueChange:n=>i("priceRange",n==="all"?"":n),children:[e.jsx(fe,{className:"h-10 bg-background border-primary/20",children:e.jsx(ge,{placeholder:"Any Price Range"})}),e.jsxs(je,{position:"popper",side:"bottom",align:"start",sideOffset:4,children:[e.jsx(B,{value:"all",children:"Any Price Range"}),e.jsx(B,{value:"0-50000",children:"Under 50,000 MMK"}),e.jsx(B,{value:"50000-100000",children:"50K - 100K MMK"}),e.jsx(B,{value:"100000-200000",children:"100K - 200K MMK"}),e.jsx(B,{value:"200000+",children:"200K+ MMK"})]})]})]})})]})})}function kr({productName:s,priceData:a,unit:t,onBack:r,isOwnProduct:o}){const[i,g]=d.useState("all"),[b,n]=d.useState("all"),v=Array.from(new Set(a.map(m=>m.location))).sort(),N=[...a.filter(m=>{const x=i==="all"||m.location===i,c=b==="all"||m.sellerType===b;return x&&c})].sort((m,x)=>m.price-x.price);return e.jsxs("div",{className:"space-y-6",children:[r&&e.jsx(Ae,{className:"w-5 h-5 cursor-pointer text-muted-foreground hover:text-foreground transition-colors",onClick:r}),e.jsx("div",{className:"bg-gradient-to-r from-primary/5 to-primary/10 rounded-lg p-6 border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-primary mb-2",children:o?"Market Price Analysis":"Price Comparison"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-xl font-semibold",children:s}),e.jsxs($,{variant:"secondary",className:"text-sm",children:["Per ",t]})]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:o?`See how your pricing compares to ${a.length} other sellers`:`Compare prices from ${a.length} sellers across Myanmar`})]}),N.length>0&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Price range"}),e.jsxs("p",{className:"text-lg font-semibold",children:[N[0]?.price?.toLocaleString()," - ",N[N.length-1]?.price?.toLocaleString()," MMK"]})]})]})}),e.jsxs(I,{children:[e.jsxs(W,{children:[e.jsxs(Y,{className:"flex items-center justify-between",children:[e.jsx("span",{children:o?"Market Competitors":"Available Sellers"}),e.jsxs($,{variant:"outline",children:[N.length," of ",a.length," listings"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ws,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Filter by:"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(pe,{value:i,onValueChange:g,children:[e.jsx(fe,{className:"w-full sm:w-48",children:e.jsx(ge,{placeholder:"All regions"})}),e.jsxs(je,{children:[e.jsx(B,{value:"all",children:"All Regions"}),v.map(m=>e.jsx(B,{value:m,children:m},m))]})]}),e.jsxs(pe,{value:b,onValueChange:n,children:[e.jsx(fe,{className:"w-full sm:w-40",children:e.jsx(ge,{placeholder:"All types"})}),e.jsxs(je,{children:[e.jsx(B,{value:"all",children:"All Types"}),e.jsx(B,{value:"farmer",children:"Farmers"}),e.jsx(B,{value:"trader",children:"Traders"})]})]})]})]})]}),e.jsxs(R,{children:[e.jsx("div",{className:"space-y-3",children:N.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Ws,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No sellers found matching your filters."}),e.jsx("p",{className:"text-sm mt-1",children:"Try adjusting your selection above."})]}):N.map((m,x)=>e.jsxs("div",{className:`p-4 rounded-lg border transition-colors hover:bg-muted/30 ${x===0?"bg-green-50 border-green-200":"bg-card"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{variant:m.sellerType==="farmer"?"default":"secondary",className:"capitalize",children:m.sellerType}),e.jsx("h3",{className:"font-medium",children:m.sellerName}),x===0&&e.jsx($,{variant:"outline",className:"text-green-600 bg-green-50 border-green-200",children:"Lowest Price"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-semibold text-primary",children:[m.price.toLocaleString()," MMK"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["per ",t]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{children:m.location})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx($,{variant:"outline",className:"text-xs",children:m.quantity})}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsxs("span",{children:["Updated ",ts(m.lastUpdated)]})]})]})]},m.id))}),N.length>0&&e.jsxs("div",{className:"mt-6 p-4 bg-muted/30 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:o?"Understanding Market Pricing":"How to Compare"}),e.jsx("div",{className:"text-sm text-muted-foreground space-y-1",children:o?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Market Position:"})," See where your prices stand against competitors"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Pricing Strategy:"})," Consider adjusting based on quality and service"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Location Advantage:"})," Your local market may support different pricing"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Value Proposition:"})," Highlight your unique selling points"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Farmers:"})," Usually offer lower prices, direct from source"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Traders:"})," May have higher prices but offer bulk quantities"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Location:"})," Consider transport costs and delivery options"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Quantity:"})," Check if available amount meets your needs"]})]})})]})]})]})]})}const Wa=d.forwardRef(({className:s,children:a,...t},r)=>e.jsxs(ba,{ref:r,"data-slot":"scroll-area",className:G("relative",s),...t,children:[e.jsx(ft,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:a}),e.jsx(Cr,{}),e.jsx(jt,{})]}));Wa.displayName=ba.displayName;function Cr({className:s,orientation:a="vertical",...t}){return e.jsx(vt,{"data-slot":"scroll-area-scrollbar",orientation:a,className:G("flex touch-none p-px transition-colors select-none",a==="vertical"&&"h-full w-2.5 border-l border-l-transparent",a==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent",s),...t,children:e.jsx(yt,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}function Ya({delayDuration:s=0,...a}){return e.jsx(bt,{"data-slot":"tooltip-provider",delayDuration:s,...a})}function Sr({...s}){return e.jsx(Ya,{children:e.jsx(Nt,{"data-slot":"tooltip",...s})})}function _r({...s}){return e.jsx(wt,{"data-slot":"tooltip-trigger",...s})}function Tr({className:s,sideOffset:a=0,children:t,arrowClassName:r,...o}){const i=g=>g?g.includes("bg-green-700")?"bg-green-700 fill-green-700":g.includes("bg-amber-700")?"bg-amber-700 fill-amber-700":g.includes("bg-yellow-700")?"bg-yellow-700 fill-yellow-700":"bg-primary fill-primary":"bg-primary fill-primary";return e.jsx(kt,{children:e.jsxs(Ct,{"data-slot":"tooltip-content",sideOffset:a,className:G("bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",s),...o,children:[t,e.jsx(St,{className:G("z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]",r||i(s))})]})})}const _s="kojgbqlxerixvckiraus",ha="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtvamdicWx4ZXJpeHZja2lyYXVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzNDIxOTIsImV4cCI6MjA3NDkxODE5Mn0.2nAVFSEZK4Je5LqI1H_otibVhpMarVOyiRBXmkxuAWM",Dr={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function Pr(){try{if(typeof import.meta<"u"&&Dr)return{SUPABASE_URL:`https://${_s}.supabase.co`,SUPABASE_ANON_KEY:ha,SUPABASE_PROJECT_ID:_s,isVite:!0}}catch{console.log("Vite environment not available, using Supabase info")}return{SUPABASE_URL:`https://${_s}.supabase.co`,SUPABASE_ANON_KEY:ha,SUPABASE_PROJECT_ID:_s,isVite:!1}}const Ts=Pr(),Ve={SUPABASE_URL:Ts.SUPABASE_URL,SUPABASE_ANON_KEY:Ts.SUPABASE_ANON_KEY,SUPABASE_PROJECT_ID:Ts.SUPABASE_PROJECT_ID,isVite:Ts.isVite,isSupabaseConfigured(){return!!(this.SUPABASE_URL&&this.SUPABASE_ANON_KEY)}},ea=()=>{const[s,a]=d.useState([]),[t,r]=d.useState({}),[o,i]=d.useState(!1),[g,b]=d.useState(null),[n,v]=d.useState(new Map),f=d.useCallback(async c=>{if(!Ve.isSupabaseConfigured()){console.log("❌ Supabase not configured for chat"),a([]),i(!1);return}try{i(!0),b(null);const{supabase:y}=await ls(async()=>{const{supabase:k}=await Promise.resolve().then(()=>ps);return{supabase:k}},void 0),{data:{session:l},error:p}=await y.auth.getSession();if(p||!l?.access_token){console.log("❌ No valid session - authentication required for chat"),a([]),i(!1);return}const{data:P,error:w}=await y.from("conversations").select(`
          *,
          buyer:users!conversations_buyer_id_fkey(id, name, user_type, location),
          seller:users!conversations_seller_id_fkey(id, name, user_type, location),
          product:products!conversations_product_id_fkey(id, name, image)
        `).or(`buyer_id.eq.${c},seller_id.eq.${c}`).order("updated_at",{ascending:!1});if(w)throw w;const h=P?.map(k=>({id:k.id,buyerId:k.buyer_id,sellerId:k.seller_id,productId:k.product_id,productName:k.product?.name||"Unknown Product",productImage:k.product?.image||"https://images.unsplash.com/photo-1546470427-227c013b2b5f?w=400&h=300&fit=crop",buyerName:k.buyer?.name||"Unknown Buyer",buyerType:k.buyer?.user_type||"buyer",buyerLocation:k.buyer?.location||"Unknown Location",sellerName:k.seller?.name||"Unknown Seller",sellerType:k.seller?.user_type||"farmer",sellerLocation:k.seller?.location||"Unknown Location",lastMessage:k.last_message,lastMessageTime:k.last_message_time,unreadCount:k.unread_count||0,createdAt:k.created_at}))||[];a(h),console.log("✅ Conversations loaded from Supabase:",h.length)}catch(y){console.error("❌ Failed to load conversations:",y),b("Failed to load conversations"),a([])}finally{i(!1)}},[]),N=d.useCallback(async c=>{if(!Ve.isSupabaseConfigured()){r(y=>({...y,[c]:[]}));return}try{const{supabase:y}=await ls(async()=>{const{supabase:h}=await Promise.resolve().then(()=>ps);return{supabase:h}},void 0),{data:{session:l}}=await y.auth.getSession();if(!l?.access_token){console.log("❌ No valid session - authentication required for chat"),r(h=>({...h,[c]:[]}));return}const{data:p,error:P}=await y.from("messages").select("*").eq("conversation_id",c).order("created_at",{ascending:!0});if(P)throw P;const w=p?.map(h=>({id:h.id,conversationId:h.conversation_id,senderId:h.sender_id,content:h.content,timestamp:new Date(h.created_at).toISOString(),type:h.type||"text",isRead:h.is_read||!1,offerDetails:h.offer_details?JSON.parse(h.offer_details):void 0}))||[];if(r(h=>({...h,[c]:w})),!n.has(c)){const h=y.channel(`messages-${c}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`conversation_id=eq.${c}`},k=>{console.log("🔄 New message received via real-time:",k.new),console.log("🔄 Current messages before update:",t[c]?.length||0);const C={id:k.new.id,conversationId:k.new.conversation_id,senderId:k.new.sender_id,content:k.new.content,timestamp:new Date(k.new.created_at).toISOString(),type:k.new.type||"text",isRead:!1,offerDetails:k.new.offer_details?JSON.parse(k.new.offer_details):void 0};r(F=>{const S={...F,[c]:[...F[c]||[],C]};return console.log("🔄 Messages after update:",S[c]?.length||0),S})}).subscribe();v(k=>new Map([...k,[c,h]])),console.log("✅ Real-time subscription set up for conversation:",c)}console.log("✅ Messages loaded from Supabase:",w.length)}catch(y){console.error("❌ Failed to load messages:",y),r(l=>({...l,[c]:[]}))}},[n]),m=d.useCallback(async(c,y,l,p="text",P)=>{if(Ve.isSupabaseConfigured())try{const{supabase:w}=await ls(async()=>{const{supabase:S}=await Promise.resolve().then(()=>ps);return{supabase:S}},void 0),{data:{session:h}}=await w.auth.getSession();if(!h?.access_token){console.log("❌ No valid session - authentication required for chat");return}const{data:k,error:C}=await w.from("messages").insert({conversation_id:c,sender_id:l,content:y,type:p,offer_details:P?JSON.stringify(P):null}).select().single();if(C)throw C;const F={id:k.id,conversationId:k.conversation_id,senderId:k.sender_id,content:k.content,timestamp:new Date(k.created_at).toISOString(),type:k.type||"text",isRead:!1,offerDetails:k.offer_details?JSON.parse(k.offer_details):void 0};return r(S=>({...S,[c]:[...S[c]||[],F]})),await w.from("conversations").update({last_message:y,last_message_time:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",c),console.log("✅ Message sent to Supabase"),F}catch(w){throw console.error("❌ Failed to send message:",w),w}},[]),x=d.useCallback(async(c,y,l)=>{if(!Ve.isSupabaseConfigured())return null;try{const{supabase:p}=await ls(async()=>{const{supabase:L}=await Promise.resolve().then(()=>ps);return{supabase:L}},void 0),{data:{session:P}}=await p.auth.getSession();if(!P?.access_token)return console.log("❌ No valid session - authentication required for chat"),null;const{data:w}=await p.from("conversations").select("*").eq("buyer_id",c).eq("seller_id",y).eq("product_id",l).single();if(w)return console.log("✅ Existing conversation found:",w.id),{id:w.id,buyerId:w.buyer_id,sellerId:w.seller_id,productId:w.product_id,productName:w.product_name||"Unknown Product",buyerName:w.buyer_name||"Unknown Buyer",sellerName:w.seller_name||"Unknown Seller",lastMessage:w.last_message,lastMessageTime:w.last_message_time,unreadCount:w.unread_count||0,createdAt:w.created_at};const{data:h}=await p.from("products").select("name").eq("id",l).single(),{data:k}=await p.from("users").select("name").eq("id",c).single(),{data:C}=await p.from("users").select("name").eq("id",y).single(),{data:F,error:S}=await p.from("conversations").insert({buyer_id:c,seller_id:y,product_id:l,product_name:h?.name||"Unknown Product",buyer_name:k?.name||"Unknown Buyer",seller_name:C?.name||"Unknown Seller",last_message:"Conversation started",last_message_time:new Date().toISOString()}).select().single();if(S)throw S;const j={id:F.id,buyerId:F.buyer_id,sellerId:F.seller_id,productId:F.product_id,productName:F.product_name,buyerName:F.buyer_name,sellerName:F.seller_name,lastMessage:F.last_message,lastMessageTime:F.last_message_time,unreadCount:0,createdAt:F.created_at};return a(L=>[j,...L]),console.log("✅ New conversation created:",j.id),j}catch(p){return console.error("❌ Failed to start conversation:",p),null}},[]);return d.useEffect(()=>()=>{Ve.isSupabaseConfigured()&&ls(async()=>{const{supabase:c}=await Promise.resolve().then(()=>ps);return{supabase:c}},void 0).then(({supabase:c})=>{n.forEach((y,l)=>{console.log("🧹 Cleaning up subscription for conversation:",l),y&&typeof y.unsubscribe=="function"?y.unsubscribe():c.removeChannel(`messages-${l}`)})})},[n]),{conversations:s,messages:t,loading:o,error:g,loadConversations:f,loadMessages:N,sendMessage:m,startConversation:x}};function sa({...s}){return e.jsx(Tt,{"data-slot":"dialog",...s})}const Ha=d.forwardRef(({...s},a)=>e.jsx(Na,{ref:a,"data-slot":"dialog-trigger",...s}));Ha.displayName=Na.displayName;function Ar({...s}){return e.jsx(_t,{"data-slot":"dialog-portal",...s})}const Ir=d.forwardRef(({...s},a)=>e.jsx(Js,{ref:a,"data-slot":"dialog-close",...s}));Ir.displayName=Js.displayName;const Ka=d.forwardRef(({className:s,...a},t)=>e.jsx(wa,{ref:t,"data-slot":"dialog-overlay",className:G("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",s),...a}));Ka.displayName=wa.displayName;const Vs=d.forwardRef(({className:s,children:a,...t},r)=>e.jsxs(Ar,{"data-slot":"dialog-portal",children:[e.jsx(Ka,{}),e.jsxs(ka,{ref:r,"data-slot":"dialog-content",className:G("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",s),...t,children:[a,e.jsxs(Js,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(Pe,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Vs.displayName=ka.displayName;function aa({className:s,...a}){return e.jsx("div",{"data-slot":"dialog-header",className:G("flex flex-col gap-2 text-center sm:text-left",s),...a})}const Os=d.forwardRef(({className:s,...a},t)=>e.jsx(Ca,{ref:t,"data-slot":"dialog-title",className:G("text-lg leading-none font-semibold",s),...a}));Os.displayName=Ca.displayName;const $s=d.forwardRef(({className:s,...a},t)=>e.jsx(Sa,{ref:t,"data-slot":"dialog-description",className:G("text-muted-foreground text-sm",s),...a}));$s.displayName=Sa.displayName;function O({className:s,...a}){return e.jsx(Dt,{"data-slot":"label",className:G("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",s),...a})}function _e({className:s,...a}){return e.jsx("textarea",{"data-slot":"textarea",className:G("resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),...a})}function Lr({isOpen:s,onClose:a,product:t,buyerId:r,buyerName:o,sellerId:i,sellerName:g,onCreateOffer:b}){console.log("🔍 CreateOfferModal product data:",{name:t.name,price:t.price,priceType:typeof t.price,quantity:t.quantity,unit:t.unit,category:t.category,hasPrice:"price"in t,priceIsNumber:typeof t.price=="number",priceIsValid:!isNaN(t.price)&&t.price>0,fullProduct:t});const[n,v]=d.useState(t.price||0),[f,N]=d.useState(1),[m,x]=d.useState(""),[c,y]=d.useState(""),[l,p]=d.useState("3"),[P,w]=d.useState(""),[h,k]=d.useState({}),C=q=>!q||isNaN(q)?"0 MMK":new Intl.NumberFormat("en-US").format(q)+" MMK",F=()=>{const q={};return n<=0&&(q.price="Price must be greater than 0"),f<=0&&(q.quantity="Quantity must be greater than 0"),m.trim()||(q.deliveryLocation="Delivery location is required"),c.trim()||(q.deliveryTerms="Delivery terms are required"),k(q),Object.keys(q).length===0},S=()=>{if(!F()){ee.error("Please fix the errors in the form");return}console.log("🎯 CreateOfferModal - Creating offer with user details:",{buyerId:r,buyerName:o,sellerId:i,sellerName:g,productId:t.id,productName:t.name});const q=new Date;q.setDate(q.getDate()+parseInt(l));const D={conversationId:"",productId:t.id,productName:t.name,sellerId:i,sellerName:g,buyerId:r,buyerName:o,price:n,quantity:f,unit:t.unit||"units",description:t.description||"",deliveryTerms:`${c}${m?` | Location: ${m}`:""}`,deliveryLocation:m||"",validUntil:q.toISOString(),status:"pending",notes:P.trim()||""};console.log("✅ CreateOfferModal - Final offer object:",D),b(D),ee.success("Formal offer sent successfully!"),a()},j=()=>{v(t.price||0),N(1),x(""),y(""),p("3"),w(""),k({}),a()},L=n*f;return e.jsx(sa,{open:s,onOpenChange:j,children:e.jsxs(Vs,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(aa,{children:[e.jsxs(Os,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5 text-primary"}),"Create Formal Offer"]}),e.jsx($s,{children:"Create a formal offer for this product. Once submitted, the seller can accept, decline, or make a counter-offer."})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(I,{className:"bg-primary/5 border-primary/20",children:e.jsxs(R,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-medium",children:t.name}),e.jsx($,{variant:"outline",children:t.category})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Listed Price"}),e.jsxs("p",{className:"font-medium",children:[C(t.price||0)," per ",t.unit||"unit"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Available"}),e.jsx("p",{className:"font-medium",children:t.quantity||"0 units"})]})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:"Seller"}),e.jsx("p",{className:"font-medium",children:g})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:"Buyer"}),e.jsx("p",{className:"font-medium",children:o})]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"flex items-center gap-2 font-medium",children:[e.jsx(Ge,{className:"w-4 h-4"}),"Offer Details"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(O,{htmlFor:"price",children:["Price per ",t.unit]}),e.jsx(J,{id:"price",type:"number",value:n,onChange:q=>v(Number(q.target.value)),className:h.price?"border-red-500":""}),h.price&&e.jsxs("p",{className:"text-red-500 text-sm flex items-center gap-1",children:[e.jsx(Ue,{className:"w-3 h-3"}),h.price]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(O,{htmlFor:"quantity",children:["Quantity (",t.unit||"units",")"]}),e.jsx(J,{id:"quantity",type:"number",value:f,onChange:q=>N(Number(q.target.value)),placeholder:"Enter quantity",className:h.quantity?"border-red-500":""}),h.quantity&&e.jsxs("p",{className:"text-red-500 text-sm flex items-center gap-1",children:[e.jsx(Ue,{className:"w-3 h-3"}),h.quantity]})]})]}),e.jsx("div",{className:"bg-muted/50 p-3 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Offer Value:"}),e.jsx("span",{className:"text-xl font-semibold text-primary",children:C(L)})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"flex items-center gap-2 font-medium",children:[e.jsx(We,{className:"w-4 h-4"}),"Delivery & Terms"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"deliveryLocation",children:"Delivery Location"}),e.jsx(J,{id:"deliveryLocation",value:m,onChange:q=>x(q.target.value),placeholder:"Where should the product be delivered?",className:h.deliveryLocation?"border-red-500":""}),h.deliveryLocation&&e.jsxs("p",{className:"text-red-500 text-sm flex items-center gap-1",children:[e.jsx(Ue,{className:"w-3 h-3"}),h.deliveryLocation]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"deliveryTerms",children:"Delivery Terms & Conditions"}),e.jsx(_e,{id:"deliveryTerms",value:c,onChange:q=>y(q.target.value),placeholder:"Delivery method, timing, payment terms, quality requirements, etc.",className:`min-h-[100px] ${h.deliveryTerms?"border-red-500":""}`}),h.deliveryTerms&&e.jsxs("p",{className:"text-red-500 text-sm flex items-center gap-1",children:[e.jsx(Ue,{className:"w-3 h-3"}),h.deliveryTerms]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"flex items-center gap-2 font-medium",children:[e.jsx(us,{className:"w-4 h-4"}),"Offer Validity"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"validity",children:"Valid for"}),e.jsxs(pe,{value:l,onValueChange:p,children:[e.jsx(fe,{children:e.jsx(ge,{})}),e.jsxs(je,{children:[e.jsx(B,{value:"1",children:"1 day"}),e.jsx(B,{value:"3",children:"3 days"}),e.jsx(B,{value:"7",children:"1 week"}),e.jsx(B,{value:"14",children:"2 weeks"}),e.jsx(B,{value:"30",children:"1 month"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"notes",children:"Additional Notes (Optional)"}),e.jsx(_e,{id:"notes",value:P,onChange:q=>w(q.target.value),placeholder:"Any additional terms, requirements, or information...",className:"min-h-[80px]"})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[e.jsx(u,{variant:"outline",onClick:j,className:"flex-1",children:"Cancel"}),e.jsx(u,{onClick:S,className:"flex-1",children:"Send Formal Offer"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:["💡 ",e.jsx("strong",{children:"Tip:"})," A formal offer creates a structured deal with clear terms. Once accepted, both parties can track the deal progress and leave reviews upon completion."]})})]})]})})}function Rr({offer:s,currentUserId:a,onViewDetails:t,onQuickAction:r}){a&&s.sellerId&&s.sellerId,a&&s.buyerId&&s.buyerId;const o=s.validUntil?new Date(s.validUntil)<new Date:!1,i=f=>new Intl.NumberFormat("en-US").format(f)+" MMK",g=f=>{switch(f){case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"accepted":return"bg-green-100 text-green-800 border-green-200";case"in_progress":return"bg-blue-100 text-blue-800 border-blue-200";case"shipped":return"bg-purple-100 text-purple-800 border-purple-200";case"delivered":return"bg-indigo-100 text-indigo-800 border-indigo-200";case"completed":return"bg-emerald-100 text-emerald-800 border-emerald-200";case"cancelled":return"bg-red-100 text-red-800 border-red-200";case"disputed":return"bg-orange-100 text-orange-800 border-orange-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},b=f=>{switch(f){case"pending":return e.jsx(ce,{className:"w-3 h-3"});case"accepted":return e.jsx(Z,{className:"w-3 h-3"});case"in_progress":return e.jsx(ne,{className:"w-3 h-3"});case"shipped":return e.jsx(We,{className:"w-3 h-3"});case"delivered":return e.jsx(Z,{className:"w-3 h-3"});case"completed":return e.jsx(Ds,{className:"w-3 h-3"});case"cancelled":return e.jsx(Ee,{className:"w-3 h-3"});case"disputed":return e.jsx(Ee,{className:"w-3 h-3"});default:return e.jsx(ce,{className:"w-3 h-3"})}},n=f=>{switch(f){case"accepted":return 20;case"in_progress":return 40;case"shipped":return 70;case"delivered":return 90;case"completed":return 100;default:return 0}},v=()=>e.jsxs(u,{size:"sm",variant:"outline",className:"h-7 px-3 text-xs",onClick:f=>{f.stopPropagation(),t(s)},children:[e.jsx(ye,{className:"w-3 h-3 mr-1"}),"View Details"]});return e.jsx(I,{className:"mb-2 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>t(s),children:e.jsx(R,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs($,{className:`${g(s.status)} flex items-center gap-1 text-xs`,children:[b(s.status),s.status.charAt(0).toUpperCase()+s.status.slice(1)]}),o&&s.status==="pending"&&e.jsx($,{variant:"outline",className:"text-xs text-red-600",children:"Expired"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ge,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:i(s.price)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ne,{className:"w-3 h-3"}),e.jsxs("span",{children:[s.quantity," ",s.unit]})]}),s.deliveryLocation&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate max-w-20",children:s.deliveryLocation})]})]}),["accepted","in_progress","shipped","delivered","completed"].includes(s.status)&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mb-1",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[n(s.status),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-green-500 h-1.5 rounded-full transition-all duration-300",style:{width:`${n(s.status)}%`}})})]})]}),e.jsx("div",{className:"flex items-center gap-2 ml-2",children:v()})]})})})}function Mr({offer:s,isOpen:a,onClose:t,currentUserId:r,onUpdateStatus:o}){const[i,g]=d.useState(!1),[b,n]=d.useState(s?.trackingNumber||""),[v,f]=d.useState(s?.deliveryAddress||""),[N,m]=d.useState(!1),[x,c]=d.useState(null);if(!s)return null;const y=r&&s.sellerId&&r===s.sellerId,l=r&&s.buyerId&&r===s.buyerId,p=s.validUntil?new Date(s.validUntil)<new Date:!1,P=j=>new Intl.NumberFormat("en-US").format(j)+" MMK",w=j=>new Date(j).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}),h=j=>{switch(j){case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"accepted":return"bg-green-100 text-green-800 border-green-200";case"in_progress":return"bg-blue-100 text-blue-800 border-blue-200";case"shipped":return"bg-purple-100 text-purple-800 border-purple-200";case"delivered":return"bg-indigo-100 text-indigo-800 border-indigo-200";case"completed":return"bg-emerald-100 text-emerald-800 border-emerald-200";case"cancelled":return"bg-red-100 text-red-800 border-red-200";case"disputed":return"bg-orange-100 text-orange-800 border-orange-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},k=j=>{switch(j){case"pending":return e.jsx(ce,{className:"w-4 h-4"});case"accepted":return e.jsx(Z,{className:"w-4 h-4"});case"in_progress":return e.jsx(ne,{className:"w-4 h-4"});case"shipped":return e.jsx(We,{className:"w-4 h-4"});case"delivered":return e.jsx(Z,{className:"w-4 h-4"});case"completed":return e.jsx(Ds,{className:"w-4 h-4"});case"cancelled":return e.jsx(Ee,{className:"w-4 h-4"});case"disputed":return e.jsx(Ee,{className:"w-4 h-4"});default:return e.jsx(ce,{className:"w-4 h-4"})}},C=async(j,L,q)=>{if(!o)return;const D=q||j.replace(/_/g," ");c(D),m(!0);try{await o(s.id,j,L),ee.success(`✅ ${D} successful!`),setTimeout(()=>{t()},1e3)}catch{ee.error(`❌ Failed to ${D.toLowerCase()}. Please try again.`)}finally{c(null),m(!1)}},F=()=>{b.trim()?(C("shipped",{trackingNumber:b.trim(),deliveryAddress:v.trim()||s.deliveryLocation}),g(!1)):ee.error("Please enter a tracking number")},S=()=>{const j=[];if(y)switch(s.status){case"pending":p||j.push(e.jsxs(u,{onClick:()=>C("accepted",void 0,"Accept Offer"),className:"bg-green-600 hover:bg-green-700",disabled:N,children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),x==="Accept Offer"?"Accepting...":"Accept Offer"]},"accept"),e.jsxs(u,{variant:"outline",onClick:()=>C("cancelled",void 0,"Decline Offer"),disabled:N,children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),x==="Decline Offer"?"Declining...":"Decline Offer"]},"decline"));break;case"accepted":j.push(e.jsxs(u,{onClick:()=>C("in_progress",void 0,"Start Preparation"),disabled:N,children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),x==="Start Preparation"?"Starting...":"Start Preparation"]},"in_progress"));break;case"in_progress":j.push(e.jsxs(u,{onClick:()=>g(!0),disabled:N,children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Mark as Shipped"]},"shipped"));break;case"delivered":j.push(e.jsxs(u,{onClick:()=>C("completed",void 0,"Complete Transaction"),className:"bg-green-600 hover:bg-green-700",disabled:N,children:[e.jsx(Ds,{className:"w-4 h-4 mr-2"}),x==="Complete Transaction"?"Completing...":"Complete Transaction"]},"completed"));break}if(l)switch(s.status){case"shipped":j.push(e.jsxs(u,{onClick:()=>C("delivered",void 0,"Confirm Delivery"),className:"bg-blue-600 hover:bg-blue-700",disabled:N,children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),x==="Confirm Delivery"?"Confirming...":"Confirm Delivery"]},"delivered"));break;case"delivered":j.push(e.jsxs(u,{onClick:()=>C("completed",void 0,"Complete Transaction"),className:"bg-green-600 hover:bg-green-700",disabled:N,children:[e.jsx(Ds,{className:"w-4 h-4 mr-2"}),x==="Complete Transaction"?"Completing...":"Complete Transaction"]},"completed"));break}return["pending","accepted","in_progress"].includes(s.status)&&j.push(e.jsxs(u,{variant:"outline",onClick:()=>C("cancelled"),children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Cancel"]},"cancel")),j};return e.jsx(sa,{open:a,onOpenChange:t,children:e.jsxs(Vs,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(aa,{children:[e.jsxs(Os,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5"}),"Offer Details"]}),e.jsx($s,{children:"View and manage offer details, track transaction status, and communicate with the other party."})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(I,{children:[e.jsx(W,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs($,{className:`${h(s.status)} flex items-center gap-2`,children:[k(s.status),s.status.charAt(0).toUpperCase()+s.status.slice(1)]}),p&&s.status==="pending"&&e.jsxs($,{variant:"outline",className:"text-red-600",children:[e.jsx(Ue,{className:"w-3 h-3 mr-1"}),"Expired"]})]})}),e.jsx(R,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(O,{className:"text-sm font-medium text-gray-500",children:"Product"}),e.jsx("p",{className:"text-lg font-semibold",children:s.productName||"Unknown Product"})]}),e.jsxs("div",{children:[e.jsx(O,{className:"text-sm font-medium text-gray-500",children:"Price"}),e.jsx("p",{className:"text-lg font-semibold text-green-600",children:P(s.price)})]}),e.jsxs("div",{children:[e.jsx(O,{className:"text-sm font-medium text-gray-500",children:"Quantity"}),e.jsxs("p",{className:"text-lg",children:[s.quantity," ",s.unit]})]}),e.jsxs("div",{children:[e.jsx(O,{className:"text-sm font-medium text-gray-500",children:"Valid Until"}),e.jsx("p",{className:"text-lg",children:w(s.validUntil)})]})]})})]}),e.jsxs(I,{children:[e.jsx(W,{children:e.jsx(Y,{className:"text-lg",children:"Parties"})}),e.jsx(R,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(O,{className:"text-sm font-medium text-gray-500",children:"Buyer"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(ve,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:s.buyerName||"Unknown Buyer"})]})]}),e.jsxs("div",{children:[e.jsx(O,{className:"text-sm font-medium text-gray-500",children:"Seller"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(ve,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:s.sellerName||"Unknown Seller"})]})]})]})})]}),e.jsxs(I,{children:[e.jsx(W,{children:e.jsx(Y,{className:"text-lg",children:"Delivery Details"})}),e.jsx(R,{children:e.jsxs("div",{className:"space-y-3",children:[s.deliveryLocation&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-gray-400 mt-1"}),e.jsxs("div",{children:[e.jsx(O,{className:"text-sm font-medium text-gray-500",children:"Location"}),e.jsx("p",{children:s.deliveryLocation})]})]}),s.deliveryTerms&&e.jsxs("div",{children:[e.jsx(O,{className:"text-sm font-medium text-gray-500",children:"Terms"}),e.jsx("p",{className:"mt-1",children:s.deliveryTerms})]}),s.trackingNumber&&e.jsxs("div",{children:[e.jsx(O,{className:"text-sm font-medium text-gray-500",children:"Tracking Number"}),e.jsx("p",{className:"mt-1 font-mono bg-gray-100 px-2 py-1 rounded",children:s.trackingNumber})]})]})})]}),s.notes&&e.jsxs(I,{children:[e.jsx(W,{children:e.jsx(Y,{className:"text-lg",children:"Notes"})}),e.jsx(R,{children:e.jsx("p",{className:"text-gray-700",children:s.notes})})]}),i&&e.jsxs(I,{className:"border-blue-200 bg-blue-50",children:[e.jsx(W,{children:e.jsx(Y,{className:"text-lg",children:"Add Tracking Information"})}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(O,{htmlFor:"tracking",children:"Tracking Number *"}),e.jsx(J,{id:"tracking",value:b,onChange:j=>n(j.target.value),placeholder:"Enter tracking number"})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"address",children:"Delivery Address"}),e.jsx(_e,{id:"address",value:v,onChange:j=>f(j.target.value),placeholder:"Enter delivery address",rows:2})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{onClick:F,children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Mark as Shipped"]}),e.jsx(u,{variant:"outline",onClick:()=>g(!1),children:"Cancel"})]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:S()})]})]})})}const z=Jt(Ve.SUPABASE_URL,Ve.SUPABASE_ANON_KEY),ps=Object.freeze(Object.defineProperty({__proto__:null,supabase:z},Symbol.toStringTag,{value:"Module"}));class Ps{static async createOffer(a){const{data:t,error:r}=await z.from("offers").insert({conversation_id:a.conversationId,product_id:a.productId,buyer_id:a.buyerId,seller_id:a.sellerId,price:a.price,quantity:a.quantity,unit:a.unit,description:a.description,delivery_terms:a.deliveryTerms,delivery_location:a.deliveryLocation,valid_until:a.validUntil,status:a.status,notes:a.notes}).select().single();if(r)throw console.error("❌ Failed to create offer:",r),r;return this.mapOfferFromDB(t)}static async getOffersForConversation(a){const{data:t,error:r}=await z.from("offers").select(`
        *,
        product:products!offers_product_id_fkey(id, name),
        buyer:users!offers_buyer_id_fkey(id, name),
        seller:users!offers_seller_id_fkey(id, name)
      `).eq("conversation_id",a).order("created_at",{ascending:!0});if(r)throw console.error("❌ Failed to fetch offers:",r),r;return t.map(o=>this.mapOfferFromDB(o))}static async getUserOffers(a){const{data:t,error:r}=await z.from("offers").select(`
        *,
        product:products!offers_product_id_fkey(id, name),
        buyer:users!offers_buyer_id_fkey(id, name),
        seller:users!offers_seller_id_fkey(id, name)
      `).or(`buyer_id.eq.${a},seller_id.eq.${a}`).order("created_at",{ascending:!1});if(r)throw console.error("❌ Failed to fetch user offers:",r),r;return t.map(o=>this.mapOfferFromDB(o))}static async deleteOffer(a){const{error:t}=await z.from("offers").delete().eq("id",a);if(t)throw console.error("❌ Failed to delete offer:",t),t}static async updateOfferStatus(a,t,r){const o={status:t,updated_at:new Date().toISOString()};switch(t){case"accepted":o.accepted_at=new Date().toISOString();break;case"shipped":o.shipped_at=new Date().toISOString();break;case"delivered":o.delivered_at=new Date().toISOString();break;case"completed":o.completed_at=new Date().toISOString();break}r&&(r.paymentStatus&&(o.payment_status=r.paymentStatus),r.shippingStatus&&(o.shipping_status=r.shippingStatus),r.trackingNumber&&(o.tracking_number=r.trackingNumber),r.deliveryAddress&&(o.delivery_address=r.deliveryAddress),r.paymentMethod&&(o.payment_method=r.paymentMethod));const{data:i,error:g}=await z.from("offers").update(o).eq("id",a).select().single();if(g)throw console.error("❌ Failed to update offer status:",g),g;return this.mapOfferFromDB(i)}static async getOffersByUser(a,t){let r=z.from("offers").select(`
        *,
        product:products(name),
        buyer:users!offers_buyer_id_fkey(id, name, email),
        seller:users!offers_seller_id_fkey(id, name, email)
      `).or(`buyer_id.eq.${a},seller_id.eq.${a}`).order("created_at",{ascending:!1});t?.status&&(r=r.eq("status",t.status)),t?.role&&(t.role==="buyer"?r=r.eq("buyer_id",a):r=r.eq("seller_id",a));const{data:o,error:i}=await r;if(i)throw console.error("❌ Failed to fetch user offers:",i),i;return o.map(g=>this.mapOfferFromDB(g))}static mapOfferFromDB(a){return console.log("🔍 Mapping offer from DB:",{id:a.id,product:a.product,buyer:a.buyer,seller:a.seller,price:a.price}),{id:a.id,conversationId:a.conversation_id,productId:a.product_id,productName:a.product?.name||"Unknown Product",buyerId:a.buyer_id,buyerName:a.buyer?.name||"Unknown Buyer",sellerId:a.seller_id,sellerName:a.seller?.name||"Unknown Seller",price:parseFloat(a.price),quantity:a.quantity,unit:a.unit,description:a.description,deliveryTerms:a.delivery_terms,deliveryLocation:a.delivery_location,validUntil:a.valid_until,status:a.status,notes:a.notes,paymentStatus:a.payment_status,shippingStatus:a.shipping_status,trackingNumber:a.tracking_number,deliveryAddress:a.delivery_address,paymentMethod:a.payment_method,acceptedAt:a.accepted_at,shippedAt:a.shipped_at,deliveredAt:a.delivered_at,completedAt:a.completed_at,createdAt:a.created_at,updatedAt:a.updated_at}}}const Fr=Object.freeze(Object.defineProperty({__proto__:null,OffersService:Ps},Symbol.toStringTag,{value:"Module"}));function Hs({sellerName:s,sellerType:a,sellerLocation:t,sellerRating:r,productName:o,productId:i,sellerId:g,conversationId:b,onClose:n,sellerVerified:v=!1,currentUserVerified:f=!1,currentUserType:N="buyer",sellerVerificationStatus:m,product:x,currentUser:c}){const y=d.useMemo(()=>c?.id?(console.log("✅ ChatInterface using passed user:",c.email||c.name),c):(console.log("❌ ChatInterface: No user passed from App.tsx"),null),[c?.id]);d.useEffect(()=>{},[c?.id,y?.id]);const{messages:l,sendMessage:p,startConversation:P,loadMessages:w}=ea(),[h,k]=d.useState(""),[C,F]=d.useState(b||null),[S,j]=d.useState(!1),L=d.useRef(null),[q,D]=d.useState(!1),[M,V]=d.useState([]),[oe,me]=d.useState(null),[he,_]=d.useState(!1),T=d.useMemo(()=>C?l[C]||[]:[],[C,l[C||""]?.length]);d.useEffect(()=>{console.log("🔄 Conversation ID changed:",{conversationId:C,hasMessages:T.length>0,timestamp:new Date().toISOString()})},[C,T.length]);const E=d.useMemo(()=>!i||!g||!y?.id?null:`${i}-${g}-${y.id}`,[i,g,y?.id]);d.useEffect(()=>()=>{D(!1),j(!1)},[]),d.useEffect(()=>{if(S){const A=setTimeout(()=>{console.warn("Chat interface stuck in loading state, forcing recovery"),j(!1),ee.warning("Chat recovered from loading state")},1e4);return()=>clearTimeout(A)}},[S]),d.useEffect(()=>{C&&y?.id?(async()=>{try{console.log("📋 Loading offers for conversation:",C);const K=await Ps.getOffersForConversation(C);console.log(`✅ Loaded ${K.length} offers for conversation`),V(K)}catch(K){console.error("❌ Failed to load offers:",K),V([])}})():V([])},[C,y?.id]),d.useEffect(()=>{(async()=>{if(!y||!i||!g){console.log("🔄 Chat initialization skipped - missing dependencies:",{hasUser:!!y,hasProductId:!!i,hasSellerId:!!g});return}if(C){console.log("✅ Chat already initialized:",C);return}try{if(console.log("🚀 Initializing chat:",{productId:i,sellerId:g,currentUserId:y.id,initialConversationId:b}),j(!0),b)console.log("📱 Using existing conversation:",b),F(b),await w(b);else{try{const ze=localStorage.getItem("agriconnect-myanmar-conversations");if(ze){const Ce=JSON.parse(ze).find(te=>(te.buyerId===y.id&&te.sellerId===g||te.sellerId===y.id&&te.buyerId===g)&&te.productId===i);if(Ce){console.log("📱 Found existing conversation in localStorage:",Ce.id),F(Ce.id),await w(Ce.id);return}}}catch(ze){console.warn("Could not check for existing conversations:",ze)}console.log("🆕 Starting new conversation");const K=y.id===g,se=K?g:y.id,Be=K?y.id:g,ke=await P(se,Be,i);console.log("✅ New conversation created:",ke.id),F(ke.id)}}catch(K){console.error("❌ Failed to initialize chat:",K),ee.error("Failed to start conversation")}finally{j(!1)}})()},[y?.id,i,g,b]),d.useEffect(()=>{if(L.current){const A=L.current.querySelector("[data-radix-scroll-area-viewport]");A&&(A.scrollTop=A.scrollHeight)}},[T,M]);const X=async()=>{if(!h.trim()||!C||S||!y){console.log("⚠️ Cannot send message:",{hasMessage:!!h.trim(),hasConversationId:!!C,hasEffectiveUser:!!y,isLoading:S});return}const A=C,K=h.trim();console.log("📤 Sending message:",{conversationId:C,content:K,sender:y.name,userId:y.id}),k("");try{j(!0);const se=await p(A,K);console.log("✅ Message sent successfully:",se),console.log("🔍 Post-send conversation state:",{conversationId:C,messageCount:T.length,isLoading:!1})}catch(se){console.error("❌ Failed to send message:",se),k(K),ee.error("Failed to send message. Please try again.")}finally{j(!1),console.log("🔍 Final conversation check:",{conversationId:A,stillValid:!!A,messageCount:T.length,timestamp:new Date().toISOString()}),setTimeout(()=>{if(L.current){const se=L.current.querySelector("[data-radix-scroll-area-viewport]");se&&(se.scrollTop=se.scrollHeight)}},100)}},Ie=A=>{A.key==="Enter"&&!A.shiftKey&&(A.preventDefault(),X())},H=A=>{if(!A)return"Just now";const K=new Date(A);if(isNaN(K.getTime()))return console.warn("Invalid timestamp:",A),"Just now";const Be=new Date().getTime()-K.getTime(),ke=Math.floor(Be/6e4);if(ke<1)return"Just now";if(ke<60)return`${ke}m ago`;const ze=Math.floor(ke/60);if(ze<24)return`${ze}h ago`;const hs=Math.floor(ze/24);return hs<7?`${hs}d ago`:K.toLocaleDateString()},re=async A=>{console.log("🎯 Creating offer - conversation state before:",{conversationId:C,productId:i,sellerId:g,currentUserId:c?.id,conversationKey:E}),{...A,createdAt:new Date().toISOString()};try{const K=await Ps.createOffer({...A,conversationId:C,productId:i,buyerId:y.id,sellerId:g});console.log("💾 Offer saved to Supabase:",K.id),V(se=>(console.log("📝 Updating offers state - previous count:",se.length),se.find(ke=>ke.id===K.id)?(console.log("⚠️ Duplicate offer detected, skipping"),se):(console.log("✅ Adding new offer to state"),[...se,K]))),D(!1),ee.success("Offer sent successfully!"),console.log("🎯 Offer creation complete - conversation state after:",{conversationId:C,productId:i,sellerId:g,currentUserId:c?.id,conversationKey:E}),setTimeout(()=>{if(L.current){const se=L.current.querySelector("[data-radix-scroll-area-viewport]");se&&(se.scrollTop=se.scrollHeight)}},100)}catch(K){console.error("❌ Failed to save offer:",K),ee.error("Failed to create offer")}},ie=A=>{be(A,"accepted",{acceptedAt:new Date().toISOString()})},we=A=>{be(A,"declined")},es=(A,K)=>{switch(K){case"accept":ie(A);break;case"decline":we(A);break;case"in_progress":be(A,"in_progress");break;case"shipped":be(A,"shipped",{shippedAt:new Date().toISOString()});break;case"delivered":be(A,"delivered",{deliveredAt:new Date().toISOString()});break;case"completed":be(A,"completed",{completedAt:new Date().toISOString()});break;case"cancel":be(A,"cancelled");break;default:console.warn("Unknown quick action:",K)}},Qe=(A,K,se)=>{be(A,K,se)},be=async(A,K,se={})=>{try{await Ps.updateOfferStatus(A,K,se),V(Be=>Be.map(ke=>ke.id===A?{...ke,status:K,...se}:ke)),ee.success(`Offer ${K}!`)}catch(Be){console.error("Failed to update offer:",Be),ee.error("Failed to update offer")}},rs=y&&x&&(y.userType==="buyer"||y.userType==="trader"&&y.id!==g),ue=y?.id===g;return console.log("🔍 ChatInterface Offer Button Debug:",{effectiveCurrentUser:y?.id,product:x?.id,sellerId:g,canCreateOffer:rs,isSeller:ue,currentUserType:y?.userType}),e.jsxs(I,{className:"h-full flex flex-col border-0 rounded-none",children:[e.jsx(W,{className:"flex-shrink-0 pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[s,e.jsx($a,{userType:a,accountType:"individual",size:"sm",className:"mr-1"})]})}),e.jsxs("div",{className:"flex gap-2",children:[rs&&e.jsx(Ya,{children:e.jsxs(Sr,{children:[e.jsx(_r,{asChild:!0,children:e.jsxs(u,{size:"sm",className:"h-9 bg-green-600 hover:bg-green-700",onClick:()=>D(!0),children:[e.jsx(Ge,{className:"w-4 h-4 mr-2"}),"Make Offer"]})}),e.jsx(Tr,{children:e.jsx("p",{children:"Make an offer for this product"})})]})}),e.jsx(u,{variant:"outline",size:"sm",onClick:n,children:e.jsx(Pe,{className:"w-4 h-4"})})]})]})}),e.jsxs(R,{className:"flex-1 flex flex-col p-0 min-h-0",children:[m&&e.jsx("div",{className:`mx-4 mt-3 p-3 rounded-lg border ${m.trustLevel!=="unverified"?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[!m.trustLevel!=="unverified"&&e.jsx(Is,{className:"w-4 h-4 text-yellow-600 mt-0.5"}),m.trustLevel!=="unverified"&&e.jsx(Z,{className:"w-4 h-4 text-green-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[!m.trustLevel!=="unverified"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"Profile Not Confirmed"}),e.jsxs("p",{className:"text-xs text-yellow-700 mt-1",children:[e.jsx("span",{className:"font-medium",children:s})," has not completed profile verification yet. Exercise appropriate caution when sharing personal information."]})]}),m.trustLevel!=="unverified"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm font-medium text-green-800",children:["Verified ",a==="farmer"?"Farmer":a==="trader"?"Trader":"User"]}),e.jsxs("p",{className:"text-xs text-green-700 mt-1",children:[e.jsx("span",{className:"font-medium",children:s})," has completed profile verification and confirmed their identity."]})]})]})]})}),e.jsx(Wa,{ref:L,className:"h-[300px] p-4",children:e.jsx("div",{className:"space-y-4 pb-4",children:S&&T.length===0&&M.length===0?e.jsx("div",{className:"text-center text-muted-foreground py-8",children:e.jsx("div",{className:"animate-pulse",children:"Starting conversation..."})}):T.length===0&&M.length===0?e.jsx("div",{className:"text-center text-muted-foreground py-8",children:e.jsx("p",{children:"No messages yet. Say hello to start the conversation!"})}):e.jsxs(e.Fragment,{children:[T.map(A=>e.jsx("div",{className:`flex ${A.senderId===y?.id?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] p-3 rounded-lg ${A.senderId===y?.id?"bg-primary text-primary-foreground":"bg-muted"}`,children:[e.jsx("p",{className:"text-sm",children:A.content}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx("p",{className:"text-xs opacity-70",children:H(A.timestamp)}),A.senderId===y?.id&&A.status&&e.jsx("span",{className:"text-xs opacity-70 ml-2",children:A.status==="sending"?"⏳":A.status==="sent"?"✓":A.status==="delivered"||A.status==="read"?"✓✓":""})]})]})},A.id)),M.length>0&&e.jsx("div",{className:"space-y-2",children:M.map(A=>e.jsx(Rr,{offer:A,currentUserId:y?.id||"",onViewDetails:K=>{me(K),_(!0)},onQuickAction:es},A.id))})]})})}),!1,e.jsxs("div",{className:"flex-shrink-0 p-4 border-t bg-card",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(J,{placeholder:C?S?"Sending...":"Type your message...":"Initializing...",value:h,onChange:A=>k(A.target.value),onKeyPress:Ie,disabled:S||!C||!y,className:"flex-1",autoComplete:"off",maxLength:1e3}),e.jsx(u,{onClick:X,size:"sm",disabled:S||!C||!h.trim()||!y,className:"shrink-0",children:S?e.jsx("div",{className:"w-4 h-4 animate-spin rounded-full border-2 border-primary border-t-transparent"}):e.jsx(Fa,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[!C&&y&&e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Setting up conversation..."}),!y&&e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Please log in to send messages"}),!1]})]})]}),q&&x&&y&&(console.log("🔍 ChatInterface - Rendering CreateOfferModal with user data:",{currentUserId:y.id,currentUserName:y.name,currentUserEmail:y.email,currentUserType:y.userType,sellerId:g,sellerName:s,productId:x.id,productName:x.name}),e.jsx(Lr,{isOpen:q,onClose:()=>D(!1),product:x,buyerId:y.id,buyerName:y.name,sellerId:g,sellerName:s,onCreateOffer:re})),e.jsx(Mr,{offer:oe,isOpen:he,onClose:()=>{_(!1),me(null)},currentUserId:y?.id||"",onUpdateStatus:Qe})]})}function $e({className:s,orientation:a="horizontal",decorative:t=!0,...r}){return e.jsx(Pt,{"data-slot":"separator-root",decorative:t,orientation:a,className:G("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",s),...r})}class Ks{static async getSellerStats(a){try{console.log("🔍 ReviewsService: Fetching stats for sellerId:",a);const{data:t,error:r}=await z.from("users").select("rating, total_reviews, response_time").eq("id",a).single();if(console.log("📊 ReviewsService: User data:",t,"Error:",r),r)return console.error("Error fetching user data:",r),this.getDefaultStats();const{data:o,error:i}=await z.from("reviews").select(`
          id,
          reviewer_id,
          reviewee_id,
          product_id,
          rating,
          comment,
          created_at,
          reviewer:users!reviews_reviewer_id_fkey(name)
        `).eq("reviewee_id",a).order("created_at",{ascending:!1}).limit(5);i&&console.error("Error fetching reviews:",i);const g=await this.calculateResponseTime(a),b={rating:t.rating||0,totalReviews:t.total_reviews||0,responseTime:g||t.response_time||"Within 24 hours",recentReviews:o?.map(n=>({id:n.id,reviewer_id:n.reviewer_id,reviewee_id:n.reviewee_id,product_id:n.product_id,rating:n.rating,comment:n.comment,created_at:n.created_at,reviewer_name:n.reviewer?.name||"Anonymous"}))||[]};return console.log("✅ ReviewsService: Final result:",b),b}catch(t){return console.error("Error in getSellerStats:",t),this.getDefaultStats()}}static async calculateResponseTime(a){try{const{data:t,error:r}=await z.from("messages").select(`
          created_at,
          sender_id,
          conversation_id
        `).eq("sender_id",a).order("created_at",{ascending:!1}).limit(50);if(r||!t||t.length===0)return"Within 24 hours";const o=[];for(const b of t){const{data:n}=await z.from("messages").select("created_at, sender_id").eq("conversation_id",b.conversation_id).lt("created_at",b.created_at).order("created_at",{ascending:!1}).limit(1).single();if(n&&n.sender_id!==a){const v=new Date(b.created_at).getTime()-new Date(n.created_at).getTime();o.push(v)}}if(o.length===0)return"Within 24 hours";const g=o.reduce((b,n)=>b+n,0)/o.length/(1e3*60*60);return g<1?"Within 1 hour":g<3?"Within 3 hours":g<6?"Within 6 hours":g<12?"Within 12 hours":g<24?"Within 24 hours":"Within 2 days"}catch(t){return console.error("Error calculating response time:",t),"Within 24 hours"}}static getDefaultStats(){return{rating:4,totalReviews:0,responseTime:"Within 24 hours",recentReviews:[]}}static async submitReview(a,t,r,o,i){try{const{error:g}=await z.from("reviews").insert({reviewer_id:a,reviewee_id:t,product_id:r,rating:o,comment:i});return g?(console.error("Error submitting review:",g),!1):(await this.updateUserStats(t),!0)}catch(g){return console.error("Error in submitReview:",g),!1}}static async updateUserStats(a){try{const{data:t,error:r}=await z.from("reviews").select("rating").eq("reviewee_id",a);if(r||!t){console.error("Error fetching reviews for stats update:",r);return}const o=t.length,i=o>0?t.reduce((b,n)=>b+n.rating,0)/o:0,{error:g}=await z.from("users").update({rating:Math.round(i*10)/10,total_reviews:o}).eq("id",a);g&&console.error("Error updating user stats:",g)}catch(t){console.error("Error in updateUserStats:",t)}}}function Er({product:s,onBack:a,onChat:t,onPriceCompare:r,onViewStorefront:o,onEditProduct:i,currentUserId:g,isUserVerified:b=!1,userType:n,isPhoneVerified:v=!1,sellerVerified:f=!1,sellerVerificationStatus:N,sellerProfile:m}){const[x,c]=d.useState(null),[y,l]=d.useState(!0);d.useEffect(()=>{(async()=>{if(s.sellerId){l(!0);try{console.log("🔍 Fetching seller stats for:",s.sellerId);const re=await Ks.getSellerStats(s.sellerId);console.log("📊 Seller stats received:",re),c(re)}catch(re){console.error("❌ Error fetching seller stats:",re)}finally{l(!1)}}})()},[s.sellerId]);const p=H=>new Intl.NumberFormat("en-US").format(H),P={description:s.description||`High-quality ${s.name.toLowerCase()} sourced ${s.sellerType==="farmer"?"directly from our farm":"from trusted farmers"} in ${s.location}. ${s.sellerType==="farmer"?"Grown using sustainable farming practices.":"Carefully selected and stored to ensure freshness."}`,harvestDate:s.sellerType==="farmer"?"January 15, 2024":"January 10-20, 2024",minimumOrder:s.minimumOrder||"10 "+s.unit.split("(")[0].trim()+"s",deliveryOptions:s.deliveryOptions&&s.deliveryOptions.length>0?s.deliveryOptions:["Nationwide Shipping","Express Delivery","Local Delivery (Within 10km)","Pickup","Regional Delivery"],paymentTerms:s.paymentTerms&&s.paymentTerms.length>0?s.paymentTerms.join(", "):"Cash on Pickup, Bank Transfer, 50% Advance, 50% on Delivery, Mobile Payment"},w={rating:x?.rating||m?.rating||4,totalReviews:x?.totalReviews||m?.totalReviews||0,yearsActive:m?.yearsActive||(m?.experience?parseInt(m.experience.split(" ")[0])||1:s.sellerType==="farmer"?5:8),responseTime:x?.responseTime||m?.responseTime||"Within 24 hours"};console.log("🔍 Seller details calculation:",{sellerStats:x,sellerProfile:m,finalDetails:w,loadingStats:y,productSellerId:s.sellerId}),d.useEffect(()=>{console.log("🧪 Testing ReviewsService directly..."),Ks.getSellerStats("test-id").then(H=>{console.log("🧪 ReviewsService test result:",H)}).catch(H=>{console.log("🧪 ReviewsService test error:",H)})},[]);const h=g&&s.sellerId===g,[k,C]=d.useState(0),[F,S]=d.useState(0),j=s.images&&s.images.length>0?s.images:s.image?[s.image]:[],L=5,q=()=>{C(H=>H===0?j.length-1:H-1)},D=()=>{C(H=>H===j.length-1?0:H+1)},M=H=>{C(H),H<F?S(H):H>=F+L&&S(H-L+1)},V=()=>{S(H=>Math.max(0,H-1))},oe=()=>{S(H=>Math.min(j.length-L,H+1))},[me,he]=d.useState(null),[_,T]=d.useState(null),E=H=>{T(null),he(H.targetTouches[0].clientX)},X=H=>{T(H.targetTouches[0].clientX)},Ie=()=>{if(!me||!_)return;const H=me-_,re=H>50,ie=H<-50;j.length>1&&(re&&D(),ie&&q())};return d.useEffect(()=>{k<F?S(k):k>=F+L&&S(Math.max(0,k-L+1))},[k,F,L]),d.useEffect(()=>{const H=re=>{j.length>1&&(re.key==="ArrowLeft"?(re.preventDefault(),q()):re.key==="ArrowRight"&&(re.preventDefault(),D()))};return window.addEventListener("keydown",H),()=>window.removeEventListener("keydown",H)},[j.length]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs(u,{variant:"ghost",onClick:a,className:"h-9 px-3 -ml-3",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold",children:s.name}),e.jsx("p",{className:"text-muted-foreground",children:"Product Details"})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-4 lg:gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-3 lg:space-y-4",children:[e.jsx(I,{className:"border-primary/30",children:e.jsx(R,{className:"p-3 lg:p-4",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 lg:gap-6",children:[e.jsx("div",{children:j.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:j[k],alt:`${s.name} - Image ${k+1}`,className:"w-full h-64 object-cover rounded-lg cursor-pointer select-none",onTouchStart:E,onTouchMove:X,onTouchEnd:Ie,draggable:!1}),j.length>1&&e.jsxs("div",{className:"absolute bottom-3 right-3 bg-black/70 text-white text-xs px-2 py-1 rounded-md",children:[k+1," / ",j.length]})]}),j.length>1&&e.jsx("div",{className:"space-y-2",children:e.jsx("div",{className:"relative",children:e.jsx("div",{className:"flex gap-2 overflow-hidden",children:j.slice(F,F+L).map((H,re)=>{const ie=F+re,we=re===0,es=re===L-1,Qe=F>0,be=F+L<j.length;return e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("img",{src:H,alt:`${s.name} - View ${ie+1}`,className:`w-16 h-16 object-cover rounded border-2 cursor-pointer transition-all ${ie===k?"border-primary ring-2 ring-primary/20":"border-border hover:border-primary"}`,onClick:()=>M(ie)}),we&&Qe&&e.jsx("button",{onClick:V,className:"absolute left-1 top-1/2 -translate-y-1/2 w-5 h-5 bg-white/90 hover:bg-white border border-black/20 rounded-sm shadow-sm flex items-center justify-center transition-all duration-200 z-10",children:e.jsx(Ae,{className:"w-3 h-3 text-gray-700"})}),es&&be&&e.jsx("button",{onClick:oe,className:"absolute right-1 top-1/2 -translate-y-1/2 w-5 h-5 bg-white/90 hover:bg-white border border-black/20 rounded-sm shadow-sm flex items-center justify-center transition-all duration-200 z-10",children:e.jsx(fs,{className:"w-3 h-3 text-gray-700"})})]},ie)})})})})]}):e.jsx("div",{className:"w-full h-64 bg-muted rounded-lg flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No images available"})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:s.price&&s.price>0?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-xl md:text-2xl font-bold",children:[p(s.price)," MMK"]}),e.jsxs("span",{className:"text-muted-foreground",children:["per ",s.unit]})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xl md:text-2xl font-bold",children:"Contact"}),e.jsx("span",{className:"text-muted-foreground",children:"for price"})]})}),s.priceChange!==void 0&&e.jsxs("div",{className:"flex items-center gap-2",children:[s.priceChange>0?e.jsx(Bs,{className:"w-4 h-4 text-green-600"}):e.jsx(Ls,{className:"w-4 h-4 text-red-600"}),e.jsxs("span",{className:`text-sm ${s.priceChange>0?"text-green-600":"text-red-600"}`,children:[s.priceChange>0?"+":"",s.priceChange,"% from last week"]})]})]}),e.jsx($e,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["Available: ",s.quantity]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:s.location})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(us,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["Updated ",ts(s.lastUpdated)]})]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-2",children:h?e.jsxs(e.Fragment,{children:[i&&e.jsxs(u,{onClick:()=>i(s),className:"flex-1 h-9 text-sm",children:[e.jsx(le,{className:"w-3 h-3 mr-1"}),"Edit Product"]}),e.jsxs(u,{variant:"outline",onClick:()=>r(s.id),className:"flex-1 h-9 text-sm",children:[e.jsx(Rs,{className:"w-3 h-3 mr-1"}),"See Market Prices"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(u,{onClick:()=>t(s.id),className:"flex-1 h-9 text-sm",children:[e.jsx(bs,{className:"w-3 h-3 mr-1"}),"Contact Seller"]}),e.jsxs(u,{variant:"outline",onClick:()=>r(s.id),className:"flex-1 h-9 text-sm",children:[e.jsx(Rs,{className:"w-3 h-3 mr-1"}),"Compare Prices"]})]})})]})]})})}),P.description&&e.jsxs(I,{className:"border-primary/30",children:[e.jsx(W,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5"}),"Product Description"]})}),e.jsx(R,{children:e.jsx("p",{className:"text-foreground leading-relaxed",children:P.description})})]}),e.jsxs(I,{className:"border-primary/30",children:[e.jsx(W,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5"}),"Order & Delivery Information"]})}),e.jsxs(R,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[s.availableQuantity&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-muted-foreground"}),"Available Stock"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.availableQuantity})]}),s.minimumOrder&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-muted-foreground"}),"Minimum Order"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.minimumOrder})]})]}),s.paymentTerms&&s.paymentTerms.length>0&&e.jsxs(e.Fragment,{children:[e.jsx($e,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(Xs,{className:"w-4 h-4 text-muted-foreground"}),"Payment Terms"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.paymentTerms.map((H,re)=>e.jsx($,{variant:"secondary",className:"text-xs",children:H},re))})]})]}),s.deliveryOptions&&s.deliveryOptions.length>0&&e.jsxs(e.Fragment,{children:[e.jsx($e,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4 text-muted-foreground"}),"Delivery Options"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.deliveryOptions.map((H,re)=>e.jsx($,{variant:"outline",className:"text-xs",children:H},re))})]})]}),s.additionalNotes&&e.jsxs(e.Fragment,{children:[e.jsx($e,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(Ea,{className:"w-4 h-4 text-muted-foreground"}),"Additional Information"]}),e.jsx("div",{className:"p-3 bg-muted/30 rounded-md border border-dashed border-muted-foreground/20",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Me,{className:"w-4 h-4 mt-0.5 text-muted-foreground flex-shrink-0"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.additionalNotes})]})})]})]}),!s.availableQuantity&&!s.minimumOrder&&(!s.paymentTerms||s.paymentTerms.length===0)&&(!s.deliveryOptions||s.deliveryOptions.length===0)&&!s.additionalNotes&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ne,{className:"w-8 h-8 mx-auto mb-2 text-muted-foreground/50"}),e.jsx("p",{children:"Contact seller for detailed order information"}),e.jsx("p",{className:"text-sm",children:"Payment terms and delivery options available upon inquiry"})]})]})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(I,{className:"border-primary/30",children:[e.jsx(W,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5"}),"Seller Information"]})}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ye,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("button",{className:"font-medium text-primary hover:underline",onClick:()=>o(s.sellerId),children:s.sellerName})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(xs,{userType:s.sellerType,accountType:N?.accountType||"individual",verificationLevel:N?N.trustLevel:"unverified",size:"sm"})})]}),e.jsx($e,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:s.location})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{className:"text-sm",children:y?"Loading...":`${w.rating.toFixed(1)} (${w.totalReviews} review${w.totalReviews!==1?"s":""})`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:y?"Loading...":`Usually responds within ${w.responseTime}`})]})]}),e.jsx($e,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Contact Information"}),m?.phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:m.phone})]}),m?.openingHours&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:"Business Hours"}),e.jsx("div",{className:"text-muted-foreground",children:m.openingHours})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[m?.email&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(bs,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:m.email})]}),!h&&e.jsxs(u,{onClick:()=>o(s.sellerId),variant:"outline",size:"sm",className:"w-full",children:[e.jsx(Ye,{className:"w-4 h-4 mr-2"}),"View Full Storefront"]})]})]})]})})]})]})}function qr({seller:s,products:a,onBack:t,onViewProduct:r,onChat:o,isOwnStorefront:i=!1,onEditStorefrontImage:g,onUpdateStorefront:b,previewMode:n=!1,onTogglePreviewMode:v}){const[f,N]=d.useState(null),[m,x]=d.useState(null),[c,y]=d.useState(!0),[l,p]=d.useState(()=>({description:s.description||"",businessHours:s.businessHours||"9 AM - 6 PM, Mon-Sat",phone:s.phone||"",email:s.email||"",website:s.website||"",facebook:s.facebook||"",instagram:s.instagram||"",whatsapp:s.whatsapp||"",tiktok:s.tiktok||"",specialties:s.specialties||[],policies:s.policies||{returns:"",delivery:"",payment:""}}));d.useEffect(()=>{(async()=>{if(s.id){y(!0);try{console.log("🔍 SellerStorefront: Fetching stats for sellerId:",s.id);const L=await Ks.getSellerStats(s.id);console.log("📊 SellerStorefront: Seller stats received:",L),x(L)}catch(L){console.error("❌ SellerStorefront: Error fetching seller stats:",L)}finally{y(!1)}}})()},[s.id]),d.useEffect(()=>{const j={description:s.description||"",businessHours:s.businessHours||"9 AM - 6 PM, Mon-Sat",phone:s.phone||"",email:s.email||"",website:s.website||"",facebook:s.facebook||"",instagram:s.instagram||"",whatsapp:s.whatsapp||"",specialties:s.specialties||[],policies:s.policies||{returns:"",delivery:"",payment:""}};p(j)},[s]);const P=(j,L)=>{N({field:j,value:L})},w=()=>{N(null)},h=async(j,L)=>{try{const q={[j]:L};p(D=>({...D,[j]:L})),N(null),b&&await b(q)}catch(q){console.error("Failed to save:",q),p(D=>({...D,[j]:l[j]}))}},k=j=>{if(!j.trim()||l.specialties.includes(j.trim()))return;const L=[...l.specialties,j.trim()];p(q=>({...q,specialties:L})),N(null),b&&b({specialties:L})},C=j=>{const L=l.specialties.filter(q=>q!==j);p(q=>({...q,specialties:L})),b&&b({specialties:L})};if(!s||!s.name)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(u,{variant:"outline",size:"sm",onClick:t,children:e.jsx(Ae,{className:"w-4 h-4"})})}),e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Seller information not available."})})]});const F=j=>new Intl.NumberFormat("en-US").format(j),S=a.length;return a.length>0&&Math.round(a.reduce((j,L)=>j+L.price,0)/a.length),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Ae,{className:"w-5 h-5 cursor-pointer text-muted-foreground hover:text-foreground transition-colors",onClick:t}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:s.name}),e.jsxs("p",{className:"text-muted-foreground",children:[s.type==="farmer"?"Farm":"Trading"," Storefront"]})]})]}),i&&v&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Preview Mode"}),e.jsx("button",{onClick:()=>v(!n),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 ${n?"bg-primary":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${n?"translate-x-6":"translate-x-1"}`})})]}),n&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-primary/10 border border-primary/30 rounded-lg",children:[e.jsx(ye,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-primary",children:"Customer View"})]})]})]}),i&&n&&e.jsx("div",{className:"bg-primary/10 border border-primary/30 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-primary",children:"Customer Preview Mode"}),e.jsx("p",{className:"text-sm text-primary/80",children:"This is exactly how customers see your storefront. Toggle off to return to editing mode."})]})]})}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[e.jsx(I,{className:"border-primary/30",children:e.jsx(R,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:s.image,alt:s.name,className:"w-full h-48 object-cover rounded-lg"}),i&&!n&&g&&e.jsxs(u,{size:"sm",variant:"secondary",className:"absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity bg-white/90 hover:bg-white shadow-md",onClick:g,children:[e.jsx(Ns,{className:"w-4 h-4 mr-1"}),"Edit Photo"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-semibold",children:s.name}),e.jsx(Oa,{verificationLevel:Ke(s),size:"sm"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(de,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s.location})]}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:e.jsx(xs,{userType:s.type,accountType:ms(s),verificationLevel:Ke(s),size:"sm"})})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("div",{className:"flex items-center",children:c?e.jsx("span",{className:"text-sm text-muted-foreground",children:"Loading..."}):e.jsxs(e.Fragment,{children:[[...Array(5)].map((j,L)=>e.jsx(He,{className:`w-4 h-4 ${L<Math.floor(m?.rating||0)?"text-yellow-400 fill-current":"text-gray-300"}`},L)),e.jsx("span",{className:"text-sm font-medium ml-2",children:m?.rating?m.rating.toFixed(1):"0.0"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",m?.totalReviews||0," ",m?.totalReviews===1?"review":"reviews",")"]})]})})}),e.jsx($e,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Business Hours"})]}),i&&!n&&e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>P("businessHours",l.businessHours),className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",children:e.jsx(le,{className:"w-4 h-4"})})]}),f?.field==="businessHours"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{value:f.value,onChange:j=>N({...f,value:j.target.value}),placeholder:"e.g., 9 AM - 6 PM, Mon-Sat",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{size:"sm",onClick:()=>h("businessHours",f.value),children:[e.jsx(Se,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsx(u,{size:"sm",variant:"outline",onClick:w,children:"Cancel"})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:l.businessHours})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(us,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["Joined ",zs(s.joinedDate)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["Response time: ",c?"Loading...":m?.responseTime||"Within 24 hours"]})]})]})]})})}),(!n||l.phone||l.email||l.website)&&e.jsxs(I,{className:"border-primary/30",children:[e.jsx(W,{children:e.jsxs(Y,{className:"text-lg flex items-center gap-2",children:[e.jsx(qe,{className:"w-5 h-5"}),"Contact Information"]})}),e.jsxs(R,{className:"space-y-4",children:[(!n||l.phone)&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Phone"})]}),i&&!n&&e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>P("phone",l.phone),className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",children:e.jsx(le,{className:"w-4 h-4"})})]}),f?.field==="phone"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{value:f.value,onChange:j=>N({...f,value:j.target.value}),placeholder:"+95 9 xxx xxx xxx",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{size:"sm",onClick:()=>h("phone",f.value),children:[e.jsx(Se,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsx(u,{size:"sm",variant:"outline",onClick:w,children:"Cancel"})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:l.phone||(i&&!n?"Add phone number":null)})]}),(!n||l.email)&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ds,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Email"})]}),i&&!n&&e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>P("email",l.email),className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",children:e.jsx(le,{className:"w-4 h-4"})})]}),f?.field==="email"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{value:f.value,onChange:j=>N({...f,value:j.target.value}),placeholder:"business@example.com",type:"email",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{size:"sm",onClick:()=>h("email",f.value),children:[e.jsx(Se,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsx(u,{size:"sm",variant:"outline",onClick:w,children:"Cancel"})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:l.email||(i&&!n?"Add email address":null)})]}),(l.website||i&&!n)&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Gt,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Website"})]}),i&&!n&&e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>P("website",l.website),className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",children:e.jsx(le,{className:"w-4 h-4"})})]}),f?.field==="website"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{value:f.value,onChange:j=>N({...f,value:j.target.value}),placeholder:"https://example.com",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{size:"sm",onClick:()=>h("website",f.value),children:[e.jsx(Se,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsx(u,{size:"sm",variant:"outline",onClick:w,children:"Cancel"})]})]}):l.website?e.jsx("a",{href:l.website,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline",children:l.website}):i&&!n&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add website URL"})]}),(l.facebook||l.instagram||l.whatsapp||l.tiktok||i&&!n)&&e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"my-4"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(qa,{className:"w-4 h-4"}),"Social Media & Online Presence"]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[(l.facebook||i&&!n)&&e.jsx(e.Fragment,{children:f?.field==="facebook"?e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(J,{value:f.value,onChange:j=>N({...f,value:j.target.value}),placeholder:"facebook.com/yourpage",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{size:"sm",onClick:()=>h("facebook",f.value),children:[e.jsx(Se,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsx(u,{size:"sm",variant:"outline",onClick:w,children:"Cancel"})]})]}):l.facebook?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("a",{href:l.facebook.startsWith("http")?l.facebook:`https://facebook.com/${l.facebook.replace("facebook.com/","").replace("@","")}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center w-10 h-10 rounded-full bg-blue-50 hover:bg-blue-100 transition-colors group",children:e.jsx(ia,{className:"w-5 h-5 text-blue-600 group-hover:text-blue-700"})}),i&&!n&&e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>P("facebook",l.facebook),className:"h-6 w-6 p-0 opacity-60 hover:opacity-100",children:e.jsx(le,{className:"w-3 h-3"})})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-blue-50 border border-blue-200",children:e.jsx(ia,{className:"w-5 h-5 text-blue-600"})}),i&&!n&&e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>P("facebook",l.facebook||""),className:"h-6 w-6 p-0 opacity-60 hover:opacity-100",children:e.jsx(le,{className:"w-3 h-3"})})]})}),(l.instagram||i&&!n)&&e.jsx(e.Fragment,{children:f?.field==="instagram"?e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(J,{value:f.value,onChange:j=>N({...f,value:j.target.value}),placeholder:"instagram.com/yourprofile",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{size:"sm",onClick:()=>h("instagram",f.value),children:[e.jsx(Se,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsx(u,{size:"sm",variant:"outline",onClick:w,children:"Cancel"})]})]}):l.instagram?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("a",{href:l.instagram.startsWith("http")?l.instagram:`https://instagram.com/${l.instagram.replace("instagram.com/","").replace("@","")}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center w-10 h-10 rounded-full bg-pink-50 hover:bg-pink-100 transition-colors group",children:e.jsx(na,{className:"w-5 h-5 text-pink-600 group-hover:text-pink-700"})}),i&&!n&&e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>P("instagram",l.instagram),className:"h-6 w-6 p-0 opacity-60 hover:opacity-100",children:e.jsx(le,{className:"w-3 h-3"})})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-pink-50 border border-pink-200",children:e.jsx(na,{className:"w-5 h-5 text-pink-600"})}),i&&!n&&e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>P("instagram",l.instagram||""),className:"h-6 w-6 p-0 opacity-60 hover:opacity-100",children:e.jsx(le,{className:"w-3 h-3"})})]})}),(l.whatsapp||i&&!n)&&e.jsx(e.Fragment,{children:f?.field==="whatsapp"?e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(J,{value:f.value,onChange:j=>N({...f,value:j.target.value}),placeholder:"+1234567890 or wa.me/1234567890",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{size:"sm",onClick:()=>h("whatsapp",f.value),children:[e.jsx(Se,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsx(u,{size:"sm",variant:"outline",onClick:w,children:"Cancel"})]})]}):l.whatsapp?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("a",{href:l.whatsapp.startsWith("http")?l.whatsapp:`https://wa.me/${l.whatsapp.replace("+","").replace("whatsapp.com/","").replace("wa.me/","")}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center w-10 h-10 rounded-full bg-green-50 hover:bg-green-100 transition-colors group",children:e.jsx(Ne,{className:"w-5 h-5 text-green-600 group-hover:text-green-700"})}),i&&!n&&e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>P("whatsapp",l.whatsapp),className:"h-6 w-6 p-0 opacity-60 hover:opacity-100",children:e.jsx(le,{className:"w-3 h-3"})})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-green-50 border border-green-200",children:e.jsx(Ne,{className:"w-5 h-5 text-green-600"})}),i&&!n&&e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>P("whatsapp",l.whatsapp||""),className:"h-6 w-6 p-0 opacity-60 hover:opacity-100",children:e.jsx(le,{className:"w-3 h-3"})})]})}),(l.tiktok||i&&!n)&&e.jsx(e.Fragment,{children:f?.field==="tiktok"?e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(J,{value:f.value,onChange:j=>N({...f,value:j.target.value}),placeholder:"Enter TikTok username or URL",className:"text-sm"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{size:"sm",onClick:()=>h("tiktok"),children:[e.jsx(Se,{className:"w-3 h-3 mr-1"}),"Save"]}),e.jsx(u,{size:"sm",variant:"outline",onClick:w,children:"Cancel"})]})]}):l.tiktok?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("a",{href:l.tiktok.startsWith("http")?l.tiktok:`https://tiktok.com/@${l.tiktok.replace("@","").replace("tiktok.com/","")}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center w-10 h-10 rounded-full bg-black hover:bg-gray-800 transition-colors group",children:e.jsx(la,{className:"w-5 h-5 text-white group-hover:text-gray-200"})}),i&&!n&&e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>P("tiktok",l.tiktok),className:"h-6 w-6 p-0 opacity-60 hover:opacity-100",children:e.jsx(le,{className:"w-3 h-3"})})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-black border border-gray-300",children:e.jsx(la,{className:"w-5 h-5 text-white"})}),i&&!n&&e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>P("tiktok",l.tiktok||""),className:"h-6 w-6 p-0 opacity-60 hover:opacity-100",children:e.jsx(le,{className:"w-3 h-3"})})]})})]})]})]}),i&&!n&&!l.phone&&!l.email&&!l.website&&!l.facebook&&!l.instagram&&!l.whatsapp&&!l.tiktok&&e.jsxs("div",{className:"text-center py-4 text-sm text-muted-foreground bg-muted/30 rounded-lg",children:[e.jsx(qe,{className:"w-8 h-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"font-medium",children:"Add contact information"}),e.jsx("p",{children:"Help customers reach you easily"})]})]})]}),(s.certifications.length>0||l.specialties.length>0||i&&!n)&&e.jsxs(I,{className:"border-primary/30",children:[e.jsx(W,{children:e.jsxs(Y,{className:"text-lg flex items-center gap-2",children:[e.jsx(as,{className:"w-5 h-5"}),"Certifications & Specialties"]})}),e.jsxs(R,{className:"space-y-4",children:[s.certifications.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Certifications"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.certifications.map((j,L)=>e.jsxs($,{variant:"outline",className:"text-xs",children:[e.jsx(Z,{className:"w-3 h-3 mr-1 text-green-600"}),j]},L))})]}),(l.specialties.length>0||i&&!n)&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Specialties"}),i&&!n&&e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>P("specialties",""),className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",title:"Add specialty",children:e.jsx(cs,{className:"w-4 h-4"})})]}),f?.field==="specialties"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{value:f.value,onChange:j=>N({...f,value:j.target.value}),placeholder:"e.g., Organic Vegetables, Rice Varieties",autoFocus:!0,onKeyDown:j=>{j.key==="Enter"&&k(f.value),j.key==="Escape"&&w()}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{size:"sm",onClick:()=>k(f.value),disabled:!f.value.trim(),children:[e.jsx(Se,{className:"w-4 h-4 mr-1"}),"Add"]}),e.jsx(u,{size:"sm",variant:"outline",onClick:w,children:"Cancel"})]})]}):e.jsx("div",{className:"flex flex-wrap gap-2 min-h-[2rem] items-center",children:l.specialties.length>0?l.specialties.map((j,L)=>e.jsxs($,{variant:"secondary",className:"text-xs flex items-center gap-1",children:[j,i&&!n&&e.jsx("button",{onClick:()=>C(j),className:"hover:text-destructive transition-colors",title:"Remove specialty",children:e.jsx(Pe,{className:"w-3 h-3"})})]},L)):i&&!n&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add your specialties"})})]}),i&&!n&&s.certifications.length===0&&l.specialties.length===0&&e.jsxs("div",{className:"text-center py-4 text-sm text-muted-foreground bg-muted/30 rounded-lg",children:[e.jsx(as,{className:"w-8 h-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"font-medium",children:"Showcase your expertise"}),e.jsx("p",{children:"Add certifications and specialties to build customer trust"})]})]})]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(I,{className:"border-primary/30",children:[e.jsx(W,{children:e.jsxs(Y,{className:"flex items-center justify-between",children:["About ",s.name,i&&!n&&e.jsxs(u,{size:"sm",variant:"ghost",onClick:()=>P("description",l.description),className:"opacity-60 hover:opacity-100",children:[e.jsx(le,{className:"w-4 h-4 mr-1"}),"Edit Description"]})]})}),e.jsx(R,{children:f?.field==="description"?e.jsxs("div",{className:"space-y-3",children:[e.jsx(_e,{value:f.value,onChange:j=>N({...f,value:j.target.value}),placeholder:"Tell customers about your business, experience, farming methods, quality standards, and what makes you unique...",rows:6,autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{onClick:()=>h("description",f.value),children:[e.jsx(Se,{className:"w-4 h-4 mr-1"}),"Save Description"]}),e.jsx(u,{variant:"outline",onClick:w,children:"Cancel"})]})]}):e.jsx("div",{className:"space-y-4",children:e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:l.description||(i&&!n?'Tell customers about your business. Click "Edit Description" to add information about your farming experience, quality standards, and what makes your products special.':"No description available.")})})})]}),(l.policies.delivery||l.policies.payment||l.policies.returns||i&&!n)&&e.jsxs(I,{className:"border-primary/30",children:[e.jsx(W,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(os,{className:"w-5 h-5"}),"Business Policies"]})}),e.jsxs(R,{className:"space-y-4",children:[(l.policies.delivery||i&&!n)&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:"Delivery & Shipping"}),i&&!n&&e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>P("delivery",l.policies.delivery),className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",children:e.jsx(le,{className:"w-4 h-4"})})]}),f?.field==="delivery"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(_e,{value:f.value,onChange:j=>N({...f,value:j.target.value}),placeholder:"Describe your delivery options, areas covered, delivery times, and shipping costs...",rows:3,autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{size:"sm",onClick:()=>{p(j=>({...j,policies:{...j.policies,delivery:f.value}})),h("policies",{...l.policies,delivery:f.value})},children:[e.jsx(Se,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsx(u,{size:"sm",variant:"outline",onClick:w,children:"Cancel"})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:l.policies.delivery||i&&!n&&"Add your delivery and shipping information"})]}),(l.policies.payment||i&&!n)&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:"Payment Methods"}),i&&!n&&e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>P("payment",l.policies.payment),className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",children:e.jsx(le,{className:"w-4 h-4"})})]}),f?.field==="payment"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(_e,{value:f.value,onChange:j=>N({...f,value:j.target.value}),placeholder:"List accepted payment methods: Cash on delivery, bank transfer, mobile payments, etc...",rows:3,autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{size:"sm",onClick:()=>{p(j=>({...j,policies:{...j.policies,payment:f.value}})),h("policies",{...l.policies,payment:f.value})},children:[e.jsx(Se,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsx(u,{size:"sm",variant:"outline",onClick:w,children:"Cancel"})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:l.policies.payment||i&&!n&&"Add your accepted payment methods"})]}),(l.policies.returns||i&&!n)&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:"Returns & Quality Guarantee"}),i&&!n&&e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>P("returns",l.policies.returns),className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",children:e.jsx(le,{className:"w-4 h-4"})})]}),f?.field==="returns"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(_e,{value:f.value,onChange:j=>N({...f,value:j.target.value}),placeholder:"Describe your quality guarantee, return policy, and how you handle customer concerns...",rows:3,autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{size:"sm",onClick:()=>{p(j=>({...j,policies:{...j.policies,returns:f.value}})),h("policies",{...l.policies,returns:f.value})},children:[e.jsx(Se,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsx(u,{size:"sm",variant:"outline",onClick:w,children:"Cancel"})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:l.policies.returns||i&&!n&&"Add your quality guarantee and return policy"})]}),i&&!n&&!l.policies.delivery&&!l.policies.payment&&!l.policies.returns&&e.jsxs("div",{className:"text-center py-4 text-sm text-muted-foreground bg-muted/30 rounded-lg",children:[e.jsx(os,{className:"w-8 h-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"font-medium",children:"Build customer trust"}),e.jsx("p",{children:"Add your business policies to help customers understand your services"})]})]})]}),e.jsxs(I,{className:"border-primary/30",children:[e.jsx(W,{children:e.jsxs(Y,{children:["Products (",S," ",S===1?"item":"items",")"]})}),e.jsx(R,{children:a.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ne,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:i?"You haven't listed any products yet. Go to your Dashboard to add and manage products.":"No products available at the moment."})]}):e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:a.map(j=>e.jsx(I,{className:"hover:shadow-md transition-shadow border-primary/30",children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("img",{src:j.image,alt:j.name,className:"w-20 h-20 object-cover rounded-lg"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:j.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-lg font-semibold",children:[F(j.price)," MMK"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["per ",j.unit]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(ne,{className:"w-3 h-3"}),e.jsx("span",{children:j.quantity})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[j.priceChange>0?e.jsx(Bs,{className:"w-3 h-3 text-green-600"}):e.jsx(Ls,{className:"w-3 h-3 text-red-600"}),e.jsxs("span",{className:`text-xs ${j.priceChange>0?"text-green-600":"text-red-600"}`,children:[j.priceChange>0?"+":"",j.priceChange,"%"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["• ",ts(j.lastUpdated)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{size:"sm",className:`h-9 px-3 py-2 ${i?"w-full":"flex-1"}`,onClick:()=>r(j.id),children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"View Details"]}),!i&&e.jsxs(u,{size:"sm",variant:"outline",className:"flex-1 h-9 px-3 py-2",onClick:()=>o(j.id),children:[e.jsx(bs,{className:"w-4 h-4 mr-2"}),"Chat"]})]})]})]})})},j.id))})})]})]})]})]})}const Br=Gs("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function Le({className:s,variant:a,...t}){return e.jsx("div",{"data-slot":"alert",role:"alert",className:G(Br({variant:a}),s),...t})}function Re({className:s,...a}){return e.jsx("div",{"data-slot":"alert-description",className:G("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",s),...a})}function zr({onLogin:s,onSwitchToRegister:a,onForgotPassword:t,onClose:r}){const[o,i]=d.useState({email:"",password:""}),[g,b]=d.useState(!1),[n,v]=d.useState(""),[f,N]=d.useState(!1),m=async x=>{x.preventDefault(),v(""),N(!0);try{await s(o.email,o.password),r()}catch(c){console.error("Login failed:",c),v(c.message||"Login failed. Please try again.")}finally{N(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("h1",{className:"text-2xl font-semibold flex items-center justify-center gap-2 mb-2",children:[e.jsx(Oe,{className:"w-6 h-6 text-primary"}),"Welcome Back"]}),e.jsx("p",{className:"text-muted-foreground",children:"Sign in to your AgriLink account"})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs(I,{className:"w-full max-w-md",children:[e.jsxs(W,{className:"space-y-1",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("div",{className:"w-12 h-12 bg-primary rounded-lg flex items-center justify-center",children:e.jsx(Oe,{className:"w-6 h-6 text-primary-foreground"})})}),e.jsx(Y,{className:"text-2xl text-center",children:"Sign In"}),e.jsx(De,{className:"text-center",children:"Access your agricultural marketplace account"})]}),e.jsxs(R,{className:"space-y-4",children:[n&&e.jsx(Le,{variant:"destructive",children:e.jsx(Re,{children:n})}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"email",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(ds,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(J,{id:"email",type:"email",placeholder:"Enter your email",value:o.email,onChange:x=>i(c=>({...c,email:x.target.value})),className:"pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ys,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(J,{id:"password",type:g?"text":"password",placeholder:"Enter your password",value:o.password,onChange:x=>i(c=>({...c,password:x.target.value})),className:"pl-10 pr-10",required:!0}),e.jsx("button",{type:"button",onClick:()=>b(!g),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground",children:g?e.jsx(ws,{className:"w-4 h-4"}):e.jsx(ye,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"text-left mb-2",children:e.jsx("button",{type:"button",onClick:t,className:"text-sm text-muted-foreground hover:text-primary hover:underline",children:"Forgot your password?"})})]}),e.jsx(u,{type:"submit",className:"w-full mt-6",disabled:f,children:f?"Signing In...":"Sign In"})]})]}),e.jsx(Ua,{className:"flex flex-col space-y-4 pt-0",children:e.jsxs("div",{className:"text-sm text-center text-muted-foreground",children:["Don't have an account?"," ",e.jsx("button",{onClick:a,className:"text-primary hover:underline font-medium",children:"Register here"})]})})]})})]})}function Vr({selectedType:s,onTypeSelect:a,onBack:t,userType:r}){const o=[{id:"farmer",name:"Farmer",icon:Oe,description:"Sell your agricultural products directly to buyers",features:["List products","Direct sales","Price setting","Customer management"],color:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200"},{id:"trader",name:"Trader",icon:Je,description:"Distribute agricultural products to retailers and businesses",features:["Bulk trading","Supply chain","Wholesale pricing","Business partnerships"],color:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200"},{id:"buyer",name:"Buyer",icon:Qs,description:"Purchase agricultural products for your business or personal use",features:["Browse products","Price comparison","Direct contact","Order tracking"],color:"text-purple-600",bgColor:"bg-purple-50",borderColor:"border-purple-200"}];return e.jsxs("div",{className:"space-y-4",children:[t&&e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(u,{variant:"ghost",size:"sm",onClick:t,children:[e.jsx(Qt,{className:"w-4 h-4 mr-2"}),"Back"]})}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Choose Your Account Type"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select the type that best describes your role in the agricultural marketplace"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:o.map(i=>{const g=i.icon,b=s===i.id;return e.jsxs(I,{className:`cursor-pointer transition-all duration-200 hover:shadow-md ${b?`${i.borderColor} border-2 shadow-md`:"border hover:border-gray-300"}`,onClick:()=>a?.(i.id),children:[e.jsx(W,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${i.bgColor}`,children:e.jsx(g,{className:`w-5 h-5 ${i.color}`})}),e.jsxs("div",{children:[e.jsx(Y,{className:"text-base",children:i.name}),b&&e.jsx($,{variant:"secondary",className:"mt-1",children:"Selected"})]})]})}),e.jsxs(R,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:i.description}),e.jsx("div",{className:"space-y-1",children:i.features.map((n,v)=>e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-muted-foreground",children:[e.jsx(ae,{className:"w-3 h-3"}),e.jsx("span",{children:n})]},v))})]})]},i.id)})}),e.jsx("div",{className:"bg-muted/50 rounded-lg p-4 text-center",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Note:"})," You can change your account type later in your profile settings. Different account types have different features and capabilities."]})})]})}function pa({onRegister:s,onSwitchToLogin:a,onClose:t}){const[r,o]=d.useState({name:"",email:"",password:"",confirmPassword:"",phone:"",userType:"",accountType:"",region:"",location:""}),[i,g]=d.useState(!1),[b,n]=d.useState(!1),[v,f]=d.useState(""),[N,m]=d.useState(!1),[x,c]=d.useState(!1);if(x)return e.jsx("div",{className:"absolute inset-0 bg-background",children:e.jsx(Vr,{onBack:()=>c(!1),userType:r.userType})});const y=()=>r.region?Fe[r.region]?.cities||[]:[],l=[{value:"farmer",label:"Farmer",description:"I grow and produce fresh agricultural products to sell",color:"bg-green-100 text-green-800 border-green-200"},{value:"trader",label:"Trader",description:"I connect farmers with buyers through distribution and trading",color:"bg-primary/10 text-primary border-primary/20"},{value:"buyer",label:"Buyer",description:"I purchase agricultural products for my business or personal consumption",color:"bg-purple-100 text-purple-800 border-purple-200"}],p=()=>!r.name||!r.email||!r.password?(f("Please fill in all required fields in the Personal Information section"),!1):r.password!==r.confirmPassword?(f("Passwords do not match"),!1):r.password.length<6?(f("Password must be at least 6 characters long"),!1):r.email.includes("@")?!r.userType||!r.accountType||!r.region||!r.location?(f("Please select your user role, account type, region, and city"),!1):!0:(f("Please enter a valid email address"),!1),P=async k=>{if(k.preventDefault(),f(""),!!p()&&!N){m(!0);try{const C={email:r.email,password:r.password,name:r.name,userType:r.userType,accountType:r.accountType,location:r.location,region:r.region,phone:r.phone,businessName:"",businessDescription:"",experience:"1 year",qualityCertifications:[],farmingMethods:r.userType==="farmer"?["Traditional"]:[]};await s(C)}catch(C){f(C.message||"Registration failed. Please try again.")}finally{m(!1)}}},w=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"name",children:"Full Name *"}),e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(J,{id:"name",placeholder:"Enter your full name",value:r.name,onChange:k=>o(C=>({...C,name:k.target.value})),className:"pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"email",children:"Email Address *"}),e.jsxs("div",{className:"relative",children:[e.jsx(ds,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(J,{id:"email",type:"email",placeholder:"Enter your email",value:r.email,onChange:k=>o(C=>({...C,email:k.target.value})),className:"pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"phone",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(J,{id:"phone",placeholder:"+95 9 123 456 789",value:r.phone,onChange:k=>o(C=>({...C,phone:k.target.value})),className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"password",children:"Password *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ys,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(J,{id:"password",type:i?"text":"password",placeholder:"Create a password (min. 6 characters)",value:r.password,onChange:k=>o(C=>({...C,password:k.target.value})),className:"pl-10 pr-10",required:!0}),e.jsx("button",{type:"button",onClick:()=>g(!i),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground",children:i?e.jsx(ws,{className:"w-4 h-4"}):e.jsx(ye,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"confirmPassword",children:"Confirm Password *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ys,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(J,{id:"confirmPassword",type:b?"text":"password",placeholder:"Confirm your password",value:r.confirmPassword,onChange:k=>o(C=>({...C,confirmPassword:k.target.value})),className:"pl-10 pr-10",required:!0}),e.jsx("button",{type:"button",onClick:()=>n(!b),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground",children:b?e.jsx(ws,{className:"w-4 h-4"}):e.jsx(ye,{className:"w-4 h-4"})})]})]})]}),h=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(O,{children:"Your Role *"}),e.jsx("div",{className:"space-y-2",children:l.map(k=>e.jsx("div",{onClick:()=>o(C=>({...C,userType:k.value})),className:`p-4 rounded-lg border cursor-pointer transition-all ${r.userType===k.value?"border-primary/80 bg-primary/8":"border-primary/50 hover:border-primary/70"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-medium",children:k.label})}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:k.description})]}),e.jsx("div",{className:`w-4 h-4 rounded-full border-2 ${r.userType===k.value?"border-primary bg-primary":"border-primary/50"}`})]})},k.value))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(O,{children:"Account Type *"}),e.jsxs(u,{variant:"ghost",size:"sm",onClick:()=>c(!0),className:"text-primary hover:text-primary/80 h-auto p-1",children:[e.jsx(Ea,{className:"w-4 h-4 mr-1"}),"Learn More"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose the account type that best fits your operation and available documents."}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{onClick:()=>o(k=>({...k,accountType:"individual"})),className:`p-4 rounded-lg border cursor-pointer transition-all ${r.accountType==="individual"?"border-primary/80 bg-primary/8":"border-primary/50 hover:border-primary/70"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"font-medium",children:"Individual Account"})]}),e.jsx("div",{className:`w-5 h-5 rounded-full border-2 ${r.accountType==="individual"?"border-primary bg-primary":"border-primary/50"}`,children:r.accountType==="individual"&&e.jsx("div",{className:"w-full h-full rounded-full bg-white scale-50"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.userType==="buyer"?"Perfect for individual consumers, small restaurants, and personal purchases.":r.userType?"Perfect for individual farmers, small operations, and personal trading.":"Perfect for individual farmers, traders, and personal operations."})]}),e.jsxs("div",{onClick:()=>o(k=>({...k,accountType:"business"})),className:`p-4 rounded-lg border cursor-pointer transition-all ${r.accountType==="business"?"border-primary/80 bg-primary/8":"border-primary/50 hover:border-primary/70"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"font-medium",children:"Business Account"})]}),e.jsx("div",{className:`w-5 h-5 rounded-full border-2 ${r.accountType==="business"?"border-primary bg-primary":"border-primary/50"}`,children:r.accountType==="business"&&e.jsx("div",{className:"w-full h-full rounded-full bg-white scale-50"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.userType==="buyer"?"For hotels, restaurants, distributors, and large-scale purchasing operations.":(r.userType,"For registered businesses, companies, and formal operations.")})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(O,{children:"Location *"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4 z-10"}),e.jsxs(pe,{value:r.region,onValueChange:k=>o(C=>({...C,region:k,location:""})),children:[e.jsx(fe,{className:"pl-10",children:e.jsx(ge,{placeholder:"Select your region"})}),e.jsx(je,{className:"max-h-64 overflow-y-auto",children:Object.entries(Fe).map(([k,C])=>e.jsx(B,{value:k,children:C.name},k))})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4 z-10"}),e.jsxs(pe,{value:r.location,onValueChange:k=>o(C=>({...C,location:k})),disabled:!r.region,children:[e.jsx(fe,{className:"pl-10",children:e.jsx(ge,{placeholder:"Select your city/town"})}),e.jsx(je,{className:"max-h-64 overflow-y-auto",children:y().map(k=>e.jsx(B,{value:k,children:k},k))})]})]})]}),!r.region&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Please select a region first"})]})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("h1",{className:"text-2xl font-semibold flex items-center justify-center gap-2 mb-2",children:[e.jsx(Oe,{className:"w-6 h-6 text-primary"}),"Join AgriLink"]}),e.jsx("p",{className:"text-muted-foreground",children:"Create your account to connect with Myanmar's agricultural community"})]}),e.jsxs("form",{onSubmit:P,className:"space-y-8",children:[v&&e.jsx(Le,{variant:"destructive",children:e.jsx(Re,{children:v})}),e.jsxs(I,{children:[e.jsx(W,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5"}),"Personal Information"]})}),e.jsx(R,{className:"space-y-4",children:w()})]}),e.jsxs(I,{children:[e.jsx(W,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5"}),"Role, Account Type & Location"]})}),e.jsx(R,{className:"space-y-4",children:h()})]}),e.jsx(I,{children:e.jsx(R,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(u,{type:"submit",className:"w-full",disabled:N,children:N?"Creating Account...":"Create Account"}),e.jsx("div",{className:"text-center",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Already have an account?"," ",e.jsx("button",{type:"button",onClick:a,className:"text-primary hover:underline font-medium",children:"Sign in here"})]})})]})})})]})]})}function Or({onBack:s,onReturnToLogin:a}){const[t,r]=d.useState("email"),[o,i]=d.useState(""),[g,b]=d.useState(""),[n,v]=d.useState(""),[f,N]=d.useState(""),[m,x]=d.useState(!1),[c,y]=d.useState(!1),[l,p]=d.useState(!1),[P,w]=d.useState({}),h=async S=>{if(S.preventDefault(),w({}),!o){w({email:"Email is required"});return}if(!o.includes("@")){w({email:"Please enter a valid email address"});return}p(!0),await new Promise(j=>setTimeout(j,1500)),p(!1),r("verification")},k=async S=>{if(S.preventDefault(),w({}),!g){w({code:"Verification code is required"});return}if(g.length!==6){w({code:"Please enter the 6-digit code"});return}if(g!=="123456"&&!/^\d{6}$/.test(g)){w({code:"Invalid verification code. Try 123456 for demo."});return}p(!0),await new Promise(j=>setTimeout(j,1e3)),p(!1),r("password")},C=async S=>{if(S.preventDefault(),w({}),!n){w({password:"New password is required"});return}if(n.length<6){w({password:"Password must be at least 6 characters"});return}if(n!==f){w({confirmPassword:"Passwords do not match"});return}p(!0),await new Promise(j=>setTimeout(j,2e3)),p(!1),r("success")},F=async()=>{p(!0),await new Promise(S=>setTimeout(S,1e3)),p(!1)};return e.jsx("div",{className:"min-h-screen bg-background py-6 px-4",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("h1",{className:"text-2xl font-semibold flex items-center justify-center gap-2 mb-2",children:[e.jsx(Oe,{className:"w-6 h-6 text-primary"}),"Reset Password"]}),e.jsx("p",{className:"text-muted-foreground",children:"Secure password recovery for your AgriLink account"})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-6",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${t==="email"||t!=="email"?"bg-primary":"bg-muted"}`}),e.jsx("div",{className:`w-8 h-1 ${t==="verification"||t==="code"||t==="password"||t==="success"?"bg-primary":"bg-muted"} rounded`}),e.jsx("div",{className:`w-3 h-3 rounded-full ${t==="verification"||t==="code"||t==="password"||t==="success"?"bg-primary":"bg-muted"}`}),e.jsx("div",{className:`w-8 h-1 ${t==="code"||t==="password"||t==="success"?"bg-primary":"bg-muted"} rounded`}),e.jsx("div",{className:`w-3 h-3 rounded-full ${t==="password"||t==="success"?"bg-primary":"bg-muted"}`}),e.jsx("div",{className:`w-8 h-1 ${t==="success"?"bg-primary":"bg-muted"} rounded`}),e.jsx("div",{className:`w-3 h-3 rounded-full ${t==="success"?"bg-primary":"bg-muted"}`})]}),e.jsxs(I,{className:"w-full",children:[e.jsxs(W,{className:"space-y-1",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsxs("div",{className:"w-12 h-12 bg-primary rounded-lg flex items-center justify-center",children:[t==="email"&&e.jsx(ds,{className:"w-6 h-6 text-primary-foreground"}),(t==="verification"||t==="code")&&e.jsx(ae,{className:"w-6 h-6 text-primary-foreground"}),t==="password"&&e.jsx(ye,{className:"w-6 h-6 text-primary-foreground"}),t==="success"&&e.jsx(Z,{className:"w-6 h-6 text-primary-foreground"})]})}),e.jsxs(Y,{className:"text-xl text-center",children:[t==="email"&&"Enter Your Email",t==="verification"&&"Check Your Email",t==="code"&&"Enter Verification Code",t==="password"&&"Set New Password",t==="success"&&"Password Reset Complete"]}),e.jsxs(De,{className:"text-center",children:[t==="email"&&"We'll send you a verification code to reset your password",t==="verification"&&"We've sent a verification code to your email",t==="code"&&"Enter the 6-digit code from your email",t==="password"&&"Choose a strong new password for your account",t==="success"&&"Your password has been successfully updated"]})]}),e.jsxs(R,{className:"space-y-4",children:[e.jsx(Le,{children:e.jsx(Re,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"🎭 Demo Mode Password Reset"}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[t==="email"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"• Enter any valid email address"}),e.jsx("p",{children:"• No actual email will be sent"})]}),(t==="verification"||t==="code")&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["• Use verification code: ",e.jsx("strong",{children:"123456"})]}),e.jsx("p",{children:"• Any 6-digit number will work"})]}),t==="password"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"• Choose any password (minimum 6 characters)"}),e.jsx("p",{children:"• This will simulate updating your password"})]}),t==="success"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"• Password reset simulation complete"}),e.jsx("p",{children:"• You can now sign in with any demo credentials"})]})]})]})})}),t==="email"&&e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(O,{htmlFor:"email",children:"Email Address"}),e.jsx(J,{id:"email",type:"email",value:o,onChange:S=>i(S.target.value),placeholder:"Enter your email address",className:P.email?"border-destructive":""}),P.email&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:P.email})]}),e.jsx(u,{type:"submit",className:"w-full h-11",disabled:l,children:l?"Sending...":"Send Verification Code"})]}),t==="verification"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-4 text-center",children:[e.jsx(ds,{className:"w-8 h-8 text-primary mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-primary",children:"Verification Email Sent!"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Check your email at ",e.jsx("strong",{children:o})]})]}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Didn't receive the email? Check your spam folder or"}),e.jsx(u,{variant:"ghost",size:"sm",onClick:F,disabled:l,children:l?"Resending...":"Resend Code"})]}),e.jsx(u,{onClick:()=>r("code"),className:"w-full h-11",children:"I Have the Code"})]}),t==="code"&&e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(O,{htmlFor:"code",children:"Verification Code"}),e.jsx(J,{id:"code",type:"text",value:g,onChange:S=>b(S.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"Enter 6-digit code",className:`text-center tracking-widest text-lg ${P.code?"border-destructive":""}`,maxLength:6}),P.code&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:P.code})]}),e.jsx("div",{className:"text-center",children:e.jsx(u,{type:"button",variant:"ghost",size:"sm",onClick:F,disabled:l,children:l?"Resending...":"Resend Code"})}),e.jsx(u,{type:"submit",className:"w-full h-11",disabled:l,children:l?"Verifying...":"Verify Code"})]}),t==="password"&&e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(O,{htmlFor:"new-password",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{id:"new-password",type:m?"text":"password",value:n,onChange:S=>v(S.target.value),placeholder:"Enter new password",className:P.password?"border-destructive pr-10":"pr-10"}),e.jsx(u,{type:"button",variant:"ghost",size:"sm",className:"absolute right-1 top-1 h-8 w-8 p-0",onClick:()=>x(!m),children:m?e.jsx(ws,{className:"w-4 h-4"}):e.jsx(ye,{className:"w-4 h-4"})})]}),P.password&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:P.password})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"confirm-password",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{id:"confirm-password",type:c?"text":"password",value:f,onChange:S=>N(S.target.value),placeholder:"Confirm new password",className:P.confirmPassword?"border-destructive pr-10":"pr-10"}),e.jsx(u,{type:"button",variant:"ghost",size:"sm",className:"absolute right-1 top-1 h-8 w-8 p-0",onClick:()=>y(!c),children:c?e.jsx(ws,{className:"w-4 h-4"}):e.jsx(ye,{className:"w-4 h-4"})})]}),P.confirmPassword&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:P.confirmPassword})]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsx("p",{children:"Password requirements:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[e.jsx("li",{className:n.length>=6?"text-primary":"",children:"At least 6 characters"}),e.jsx("li",{className:n!==f||!f?"":"text-primary",children:"Passwords match"})]})]}),e.jsx(u,{type:"submit",className:"w-full h-11",disabled:l,children:l?"Updating Password...":"Update Password"})]}),t==="success"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6 text-center",children:[e.jsx(Z,{className:"w-12 h-12 text-green-600 mx-auto mb-3"}),e.jsx("h3",{className:"font-medium text-green-800 mb-2",children:"Password Reset Successful!"}),e.jsx("p",{className:"text-sm text-green-700",children:"Your password has been updated successfully. You can now sign in with your new password."})]}),e.jsx(u,{onClick:a,className:"w-full h-11",children:"Return to Sign In"})]}),(t==="email"||t==="verification")&&e.jsx("div",{className:"pt-4 border-t",children:e.jsxs(u,{type:"button",variant:"ghost",onClick:s,className:"w-full",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Back to Sign In"]})}),(t==="code"||t==="password")&&e.jsx("div",{className:"pt-4 border-t",children:e.jsx("div",{className:"text-center",children:e.jsx(u,{type:"button",variant:"ghost",size:"sm",onClick:()=>r("email"),children:"Use Different Email"})})})]})]})]})})}function ga({className:s,...a}){return e.jsx(At,{"data-slot":"checkbox",className:G("peer h-4 w-4 shrink-0 rounded border-2 border-primary/40 bg-white shadow focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground data-[state=checked]:border-primary hover:border-primary/60 transition-all",s),...a,children:e.jsx(It,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current",children:e.jsx(La,{className:"h-3 w-3 text-white"})})})}function $r({currentUser:s,onBack:a,onSave:t,editingProduct:r}){const[o,i]=d.useState(""),[g,b]=d.useState(""),[n,v]=d.useState(!1),[f,N]=d.useState({}),m=d.useRef(null),x=d.useRef(null),[c,y]=d.useState(()=>{if(r){console.log("🔄 Initializing form with editing product:",{id:r.id,name:r.name,price:r.price,priceType:typeof r.price,description:r.description||"UNDEFINED",category:r.category||"UNDEFINED",hasImage:!!r.image||!!r.images?.length});const T={id:r.id,sellerId:r.sellerId,name:r.name||"",price:r.price||0,unit:r.unit||"",location:r.location||s?.location||"",region:r.region||s?.region||"yangon",sellerType:r.sellerType||s?.userType||"farmer",sellerName:r.sellerName||s?.name||"",image:r.image||"",images:r.images||(r.image?[r.image]:[]),quantity:r.quantity||"",minimumOrder:r.minimumOrder||"",availableQuantity:r.availableQuantity||"",deliveryOptions:r.deliveryOptions||[],paymentTerms:r.paymentTerms||[],lastUpdated:r.lastUpdated||new Date().toISOString(),category:r.category||"",description:r.description||"",additionalNotes:r.additionalNotes||"",priceChange:r.priceChange,isEditing:!0};return x.current={...T},T}return{id:"",sellerId:s?.id||"",name:"",price:0,unit:"",location:s?.location||"",region:s?.region||"yangon",sellerType:s?.userType||"farmer",sellerName:s?.name||"",image:"",images:[],quantity:"",minimumOrder:"",availableQuantity:"",deliveryOptions:[],paymentTerms:[],lastUpdated:new Date().toISOString(),category:"",description:"",additionalNotes:"",priceChange:void 0}}),l=d.useMemo(()=>{const T=["Pickup","Local Delivery (Within 10km)","Regional Delivery","Nationwide Shipping","Express Delivery","Cold Chain Transport"],E=localStorage.getItem("agriconnect-custom-delivery-options"),X=E?JSON.parse(E):[];return[...T,...X]},[]),p=d.useMemo(()=>{const T=localStorage.getItem("agriconnect-custom-delivery-options");return T?JSON.parse(T):[]},[]),P=d.useMemo(()=>{if(!r||!x.current)return!1;const T=x.current,X=["name","price","unit","location","region","category","description","quantity","minimumOrder","availableQuantity","additionalNotes"].some(ie=>String(c[ie]||"")!==String(T[ie]||"")),Ie=JSON.stringify(c.deliveryOptions?.sort())!==JSON.stringify(T.deliveryOptions?.sort()),H=JSON.stringify(c.paymentTerms?.sort())!==JSON.stringify(T.paymentTerms?.sort()),re=JSON.stringify(c.images?.sort())!==JSON.stringify(T.images?.sort());return X||Ie||H||re},[c,r]),w=()=>r?P?{text:"Save Changes",disabled:!1,variant:"default"}:{text:"Update Product",disabled:!0,variant:"secondary"}:{text:"Publish Product",disabled:!1,variant:"default"},h=d.useCallback(T=>{localStorage.setItem("agriconnect-custom-delivery-options",JSON.stringify(T))},[]),k=d.useMemo(()=>{const T=["Cash on Delivery","Bank Transfer","Mobile Payment","Cash on Pickup","50% Advance, 50% on Delivery","30% Advance, 70% on Delivery"],E=localStorage.getItem("agriconnect-custom-payment-terms"),X=E?JSON.parse(E):[];return[...T,...X]},[]),C=d.useMemo(()=>{const T=localStorage.getItem("agriconnect-custom-payment-terms");return T?JSON.parse(T):[]},[]),F=d.useCallback(T=>{localStorage.setItem("agriconnect-custom-payment-terms",JSON.stringify(T))},[]),S=d.useCallback(()=>{const T={};return c.name?.trim()||(T.name="Product name is required"),c.category?.trim()||(T.category="Category is required"),c.unit?.trim()||(T.unit='Quantity & unit is required (e.g., "50 kg", "25 bags")'),(!c.price||c.price<=0)&&(T.price="Valid price is required"),c.availableQuantity?.trim()||(T.availableQuantity="Available quantity is required"),c.minimumOrder?.trim()||(T.minimumOrder="Minimum order is required"),c.region?.trim()||(T.region="Region is required"),c.location?.trim()||(T.location="City/Location is required"),c.deliveryOptions.length===0&&(T.deliveryOptions="At least one delivery option is required"),c.paymentTerms.length===0&&(T.paymentTerms="At least one payment term is required"),N(T),Object.keys(T).length===0},[c]),j=d.useCallback(T=>{y(E=>({...E,deliveryOptions:E.deliveryOptions.includes(T)?E.deliveryOptions.filter(X=>X!==T):[...E.deliveryOptions,T]}))},[]),L=d.useCallback(T=>{y(E=>({...E,paymentTerms:E.paymentTerms.includes(T)?E.paymentTerms.filter(X=>X!==T):[...E.paymentTerms,T]}))},[]),q=d.useCallback(()=>{if(!o.trim())return;const T=[...p,o.trim()];h(T),i("")},[o,p,h]),D=d.useCallback(T=>{const E=p.filter(X=>X!==T);h(E),y(X=>({...X,deliveryOptions:X.deliveryOptions.filter(Ie=>Ie!==T)}))},[p,h]),M=d.useCallback(()=>{if(!g.trim())return;const T=[...C,g.trim()];F(T),b("")},[g,C,F]),V=d.useCallback(T=>{const E=C.filter(X=>X!==T);F(E),y(X=>({...X,paymentTerms:X.paymentTerms.filter(Ie=>Ie!==T)}))},[C,F]),oe=d.useCallback(T=>{const E=Array.from(T.target.files||[]);if(E.length===0)return;const X=10;if((c.images?.length||0)+E.length>X){N(ie=>({...ie,images:`Maximum ${X} images allowed`}));return}if(E.filter(ie=>ie.size>3*1024*1024).length>0){N(ie=>({...ie,images:"Each image must be smaller than 3MB"}));return}N(ie=>{const we={...ie};return delete we.images,we}),(async()=>{const ie=[];for(const we of E)await new Promise(es=>{const Qe=new FileReader;Qe.onload=be=>{const rs=be.target?.result;ie.push(rs),es()},Qe.readAsDataURL(we)});y(we=>({...we,images:[...we.images||[],...ie],image:we.images?.length===0&&ie.length>0?ie[0]:we.image}))})(),m.current&&(m.current.value="")},[c.images]),me=d.useCallback(T=>{y(E=>{const X=[...E.images||[]];return X.splice(T,1),{...E,images:X,image:X.length>0?X[0]:""}})},[]),he=d.useCallback(()=>{y(T=>({...T,images:[],image:""})),m.current&&(m.current.value="")},[]),_=d.useCallback(async()=>{if(console.log("🚀 Form submission started"),r&&!P){console.log("❌ No changes detected, skipping submission");return}if(console.log("Form data being validated:",{id:c.id,name:c.name,price:c.price,priceType:typeof c.price,category:c.category,description:c.description,isEditing:c.isEditing,hasImages:!!(c.images?.length||c.image),imagesCount:c.images?.length||(c.image?1:0),hasChanges:P}),!S()){console.log("❌ Validation failed:",f);return}v(!0);try{console.log("✅ Validation passed, calling onSave");const T={...c,quantity:c.availableQuantity,lastUpdated:new Date().toISOString(),isEditing:c.isEditing};await t(T),console.log("✅ onSave completed successfully")}catch(T){console.error("❌ Product save failed:",T),v(!1)}},[c,S,f,t,r,P]);return e.jsxs("div",{className:"max-w-4xl mx-auto p-4 md:p-6 space-y-6 md:space-y-8",children:[e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsxs(u,{variant:"ghost",onClick:a,className:"h-9 px-3 -ml-3",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:r?"Edit Product":"Add New Product"}),e.jsx("p",{className:"text-muted-foreground",children:r?"Update your product listing details":"Create a detailed product listing for buyers"})]})]}),!r&&e.jsxs(Le,{className:"border-primary/20 bg-primary/5",children:[e.jsx(Zt,{className:"h-4 w-4 text-primary"}),e.jsxs(Re,{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-primary",children:"💡 Selling multiple sizes or variants?"}),e.jsx("br",{}),'Create separate product listings for each size/variant (e.g., "Rice - 25kg bag", "Rice - 50kg bag"). This makes it easier for buyers to find exactly what they need and helps with analytics.']})]}),Object.keys(f).length>0&&e.jsxs(Le,{variant:"destructive",children:[e.jsx(Ue,{className:"h-4 w-4"}),e.jsxs(Re,{children:["Please fix the following errors:",e.jsx("ul",{className:"mt-2 ml-4 list-disc",children:Object.entries(f).map(([T,E])=>e.jsx("li",{className:"text-sm",children:E},T))})]})]}),e.jsxs("div",{className:"space-y-6 md:space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 lg:items-start",children:[e.jsx("div",{className:"lg:col-span-2 lg:self-start",children:e.jsxs(I,{className:"h-[300px] lg:h-[320px] flex flex-col",children:[e.jsx(W,{className:"flex-shrink-0 pb-4",children:e.jsxs(Y,{className:"flex items-center gap-2 text-base md:text-lg",children:[e.jsx(ne,{className:"w-5 h-5"}),"Product Information"]})}),e.jsxs(R,{className:"flex-grow flex flex-col space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"productName",children:"Product Name *"}),e.jsx(J,{id:"productName",placeholder:"e.g., Fresh Cabbage",value:c.name,onChange:T=>y(E=>({...E,name:T.target.value})),className:`h-10 ${f.name?"border-destructive":""}`})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"category",children:"Category *"}),e.jsxs(pe,{value:c.category,onValueChange:T=>y(E=>({...E,category:T})),children:[e.jsx(fe,{className:`h-10 ${f.category?"border-destructive":""}`,children:e.jsx(ge,{placeholder:"Pulses & Beans"})}),e.jsxs(je,{children:[e.jsx(B,{value:"rice",children:"Rice"}),e.jsx(B,{value:"vegetables",children:"Vegetables"}),e.jsx(B,{value:"fruits",children:"Fruits"}),e.jsx(B,{value:"spices",children:"Spices & Herbs"}),e.jsx(B,{value:"pulses",children:"Pulses & Beans"}),e.jsx(B,{value:"grains",children:"Grains & Cereals"}),e.jsx(B,{value:"tea-coffee",children:"Tea & Coffee"}),e.jsx(B,{value:"nuts",children:"Nuts & Seeds"}),e.jsx(B,{value:"livestock",children:"Livestock"}),e.jsx(B,{value:"dairy",children:"Dairy Products"}),e.jsx(B,{value:"other",children:"Other"})]})]})]})]}),e.jsxs("div",{className:"space-y-2 flex-grow flex flex-col",children:[e.jsx(O,{htmlFor:"description",children:"Product Description"}),e.jsx(_e,{id:"description",placeholder:"Describe your product, quality, farming methods, and what makes it special...",value:c.description,onChange:T=>y(E=>({...E,description:T.target.value})),className:"flex-grow resize-none h-[100px] lg:h-[110px]"})]})]})]})}),e.jsx("div",{className:"lg:col-span-1 lg:self-end",children:e.jsxs(I,{className:"h-[300px] lg:h-[320px] flex flex-col",children:[e.jsx(W,{className:"flex-shrink-0 pb-4",children:e.jsxs(Y,{className:"flex items-center gap-2 text-base md:text-lg",children:[e.jsx(Ns,{className:"w-5 h-5"}),"Product Photos"]})}),e.jsxs(R,{className:"flex-grow flex flex-col space-y-3",children:[c.images&&c.images.length>0?e.jsxs("div",{className:"flex-grow flex flex-col space-y-2",children:[e.jsx("div",{className:"flex-grow",children:e.jsx("div",{className:"grid grid-cols-2 gap-2 h-[120px] lg:h-[130px] overflow-y-auto",children:c.images.map((T,E)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:T,alt:`Product ${E+1}`,className:"w-full h-16 md:h-18 object-cover rounded-lg border hover:opacity-90 transition-opacity"}),e.jsx(u,{type:"button",variant:"destructive",size:"sm",onClick:()=>me(E),className:"absolute top-1 right-1 h-5 w-5 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Pe,{className:"w-2 h-2"})}),E===0&&e.jsx($,{className:"absolute bottom-1 left-1 text-xs px-1 py-0 h-4",children:"Main"})]},E))})}),e.jsxs("div",{className:"flex-shrink-0 space-y-2",children:[c.images.length<10&&e.jsxs(u,{type:"button",variant:"outline",size:"sm",onClick:()=>m.current?.click(),className:"w-full h-9",children:[e.jsx(cs,{className:"w-3 h-3 mr-1"}),"Add More (",c.images.length,"/10)"]}),c.images.length>1&&e.jsx(u,{type:"button",variant:"ghost",size:"sm",onClick:he,className:"w-full text-destructive hover:text-destructive h-9",children:"Remove All Photos"})]})]}):e.jsx("div",{className:"flex-grow flex items-center justify-center",children:e.jsxs("div",{className:"border-2 border-dashed border-muted rounded-lg p-3 text-center w-full",children:[e.jsx(Ns,{className:"w-12 h-12 mx-auto text-muted-foreground mb-3"}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1 mb-3",children:[e.jsx("p",{children:"• Use high-quality photos"}),e.jsx("p",{children:"• Multiple photos help customers"}),e.jsx("p",{children:"• JPG, PNG up to 3MB each"})]}),e.jsxs(u,{type:"button",variant:"outline",size:"sm",onClick:()=>m.current?.click(),className:"h-9",children:[e.jsx(Xt,{className:"w-3 h-3 mr-1"}),"Upload Photos"]})]})}),e.jsx("input",{ref:m,type:"file",accept:"image/*",multiple:!0,onChange:oe,className:"hidden"}),f.images&&e.jsx("p",{className:"text-sm text-destructive",children:f.images})]})]})})]}),e.jsxs(I,{children:[e.jsx(W,{children:e.jsxs(Y,{className:"flex items-center gap-2 text-base md:text-lg",children:[e.jsx(Ge,{className:"w-5 h-5"}),"Pricing & Quantity"]})}),e.jsxs(R,{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"unit",children:"Package Size *"}),e.jsx(J,{id:"unit",placeholder:"e.g., 50 kg, 25 bags, 1 basket",value:c.unit,onChange:T=>y(E=>({...E,unit:T.target.value})),className:`h-11 ${f.unit?"border-destructive":""}`})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"price",children:"Price (MMK) *"}),e.jsx(J,{id:"price",type:"number",placeholder:"0",value:c.price||"",onChange:T=>{const E=parseFloat(T.target.value)||0;console.log("💰 Price changed:",{inputValue:T.target.value,parsedValue:E,previousPrice:c.price}),y(X=>({...X,price:E}))},className:`h-11 ${f.price?"border-destructive":""}`})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"availableQuantity",children:"Available Stock *"}),e.jsx(J,{id:"availableQuantity",placeholder:"e.g., 100 bags available",value:c.availableQuantity,onChange:T=>y(E=>({...E,availableQuantity:T.target.value})),className:`h-11 ${f.availableQuantity?"border-destructive":""}`})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"minimumOrder",children:"Minimum Order *"}),e.jsx(J,{id:"minimumOrder",placeholder:"e.g., 5 bags minimum",value:c.minimumOrder,onChange:T=>y(E=>({...E,minimumOrder:T.target.value})),className:`h-11 ${f.minimumOrder?"border-destructive":""}`})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"region",children:"Region *"}),e.jsxs(pe,{value:c.region,onValueChange:T=>y(E=>({...E,region:T,location:""})),children:[e.jsx(fe,{className:`h-11 ${f.region?"border-destructive":""}`,children:e.jsx(ge,{placeholder:"Select your region"})}),e.jsx(je,{className:"max-h-64 overflow-y-auto",children:Object.entries(Fe).map(([T,E])=>e.jsx(B,{value:T,children:E.name},T))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"location",children:"City/Location *"}),e.jsxs(pe,{value:c.location,onValueChange:T=>y(E=>({...E,location:T})),disabled:!c.region,children:[e.jsx(fe,{className:`h-11 ${f.location?"border-destructive":""}`,children:e.jsx(ge,{placeholder:c.region?"Select your city":"Select region first"})}),e.jsx(je,{className:"max-h-64 overflow-y-auto",children:c.region&&Fe[c.region]?.cities.map(T=>e.jsx(B,{value:T,children:T},T))})]})]})]})]}),e.jsxs(I,{children:[e.jsx(W,{children:e.jsxs(Y,{className:"flex items-center gap-2 text-base md:text-lg",children:[e.jsx(We,{className:"w-5 h-5"}),"Delivery Options *"]})}),e.jsxs(R,{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:l.map(T=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ga,{id:`delivery-${T}`,checked:c.deliveryOptions.includes(T),onCheckedChange:()=>j(T)}),e.jsx(O,{htmlFor:`delivery-${T}`,className:"text-sm leading-5 cursor-pointer",children:T}),p.includes(T)&&e.jsx(u,{type:"button",variant:"ghost",size:"sm",onClick:()=>D(T),className:"h-6 w-6 p-0 ml-2 text-destructive hover:text-destructive",children:e.jsx(Pe,{className:"w-3 h-3"})})]},T))}),f.deliveryOptions&&e.jsx("p",{className:"text-sm text-destructive",children:f.deliveryOptions}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(J,{placeholder:"Add custom delivery option",value:o,onChange:T=>i(T.target.value),className:"h-11",onKeyPress:T=>T.key==="Enter"&&q()}),e.jsx(u,{type:"button",variant:"outline",onClick:q,disabled:!o.trim(),className:"h-11 px-3",children:e.jsx(cs,{className:"w-4 h-4"})})]})]})]}),e.jsxs(I,{children:[e.jsx(W,{children:e.jsxs(Y,{className:"flex items-center gap-2 text-base md:text-lg",children:[e.jsx(Xs,{className:"w-5 h-5"}),"Payment Terms *"]})}),e.jsxs(R,{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:k.map(T=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ga,{id:`payment-${T}`,checked:c.paymentTerms.includes(T),onCheckedChange:()=>L(T)}),e.jsx(O,{htmlFor:`payment-${T}`,className:"text-sm leading-5 cursor-pointer",children:T}),C.includes(T)&&e.jsx(u,{type:"button",variant:"ghost",size:"sm",onClick:()=>V(T),className:"h-6 w-6 p-0 ml-2 text-destructive hover:text-destructive",children:e.jsx(Pe,{className:"w-3 h-3"})})]},T))}),f.paymentTerms&&e.jsx("p",{className:"text-sm text-destructive",children:f.paymentTerms}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(J,{placeholder:"Add custom payment term",value:g,onChange:T=>b(T.target.value),className:"h-11",onKeyPress:T=>T.key==="Enter"&&M()}),e.jsx(u,{type:"button",variant:"outline",onClick:M,disabled:!g.trim(),className:"h-11 px-3",children:e.jsx(cs,{className:"w-4 h-4"})})]})]})]}),e.jsxs(I,{children:[e.jsx(W,{children:e.jsxs(Y,{className:"flex items-center gap-2 text-base md:text-lg",children:[e.jsx(Me,{className:"w-5 h-5"}),"Additional Notes"]})}),e.jsx(R,{children:e.jsx(_e,{placeholder:"Any special conditions, harvest dates, certifications, or additional information...",value:c.additionalNotes,onChange:T=>y(E=>({...E,additionalNotes:T.target.value})),className:"min-h-20 resize-none"})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 sm:justify-end",children:[e.jsx(u,{variant:"outline",onClick:a,disabled:n,className:"h-11 sm:px-6 order-2 sm:order-1 min-h-11",children:"Cancel"}),e.jsx(u,{onClick:_,disabled:n||w().disabled,variant:w().variant,className:`h-11 flex-1 sm:flex-none sm:px-8 order-1 sm:order-2 min-h-11 ${w().disabled?"opacity-50 cursor-not-allowed bg-muted text-muted-foreground hover:bg-muted":""}`,children:n?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-4 h-4 mr-2 animate-spin"}),r?"Updating...":"Publishing..."]}):e.jsxs(e.Fragment,{children:[!r&&e.jsx(ne,{className:"w-4 h-4 mr-2"}),w().text]})})]})]})]})}function Ur(s){if(!s)return"unit";const a=s.toLowerCase(),t=["sack","sacks","bag","bags","basket","baskets","crate","crates","box","boxes","carton","cartons","bottle","bottles","jar","jars","can","cans","pack","packs","bundle","bundles","bunch","bunches"];for(const i of t)if(a.includes(i))return i.endsWith("s")?i:i+"s";const r=a.split(/[^\w]+/),o=r[r.length-1];return o&&o.length>1?o.endsWith("s")?o:o+"s":"units"}function Wr({user:s,userProducts:a,onAddListing:t,onEditListing:r,onDeleteListing:o,onViewStorefront:i,onGoToMarketplace:g,onViewProduct:b,onShowVerification:n,onViewMessages:v}){const f=x=>{if(x.variations&&x.variations.length>0){const c=x.variations.filter(y=>y.price&&y.price>0);if(c.length===0)return{price:"Contact for price",unit:"",showUnit:!1};if(c.length===1){const y=c[0],l=y.quantity?`${y.quantity} ${y.unit}`:y.unit||Ur(y.name);return{price:`${new Intl.NumberFormat("en-US").format(y.price)} MMK`,unit:l,showUnit:!0}}else{const y=c.map(p=>p.price),l=Math.min(...y);return{price:`From ${new Intl.NumberFormat("en-US").format(l)} MMK`,unit:"multiple options",showUnit:!0}}}else return x.price&&x.price>0?{price:`${new Intl.NumberFormat("en-US").format(x.price)} MMK`,unit:x.unit,showUnit:!!x.unit}:{price:"Contact for price",unit:"",showUnit:!1}},N=a.length;a.slice(0,3);const m=d.useMemo(()=>{const x=new Date;x.getMonth(),x.getFullYear();let c=0;if(N>0){const P=s.verified?8:3;c=N*P;const w=a.filter(h=>h.name.length>20&&h.image&&!h.image.includes("placeholder")).length*2;c+=w,s.verified&&(c+=Math.floor(c*.3)),c=Math.min(c,150)}let y=0;if(N>0){const P=s.verified?25:12;y=N*P;const w=a.filter(h=>{const k=new Date(h.lastUpdated);return(x.getTime()-k.getTime())/(1e3*3600*24)<=7}).length;y+=w*15,s.verified&&(y+=Math.floor(y*.4)),s.userType==="farmer"&&(y+=Math.floor(y*.1)),y=Math.min(y,500)}const l=Math.floor(c*.85),p=l>0?Math.round((c-l)/l*100):0;return{monthlyInquiries:c,profileViews:y,growthPercentage:Math.max(0,Math.min(p,50))}},[s.id,s.verified,s.userType,N,a]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary/10 via-primary/5 to-amber-900/10 rounded-xl p-6 border border-primary/30",children:e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold",children:["Welcome back, ",s.name.split(" ")[0],"!"]}),e.jsxs("p",{className:"text-muted-foreground flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4"}),s.businessName||`${s.name}'s ${s.userType==="farmer"?"Farm":"Trading"}`," • ",s.location]})]})}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(us,{className:"w-4 h-4"}),e.jsxs("span",{children:["Member since ",zs(s.joinedDate)]})]}),s.verified?e.jsxs($,{variant:"secondary",className:"bg-emerald-100 text-emerald-800 border-emerald-300",children:[e.jsx(Z,{className:"w-3 h-3 mr-1"}),"Verified"]}):e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(xs,{userType:s.userType,accountType:ms(s),verificationLevel:Ke(s),size:"sm"})})]})]})})}),(()=>{const c=(()=>{if(s.verified)return"verified";if(s.verificationStatus==="under_review"||s.verificationSubmitted)return"under-review";const y=s.phoneVerified===!0,l=s.verificationDocuments?.idCard==="uploaded"||s.verificationDocuments?.idCard==="approved",p=s.businessDetailsCompleted;return console.log("🔍 Verification Progress Debug:",{userId:s.id,userType:s.userType,phoneVerified:s.phoneVerified,hasPhoneVerification:y,verificationStatus:s.verificationStatus,verificationSubmitted:s.verificationSubmitted,verificationDocuments:s.verificationDocuments,hasDocuments:l,hasBusinessDetails:p}),s.userType==="buyer"?y?"verified":"not-started":y||l||p?"in-progress":"not-started"})();return c==="verified"?e.jsxs(Le,{className:"border-emerald-200 bg-gradient-to-r from-emerald-50 to-emerald-100",children:[e.jsx(Z,{className:"h-5 w-5",style:{color:"#059669"}}),e.jsx(Re,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"font-semibold text-emerald-700",children:"AgriLink Verification Complete"})}),e.jsx("p",{className:"text-sm text-emerald-600",children:"Your account is fully verified! You now have enhanced buyer trust and credibility on the platform."})]}),e.jsx("div",{className:"flex justify-end sm:justify-start",children:e.jsx(u,{size:"sm",variant:"outline",className:"border-emerald-300 text-emerald-700 hover:bg-emerald-50 shrink-0",onClick:()=>{console.log("👀 View Verification clicked"),n()},children:"View Details"})})]})})]}):c==="under-review"?e.jsxs(Le,{className:"border-blue-200 bg-gradient-to-r from-blue-50 to-blue-100",children:[e.jsx(ae,{className:"h-5 w-5",style:{color:"#2563eb"}}),e.jsx(Re,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"font-semibold text-blue-700",children:"Verification Under Review"})}),e.jsx("p",{className:"text-sm text-blue-600",children:"Your verification documents have been submitted. AgriLink team will review within 1-2 business days."})]}),e.jsx(u,{size:"sm",variant:"outline",className:"border-blue-300 text-blue-700 hover:bg-blue-50 shrink-0",onClick:()=>{console.log("🔍 Check Status clicked"),n()},children:"Check Status"})]})})]}):c==="in-progress"?e.jsxs(Le,{className:"border-amber-200 bg-gradient-to-r from-amber-50 to-amber-100",children:[e.jsx(ae,{className:"h-5 w-5",style:{color:"#d97706"}}),e.jsx(Re,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"font-semibold text-amber-700",children:"Complete Your Verification"})}),e.jsx("p",{className:"text-sm text-amber-600",children:"Your phone is verified! Complete ID verification to get the green verified badge and boost buyer trust."})]}),e.jsx(u,{size:"sm",className:"bg-amber-600 hover:bg-amber-700 text-white shrink-0",onClick:()=>{console.log("📋 Continue Verification clicked"),n()},children:"Continue Setup"})]})})]}):e.jsxs(Le,{className:"border-red-200 bg-gradient-to-r from-red-50 to-red-100",children:[e.jsx(ae,{className:"h-5 w-5",style:{color:"#dc2626"}}),e.jsx(Re,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"font-semibold text-red-700",children:"Boost Your Sales with Verification!"})}),e.jsxs("p",{className:"text-sm text-red-600",children:["Verified ",s.userType,"s get 3x more inquiries, featured listings, and buyer trust"]})]}),e.jsx(u,{size:"sm",className:"bg-red-600 hover:bg-red-700 text-white shrink-0",onClick:()=>{console.log("🚀 Start Verification clicked"),n()},children:"Start Verification"})]})})]})})(),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(I,{className:"hover:shadow-md transition-shadow border-primary/30",children:e.jsx(R,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Active Products"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:N}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:N>0?"Great inventory!":"Add your first product"})]}),e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(ne,{className:"w-6 h-6 text-primary"})})]})})}),e.jsx(I,{className:"hover:shadow-md transition-shadow border-primary/30",children:e.jsx(R,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Monthly Inquiries"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:m.monthlyInquiries}),e.jsxs("p",{className:"text-xs text-primary/80 mt-1 flex items-center gap-1",children:[e.jsx(Bs,{className:"w-3 h-3"}),m.monthlyInquiries>0&&s.verified?`+${m.growthPercentage}% this month`:m.monthlyInquiries>0?"Growing steadily":"Add products to start"]})]}),e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(Ne,{className:"w-6 h-6 text-primary"})})]})})}),e.jsx(I,{className:"hover:shadow-md transition-shadow border-primary/30",children:e.jsx(R,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Profile Views"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:m.profileViews}),e.jsxs("p",{className:"text-xs text-primary/80 mt-1 flex items-center gap-1",children:[e.jsx(Xe,{className:"w-3 h-3"}),"This month"]})]}),e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(Xe,{className:"w-6 h-6 text-primary"})})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[e.jsxs(u,{onClick:x=>{x.preventDefault(),x.stopPropagation(),console.log("✨ Quick Add Product clicked - calling onAddListing"),console.log("onAddListing function:",typeof t);try{t(),console.log("✅ onAddListing called successfully")}catch(c){console.error("❌ Error calling onAddListing:",c)}},className:"h-12 justify-start gap-3 bg-primary hover:bg-primary/90",children:[e.jsx(cs,{className:"w-5 h-5"}),"Add New Product"]}),e.jsxs(u,{onClick:()=>{console.log("👁️ View Storefront clicked"),i()},variant:"outline",className:"h-12 justify-start gap-3",children:[e.jsx(Ye,{className:"w-5 h-5"}),"View Storefront"]}),e.jsxs(u,{onClick:()=>{console.log("💬 Check Messages clicked"),v()},variant:"outline",className:"h-12 justify-start gap-3",children:[e.jsx(Ne,{className:"w-5 h-5"}),"Check Messages"]})]}),e.jsxs(I,{className:"border-primary/30",children:[e.jsx(W,{children:e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:e.jsxs("div",{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5"}),"My Products (",N,")"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Manage your product listings and track performance"})]})})}),e.jsx(R,{children:N===0?e.jsxs("div",{className:"text-center py-12 space-y-6",children:[e.jsx("div",{className:"w-20 h-20 bg-muted/50 rounded-full flex items-center justify-center mx-auto",children:e.jsx(ne,{className:"w-10 h-10 text-muted-foreground"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Ready to start selling?"}),e.jsxs("p",{className:"text-muted-foreground max-w-md mx-auto",children:["Add your first product to connect with buyers across Myanmar.",s.userType==="farmer"?" Share your fresh produce with customers who value quality.":" Start distributing quality agricultural products to retailers and businesses."]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(u,{onClick:x=>{x.preventDefault(),x.stopPropagation(),console.log("🎯 Add First Product clicked"),console.log("onAddListing function:",typeof t);try{t(),console.log("✅ First Product onAddListing called successfully")}catch(c){console.error("❌ Error calling first product onAddListing:",c)}},size:"lg",className:"h-12 px-8",children:[e.jsx(cs,{className:"w-5 h-5 mr-2"}),"Add Your First Product"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Takes less than 5 minutes to create your first listing"})]})]}):e.jsxs("div",{className:"space-y-4",children:[a.map(x=>e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 p-4 border rounded-lg hover:bg-muted/30 transition-colors",children:[e.jsx("div",{className:"shrink-0",children:e.jsx("img",{src:x.image,alt:x.name,className:"w-full sm:w-20 h-48 sm:h-20 object-cover rounded-lg"})}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",children:x.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-primary text-base",children:f(x).price}),f(x).showUnit&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"/"}),e.jsx("span",{children:f(x).unit})]})]})]}),e.jsxs("div",{className:"flex gap-2 sm:shrink-0",children:[e.jsxs(u,{size:"sm",variant:"outline",onClick:()=>{console.log("👁️ View Product:",x.id),b(x.id)},className:"h-9",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline ml-2",children:"View"})]}),e.jsxs(u,{size:"sm",variant:"outline",onClick:()=>{console.log("✏️ Edit Product:",x.id),r(x)},className:"h-9",children:[e.jsx(er,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline ml-2",children:"Edit"})]}),e.jsxs(u,{size:"sm",variant:"outline",onClick:()=>{console.log("🗑️ Delete Product:",x.id),confirm(`Are you sure you want to delete "${x.name}"?`)&&o(x.id)},className:"text-destructive hover:text-destructive h-9",children:[e.jsx(Zs,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline ml-2",children:"Delete"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ne,{className:"w-3 h-3"}),(()=>{if(x.variations&&x.variations.length>0){const c=x.variations.filter(y=>y.availableQuantity);if(c.length===1)return c[0].availableQuantity;if(c.length>1)return`${c.length} options`}return x.quantity||"Available"})()]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),x.location]}),e.jsxs("span",{children:["Updated ",ts(x.lastUpdated)]})]})]})]},x.id)),N>5&&e.jsx("div",{className:"pt-4 border-t",children:e.jsxs(u,{variant:"outline",className:"w-full",onClick:()=>{console.log("🔍 View All Products clicked"),i()},children:["View All ",N," Products",e.jsx(Ms,{className:"w-4 h-4 ml-2"})]})})]})})]})]})}function Yr({user:s,allProducts:a,savedProducts:t,onGoToMarketplace:r,onViewProduct:o,onStartChat:i,onViewMessages:g}){const b=d.useMemo(()=>t.map(f=>{const N=a.find(y=>y.id===f.productId),m=N&&N.price!==f.priceWhenSaved,x=N&&N.price>f.priceWhenSaved,c=N&&N.price<f.priceWhenSaved;return{...f,product:N,priceChanged:m,priceIncrease:x,priceDecrease:c,currentPrice:N?.price||f.priceWhenSaved}}),[a,t]),n=d.useMemo(()=>{const f=t.length,N=t.filter(x=>x.alerts.priceAlert).length,m=b.filter(x=>x.priceDecrease&&x.alerts.priceAlert).length;return{savedProductsCount:f,priceAlertsActive:N,priceDropsDetected:m}},[t,b]),v=f=>new Intl.NumberFormat("en-US").format(f)+" MMK";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl md:text-3xl",children:["Welcome back, ",s.name,"!"]}),e.jsx("p",{className:"text-muted-foreground",children:"Your AgriLink buying dashboard"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(I,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(ys,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Saved Products"}),e.jsx("p",{className:"text-xl",children:n.savedProductsCount})]})]})})}),e.jsx(I,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(Ba,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Price Alerts"}),e.jsx("p",{className:"text-xl text-orange-600",children:n.priceAlertsActive})]})]})})}),e.jsx(I,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(Ls,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Price Drops"}),e.jsx("p",{className:"text-xl text-green-600",children:n.priceDropsDetected})]})]})})})]}),e.jsxs(I,{children:[e.jsxs(W,{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(ys,{className:"w-5 h-5"}),"Your Saved Products (",b.length,")"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Track prices and get alerts on products you're interested in"})]}),e.jsx(R,{children:e.jsxs("div",{className:"space-y-4",children:[b.map(f=>e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center space-y-3 md:space-y-0 md:space-x-4 p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"font-medium",children:f.product?.name||"Product Not Found"}),f.priceDecrease&&f.alerts.priceAlert&&e.jsxs($,{variant:"secondary",className:"text-green-600",children:[e.jsx(Ls,{className:"w-3 h-3 mr-1"}),"Price Drop!"]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Saved at: ",v(f.priceWhenSaved)]}),e.jsx("span",{className:"hidden md:inline",children:"•"}),e.jsxs("span",{children:["Current: ",v(f.currentPrice)]}),f.priceChanged&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden md:inline",children:"•"}),e.jsxs("span",{className:f.priceDecrease?"text-green-600":"text-red-600",children:[f.priceDecrease?"↓":"↑"," ",v(Math.abs(f.currentPrice-f.priceWhenSaved))," change"]})]})]}),f.product&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Seller: ",f.product.sellerName," • ",f.product.location]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2",children:[e.jsxs(u,{variant:"outline",size:"sm",className:"w-full md:w-auto",onClick:()=>f.product&&o(f.productId),disabled:!f.product,children:[e.jsx(ye,{className:"w-4 h-4 mr-1"}),"View Product"]}),e.jsxs(u,{size:"sm",className:"w-full md:w-auto",onClick:()=>f.product&&i(f.productId,f.product.sellerId),disabled:!f.product,children:[e.jsx(bs,{className:"w-4 h-4 mr-1"}),"Contact Seller"]})]})]},f.productId)),b.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ys,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No saved products yet"}),e.jsx("p",{className:"text-muted-foreground",children:"Start saving products to track their prices and get notified when prices drop. You can save products by clicking the heart icon on any product card in the marketplace."})]})]})})]})]})}class js{static config=null;static async initialize(){try{this.config={accountSid:"supabase-managed",authToken:"supabase-managed",phoneNumber:"supabase-managed"},console.log("✅ Twilio service initialized with Supabase Edge Functions")}catch(a){console.error("❌ Failed to initialize Twilio service:",a)}}static async sendVerificationSMS(a){try{if(!z)throw new Error("Supabase not available");console.log("📱 Sending verification SMS via Supabase Edge Function..."),console.log("📱 Phone number being sent:",a);const{data:t,error:r}=await z.functions.invoke("send-verification-sms",{body:{phoneNumber:a}});if(r)throw console.error("❌ Supabase Edge Function error:",r),r;return console.log("✅ SMS sent successfully:",t),t}catch(t){throw console.error("❌ Error sending verification SMS:",t),t}}static async verifySMSCode(a,t){try{if(!z)throw new Error("Supabase not available");console.log("📱 Verifying SMS code via Supabase Edge Function...");const{data:r,error:o}=await z.functions.invoke("verify-sms-code",{body:{phoneNumber:a,code:t}});if(o)throw console.error("❌ Supabase Edge Function error:",o),o;return console.log("✅ SMS code verification result:",r),r}catch(r){throw console.error("❌ Error verifying SMS code:",r),r}}static async updateUserPhoneVerification(a,t,r=!0){try{if(!z)throw new Error("Supabase not available");const{error:o}=await z.from("users").update({phone:t,phone_verified:r,phone_verified_at:r?new Date().toISOString():null,updated_at:new Date().toISOString()}).eq("id",a);return o?(console.error("❌ Database update error:",o),{success:!1,error:o.message}):(console.log("✅ User phone verification status updated successfully"),{success:!0})}catch(o){return console.error("❌ Error updating user phone verification:",o),{success:!1,error:o.message}}}static isConfigured(){return!0}static async getVerificationStatus(a){try{if(!z)throw new Error("Supabase not available");const{data:t,error:r}=await z.from("users").select("phone, phone_verified, phone_verified_at").eq("id",a).single();return r?(console.error("❌ Error fetching verification status:",r),{phoneVerified:!1}):{phoneVerified:t.phone_verified||!1,phoneNumber:t.phone,phoneVerifiedAt:t.phone_verified_at}}catch(t){return console.error("❌ Error getting verification status:",t),{phoneVerified:!1}}}}js.initialize();function Hr({currentUser:s,onVerificationComplete:a,onBack:t}){const[r,o]=d.useState("phone"),[i,g]=d.useState(s.phone||"");d.useEffect(()=>{s.phone&&g(s.phone)},[s.phone]);const[b,n]=d.useState(""),[v,f]=d.useState(!1),[N,m]=d.useState(""),[x,c]=d.useState(0),[y,l]=d.useState(!1),[p,P]=d.useState(null),[w,h]=d.useState(!1);d.useEffect(()=>{l(js.isConfigured())},[]);const k=()=>{c(60);const j=setInterval(()=>{c(L=>L<=1?(clearInterval(j),0):L-1)},1e3)},C=async()=>{if(!i.trim()){m("Please enter your phone number");return}if(!/^\+[1-9]\d{1,14}$/.test(i)){m("Please enter a valid phone number with country code (e.g., +959123456789)");return}f(!0),m("");try{console.log("📱 Sending verification SMS via Twilio...");const L=await js.sendVerificationSMS(i);if(!L.success)throw new Error(L.message);P(L.verificationSid||null),ee.success(L.message),o("otp"),k(),console.log("✅ Verification SMS sent successfully")}catch(L){console.error("❌ Send OTP error:",L),m(L.message||"Failed to send verification code. Please try again.")}finally{f(!1)}},F=async()=>{if(!b.trim()){m("Please enter the verification code");return}if(b.length!==6){m("Verification code must be 6 digits");return}f(!0),m("");try{console.log("📱 Verifying SMS code via Twilio...");const j=await js.verifySMSCode(i,b);if(!j.success)throw new Error(j.message);console.log("📱 Updating user profile with phone verification:",{userId:s.id,phoneNumber:i});const L=await js.updateUserPhoneVerification(s.id,i,!0);if(!L.success)throw new Error(L.error||"Failed to update user profile");console.log("✅ Phone verification completed successfully"),ee.success("Phone number verified successfully!"),a(i)}catch(j){console.error("❌ Verify OTP error:",j),m(j.message||"Invalid verification code. Please try again.")}finally{f(!1)}},S=async()=>{x>0||(n(""),m(""),await C())};return e.jsxs(I,{className:"max-w-md mx-auto",children:[e.jsx(W,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-5 h-5"}),"Phone Verification"]})}),e.jsx(R,{className:"space-y-4",children:r==="phone"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"phone",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{id:"phone",type:"tel",placeholder:i||"+959123456789",value:i,onChange:j=>g(j.target.value),disabled:v||!w,className:`pr-10 ${w?"":"bg-muted text-muted-foreground cursor-not-allowed"}`}),!w&&e.jsx(u,{type:"button",variant:"ghost",size:"sm",onClick:()=>h(!0),className:"absolute right-1 top-1/2 -translate-y-1/2 h-8 w-8 p-0 text-muted-foreground hover:text-foreground",children:e.jsx(le,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:w?"Enter your phone number with country code (e.g., +959 for Myanmar)":"Click the edit button to modify your phone number"})]}),e.jsxs(Le,{className:"border-green-200 bg-green-50",children:[e.jsx(ae,{className:"w-4 h-4 text-green-600"}),e.jsx(Re,{children:e.jsxs("span",{className:"text-green-800",children:[e.jsx("strong",{children:"Twilio Connected:"})," Real SMS verification enabled"]})})]}),N&&e.jsx(Le,{variant:"destructive",children:e.jsx(Re,{children:N})}),e.jsxs("div",{className:"flex gap-2",children:[t&&e.jsx(u,{variant:"outline",onClick:t,disabled:v,children:"Back"}),e.jsx(u,{onClick:C,disabled:v||!i.trim(),className:"flex-1",children:v?"Sending...":"Send Verification Code"}),w&&e.jsx(u,{variant:"outline",onClick:()=>{h(!1),g(s.phone||"")},className:"px-4",children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs($,{variant:"outline",className:"bg-blue-50 text-blue-700",children:[e.jsx(ce,{className:"w-3 h-3 mr-1"}),"Code Sent"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["We sent a 6-digit code to ",e.jsx("strong",{children:i})]}),!y&&e.jsx("p",{className:"text-xs text-yellow-600 font-medium",children:"Demo Mode: Use 123456 or any code ending in 00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"otp",children:"Verification Code"}),e.jsx(J,{id:"otp",type:"text",placeholder:"123456",value:b,onChange:j=>n(j.target.value.replace(/\D/g,"").slice(0,6)),disabled:v,className:"text-center text-lg tracking-widest",maxLength:6})]}),N&&e.jsx(Le,{variant:"destructive",children:e.jsx(Re,{children:N})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{onClick:F,disabled:v||b.length!==6,className:"w-full",children:v?"Verifying...":"Verify Phone Number"}),e.jsx("div",{className:"text-center",children:e.jsx(u,{variant:"ghost",size:"sm",onClick:S,disabled:x>0||v,children:x>0?`Resend in ${x}s`:"Resend Code"})}),e.jsx(u,{variant:"outline",size:"sm",onClick:()=>{o("phone"),n(""),m("")},className:"w-full",children:"Change Phone Number"})]})]})})]})}function Kr({currentUser:s,onClose:a,onUpdate:t}){const[r,o]=d.useState(()=>{const D={};if(s.verificationDocuments){const M=s.verificationDocuments;M.idCard&&typeof M.idCard=="object"&&M.idCard.status&&M.idCard.status!=="pending"&&(D.idCard={file:null,url:"",name:M.idCard.name||"ID Card Document",verified:M.idCard.status==="verified",status:M.idCard.status}),M.businessLicense&&typeof M.businessLicense=="object"&&M.businessLicense.status&&M.businessLicense.status!=="pending"&&(D.businessLicense={file:null,url:"",name:M.businessLicense.name||"Business License Document",verified:M.businessLicense.status==="verified",status:M.businessLicense.status})}return D});d.useEffect(()=>{const D=s.verificationDocuments;D&&o(M=>{const V={...M};return D.idCard&&typeof D.idCard=="object"&&D.idCard.status&&D.idCard.status!=="pending"&&!M.idCard&&(V.idCard={file:null,url:"",name:D.idCard.name||"ID Card Document",verified:D.idCard.status==="verified",status:D.idCard.status}),D.businessLicense&&typeof D.businessLicense=="object"&&D.businessLicense.status&&D.businessLicense.status!=="pending"&&!M.businessLicense&&(V.businessLicense={file:null,url:"",name:D.businessLicense.name||"Business License Document",verified:D.businessLicense.status==="verified",status:D.businessLicense.status}),V})},[s.verificationDocuments]);const[i,g]=d.useState({businessName:s.businessName||"",businessDescription:s.businessDescription||"",businessLicenseNumber:s.businessLicenseNumber||""}),[b,n]=d.useState(!1);d.useEffect(()=>{g({businessName:s.businessName||"",businessDescription:s.businessDescription||"",businessLicenseNumber:s.businessLicenseNumber||""})},[s.businessName,s.businessDescription,s.businessLicenseNumber]);const[v,f]=d.useState(()=>{console.log("🔄 Initializing AgriLink verification state"),console.log("📋 User agriLinkVerificationRequested:",s.agriLinkVerificationRequested),console.log("📋 User verified:",s.verified);const D=s.agriLinkVerificationRequested,M=s.verified;return console.log("✅ AgriLink verification state:",D||M?"true":"false"),D||M}),[N,m]=d.useState(()=>{const D=s.agriLinkVerificationRequested,M=s.verificationStatus==="under_review",V=!s.verified;return console.log("🔄 Initializing success message state:",{hasRequestedVerification:D,isUnderReview:M,isNotYetVerified:V,shouldShow:D&&M&&V}),D&&M&&V}),[x,c]=d.useState(!1);d.useEffect(()=>{N&&(s.verified||s.verificationStatus==="rejected")&&m(!1)},[s.verified,s.verificationStatus,N]);const[y,l]=d.useState(!1),[p,P]=d.useState(!1),[w,h]=d.useState(!1),k=s.accountType==="business",C=d.useMemo(()=>{const D=s.verificationDocuments,M=r.idCard||D?.idCard&&D.idCard!=="pending";return{hasIdCard:M,hasBusinessLicense:!1,isComplete:M}},[r.idCard,s.verificationDocuments,k]),F=()=>{let D=0,M=k?4:3;s.phoneVerified&&D++;const V=s.verificationDocuments;if((r.idCard||V?.idCard&&V.idCard!=="pending")&&D++,k){const me=s.businessName&&s.businessName.trim()!=="",he=s.verificationDocuments?.businessLicense&&s.verificationDocuments.businessLicense!=="pending";me&&he&&D++}return s.verified&&D++,Math.round(D/M*100)},S=async(D,M)=>{const V=D.target.files?.[0];if(V){if(V.size>10*1024*1024){alert("File size must be less than 10MB");return}if(!V.type.startsWith("image/")){alert("Please upload an image file (JPG, PNG, etc.)");return}c(!0);try{const oe=URL.createObjectURL(V);o(he=>({...he,[M]:{file:V,url:oe,name:V.name,verified:!1,status:"uploaded"}})),await new Promise(he=>setTimeout(he,1500));const me={...s.verificationDocuments||{},[M]:{status:"uploaded",name:V.name,size:V.size,type:V.type,uploadedAt:new Date().toISOString(),data:await new Promise(he=>{const _=new FileReader;_.onload=()=>he(_.result),_.readAsDataURL(V)})}};await t({...s,verificationDocuments:me}),await new Promise(he=>setTimeout(he,100))}catch(oe){console.error("Upload failed:",oe),alert("Upload failed. Please try again.")}finally{c(!1)}}},j=D=>{o(M=>{const V={...M};return delete V[D],V})},L=async()=>{c(!0);const D=setTimeout(()=>{console.error("❌ Verification request timeout - stopping processing"),c(!1)},1e4);try{console.log("🛡️ Requesting AgriLink verification for user:",s.email);const M=s.verificationDocuments||{},V=M.idCard&&M.idCard.status==="uploaded",oe=!k||M.businessLicense&&M.businessLicense.status==="uploaded",me=V&&oe;if(console.log("🔍 Debug - Document check results:"),console.log("  - hasIdCard:",V),console.log("  - hasBusinessLicense:",oe),console.log("  - hasUploadedDocs:",me),console.log("  - userDocs:",M),console.log("  - isBusinessAccount:",k),me){const he={id:`req-${Date.now()}`,userId:s.id,userEmail:s.email,userName:s.name,userType:s.userType,accountType:s.accountType,requestType:"standard",status:"pending",submittedAt:new Date().toISOString(),documents:{nationalId:M.idCard?{status:M.idCard.status,name:M.idCard.name,uploadedAt:M.idCard.uploadedAt}:void 0,businessLicense:M.businessLicense?{status:M.businessLicense.status,name:M.businessLicense.name,uploadedAt:M.businessLicense.uploadedAt}:void 0},businessInfo:k?{businessName:s.businessName,businessDescription:s.businessDescription,businessLicenseNumber:s.businessLicenseNumber,location:s.location}:void 0,phoneVerified:s.phoneVerified};console.log("🔄 Inserting verification request into database..."),console.log("📋 Request data:",{user_id:s.id,user_email:s.email,user_name:s.name,user_type:s.userType,account_type:s.accountType,request_type:"standard",status:"under_review",submitted_at:new Date().toISOString(),verification_documents:M,business_info:k?{business_name:s.businessName,business_description:s.businessDescription,business_license_number:s.businessLicenseNumber,location:s.location}:null,phone_verified:s.phoneVerified});const{data:_,error:T}=await z.from("verification_requests").insert([{user_id:s.id,user_email:s.email,user_name:s.name,user_type:s.userType,account_type:s.accountType,request_type:"standard",status:"under_review",submitted_at:new Date().toISOString(),verification_documents:M,business_info:k?{business_name:s.businessName,business_description:s.businessDescription,business_license_number:s.businessLicenseNumber,location:s.location}:null,phone_verified:s.phoneVerified}]).select();if(T)throw console.error("❌ Error storing verification request:",T),console.error("❌ Full error details:",T),new Error("Failed to submit verification request");console.log("✅ Verification request inserted successfully:",_),await new Promise(X=>setTimeout(X,1500)),f(!0),m(!0),console.log("🔄 Updating user profile with verification request data...");const E={...s,agriLinkVerificationRequested:!0,agriLinkVerificationRequestedAt:new Date().toISOString(),verificationStatus:"under_review",verificationSubmittedAt:new Date().toISOString(),verificationDocuments:M};console.log("📋 User update data:",E);try{await t(E),console.log("✅ User profile updated successfully")}catch(X){console.error("❌ Error updating user profile:",X)}console.log("✅ AgriLink verification request submitted successfully:",he)}else alert("Please upload all required documents before requesting verification.")}catch(M){console.error("❌ Failed to request AgriLink verification:",M),alert("Failed to request verification. Please try again.")}finally{clearTimeout(D),c(!1)}},q=async()=>{if(!i.businessName.trim()){alert("Please enter your business name");return}if(!i.businessLicenseNumber.trim()){alert("Please enter your business license number");return}c(!0);try{console.log("💼 Saving business information:",{businessName:i.businessName,businessDescription:i.businessDescription,businessLicenseNumber:i.businessLicenseNumber}),await t({...s,businessName:i.businessName,businessDescription:i.businessDescription,businessLicenseNumber:i.businessLicenseNumber}),console.log("✅ Business information saved to user profile"),n(!1)}catch{alert("Failed to save business information. Please try again.")}finally{c(!1)}};return y?e.jsxs("div",{className:"max-w-2xl mx-auto space-y-4 md:space-y-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(qe,{className:"w-5 h-5 text-primary"})}),e.jsx("h1",{className:"text-xl font-semibold text-primary",children:"Phone Verification"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Verify your phone number with Supabase backend integration"})]})}),e.jsx(Hr,{currentUser:s,onVerificationComplete:D=>{t({...s,phone:D,phoneVerified:!0,phoneVerificationDate:new Date().toISOString()}),l(!1)},onBack:()=>l(!1)})]}):p?e.jsxs("div",{className:"max-w-2xl mx-auto space-y-4 md:space-y-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(Me,{className:"w-5 h-5 text-primary"})}),e.jsx("h1",{className:"text-xl font-semibold text-primary",children:"Identity Documents"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.verified?"Documents submitted for identity verification":"Upload your government-issued ID to verify your identity"})]})}),s.verified?e.jsx(I,{className:"bg-primary/5 border-primary/20",children:e.jsxs(R,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4 text-primary",children:"Submitted Documents"}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-muted rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Me,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"National ID Card"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Government-issued identification"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{variant:"secondary",className:"bg-primary/10 text-primary",children:"Verified"}),r.businessLicense&&e.jsxs(u,{variant:"ghost",size:"sm",onClick:()=>window.open(r.businessLicense.url,"_blank"),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(ye,{className:"w-4 h-4 mr-1"}),"View"]})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground mb-3",children:r.businessLicense?`Uploaded: ${r.businessLicense.name}`:"Document verified and stored securely"})]})}),e.jsxs("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4 mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Z,{className:"w-5 h-5 text-primary"}),e.jsx("p",{className:"font-medium text-primary",children:"Verification Complete"})]}),e.jsx("p",{className:"text-sm text-primary/80",children:"Your documents have been successfully verified. You now have full access to AgriLink platform features."})]})]})}):s.verificationStatus==="under_review"&&!v?e.jsx(I,{className:"bg-orange-50 border-orange-200",children:e.jsxs(R,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4 text-orange-800",children:"Documents Under Review"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Me,{className:"w-5 h-5 text-orange-600"}),e.jsx("p",{className:"font-medium text-orange-800",children:"Review in Progress"})]}),e.jsx("p",{className:"text-sm text-orange-700 mb-2",children:"We'll notify you once the review is complete, typically within 1-2 business days."}),s.verificationSubmittedAt&&e.jsxs("p",{className:"text-xs text-orange-600 mt-2",children:["Submitted on ",new Date(s.verificationSubmittedAt).toLocaleDateString()]})]}),r.idCard&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Me,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-orange-800",children:r.idCard.name}),e.jsx("p",{className:"text-xs text-orange-700",children:"Under Review"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(u,{variant:"ghost",size:"sm",onClick:()=>window.open(r.idCard.url,"_blank"),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(ye,{className:"w-4 h-4 mr-1"}),"View"]}),e.jsx($,{variant:"secondary",className:"bg-orange-100 text-orange-700",children:"Under Review"})]})]})}),k&&r.businessLicense&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(os,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-orange-800",children:r.businessLicense.name}),e.jsx("p",{className:"text-xs text-orange-700",children:"Under Review"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(u,{variant:"ghost",size:"sm",onClick:()=>window.open(r.businessLicense.url,"_blank"),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(ye,{className:"w-4 h-4 mr-1"}),"View"]}),e.jsx($,{variant:"secondary",className:"bg-orange-100 text-orange-700",children:"Under Review"})]})]})})]})]})}):e.jsx(e.Fragment,{children:e.jsx(I,{className:"border-primary/20 bg-primary/2",children:e.jsx(R,{className:"p-6",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-primary/80 mb-4",children:"Please upload a clear photo of your government-issued ID (National ID card, passport, or driver's license)."}),e.jsxs("div",{className:"space-y-4",children:[!r.idCard&&!v&&e.jsxs("div",{className:"border-2 border-dashed border-primary/30 bg-primary/5 rounded-lg p-6 text-center hover:border-primary/50 hover:bg-primary/8 transition-all duration-200",children:[e.jsx(Me,{className:"w-12 h-12 text-primary/70 mx-auto mb-4"}),e.jsx("p",{className:"text-sm font-medium mb-2 text-primary",children:"Upload Identity Document"}),e.jsx("p",{className:"text-xs text-primary/70 mb-4",children:"National ID, Passport, or Driver's License • JPG, PNG up to 10MB"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",id:"id-upload",onChange:D=>S(D,"idCard")}),e.jsx(u,{variant:"outline",size:"sm",asChild:!0,className:"border-primary/30 text-primary hover:bg-primary hover:text-primary-foreground",children:e.jsx("label",{htmlFor:"id-upload",className:"cursor-pointer",children:"Choose File"})})]}),r.idCard&&e.jsx("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Me,{className:"w-5 h-5 text-primary"}),e.jsx("div",{children:e.jsx("button",{onClick:()=>window.open(r.idCard.url,"_blank"),className:"text-sm font-medium text-primary hover:text-primary/80 hover:underline transition-colors text-left",children:r.idCard.name})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.verificationStatus!=="under_review"&&!s.verified&&!v&&e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>j("idCard"),className:"text-muted-foreground hover:text-foreground hover:bg-muted",children:e.jsx(Pe,{className:"w-4 h-4"})}),e.jsx($,{variant:"secondary",className:"bg-primary/10 text-primary",children:"Uploaded"})]})]})})]})]})})})})}),e.jsx("div",{className:"flex justify-start",children:e.jsxs(u,{variant:"ghost",size:"sm",onClick:()=>P(!1),className:"px-3 py-2 text-primary/70 hover:text-primary hover:bg-primary/10",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Back to Overview"]})})]}):w?e.jsxs("div",{className:"max-w-2xl mx-auto space-y-4 md:space-y-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Business Details"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.businessName?"Your business information":"Complete your business information"})]})}),e.jsx(I,{children:e.jsxs(R,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:b?"Update Business Information":"Business Information"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Business Name *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:i.businessName,onChange:D=>g(M=>({...M,businessName:D.target.value})),placeholder:"Enter your business name",className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary ${s.businessName&&!b?"bg-muted text-muted-foreground border-muted cursor-not-allowed":"border-muted bg-background text-foreground"}`,disabled:!!s.businessName&&!b}),s.businessName&&!b&&e.jsx(u,{type:"button",variant:"ghost",size:"sm",onClick:()=>n(!0),className:"absolute right-1 top-1/2 -translate-y-1/2 h-8 w-8 p-0 text-muted-foreground hover:text-foreground",children:e.jsx(le,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Business License Number *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:i.businessLicenseNumber,onChange:D=>g(M=>({...M,businessLicenseNumber:D.target.value})),placeholder:"Enter your business license number",className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary ${s.businessLicenseNumber&&!b?"bg-muted text-muted-foreground border-muted cursor-not-allowed":"border-muted bg-background text-foreground"}`,disabled:!!s.businessLicenseNumber&&!b}),s.businessLicenseNumber&&!b&&e.jsx(u,{type:"button",variant:"ghost",size:"sm",onClick:()=>n(!0),className:"absolute right-1 top-1/2 -translate-y-1/2 h-8 w-8 p-0 text-muted-foreground hover:text-foreground",children:e.jsx(le,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Business Description"}),e.jsx("textarea",{value:i.businessDescription,onChange:D=>g(M=>({...M,businessDescription:D.target.value})),placeholder:"Describe your business activities",rows:3,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary resize-none ${s.businessName&&!b?"bg-muted text-muted-foreground border-muted cursor-not-allowed":"border-muted bg-background text-foreground"}`,disabled:!!s.businessName&&!b})]}),s.businessName&&!b&&e.jsx("div",{className:"bg-muted/50 border border-muted rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Business information saved to your profile"})]})}),e.jsx("div",{className:"flex gap-2",children:b||!s.businessName?e.jsxs(e.Fragment,{children:[e.jsx(u,{onClick:q,disabled:x||s.verificationStatus==="under_review",className:"flex-1",children:x?"Saving...":"Save Business Info"}),b&&e.jsx(u,{variant:"outline",onClick:()=>{n(!1),g({businessName:s.businessName||"",businessDescription:s.businessDescription||"",businessLicenseNumber:s.businessLicenseNumber||""})},className:"px-4",children:"Cancel"})]}):e.jsx(u,{onClick:()=>n(!0),variant:"outline",className:"flex-1",children:"Edit Business Info"})})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h4",{className:"font-medium mb-4",children:"Business License Document *"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Upload your business registration or license document to complete your business verification. This is mandatory for business account verification."}),!r.businessLicense&&!v&&e.jsxs("div",{className:"border-2 border-dashed border-muted rounded-lg p-6 text-center",children:[e.jsx(os,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-sm font-medium mb-2",children:"Upload Business Registration"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-4",children:"Business License or Registration • JPG, PNG up to 10MB"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",id:"business-detail-upload",onChange:D=>S(D,"businessLicense")}),e.jsx(u,{variant:"outline",size:"sm",asChild:!0,children:e.jsx("label",{htmlFor:"business-detail-upload",className:"cursor-pointer",children:"Choose File"})})]}),r.businessLicense&&e.jsx("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(os,{className:"w-5 h-5 text-primary"}),e.jsx("div",{children:e.jsx("button",{onClick:()=>window.open(r.businessLicense.url,"_blank"),className:"text-sm font-medium text-primary hover:text-primary/80 hover:underline transition-colors text-left",children:r.businessLicense.name})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.verificationStatus!=="under_review"&&!s.verified&&!v&&e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>j("businessLicense"),className:"text-muted-foreground hover:text-foreground hover:bg-muted",children:e.jsx(Pe,{className:"w-4 h-4"})}),e.jsx($,{variant:"secondary",className:"bg-primary/10 text-primary",children:"Uploaded"})]})]})})]})]})]})}),e.jsx("div",{className:"flex justify-start",children:e.jsxs(u,{variant:"ghost",size:"sm",onClick:()=>h(!1),className:"px-3 py-2",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Back to Overview"]})})]}):e.jsxs("div",{className:"max-w-2xl mx-auto space-y-4 md:space-y-6 pb-20",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"AgriLink Verification"}),e.jsx(u,{variant:"outline",size:"sm",onClick:async()=>{console.log("🔄 Manual refresh triggered");try{const{data:D,error:M}=await z.from("users").select(`
                    id,
                    email,
                    name,
                    user_type,
                    account_type,
                    location,
                    region,
                    verified,
                    phone_verified,
                    phone,
                    business_name,
                    business_description,
                    business_license_number,
                    created_at,
                    total_reviews,
                    verification_status,
                    verification_documents,
                    verification_submitted,
                    phone_verified_at,
                    verified_at,
                    agri_link_verification_requested_at,
                    business_details_completed
                  `).eq("id",s.id).single();if(M){console.error("❌ Error refreshing user data:",M);return}if(D){const V={id:D.id,email:D.email,name:D.name,userType:D.user_type,accountType:D.account_type,location:D.location,region:D.region||void 0,verified:D.verified,phoneVerified:D.phone_verified,phone:D.phone,businessName:D.business_name,businessDescription:D.business_description,businessLicenseNumber:D.business_license_number,experience:"Unknown",joinedDate:D.created_at,totalReviews:D.total_reviews||0,verificationStatus:D.verification_status||"not_started",verificationDocuments:D.verification_documents||{},phoneVerifiedAt:D.phone_verified_at,verifiedAt:D.verified_at,agriLinkVerificationRequested:D.verification_submitted||!1,agriLinkVerificationRequestedAt:D.agri_link_verification_requested_at};console.log("✅ User data refreshed:",V.email),console.log("📋 Updated verification status:",V.verificationStatus),console.log("📋 Updated verified status:",V.verified),await t(V)}}catch(D){console.error("❌ Error refreshing user data:",D)}},children:"🔄 Refresh"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Complete your verification in ",k?"4":"3"," steps to build trust and credibility"]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2 mt-4",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-500",style:{width:`${F()}%`}})}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[F(),"% Complete"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(I,{className:(s.phoneVerified,"bg-primary/5 border-primary/20"),children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${s.phoneVerified?"bg-primary":"bg-primary/10 border-2 border-primary/40"}`,children:s.phoneVerified?e.jsx(Z,{className:"w-5 h-5 text-white"}):e.jsx(qe,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`font-medium truncate ${s.phoneVerified?"text-primary":"text-primary/90"}`,children:"Phone Verification"}),e.jsx("p",{className:`text-sm truncate ${s.phoneVerified?"text-primary/80":"text-primary"}`,children:s.phoneVerified?"Phone number verified":"Verify your phone number"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx($,{variant:"secondary",className:s.phoneVerified?"bg-green-100 text-green-700 border-green-200":"bg-red-100 text-red-700 border-red-200",children:s.phoneVerified?"Complete":"Required"}),e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>l(!0),className:`p-1 h-8 w-8 ${s.phoneVerified?"text-primary hover:bg-primary/10":"text-muted-foreground hover:bg-muted"}`,children:e.jsx(fs,{className:"w-4 h-4"})})]})]})})}),e.jsx(I,{className:(s.verified||C.isComplete,"bg-primary/5 border-primary/20"),children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${s.verified||C.isComplete?"bg-primary":"bg-primary/10 border-2 border-primary/40"}`,children:s.verified?e.jsx(Z,{className:"w-5 h-5 text-white"}):C.isComplete?e.jsx(Z,{className:"w-5 h-5 text-white"}):e.jsx(Me,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`font-medium truncate ${s.verified||C.isComplete?"text-primary":"text-primary/90"}`,children:"Identity Documents"}),e.jsx("p",{className:`text-sm truncate ${s.verified||C.isComplete?"text-primary/80":"text-primary"}`,children:s.verified?"Documents verified":C.isComplete?"Documents uploaded":"Upload identity documents"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx($,{variant:"secondary",className:s.verified||C.isComplete?"bg-green-100 text-green-700 border-green-200":"bg-red-100 text-red-700 border-red-200",children:s.verified||C.isComplete?"Complete":"Required"}),e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>P(!0),className:`p-1 h-8 w-8 ${s.verified||C.isComplete,"text-primary hover:bg-primary/10"}`,children:e.jsx(fs,{className:"w-4 h-4"})})]})]})})}),k&&(()=>{const D=!!s.businessName,M=!!r.businessLicense||!!s.verificationDocuments?.businessLicense&&s.verificationDocuments?.businessLicense?.status!=="pending",V=s.verified||D&&M;return e.jsx(I,{className:"bg-primary/5 border-primary/20",children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${V?"bg-primary":"bg-primary/10 border-2 border-primary/40"}`,children:V?e.jsx(Z,{className:"w-5 h-5 text-white"}):e.jsx(os,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`font-medium truncate ${V?"text-primary":"text-primary/90"}`,children:"Business Details"}),e.jsx("p",{className:`text-sm truncate ${V?"text-primary/80":"text-primary"}`,children:V?"Business information & license completed":D?"Business license needed":"Complete business information"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx($,{variant:"secondary",className:V?"bg-green-100 text-green-700 border-green-200":"bg-red-100 text-red-700 border-red-200",children:V?"Complete":"Required"}),e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>h(!0),className:"p-1 h-8 w-8 text-primary hover:bg-primary/10",children:e.jsx(fs,{className:"w-4 h-4"})})]})]})})})})(),s.verified?e.jsx(I,{className:"bg-emerald-50 border-emerald-200",children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-emerald-600 flex items-center justify-center flex-shrink-0",children:e.jsx(Z,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-emerald-700 truncate",children:"AgriLink Verification"}),e.jsx("p",{className:"text-sm text-emerald-600 truncate",children:"Your account is fully verified!"}),s.agriLinkVerificationDate&&e.jsxs("p",{className:"text-xs text-emerald-600 mt-1 truncate",children:["on ",new Date(s.agriLinkVerificationDate).toLocaleDateString()]})]})]}),e.jsx($,{variant:"secondary",className:"bg-emerald-100 text-emerald-700 border-emerald-200 flex-shrink-0",children:"Verified"})]})})}):v?e.jsx(I,{className:"bg-blue-50 border-blue-200",children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center flex-shrink-0",children:e.jsx(ae,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-blue-800 truncate",children:"AgriLink Verification"}),e.jsx("p",{className:"text-sm text-blue-700 truncate",children:"Verification submitted for review"})]})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:e.jsx(u,{size:"sm",disabled:!0,variant:"secondary",className:"text-xs px-3 py-2 bg-blue-100 text-blue-700 border-blue-200",children:"Verification Requested"})})]})})}):e.jsx(I,{className:"bg-primary/5 border-primary/20",children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 border-2 border-primary/40 flex items-center justify-center flex-shrink-0",children:e.jsx(ae,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-primary/90 truncate",children:"AgriLink Verification"}),e.jsx("p",{className:"text-sm text-primary truncate",children:"Complete all steps to get verified"})]})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:(()=>{const D=!k||!!s.businessName,M=!k||!!r.businessLicense||!!s.verificationDocuments?.businessLicense&&s.verificationDocuments?.businessLicense?.status!=="pending";if(s.verified,s.phoneVerified&&r.idCard&&D&&M&&!v)return e.jsx(u,{size:"sm",onClick:L,disabled:x,className:"text-xs px-3 py-2",children:x?"Processing...":"Request Verification"});{const oe=[];s.phoneVerified||oe.push("phone verification"),r.idCard||oe.push("ID documents"),k&&!D&&oe.push("business information"),k&&!M&&oe.push("business license");const me=oe.length>0?`Complete ${oe.join(", ")} first`:"Complete required steps above";return e.jsx(u,{size:"sm",disabled:!0,variant:"outline",className:"text-xs px-3 py-2 opacity-60 cursor-not-allowed",title:me,children:"Request Verification"})}})()})]})})}),s.verified&&e.jsx("p",{className:"text-sm text-emerald-600",children:"Congratulations! Your AgriLink verification is complete. You now have enhanced buyer trust and credibility."}),N&&e.jsx("p",{className:"text-sm text-blue-700",children:"AgriLink verification requested successfully! We will review your documents within 1-2 business days and notify you of the outcome."}),e.jsx("div",{className:"mt-8 pt-6",children:e.jsxs(u,{variant:"ghost",size:"sm",onClick:a,className:"px-3 py-2",children:[e.jsx(fs,{className:"w-4 h-4 mr-2 rotate-180"}),"Back to Profile"]})})]})]})}function Jr({user:s,onBack:a,onEditProfile:t,onShowVerification:r,onUpdate:o,onViewStorefront:i}){if(!s)return e.jsx("div",{className:"max-w-4xl mx-auto p-4",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-muted-foreground",children:"User data not available"}),e.jsx(u,{onClick:a,className:"mt-4",children:"Go Back"})]})});const[g,b]=d.useState(null),[n,v]=d.useState(!1),[f,N]=d.useState(!1),[m,x]=d.useState(()=>s?{name:s.name||"",phone:s.phone||"",location:s.location||"",profileImage:s.profileImage||"",region:s.region||"",businessName:s.businessName||""}:{name:"",phone:"",location:"",profileImage:"",region:"",businessName:""}),c=d.useRef(null),y=d.useRef(null);d.useEffect(()=>{if(!s)return;if(!y.current||s.name!==y.current.name||s.phone!==y.current.phone||s.location!==y.current.location||s.profileImage!==y.current.profileImage||s.region!==y.current.region||s.businessName!==y.current.businessName||s.facebook!==y.current.facebook||s.instagram!==y.current.instagram||s.website!==y.current.website||s.telegram!==y.current.telegram){console.log("Profile: User data changed, updating form data");const j={name:s.name||"",phone:s.phone||"",location:s.location||"",profileImage:s.profileImage||"",region:s.region||"",businessName:s.businessName||"",facebook:s.facebook||"",instagram:s.instagram||"",website:s.website||"",telegram:s.telegram||""};x(j),y.current=s}},[s]);const l=async(S,j)=>{try{x(L=>({...L,[S]:j})),b(null),o&&await o({[S]:j})}catch(L){console.error("Failed to save:",L),x(q=>({...q,[S]:m[S]}))}},p=async S=>{if(!S.type.startsWith("image/")){alert("Please select a valid image file");return}if(S.size>10*1024*1024){alert("Image size must be less than 10MB");return}try{v(!1);const j=new FileReader,q=await new Promise(D=>{j.onload=()=>D(j.result),j.readAsDataURL(S)});if(console.log("Image compressed:",{originalSize:S.size,compressedSize:q.length,compressionRatio:(S.size/q.length).toFixed(2)}),o)try{await o({profileImage:q}),x(D=>({...D,profileImage:q})),console.log("✅ Profile image updated successfully")}catch(D){console.error("Failed to save profile image:",D);let M="Failed to save profile image. ";D instanceof Error?D.message.includes("Storage quota exceeded")||D.message.includes("storage is full")?(M+="Your browser storage is full. Please clear browser data or try a smaller image.",N(!0)):M+=D.message:(M+="Please try with a smaller image or clear browser data.",N(!0)),alert(M)}else x(D=>({...D,profileImage:q}))}catch(j){console.error("Failed to process image:",j),alert("Failed to process image. Please try a different image."),v(!1)}},P=async()=>{try{v(!1),o?(await o({profileImage:""}),console.log("✅ Profile image removed successfully")):x(S=>({...S,profileImage:""}))}catch(S){console.error("Failed to remove profile image:",S)}},w=(S,j)=>{b({field:S,value:j})},h=()=>{b(null),v(!1)},k=()=>{if(!m.region)return[];const S=Fe[m.region];return S?S.cities:[]},C=async S=>{try{const j={region:S,location:""};x(L=>({...L,...j})),b(null),o&&await o(j)}catch(j){console.error("Failed to save region:",j),x(L=>({...L,region:m.region,location:m.location}))}},F=async S=>{try{x(j=>({...j,location:S})),b(null),o&&await o({location:S})}catch(j){console.error("Failed to save location:",j),x(L=>({...L,location:m.location}))}};return e.jsxs("div",{className:"space-y-6",children:[f&&e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"w-5 h-5 text-amber-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-800",children:"Storage Nearly Full"}),e.jsx("p",{className:"text-sm text-amber-700",children:"Your browser storage may be getting full. This can cause issues saving profile changes."})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{size:"sm",variant:"outline",onClick:()=>console.log("Storage management not needed with Supabase"),className:"border-amber-300 text-amber-700 hover:bg-amber-100",children:[e.jsx(sr,{className:"w-4 h-4 mr-2"}),"Manage Storage"]}),e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>N(!1),className:"text-amber-700",children:e.jsx(Pe,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(u,{variant:"ghost",onClick:a,className:"h-9 px-3 -ml-3",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Back"]}),g||n?e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(u,{variant:"outline",size:"sm",onClick:h,children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Cancel"]})}):null]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"My Profile"}),e.jsx("p",{className:"text-muted-foreground",children:"View and manage your account information"})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx(I,{className:"overflow-hidden border-primary/30",children:e.jsxs(W,{className:"text-center pb-6",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsxs("div",{className:"relative group",children:[m.profileImage?e.jsx(Es,{src:m.profileImage,alt:`${m.name}'s profile picture`,className:"w-28 h-28 rounded-full object-cover border-4 border-border shadow-lg"}):e.jsx("div",{className:"w-28 h-28 rounded-full border-4 border-border shadow-lg bg-muted flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mx-auto",children:e.jsx(ve,{className:"w-6 h-6 text-primary"})})})}),e.jsx("div",{className:"absolute inset-0 bg-black/40 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer",onClick:()=>v(!0),children:e.jsx(Ns,{className:"w-6 h-6 text-white"})}),s.verified&&e.jsx("div",{className:"absolute -bottom-1 -right-1 w-8 h-8 bg-green-500 rounded-full flex items-center justify-center border-2 border-card",children:e.jsx(Z,{className:"w-5 h-5 text-white"})})]})}),e.jsx("input",{ref:c,type:"file",accept:"image/*",onChange:S=>{const j=S.target.files?.[0];j&&p(j)},className:"hidden"}),n&&e.jsxs("div",{className:"mb-4 p-4 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Update your profile picture"}),e.jsxs("div",{className:"flex gap-2 justify-center flex-wrap",children:[e.jsxs(u,{size:"sm",onClick:()=>c.current?.click(),children:[e.jsx(Ns,{className:"w-4 h-4 mr-2"}),"Choose Photo"]}),s.profileImage&&m.profileImage&&e.jsxs(u,{size:"sm",variant:"outline",onClick:P,className:"text-destructive hover:text-destructive",children:[e.jsx(Zs,{className:"w-4 h-4 mr-2"}),"Remove Photo"]}),e.jsx(u,{size:"sm",variant:"outline",onClick:()=>v(!1),children:"Cancel"})]})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[g?.field==="name"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{value:g.value,onChange:S=>b({...g,value:S.target.value}),className:"text-center text-xl font-bold",autoFocus:!0,onKeyDown:S=>{S.key==="Enter"&&l("name",g.value),S.key==="Escape"&&h()}}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsxs(u,{size:"sm",onClick:()=>l("name",g.value),children:[e.jsx(Se,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsx(u,{size:"sm",variant:"outline",onClick:h,children:"Cancel"})]})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Y,{className:"text-2xl font-bold",children:m.name}),e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>w("name",m.name),className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",children:e.jsx(le,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex justify-center gap-2 flex-wrap",children:e.jsx(xs,{userType:s.userType,accountType:ms(s),verificationLevel:Ke(s),size:"md"})})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs(u,{variant:"outline",className:`w-full h-11 font-medium ${(()=>{switch(Ke(s)){case"business-verified":case"id-verified":return"text-green-600 border-green-300 hover:bg-green-50 hover:text-green-700 dark:text-green-400 dark:border-green-700 dark:hover:bg-green-900/20";case"under-review":return"text-blue-600 border-blue-300 hover:bg-blue-50 hover:text-blue-700 dark:text-blue-400 dark:border-blue-700 dark:hover:bg-blue-900/20";case"phone-verified":return"text-yellow-600 border-yellow-300 hover:bg-yellow-50 hover:text-yellow-700 dark:text-yellow-400 dark:border-yellow-700 dark:hover:bg-yellow-900/20";default:return"text-red-600 border-red-300 hover:bg-red-50 hover:text-red-700 dark:text-red-400 dark:border-red-700 dark:hover:bg-red-900/20"}})()}`,onClick:()=>r(1),children:[(()=>{switch(Ke(s)){case"business-verified":case"id-verified":return e.jsx(ae,{className:"w-4 h-4 mr-2 text-green-600 dark:text-green-400"});case"under-review":return e.jsx(ae,{className:"w-4 h-4 mr-2 text-blue-600 dark:text-blue-400"});case"phone-verified":return e.jsx(ae,{className:"w-4 h-4 mr-2 text-yellow-600 dark:text-yellow-400"});default:return e.jsx(ae,{className:"w-4 h-4 mr-2 text-red-600 dark:text-red-400"})}})(),"View Verification Details"]})})]})}),e.jsxs(I,{className:"mt-6 border-primary/30",children:[e.jsx(W,{children:e.jsx(Y,{className:"text-lg",children:"Account Stats"})}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(us,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Member Since"})]}),e.jsx("span",{className:"text-sm font-medium",children:zs(s.joinedDate)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Rating"})]}),e.jsx("span",{className:"text-sm font-medium",children:s.rating>0?`${s.rating}/5 (${s.totalReviews} reviews)`:"No ratings yet"})]})]})]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(I,{className:"border-primary/30",children:[e.jsx(W,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5"}),"Contact Information"]})}),e.jsx(R,{className:"space-y-6",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 md:gap-x-10 md:gap-y-8",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ds,{className:"w-4 h-4"}),"Email Address"]}),e.jsx("p",{className:"font-medium",children:s.email})]}),(s.userType==="farmer"||s.userType==="trader")&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Ye,{className:"w-4 h-4"}),s.userType==="farmer"?"Farm Name":"Business Name"]}),g?.field==="businessName"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{value:g.value,onChange:S=>b({...g,value:S.target.value}),placeholder:s.userType==="farmer"?"Enter your farm name":"Enter your business name",autoFocus:!0,onKeyDown:S=>{S.key==="Enter"&&l("businessName",g.value),S.key==="Escape"&&h()}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{size:"sm",onClick:()=>l("businessName",g.value),children:[e.jsx(Se,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsx(u,{size:"sm",variant:"outline",onClick:h,children:"Cancel"})]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium flex-1",children:m.businessName||`${m.name}'s ${s.userType==="farmer"?"Farm":"Trading"}`}),e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>w("businessName",m.businessName||""),className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",children:e.jsx(le,{className:"w-4 h-4"})})]}),!m.businessName&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:['Currently showing as "',m.name,"'s ",s.userType==="farmer"?"Farm":"Trading",'" - Click edit to customize']})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(qe,{className:"w-4 h-4"}),"Phone Number"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium flex-1",children:m.phone||"Add phone number"}),e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>{r(3)},className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",title:m.phone?"Update and verify phone number":"Add and verify phone number",children:e.jsx(le,{className:"w-4 h-4"})})]}),s.phoneVerified&&e.jsxs($,{variant:"outline",className:"text-xs text-green-600 border-green-200",children:[e.jsx(Z,{className:"w-3 h-3 mr-1"}),"Verified"]}),!s.phoneVerified&&m.phone&&e.jsxs($,{variant:"outline",className:"text-xs text-orange-600 border-orange-200",children:[e.jsx(Ue,{className:"w-3 h-3 mr-1"}),"Unverified"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(de,{className:"w-4 h-4"}),"Location"]}),g?.field==="location"||g?.field==="region"?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{className:"text-sm",children:"Region"}),e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4 z-10"}),e.jsxs(pe,{value:m.region,onValueChange:C,children:[e.jsx(fe,{className:"pl-10",children:e.jsx(ge,{placeholder:"Select your region"})}),e.jsx(je,{className:"max-h-64 overflow-y-auto",children:Object.entries(Fe).map(([S,j])=>e.jsx(B,{value:S,children:j.name},S))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{className:"text-sm",children:"City/Town"}),e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4 z-10"}),e.jsxs(pe,{value:m.location,onValueChange:F,disabled:!m.region,children:[e.jsx(fe,{className:"pl-10",children:e.jsx(ge,{placeholder:"Select your city/town"})}),e.jsx(je,{className:"max-h-64 overflow-y-auto",children:k().map(S=>e.jsx(B,{value:S,children:S},S))})]})]}),!m.region&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Please select a region first"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(u,{size:"sm",variant:"outline",onClick:h,children:"Done"})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium flex-1",children:(()=>{if(console.log("Profile: Location display debug:",{location:m.location,region:m.region,regionData:m.region?Fe[m.region]:null}),m.location&&!m.region){const S=Object.entries(Fe).find(([j,L])=>L.cities.includes(m.location));if(S){console.log("Auto-detected region for",m.location,":",S[0]);const j={region:S[0]};return x(L=>({...L,...j})),o&&o(j).catch(L=>{console.error("Failed to auto-save region:",L),x(q=>({...q,region:""}))}),`${m.location}, ${S[1].name}`}}return m.location?`${m.location}${m.region?`, ${Fe[m.region]?.name||m.region}`:""}`:"Add location"})()}),e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>{b({field:"location",value:m.location})},className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",children:e.jsx(le,{className:"w-4 h-4"})})]})]})]})})]}),(s.userType==="farmer"||s.userType==="trader")&&e.jsxs(I,{className:"border-primary/30",children:[e.jsx(W,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"w-5 h-5"}),"Business Management"]})}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mx-auto",children:e.jsx(Ye,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Manage Your Storefront"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Set up your business description, product categories, and customer information in your dedicated storefront."})]}),e.jsx(u,{onClick:()=>{i&&s?.id&&i(s.id)},className:"w-full",children:"View My Storefront"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground bg-amber-50 border border-amber-200 rounded-lg p-3",children:[e.jsx("strong",{children:"💡 Business Focus:"})," Your profile is for account management. Use your storefront to showcase products, business information, and connect with customers."]})]})]})]})]})]})}function Gr({currentUser:s,onBack:a,onStartChat:t}){const[r,o]=d.useState(""),[i,g]=d.useState("all"),[b,n]=d.useState(null),v=s,{conversations:f,messages:N,loading:m,loadConversations:x,loadMessages:c,error:y}=ea();d.useEffect(()=>{v?.id&&x(v.id)},[v?.id,x]),d.useEffect(()=>{b&&v?.id&&c(b)},[b,v?.id,c]);const l=h=>{if(!h)return"Just now";const k=new Date(h);if(isNaN(k.getTime()))return console.warn("Invalid timestamp in Messages:",h),"Just now";const F=new Date().getTime()-k.getTime(),S=Math.floor(F/(1e3*60*60)),j=Math.floor(S/24);return S<1?"Just now":S<24?`${S}h ago`:j<7?`${j}d ago`:k.toLocaleDateString()},p=d.useMemo(()=>f?.length?f.map(h=>{const k=h.buyerId===v?.id?h.sellerId:h.buyerId,C=h.buyerId===v?.id?h.sellerName:h.buyerName,F=h.unreadCount||0,S=h.lastMessage;return{id:h.id,productId:h.productId,productName:h.productName||"Unknown Product",productImage:h.productImage||"https://images.unsplash.com/photo-1546470427-227c013b2b5f?w=400&h=300&fit=crop",otherParty:{id:k,name:C||"Unknown User",type:h.buyerId===v?.id?h.sellerType:h.buyerType,location:h.buyerId===v?.id?h.sellerLocation:h.buyerLocation||"Unknown Location",rating:h.buyerId===v?.id?h.sellerRating:h.buyerRating,verified:h.buyerId===v?.id?h.sellerVerified:h.buyerVerified},lastMessage:S?{content:S,timestamp:h.lastMessageTime||h.createdAt,isOwn:!1}:{content:"No messages yet",timestamp:h.lastMessageTime||h.createdAt,isOwn:!1},unreadCount:F,status:h.status==="active"?"active":"archived"}}):[],[f?.length,Object.keys(N).length,v?.id]),P=d.useMemo(()=>{let h=p;switch(r&&(h=h.filter(k=>k.otherParty.name.toLowerCase().includes(r.toLowerCase())||k.productName.toLowerCase().includes(r.toLowerCase())||k.lastMessage.content.toLowerCase().includes(r.toLowerCase()))),i){case"unread":h=h.filter(k=>k.unreadCount>0);break;case"active":h=h.filter(k=>k.status==="active");break;case"archived":h=h.filter(k=>k.status==="archived");break}return h.sort((k,C)=>new Date(C.lastMessage.timestamp).getTime()-new Date(k.lastMessage.timestamp).getTime())},[p,r,i]),w=p.reduce((h,k)=>h+k.unreadCount,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(u,{variant:"ghost",onClick:a,className:"h-9 px-3 -ml-3",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Back"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Messages"}),e.jsxs("p",{className:"text-muted-foreground",children:[w>0?`${w} unread messages`:"All caught up!",v?` • Logged in as ${v.name}`:" • Not authenticated"]})]})]}),y&&e.jsx(I,{className:"border-red-200 bg-red-50",children:e.jsxs(R,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(Is,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Error loading conversations"})]}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:y}),e.jsx(u,{variant:"outline",size:"sm",onClick:()=>x(v?.id),className:"mt-2",children:"Retry"})]})}),!v&&e.jsx(I,{className:"border-amber-200 bg-amber-50",children:e.jsxs(R,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-amber-700",children:[e.jsx(Is,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Authentication Issue"})]}),e.jsx("p",{className:"text-amber-600 text-sm mt-1",children:"No authenticated user found. Please log in to view messages."}),e.jsx(u,{variant:"outline",size:"sm",onClick:a,className:"mt-2",children:"Go Back"})]})}),e.jsx(I,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ma,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(J,{type:"text",placeholder:"Search conversations...",value:r,onChange:h=>o(h.target.value),className:"w-full pl-10"})]}),e.jsx("div",{className:"flex gap-2",children:[{key:"all",label:"All",count:p.length},{key:"unread",label:"Unread",count:w},{key:"active",label:"Active",count:p.filter(h=>h.status==="active").length}].map(h=>e.jsxs(u,{variant:i===h.key?"default":"outline",size:"sm",onClick:()=>g(h.key),className:"gap-2",children:[h.label,h.count>0&&e.jsx($,{variant:"secondary",className:"text-xs px-1.5 py-0.5",children:h.count})]},h.key))})]})})}),e.jsx("div",{className:"space-y-4",children:P.length===0?e.jsx(I,{children:e.jsxs(R,{className:"p-12 text-center",children:[e.jsx(Ne,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"font-medium mb-2",children:"No conversations found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:r?`No conversations match "${r}"`:i==="unread"?"You're all caught up! No unread messages.":"Start chatting with sellers and buyers to see conversations here."}),!r&&i==="all"&&e.jsx(u,{variant:"outline",onClick:a,children:"Browse Products"})]})}):P.map(h=>e.jsx(I,{className:`cursor-pointer transition-all hover:shadow-md ${h.unreadCount>0?"ring-2 ring-primary/20":""}`,onClick:()=>n(h.id),children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:h.productImage,alt:h.productName,className:"w-16 h-16 rounded-lg object-cover",onError:k=>{const C=k.target;C.src="https://images.unsplash.com/photo-1546470427-227c013b2b5f?w=400&h=300&fit=crop"}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-medium truncate",children:h.otherParty.name}),e.jsx(xs,{userType:h.otherParty.type,accountType:ms(h.otherParty),verificationLevel:Ke(h.otherParty),size:"sm"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(ce,{className:"w-3 h-3"}),l(h.lastMessage.timestamp)]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-2",children:[e.jsx(ne,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:h.productName}),e.jsx("span",{children:"•"}),e.jsx(de,{className:"w-3 h-3"}),e.jsx("span",{children:h.otherParty.location}),h.otherParty.rating>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(He,{className:"w-3 h-3 text-yellow-400 fill-current"}),e.jsx("span",{children:h.otherParty.rating.toFixed(1)})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-muted-foreground truncate flex-1 mr-4",children:[h.lastMessage.isOwn?"You: ":"",h.lastMessage.content||"No message content"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[h.unreadCount>0&&e.jsx($,{variant:"default",className:"bg-primary text-primary-foreground px-2 py-1 text-xs",children:h.unreadCount}),e.jsx(u,{variant:"ghost",size:"sm",className:"p-1",children:e.jsx(ar,{className:"w-4 h-4"})})]})]})]})]})})},h.id))}),p.length===0&&!m&&v&&e.jsx(I,{children:e.jsxs(R,{className:"p-12 text-center",children:[e.jsx(Ne,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No messages yet"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:"Start conversations with farmers, traders, and buyers by browsing products and clicking the chat button."}),e.jsx("div",{className:"flex justify-center",children:e.jsx(u,{onClick:a,children:"Browse Products"})})]})}),m&&e.jsx(I,{children:e.jsxs(R,{className:"p-12 text-center",children:[e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-muted rounded-full mx-auto"}),e.jsx("div",{className:"h-4 bg-muted rounded w-1/2 mx-auto"}),e.jsx("div",{className:"h-3 bg-muted rounded w-1/3 mx-auto"})]}),e.jsx("p",{className:"text-muted-foreground mt-4",children:"Loading conversations..."})]})}),b&&(()=>{const h=p.find(k=>k.id===b);return h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-card shadow-2xl border-l border-t z-50 transition-transform duration-300 md:hidden",children:e.jsx(Hs,{sellerName:h.otherParty.name,sellerType:h.otherParty.type,sellerLocation:h.otherParty.location,sellerRating:h.otherParty.rating,productName:h.productName,productId:h.productId,sellerId:h.otherParty.id,conversationId:h.id,onClose:()=>n(null),sellerVerified:h.otherParty.verified,currentUserVerified:v?.verified||!1,currentUserType:v?.userType,currentUser:v,sellerVerificationStatus:{trustLevel:h.otherParty.verified?"id-verified":"unverified",tierLabel:h.otherParty.verified?"Verified":"Unverified",levelBadge:h.otherParty.verified?"Tier 1":"Unverified"},product:{id:h.productId,name:h.productName,price:h.productPrice||0,quantity:h.productQuantity||0,unit:h.productUnit||"units",category:h.productCategory||"General",sellerId:h.otherParty.id,sellerName:h.otherParty.name,sellerType:h.otherParty.type,location:h.otherParty.location,image:h.productImage}})}),e.jsx("div",{className:"hidden md:block fixed right-0 bottom-0 h-[500px] w-96 bg-card shadow-2xl border-l border-t z-50 transition-transform duration-300",children:e.jsx(Hs,{sellerName:h.otherParty.name,sellerType:h.otherParty.type,sellerLocation:h.otherParty.location,sellerRating:h.otherParty.rating,productName:h.productName,productId:h.productId,sellerId:h.otherParty.id,conversationId:h.id,onClose:()=>n(null),sellerVerified:h.otherParty.verified,currentUserVerified:v?.verified||!1,currentUserType:v?.userType,currentUser:v,sellerVerificationStatus:{trustLevel:h.otherParty.verified?"id-verified":"unverified",tierLabel:h.otherParty.verified?"Verified":"Unverified",levelBadge:h.otherParty.verified?"Tier 1":"Unverified"},product:{id:h.productId,name:h.productName,price:h.productPrice||0,quantity:h.productQuantity||0,unit:h.productUnit||"units",category:h.productCategory||"General",sellerId:h.otherParty.id,sellerName:h.otherParty.name,sellerType:h.otherParty.type,location:h.otherParty.location,image:h.productImage}})})]}):null})()]})}function Qr({onClose:s,onStartVerification:a,feature:t,sellerName:r,userType:o}){const g=(()=>{switch(t){case"chat":return{icon:e.jsx(Ne,{className:"w-6 h-6"}),title:o==="buyer"?"Quick Phone Verification Required":"Direct Messaging Requires Verification",description:o==="buyer"?`To start chatting with ${r||"sellers"}, you just need to verify your phone number.`:`To start a conversation with ${r||"sellers"}, you need to complete account verification.`,benefits:o==="buyer"?["Instant access to chat with sellers","View seller contact information","Secure communication","No complex verification required"]:["Direct communication with verified sellers","Protected messaging environment","Priority seller responses","Access to exclusive deals and bulk pricing"]};case"contact":return{icon:e.jsx(qe,{className:"w-6 h-6"}),title:o==="buyer"?"Phone Verification Required":"Contact Information Requires Verification",description:o==="buyer"?"Just verify your phone number to access seller contact information.":"Phone numbers and direct contact details are only available to verified users.",benefits:o==="buyer"?["Access to seller phone numbers","Direct contact capabilities","Faster communication","Simple one-step verification"]:["Access to seller phone numbers","Direct contact capabilities","Faster communication channels","Building trusted business relationships"]};case"listing":return{icon:e.jsx(ne,{className:"w-6 h-6"}),title:"Product Listing Requires Verification",description:o==="farmer"?"Farmers need verification to create product listings and ensure marketplace quality.":"Sellers need verification to create product listings and ensure marketplace quality.",benefits:["List unlimited products","Full storefront customization","Advanced listing management","Higher visibility in search results"]};case"storefront":return{icon:e.jsx(Ye,{className:"w-6 h-6"}),title:"Storefront Management Requires Verification",description:"Professional storefront features are available only to verified sellers.",benefits:["Custom storefront design","Business analytics dashboard","Advanced inventory management","Professional seller badge"]};default:return{icon:e.jsx(ae,{className:"w-6 h-6"}),title:"Feature Requires Verification",description:"This feature is only available to verified users.",benefits:["Enhanced platform access","Trusted user status"]}}})();return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs(I,{className:"w-full max-w-lg",children:[e.jsxs(W,{className:"relative",children:[e.jsx(u,{variant:"ghost",size:"sm",className:"absolute right-2 top-2",onClick:s,children:e.jsx(Pe,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex items-center gap-3 pr-8",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center text-primary",children:g.icon}),e.jsxs("div",{children:[e.jsx(Y,{className:"text-lg",children:g.title}),e.jsx(De,{className:"text-sm mt-1",children:g.description})]})]})]}),e.jsxs(R,{className:"space-y-6",children:[e.jsxs(Le,{children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsxs(Re,{children:[e.jsx("strong",{children:"Why verification?"})," We require verification to build trust, prevent spam, and ensure quality interactions between all users in the AgriLink marketplace."]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-primary"}),"Verification Benefits"]}),e.jsx("ul",{className:"space-y-2",children:g.benefits.map((b,n)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-primary rounded-full"}),b]},n))})]}),(t==="listing"||t==="storefront")&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:o==="buyer"?"Simple Verification":"Verification Process"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx($,{variant:"outline",className:"w-6 h-6 rounded-full p-0 flex items-center justify-center",children:"1"}),e.jsxs("span",{className:"text-muted-foreground",children:["Phone verification (",o==="buyer"?"1 minute":"2 minutes",")"]})]}),o!=="buyer"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx($,{variant:"outline",className:"w-6 h-6 rounded-full p-0 flex items-center justify-center",children:"2"}),e.jsx("span",{className:"text-muted-foreground",children:"Upload ID document (5 minutes)"})]}),(o==="farmer"||o==="trader")&&e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx($,{variant:"outline",className:"w-6 h-6 rounded-full p-0 flex items-center justify-center",children:"3"}),e.jsx("span",{className:"text-muted-foreground",children:"Complete business details (3 minutes)"})]})]}),o==="buyer"&&e.jsx("div",{className:"text-sm text-muted-foreground",children:"That's it! Just one step for buyers."})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(u,{onClick:s,variant:"outline",className:"flex-1",children:"Maybe Later"}),e.jsxs(u,{onClick:a,className:"flex-1",children:[o==="buyer"?"Verify Phone":"Start Verification",e.jsx(Ms,{className:"w-4 h-4 ml-2"})]})]})]})]})})}function Zr({currentAdmin:s,onBack:a}){const[t,r]=d.useState([]),[o,i]=d.useState(null),[g,b]=d.useState(""),[n,v]=d.useState(!1);d.useEffect(()=>{const l=async()=>{try{const{data:P,error:w}=await z.from("verification_requests").select(`
            id,
            user_id,
            user_email,
            user_name,
            user_type,
            account_type,
            request_type,
            status,
            submitted_at,
            reviewed_at,
            reviewed_by,
            verification_documents,
            business_info,
            phone_verified,
            admin_notes,
            created_at,
            updated_at
          `).order("submitted_at",{ascending:!1});if(w)throw console.error("❌ Error fetching verification requests:",w),w;const k=(P||[]).map(C=>({id:C.id,userId:C.user_id,userEmail:C.user_email,userName:C.user_name,userType:C.user_type,accountType:C.account_type,verificationStatus:C.status==="under_review"?"under_review":C.status==="approved"?"verified":C.status==="rejected"?"rejected":"under_review",verificationSubmitted:!0,verificationDocuments:C.verification_documents||{},businessInfo:C.business_info||{},phoneVerified:C.phone_verified,submittedAt:C.submitted_at,type:C.account_type==="business"?"Business Account":"Individual Account",status:C.status,documents:C.verification_documents||{},businessType:C.account_type}));r(k)}catch(P){console.error("❌ Failed to load verification requests:",P),ee.error("Failed to load verification requests")}};l();const p=setInterval(l,3e4);return()=>clearInterval(p)},[]);const f=async l=>{v(!0);try{const{data:p,error:P}=await z.from("users").select("id, email, user_type, name").eq("id",s.id).single(),{error:w}=await z.from("verification_requests").update({status:"approved",reviewed_at:new Date().toISOString(),reviewed_by:s.id,admin_notes:g||"Approved by admin"}).eq("id",l);if(w)throw w;const h=t.find(C=>C.id===l);if(h){const{data:C,error:F}=await z.from("users").select("id, email, verification_status, verified").eq("id",h.userId).single();if(F){console.error("❌ User not found in database:",F);return}const{data:S,error:j}=await z.from("users").update({verification_status:"verified",verified:!0,verified_at:new Date().toISOString()}).eq("id",h.userId).select("id, email, verification_status, verified, verified_at");j&&(console.error("❌ Error updating user status:",j),console.log("⚠️ This is likely due to RLS policies - admin cannot update other users directly"))}else console.error("❌ Request not found for ID:",l),console.error("❌ Available requests:",t.map(C=>({id:C.id,userId:C.userId})));await(async()=>{try{const{data:C,error:F}=await z.from("verification_requests").select(`
              id,
              user_id,
              user_email,
              user_name,
              user_type,
              account_type,
              request_type,
              status,
              submitted_at,
              reviewed_at,
              reviewed_by,
              verification_documents,
              business_info,
              phone_verified,
              admin_notes,
              created_at,
              updated_at
            `).order("submitted_at",{ascending:!1});if(F)throw F;const S=(C||[]).map(j=>({id:j.id,userId:j.user_id,userEmail:j.user_email,userName:j.user_name,userType:j.user_type,accountType:j.account_type,verificationStatus:j.status==="under_review"?"under_review":j.status==="approved"?"verified":j.status==="rejected"?"rejected":"under_review",verificationSubmitted:!0,verificationDocuments:j.verification_documents||{},businessInfo:j.business_info||{},phoneVerified:j.phone_verified,submittedAt:j.submitted_at,type:j.account_type==="business"?"Business Account":"Individual Account",status:j.status,documents:j.verification_documents||{},businessType:j.account_type}));r(S)}catch(C){console.error("❌ Failed to refresh requests:",C)}})(),i(null),b(""),ee.success("Verification request approved")}catch(p){console.error("Error approving request:",p),ee.error("Failed to approve request")}finally{v(!1)}},N=async l=>{v(!0);try{const{error:p}=await z.from("verification_requests").update({status:"rejected",reviewed_at:new Date().toISOString(),reviewed_by:s.id,admin_notes:g||"Rejected by admin"}).eq("id",l);if(p)throw p;const P=t.find(w=>w.id===l);if(P){const{error:w}=await z.from("users").update({verification_status:"rejected",verified:!1}).eq("id",P.userId);w&&console.error("Error updating user status:",w)}r(w=>w.map(h=>h.id===l?{...h,verificationStatus:"rejected",status:"rejected"}:h)),i(null),b(""),ee.success("Verification request rejected")}catch(p){console.error("Error rejecting request:",p),ee.error("Failed to reject request")}finally{v(!1)}},m=l=>{switch(l){case"under_review":return e.jsxs($,{variant:"secondary",className:"bg-yellow-100 text-yellow-800",children:[e.jsx(ce,{className:"w-3 h-3 mr-1"}),"Under Review"]});case"approved":case"verified":return e.jsxs($,{variant:"secondary",className:"bg-green-100 text-green-800",children:[e.jsx(Z,{className:"w-3 h-3 mr-1"}),"Approved"]});case"rejected":return e.jsxs($,{variant:"secondary",className:"bg-red-100 text-red-800",children:[e.jsx(Ee,{className:"w-3 h-3 mr-1"}),"Rejected"]});default:return e.jsxs($,{variant:"secondary",className:"bg-gray-100 text-gray-800",children:[e.jsx(ce,{className:"w-3 h-3 mr-1"}),"Pending"]})}},x=l=>l==="business"?e.jsx(Je,{className:"w-4 h-4"}):e.jsx(ve,{className:"w-4 h-4"}),c=t.filter(l=>l.verificationStatus==="under_review"),y=t.filter(l=>l.verificationStatus!=="under_review");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Verification Requests"}),e.jsx("p",{className:"text-gray-600",children:"Review and manage user verification requests"})]}),e.jsx(u,{variant:"outline",onClick:a,children:"← Back to Dashboard"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(I,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Requests"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.length})]}),e.jsx(ae,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(I,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Review"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:c.length})]}),e.jsx(ce,{className:"h-8 w-8 text-yellow-600"})]})})}),e.jsx(I,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Approved"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:t.filter(l=>l.verificationStatus==="verified").length})]}),e.jsx(Z,{className:"h-8 w-8 text-green-600"})]})})}),e.jsx(I,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Rejected"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:t.filter(l=>l.verificationStatus==="rejected").length})]}),e.jsx(Ee,{className:"h-8 w-8 text-red-600"})]})})})]}),c.length>0&&e.jsxs(I,{children:[e.jsxs(W,{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5 text-yellow-600"}),"Pending Review (",c.length,")"]}),e.jsx(De,{children:"Verification requests awaiting admin review"})]}),e.jsx(R,{children:e.jsx("div",{className:"space-y-4",children:c.map(l=>e.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[x(l.accountType),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:l.userName}),e.jsx("p",{className:"text-sm text-gray-600",children:l.userEmail}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[m(l.verificationStatus),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(l.submittedAt).toLocaleDateString()})]})]})]}),e.jsxs(sa,{children:[e.jsx(Ha,{asChild:!0,children:e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>i(l),children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Review"]})}),e.jsxs(Vs,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(aa,{children:[e.jsx(Os,{children:"Review Verification Request"}),e.jsxs($s,{children:["Review documents and information for ",l.userName]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(O,{className:"text-sm font-medium",children:"User Information"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm",children:l.userName})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Email:"}),e.jsx("span",{className:"text-sm",children:l.userEmail})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Type:"}),e.jsx("span",{className:"text-sm",children:l.type})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Phone Verified:"}),e.jsx("span",{className:"text-sm",children:l.phoneVerified?"Yes":"No"})]})]})]}),l.businessInfo&&e.jsxs("div",{children:[e.jsx(O,{className:"text-sm font-medium",children:"Business Information"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm",children:l.businessInfo.businessName})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm",children:l.businessInfo.location})]}),e.jsx("p",{className:"text-sm text-gray-600",children:l.businessInfo.businessDescription})]})]})]}),e.jsx($e,{}),e.jsxs("div",{children:[e.jsx(O,{className:"text-sm font-medium",children:"Uploaded Documents"}),e.jsxs("div",{className:"mt-2 space-y-3",children:[l.verificationDocuments?.idCard&&e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium",children:"ID Card"}),e.jsx($,{variant:"outline",className:"text-xs",children:l.verificationDocuments.idCard.status})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:l.verificationDocuments.idCard.name}),l.verificationDocuments.idCard.data?e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>{const p=document.createElement("a");p.href=l.verificationDocuments?.idCard?.data||"",p.download=l.verificationDocuments?.idCard?.name||"id-card",p.click()},children:[e.jsx(oa,{className:"w-3 h-3 mr-1"}),"Download"]}):e.jsx("div",{className:"text-xs text-gray-400",children:"File content not stored"})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Uploaded: ",l.verificationDocuments.idCard.uploadedAt?new Date(l.verificationDocuments.idCard.uploadedAt).toLocaleString():"Unknown"]})]}),l.verificationDocuments?.businessLicense&&e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Business License"}),e.jsx($,{variant:"outline",className:"text-xs",children:l.verificationDocuments.businessLicense.status})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:l.verificationDocuments.businessLicense.name}),l.verificationDocuments.businessLicense.data?e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>{const p=document.createElement("a");p.href=l.verificationDocuments?.businessLicense?.data||"",p.download=l.verificationDocuments?.businessLicense?.name||"business-license",p.click()},children:[e.jsx(oa,{className:"w-3 h-3 mr-1"}),"Download"]}):e.jsx("div",{className:"text-xs text-gray-400",children:"File content not stored"})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Uploaded: ",l.verificationDocuments.businessLicense.uploadedAt?new Date(l.verificationDocuments.businessLicense.uploadedAt).toLocaleString():"Unknown"]})]})]})]}),e.jsx($e,{}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"admin-notes",className:"text-sm font-medium",children:"Admin Notes (Optional)"}),e.jsx(_e,{id:"admin-notes",placeholder:"Add notes about this verification request...",value:g,onChange:p=>b(p.target.value),className:"mt-2"})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(u,{variant:"outline",onClick:()=>{i(null),b("")},children:"Cancel"}),e.jsxs(u,{variant:"destructive",onClick:()=>N(l.id),disabled:n,children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Reject"]}),e.jsxs(u,{onClick:()=>f(l.id),disabled:n,children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Approve"]})]})]})]})]})]})},l.id))})})]}),y.length>0&&e.jsxs(I,{children:[e.jsxs(W,{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5 text-green-600"}),"Processed Requests (",y.length,")"]}),e.jsx(De,{children:"Previously reviewed verification requests"})]}),e.jsx(R,{children:e.jsx("div",{className:"space-y-4",children:y.map(l=>e.jsx("div",{className:"border rounded-lg p-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[x(l.accountType),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:l.userName}),e.jsx("p",{className:"text-sm text-gray-600",children:l.userEmail}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[m(l.verificationStatus),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(l.submittedAt).toLocaleDateString()})]})]})]})})},l.id))})})]}),t.length===0&&e.jsx(I,{children:e.jsxs(R,{className:"p-8 text-center",children:[e.jsx(ae,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Verification Requests"}),e.jsx("p",{className:"text-gray-600",children:"No verification requests have been submitted yet."})]})})]})}function Xr({currentAdmin:s,onBack:a,onNavigateToVerification:t}){const[r,o]=d.useState({totalUsers:0,pendingVerifications:0,totalProducts:0,activeTransactions:0,reportedContent:0,platformRevenue:0}),[i,g]=d.useState([]),[b,n]=d.useState(!0),[v]=d.useState([{id:"1",name:"Spam Product",seller:"Unknown",price:100,reportedCount:5},{id:"2",name:"Fake Listing",seller:"Suspicious",price:200,reportedCount:3}]),[f]=d.useState([{id:"1",amount:150,buyer:"John Doe",seller:"Jane Smith",date:"2 hours ago"},{id:"2",amount:300,buyer:"Mike Johnson",seller:"John Doe",date:"4 hours ago"}]),N=async()=>{try{n(!0);const{count:c}=await z.from("users").select("*",{count:"exact",head:!0}).neq("user_type","admin"),{data:y}=await z.from("users").select("verification_status, user_type").neq("user_type","admin");console.log("🔍 Debug - All verification statuses:",y?.map(w=>w.verification_status)),console.log("🔍 Debug - Under review count:",y?.filter(w=>w.verification_status==="under_review").length),console.log("🔍 Debug - Pending count:",y?.filter(w=>w.verification_status==="pending").length);const{count:l}=await z.from("users").select("*",{count:"exact",head:!0}).eq("verification_status","under_review").neq("user_type","admin"),{count:p}=await z.from("products").select("*",{count:"exact",head:!0}),{data:P}=await z.from("users").select("id, name, user_type, created_at, email").neq("user_type","admin").order("created_at",{ascending:!1}).limit(5);o({totalUsers:c||0,pendingVerifications:l||0,totalProducts:p||0,activeTransactions:156,reportedContent:8,platformRevenue:45670}),g(P||[])}catch(c){console.error("Error fetching admin data:",c)}finally{n(!1)}};d.useEffect(()=>{N()},[]),d.useEffect(()=>{const c=()=>{N()};return window.addEventListener("focus",c),()=>window.removeEventListener("focus",c)},[]);const m=(c,y)=>{console.log(`${y} product ${c}`)},x=c=>{const y=new Date(c),p=Math.floor((new Date().getTime()-y.getTime())/1e3);return p<60?"just now":p<3600?`${Math.floor(p/60)} minutes ago`:p<86400?`${Math.floor(p/3600)} hours ago`:`${Math.floor(p/86400)} days ago`};return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Admin Dashboard"}),e.jsxs("p",{className:"text-gray-600",children:["Welcome back, ",s.name]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(u,{variant:"outline",size:"sm",onClick:N,disabled:b,className:"flex items-center gap-2",children:[e.jsx(za,{className:`h-4 w-4 ${b?"animate-spin":""}`}),"Refresh"]}),e.jsx(u,{variant:"outline",onClick:a,children:"← Back to App"})]})]}),e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(I,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Xe,{className:"h-4 w-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold",children:b?"...":r.totalUsers.toLocaleString()})]})]})})}),e.jsx(I,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"h-4 w-4 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Verifications"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:b?"...":r.pendingVerifications})]})]})})}),e.jsx(I,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ne,{className:"h-4 w-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Products"}),e.jsx("p",{className:"text-2xl font-bold",children:b?"...":r.totalProducts.toLocaleString()})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(I,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ge,{className:"h-4 w-4 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Transactions"}),e.jsx("p",{className:"text-2xl font-bold",children:r.activeTransactions})]})]})})}),e.jsx(I,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ca,{className:"h-4 w-4 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Reported Content"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:r.reportedContent})]})]})})}),e.jsx(I,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Bs,{className:"h-4 w-4 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Platform Revenue"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",r.platformRevenue.toLocaleString()]})]})]})})})]})]}),e.jsx("div",{className:"mb-8",children:e.jsxs(I,{children:[e.jsxs(W,{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(Va,{className:"h-5 w-5"}),"Quick Actions"]}),e.jsx(De,{children:"Common admin tasks"})]}),e.jsx(R,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs(u,{variant:"outline",className:"h-20 flex-col gap-2",onClick:()=>{t?t():window.location.href="/admin-verification"},children:[e.jsx(ae,{className:"h-6 w-6"}),e.jsx("span",{className:"text-sm",children:"Review Verifications"})]}),e.jsxs(u,{variant:"outline",className:"h-20 flex-col gap-2",children:[e.jsx(ne,{className:"h-6 w-6"}),e.jsx("span",{className:"text-sm",children:"Moderate Products"})]}),e.jsxs(u,{variant:"outline",className:"h-20 flex-col gap-2",children:[e.jsx(Xe,{className:"h-6 w-6"}),e.jsx("span",{className:"text-sm",children:"Manage Users"})]}),e.jsxs(u,{variant:"outline",className:"h-20 flex-col gap-2",children:[e.jsx(Ge,{className:"h-6 w-6"}),e.jsx("span",{className:"text-sm",children:"View Transactions"})]})]})})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6 mb-6",children:[e.jsxs(I,{className:"border-l-4 border-l-yellow-500",children:[e.jsxs(W,{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5 text-yellow-600"}),"Verification Requests",e.jsxs($,{variant:"destructive",className:"ml-2",children:[r.pendingVerifications," pending"]})]}),e.jsx(De,{children:"User verification requests requiring review"})]}),e.jsx(R,{children:b?e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-gray-500",children:"Loading verification requests..."})}):r.pendingVerifications===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 mb-2",children:"✓"}),e.jsx("div",{className:"text-gray-500 mb-4",children:"No pending verification requests"}),e.jsx("div",{className:"text-sm text-gray-400",children:"All users are verified or no requests submitted"})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl font-bold text-yellow-600 mb-2",children:r.pendingVerifications}),e.jsxs("div",{className:"text-gray-600 mb-4",children:[r.pendingVerifications===1?"verification request":"verification requests"," pending review"]}),e.jsx(u,{className:"bg-yellow-600 hover:bg-yellow-700 text-white",onClick:()=>{t?t():window.location.href="/admin-verification"},children:"Review Verification Requests"})]})})]}),e.jsxs(I,{children:[e.jsxs(W,{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-5 w-5"}),"Recent Users"]}),e.jsx(De,{children:"Latest user registrations"})]}),e.jsx(R,{children:e.jsx("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:b?e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-gray-500",children:"Loading recent users..."})}):i.length===0?e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-gray-500",children:"No recent users"})}):i.map(c=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:c.name}),e.jsx("p",{className:"text-sm text-gray-600 truncate",children:c.email}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx($,{variant:c.user_type==="farmer"?"default":"secondary",className:"text-xs",children:c.user_type}),e.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(ce,{className:"h-3 w-3"}),x(c.created_at)]})]})]}),e.jsxs("div",{className:"flex gap-1 ml-2",children:[e.jsx(u,{size:"sm",variant:"outline",className:"h-8 w-8 p-0",children:e.jsx(ye,{className:"h-4 w-4"})}),e.jsx(u,{size:"sm",variant:"outline",className:"h-8 w-8 p-0",children:e.jsx(ae,{className:"h-4 w-4"})})]})]},c.id))})})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-1 gap-6",children:e.jsxs(I,{children:[e.jsxs(W,{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(ca,{className:"h-5 w-5"}),"Reported Content"]}),e.jsx(De,{children:"Items requiring attention"})]}),e.jsx(R,{children:e.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:v.map(c=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:c.name}),e.jsxs("p",{className:"text-sm text-gray-600 truncate",children:["by ",c.seller]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs($,{variant:"destructive",className:"text-xs",children:[c.reportedCount," reports"]}),e.jsxs("span",{className:"text-sm text-gray-600",children:["$",c.price]})]})]}),e.jsxs("div",{className:"flex gap-1 ml-2",children:[e.jsx(u,{size:"sm",variant:"outline",className:"h-8 w-8 p-0",onClick:()=>m(c.id,"approve"),children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx(u,{size:"sm",variant:"outline",className:"h-8 w-8 p-0",onClick:()=>m(c.id,"remove"),children:e.jsx(tr,{className:"h-4 w-4"})})]})]},c.id))})})]})})]})]})})}function ei({onBack:s}){return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsxs(u,{variant:"ghost",onClick:s,className:"h-9 px-3 -ml-3",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"About AgriLink"}),e.jsx("p",{className:"text-muted-foreground",children:"Connecting Myanmar's Agricultural Community"})]})]}),e.jsxs(I,{className:"border-primary/20 bg-primary/5",children:[e.jsx(W,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary rounded-lg flex items-center justify-center",children:e.jsx(Oe,{className:"w-5 h-5 text-primary-foreground"})}),e.jsxs("div",{children:[e.jsx(Y,{children:"Our Mission"}),e.jsx(De,{children:"Empowering Myanmar's agricultural ecosystem"})]})]})}),e.jsx(R,{children:e.jsx("p",{className:"text-base leading-relaxed",children:"AgriLink is dedicated to creating transparent, efficient connections between farmers, traders, and buyers across Myanmar. We believe in fair pricing, quality products, and building trust through verified partnerships that strengthen our agricultural community."})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Core Values"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(I,{children:[e.jsx(W,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ys,{className:"w-5 h-5 text-primary"}),e.jsx(Y,{className:"text-lg",children:"Transparency"})]})}),e.jsx(R,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Clear pricing, honest product descriptions, and verified seller information to build trust in every transaction."})})]}),e.jsxs(I,{children:[e.jsx(W,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"w-5 h-5 text-primary"}),e.jsx(Y,{className:"text-lg",children:"Community"})]})}),e.jsx(R,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Supporting local farmers and building connections that strengthen Myanmar's agricultural network."})})]}),e.jsxs(I,{children:[e.jsx(W,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(as,{className:"w-5 h-5 text-primary"}),e.jsx(Y,{className:"text-lg",children:"Quality"})]})}),e.jsx(R,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Promoting high-quality agricultural products and sustainable farming practices across Myanmar."})})]}),e.jsxs(I,{children:[e.jsx(W,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rr,{className:"w-5 h-5 text-primary"}),e.jsx(Y,{className:"text-lg",children:"Innovation"})]})}),e.jsx(R,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Using technology to modernize agricultural trade while respecting traditional farming values and practices."})})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Project Background"}),e.jsxs(I,{children:[e.jsx(W,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ir,{className:"w-6 h-6 text-primary"}),e.jsxs("div",{children:[e.jsx(Y,{children:"Academic Partnership Project"}),e.jsx(De,{children:"6th Semester IBS Project"})]})]})}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-medium",children:"External Client"})]}),e.jsx("p",{className:"text-sm text-muted-foreground pl-6",children:"Infinity Success Co. Ltd."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-medium",children:"Timeline"})]}),e.jsx("p",{className:"text-sm text-muted-foreground pl-6",children:"12-week development cycle"})]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Key Features"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm",children:"Price transparency system"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm",children:"Seller verification system"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm",children:"Mobile-first design"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm",children:"Myanmar agricultural context"})]})]})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Who We Serve"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(I,{className:"text-center",children:[e.jsxs(W,{children:[e.jsx(Cs,{className:"w-8 h-8 text-primary mx-auto mb-2"}),e.jsx(Y,{className:"text-lg",children:"Farmers"})]}),e.jsx(R,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connect directly with buyers, get fair prices for your products, and expand your market reach across Myanmar."})})]}),e.jsxs(I,{className:"text-center",children:[e.jsxs(W,{children:[e.jsx(qa,{className:"w-8 h-8 text-primary mx-auto mb-2"}),e.jsx(Y,{className:"text-lg",children:"Traders"})]}),e.jsx(R,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Source quality products from verified farmers and efficiently distribute to buyers throughout the region."})})]}),e.jsxs(I,{className:"text-center",children:[e.jsxs(W,{children:[e.jsx(Xe,{className:"w-8 h-8 text-primary mx-auto mb-2"}),e.jsx(Y,{className:"text-lg",children:"Buyers"})]}),e.jsx(R,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Access fresh, quality agricultural products directly from verified sources with transparent pricing."})})]})]})]}),e.jsxs("div",{className:"text-center pt-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"For more information about this project or partnership opportunities,"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"please contact us through our support channels."})]})]})}function si({onBack:s,currentUser:a}){const[t,r]=d.useState({name:a?.name||"",email:a?.email||"",subject:"",message:"",category:""}),[o,i]=d.useState(!1),g=async n=>{if(n.preventDefault(),!t.name||!t.email||!t.message){ee.error("Please fill in all required fields");return}i(!0);try{await new Promise(v=>setTimeout(v,1500)),ee.success("Message sent successfully! We'll get back to you soon."),r({name:"",email:"",subject:"",message:"",category:""})}catch{ee.error("Failed to send message. Please try again.")}finally{i(!1)}},b=(n,v)=>{r(f=>({...f,[n]:v}))};return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsxs(u,{variant:"ghost",onClick:s,className:"h-9 px-3 -ml-3",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Contact & Support"}),e.jsx("p",{className:"text-muted-foreground",children:"Get in touch with the AgriLink team for any questions or support"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs(I,{children:[e.jsxs(W,{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-primary"}),"Send us a Message"]}),e.jsx(De,{children:"Need help or have questions? Send us a message and we'll respond as soon as possible."})]}),e.jsx(R,{children:e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Name *"}),e.jsx(J,{value:t.name,onChange:n=>b("name",n.target.value),placeholder:"Your full name",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Email *"}),e.jsx(J,{type:"email",value:t.email,onChange:n=>b("email",n.target.value),placeholder:"your.email@example.com",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Category"}),e.jsxs(pe,{value:t.category,onValueChange:n=>b("category",n),children:[e.jsx(fe,{className:"w-full",children:e.jsx(ge,{placeholder:"Select a category"})}),e.jsxs(je,{children:[e.jsx(B,{value:"general",children:"General Inquiry"}),e.jsx(B,{value:"technical",children:"Technical Support"}),e.jsx(B,{value:"verification",children:"Account Verification"}),e.jsx(B,{value:"dispute",children:"Transaction Dispute"}),e.jsx(B,{value:"partnership",children:"Partnership"}),e.jsx(B,{value:"feedback",children:"Feedback"}),e.jsx(B,{value:"bug",children:"Bug Report"})]})]}),t.category==="technical"&&e.jsx("p",{className:"text-xs text-muted-foreground bg-blue-50 p-2 rounded",children:"💡 For technical issues, please describe what you were doing when the problem occurred and any error messages you saw."}),t.category==="verification"&&e.jsx("p",{className:"text-xs text-muted-foreground bg-green-50 p-2 rounded",children:"✅ For verification help, please mention your account type (Individual/Business) and which step you need assistance with."}),t.category==="dispute"&&e.jsx("p",{className:"text-xs text-muted-foreground bg-orange-50 p-2 rounded",children:"⚖️ For transaction disputes, please include relevant details about the order, seller, and the issue you're experiencing."}),t.category==="partnership"&&e.jsx("p",{className:"text-xs text-muted-foreground bg-purple-50 p-2 rounded",children:"🤝 For partnership inquiries, please describe your business and how you'd like to collaborate with AgriLink."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Subject"}),e.jsx(J,{value:t.subject,onChange:n=>b("subject",n.target.value),placeholder:"Brief description of your inquiry"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Message *"}),e.jsx(_e,{value:t.message,onChange:n=>b("message",n.target.value),placeholder:"Tell us how we can help you...",className:"min-h-32",required:!0})]}),e.jsx(u,{type:"submit",className:"w-full",disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin mr-2"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Fa,{className:"w-4 h-4 mr-2"}),"Send Message"]})})]})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(I,{children:[e.jsxs(W,{children:[e.jsx(Y,{className:"text-lg",children:"Project Information"}),e.jsx(De,{children:"Academic project details"})]}),e.jsx(R,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Je,{className:"w-4 h-4 text-primary mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"External Client"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Infinity Success Co. Ltd."})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ve,{className:"w-4 h-4 text-primary mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Project Type"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"6th Semester IBS Project"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ce,{className:"w-4 h-4 text-primary mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Development Period"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"12-week timeline"})]})]})]})})]}),e.jsxs(I,{children:[e.jsx(W,{children:e.jsx(Y,{className:"text-lg",children:"Response Time"})}),e.jsx(R,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm",children:"General inquiries: 1-2 business days"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm",children:"Technical/Account support: Same day"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm",children:"Partnership inquiries: 2-3 business days"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm",children:"Transaction disputes: 1 business day"})]})]})})]})]})]})]})}function ai({...s}){return e.jsx(Lt,{"data-slot":"accordion",...s})}function ti({className:s,...a}){return e.jsx(Rt,{"data-slot":"accordion-item",className:G("border-b last:border-b-0",s),...a})}function ri({className:s,children:a,...t}){return e.jsx(Mt,{className:"flex",children:e.jsxs(Ft,{"data-slot":"accordion-trigger",className:G("focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",s),...t,children:[a,e.jsx(qs,{className:"text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200"})]})})}function ii({className:s,children:a,...t}){return e.jsx(Et,{"data-slot":"accordion-content",className:"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm",...t,children:e.jsx("div",{className:G("pt-0 pb-4",s),children:a})})}const Us=[{id:"getting-started",title:"Getting Started",icon:Cs,color:"bg-green-100 text-green-700",questions:[{question:"How do I create an account on AgriLink?",answer:"Click the 'Register' button in the top navigation. Choose between Individual Account (for individual farmers/buyers) or Business Account (for registered businesses). Fill in the required information and verify your account through the steps provided."},{question:"What's the difference between Individual and Business accounts?",answer:"Individual accounts are for personal farmers, small-scale producers, and individual buyers. Business accounts are for registered companies, cooperatives, and formal trading businesses. Each has different verification requirements that respect Myanmar's agricultural context."},{question:"How do I add my first product listing?",answer:"After logging in as a farmer or trader, go to your Dashboard and click 'Add Listing'. Fill in product details including name, category, price, quantity, and location. Add clear photos and a detailed description to attract buyers."},{question:"Is AgriLink free to use?",answer:"Yes, AgriLink is completely free to use for all farmers, traders, and buyers. There are no listing fees, transaction fees, or subscription costs. Our goal is to make agricultural trade accessible to everyone in Myanmar."}]},{id:"verification",title:"Verification & Trust",icon:ae,color:"bg-blue-100 text-blue-700",questions:[{question:"What is the verification system?",answer:"Our verification system helps build trust by confirming seller identities and business legitimacy. Individual accounts verify personal ID and farming credentials, while Business accounts verify business registration and certifications."},{question:"Do I need a business license to sell on AgriLink?",answer:"No, you don't need a business license for an Individual Account. We understand many farmers in Myanmar operate informally. Business licenses are only required for Business Account verification."},{question:"How long does verification take?",answer:"Individual verification typically takes 1-2 business days. Business verification can take 3-5 business days as we review business documents. You can start listing products immediately, but verified status helps build buyer trust."},{question:"What documents do I need for verification?",answer:"For Individual accounts: Only Myanmar National ID/NRC is required - we respect that many farmers operate informally and don't require business licenses. For Business accounts: Business registration documents plus personal ID verification are required. All documents can be uploaded securely through the app."},{question:"Why do verification badges have different colors?",answer:"We use a color-coded system to make verification status clear at a glance: Red indicates unverified status, Yellow shows phone verification in progress, Blue means documents are under admin review, and Green indicates full verification complete. This helps users quickly assess trust levels when browsing products."}]},{id:"buying-selling",title:"Buying & Selling",icon:Xs,color:"bg-purple-100 text-purple-700",questions:[{question:"How do I contact a seller?",answer:"Click the 'Chat' button on any product listing to start a conversation with the seller. You can discuss pricing, quantity, quality, and delivery arrangements directly through our messaging system."},{question:"How are prices determined?",answer:"Sellers set their own prices based on quality, quantity, location, and market conditions. Use our price comparison feature to see how prices compare across different sellers for the same product."},{question:"Can I negotiate prices?",answer:"Yes! Most sellers are open to price negotiations, especially for bulk orders. Use the chat feature to discuss pricing, and remember to be respectful and fair in your negotiations."},{question:"How do payments work?",answer:"AgriLink facilitates connections but doesn't process payments directly. Buyers and sellers arrange payment methods that work for them - cash on delivery, bank transfer, or mobile payment systems popular in Myanmar."}]},{id:"delivery",title:"Delivery & Logistics",icon:We,color:"bg-orange-100 text-orange-700",questions:[{question:"Does AgriLink provide delivery services?",answer:"AgriLink connects buyers and sellers, but delivery arrangements are made directly between parties. Sellers often provide delivery within their local area, or buyers can arrange pickup."},{question:"How do I arrange product pickup or delivery?",answer:"Discuss delivery options through the chat feature with your seller. Many farmers offer local delivery, while others prefer farm pickup. For long-distance orders, you may need to arrange third-party transport."},{question:"What if products are damaged during transport?",answer:"Inspect products upon delivery and communicate any issues immediately with the seller. Most verified sellers will work with you to resolve quality issues fairly."}]},{id:"badges",title:"Badges & Trust System",icon:ae,color:"bg-amber-100 text-amber-700",questions:[{question:"What do the different user type badges mean?",answer:"AgriLink uses badges to help identify different types of users: Farmer (green badge - grows and harvests agricultural products), Trader (orange badge - distributes and trades agricultural products), and Buyer (blue badge - purchases products for business or personal use). Each badge also shows an icon indicating account type: a person icon for Individual accounts or building icon for Business accounts."},{question:"What are the verification levels and what do they mean?",answer:"AgriLink has four verification levels with color-coded badges: Unverified (red - no verification started), Phone Verified (yellow - phone confirmed but ID still needed), Under Review (blue - documents submitted, awaiting admin review), and Verified (green - verification complete). Both Individual and Business account types go through these same levels and reach the same final 'Verified' status."},{question:"Does verification guarantee a seller is trustworthy?",answer:"Verification helps build trust by confirming identity and legitimacy, but it doesn't guarantee transaction success or product quality. We encourage all users to communicate clearly, ask questions, and use good judgment when making transactions. Think of verification as one helpful factor in building confidence, not a complete guarantee."},{question:"Do I need to be verified to use AgriLink?",answer:"No, verification is completely voluntary. You can browse products, contact sellers, and make transactions without verification. However, many buyers prefer to work with verified sellers as it helps build confidence in the transaction."},{question:"Can verification status change?",answer:"Once verified, your status remains verified unless there are policy violations. If you're unverified, you can start the verification process anytime by choosing either Individual or Business account verification and submitting the required documents. The verification progresses through stages: Phone Verification (yellow) → Under Review (blue) → Verified (green)."},{question:"What's the difference between Individual and Business account verification?",answer:"Individual Account verification is designed for farmers, traders, and buyers who operate informally - requiring only Myanmar National ID/NRC for verification. Business Account verification is for registered companies, cooperatives, and formal businesses - requiring both business registration documents AND personal ID verification. This system respects Myanmar's agricultural context where many farmers don't have business licenses."},{question:"How can I tell if someone has an Individual or Business account?",answer:"Look at the icon in their user badge: Individual accounts show a person icon, while Business accounts show a building icon. This appears next to their user type (Farmer, Trader, or Buyer) and helps you understand whether you're dealing with an individual seller or a formal business."}]},{id:"account",title:"Account Management",icon:Va,color:"bg-gray-100 text-gray-700",questions:[{question:"How do I edit my profile information?",answer:"Go to your profile page and click the edit icon next to any section you want to update. You can change your contact information, business description, and other details anytime."},{question:"Can I delete my account?",answer:"Yes, you can delete your account by contacting our support team. Note that this will remove all your listings and chat history permanently."},{question:"How do I change my password?",answer:"Go to your profile settings and look for the 'Change Password' option. You'll need to enter your current password and choose a new secure password."},{question:"I forgot my password. How do I reset it?",answer:"Click 'Forgot Password' on the login page and enter your email address. We'll send you instructions to reset your password securely."}]},{id:"technical",title:"Technical Support",icon:Ne,color:"bg-red-100 text-red-700",questions:[{question:"The app is running slowly. What can I do?",answer:"Try refreshing your browser or restarting the app. Clear your browser cache if issues persist. AgriLink is optimized for mobile devices and works best with a stable internet connection."},{question:"Why can't I upload photos?",answer:"Check your internet connection and ensure your photos are under 5MB each. Supported formats are JPG, PNG, and WebP. Try refreshing the page and uploading again."},{question:"Messages aren't sending. What's wrong?",answer:"Check your internet connection first. If you're in a rural area with poor connectivity, messages may take longer to send. Try refreshing the page or restarting the app."},{question:"Can I use AgriLink offline?",answer:"AgriLink requires an internet connection for most features. However, you can view previously loaded content offline, and messages will send once you're back online."}]}];function ni({onBack:s,onShowContactUs:a}){const[t,r]=d.useState("getting-started"),o=t?Us.filter(i=>i.id===t):Us;return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsxs(u,{variant:"ghost",onClick:s,className:"h-9 px-3 -ml-3",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Frequently Asked Questions"}),e.jsx("p",{className:"text-muted-foreground",children:"Find answers to common questions about AgriLink"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3",children:[e.jsx(u,{variant:t===null?"default":"outline",onClick:()=>r(null),className:"text-xs h-auto py-2",children:"All Topics"}),Us.map(i=>e.jsx(u,{variant:t===i.id?"default":"outline",onClick:()=>r(i.id),className:"text-xs h-auto py-2",children:i.title},i.id))]}),e.jsx("div",{className:"space-y-8",children:o.map(i=>e.jsxs(I,{className:"shadow-sm border-border",children:[e.jsx(W,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${i.color}`,children:e.jsx(i.icon,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx(Y,{className:"text-xl",children:i.title}),e.jsxs(De,{className:"text-sm",children:[i.questions.length," question",i.questions.length!==1?"s":""]})]})]})}),e.jsx(R,{className:"pt-0 space-y-3",children:i.questions.map((g,b)=>e.jsx(ai,{type:"single",collapsible:!0,className:"w-full",children:e.jsxs(ti,{value:`${i.id}-${b}`,className:"border border-border rounded-lg overflow-hidden",children:[e.jsx(ri,{className:"text-left hover:no-underline px-6 py-4 hover:bg-muted/20 transition-colors",children:e.jsx("span",{className:"font-medium text-sm md:text-base pr-4",children:g.question})}),e.jsx(ii,{className:"px-6 pb-6 pt-2 border-t border-border",children:e.jsx("div",{className:"text-sm text-muted-foreground leading-relaxed",children:g.answer})})]})},b))})]},i.id))}),e.jsx(I,{className:"border-primary/20 bg-primary/5",children:e.jsx(R,{className:"pt-6",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"font-medium",children:"Still need help?"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Can't find the answer you're looking for? Our support team is here to help."}),e.jsx(u,{className:"mt-3",onClick:a,children:"Contact Support"})]})})})]})}const Ja=d.forwardRef(({className:s,...a},t)=>e.jsx(_a,{ref:t,"data-slot":"tabs",className:G("flex flex-col gap-2",s),...a}));Ja.displayName=_a.displayName;const Ga=d.forwardRef(({className:s,...a},t)=>e.jsx(Ta,{ref:t,"data-slot":"tabs-list",className:G("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-xl p-[3px] flex",s),...a}));Ga.displayName=Ta.displayName;const vs=d.forwardRef(({className:s,...a},t)=>e.jsx(Da,{ref:t,"data-slot":"tabs-trigger",className:G("data-[state=active]:bg-card dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-xl border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...a}));vs.displayName=Da.displayName;const Qa=d.forwardRef(({className:s,...a},t)=>e.jsx(Pa,{ref:t,"data-slot":"tabs-content",className:G("flex-1 outline-none",s),...a}));Qa.displayName=Pa.displayName;function li({currentUserId:s,currentUserName:a,currentUserType:t,onBack:r}){const[o,i]=d.useState([]),[g,b]=d.useState(!0),[n,v]=d.useState("all");d.useEffect(()=>{const P=[{id:"1",productId:"1",productName:"Premium Jasmine Rice - 50kg",productImage:"https://images.unsplash.com/photo-1586201375761-83865001e31c?w=100&h=100&fit=crop",buyerId:"buyer1",buyerName:"Ma Phyu Phyu",sellerId:"seller1",sellerName:"Ko Thura Min",offerPrice:42e3,originalPrice:45e3,quantity:"10 bags",message:"Interested in bulk purchase. Can we discuss delivery?",deliveryAddress:"123 Main Street, Yangon",paymentMethod:"cash",status:"pending",createdAt:new Date(Date.now()-1728e5).toISOString(),chatId:"chat1"},{id:"2",productId:"2",productName:"Fresh Tomatoes - 25kg",productImage:"https://images.unsplash.com/photo-1592841200221-a6898f307baa?w=100&h=100&fit=crop",buyerId:"buyer2",buyerName:"U Aung Min",sellerId:"seller2",sellerName:"Ma Su Hlaing",offerPrice:17e3,originalPrice:18e3,quantity:"5 crates",message:"Looking for fresh tomatoes for my restaurant.",deliveryAddress:"456 Business District, Mandalay",paymentMethod:"bank_transfer",status:"accepted",createdAt:new Date(Date.now()-432e6).toISOString(),acceptedAt:new Date(Date.now()-3456e5).toISOString(),chatId:"chat2"},{id:"3",productId:"3",productName:"Premium Turmeric Powder - 10kg",productImage:"https://images.unsplash.com/photo-1615485290382-441e4d049cb5?w=100&h=100&fit=crop",buyerId:"buyer3",buyerName:"Daw Hla Hla",sellerId:"seller3",sellerName:"Ko Kyaw Zin",offerPrice:24e3,originalPrice:25e3,quantity:"3 sacks",message:"Need for export. Can you provide quality certificate?",deliveryAddress:"789 Export Zone, Yangon",paymentMethod:"advance",status:"completed",createdAt:new Date(Date.now()-864e6).toISOString(),acceptedAt:new Date(Date.now()-7776e5).toISOString(),completedAt:new Date(Date.now()-6048e5).toISOString(),chatId:"chat3"}].filter(w=>w.buyerId===s||w.sellerId===s);i(P),b(!1)},[s]);const f=p=>{switch(p){case"accepted":return"bg-green-100 text-green-800 border-green-300";case"rejected":return"bg-red-100 text-red-800 border-red-300";case"expired":return"bg-gray-100 text-gray-800 border-gray-300";case"completed":return"bg-blue-100 text-blue-800 border-blue-300";case"cancelled":return"bg-orange-100 text-orange-800 border-orange-300";default:return"bg-yellow-100 text-yellow-800 border-yellow-300"}},N=p=>{switch(p){case"accepted":return e.jsx(Z,{className:"w-4 h-4"});case"rejected":return e.jsx(Ee,{className:"w-4 h-4"});case"completed":return e.jsx(Z,{className:"w-4 h-4"});case"cancelled":return e.jsx(Ee,{className:"w-4 h-4"});default:return e.jsx(ce,{className:"w-4 h-4"})}},m=o.filter(p=>n==="all"?!0:n==="pending"?p.status==="pending":n==="accepted"?p.status==="accepted":n==="completed"?p.status==="completed":!0),x=p=>p.sellerId===s,c=p=>{i(P=>P.map(w=>w.id===p?{...w,status:"accepted",acceptedAt:new Date().toISOString()}:w))},y=p=>{i(P=>P.map(w=>w.id===p?{...w,status:"rejected"}:w))},l=p=>{i(P=>P.map(w=>w.id===p?{...w,status:"completed",completedAt:new Date().toISOString()}:w))};return g?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-2xl font-bold",children:"Deals Management"})}),e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Loading deals..."})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Deals Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your offers, negotiations, and completed transactions"})]}),e.jsx(u,{variant:"outline",onClick:r,children:"Back"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(I,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold",children:o.filter(p=>p.status==="pending").length})]})]})})}),e.jsx(I,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Accepted"}),e.jsx("p",{className:"text-2xl font-bold",children:o.filter(p=>p.status==="accepted").length})]})]})})}),e.jsx(I,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(He,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold",children:o.filter(p=>p.status==="completed").length})]})]})})}),e.jsx(I,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ge,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Value"}),e.jsxs("p",{className:"text-2xl font-bold",children:[o.filter(p=>p.status==="completed").reduce((p,P)=>p+(P.offerPrice*parseFloat(P.quantity)||0),0).toLocaleString()," MMK"]})]})]})})})]}),e.jsxs(Ja,{value:n,onValueChange:v,children:[e.jsxs(Ga,{className:"grid w-full grid-cols-4",children:[e.jsx(vs,{value:"all",children:"All Deals"}),e.jsx(vs,{value:"pending",children:"Pending"}),e.jsx(vs,{value:"accepted",children:"Accepted"}),e.jsx(vs,{value:"completed",children:"Completed"})]}),e.jsx(Qa,{value:n,className:"space-y-4",children:m.length===0?e.jsx(I,{children:e.jsxs(R,{className:"text-center py-12",children:[e.jsx(ne,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No deals found"}),e.jsx("p",{className:"text-muted-foreground",children:n==="all"?"You don't have any deals yet. Start by making an offer on a product!":`No ${n} deals found.`})]})}):m.map(p=>e.jsx(I,{className:"hover:shadow-md transition-shadow",children:e.jsx(R,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("img",{src:p.productImage,alt:p.productName,className:"w-20 h-20 object-cover rounded-lg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:p.productName}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ve,{className:"w-4 h-4"}),x(p)?p.buyerName:p.sellerName]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(us,{className:"w-4 h-4"}),new Date(p.createdAt).toLocaleDateString()]})]})]})]}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Offer Price:"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-bold text-lg",children:[p.offerPrice.toLocaleString()," MMK"]}),p.offerPrice!==p.originalPrice&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Original: ",p.originalPrice.toLocaleString()," MMK"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Quantity:"}),e.jsx("span",{className:"font-medium",children:p.quantity})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Total Amount:"}),e.jsxs("span",{className:"font-bold text-primary text-lg",children:[(p.offerPrice*parseFloat(p.quantity)||0).toLocaleString()," MMK"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Payment:"}),e.jsx("span",{className:"text-sm",children:p.paymentMethod==="cash"?"Cash on Delivery":p.paymentMethod==="bank_transfer"?"Bank Transfer":p.paymentMethod==="mobile_payment"?"Mobile Payment":p.paymentMethod==="advance"?"50% Advance, 50% on Delivery":p.paymentMethod})]}),p.deliveryAddress&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Delivery Address:"}),e.jsx("p",{className:"text-sm",children:p.deliveryAddress})]})]}),p.message&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Message:"}),e.jsx("p",{className:"text-sm",children:p.message})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end space-y-3",children:[e.jsxs($,{className:f(p.status),children:[N(p.status),e.jsx("span",{className:"ml-1 capitalize",children:p.status})]}),p.status==="pending"&&x(p)&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{size:"sm",onClick:()=>c(p.id),children:[e.jsx(Z,{className:"w-4 h-4 mr-1"}),"Accept"]}),e.jsxs(u,{size:"sm",variant:"outline",onClick:()=>y(p.id),children:[e.jsx(Ee,{className:"w-4 h-4 mr-1"}),"Reject"]})]}),p.status==="accepted"&&e.jsxs(u,{size:"sm",onClick:()=>l(p.id),children:[e.jsx(Z,{className:"w-4 h-4 mr-1"}),"Mark Completed"]}),p.status==="completed"&&e.jsxs(u,{size:"sm",variant:"outline",children:[e.jsx(He,{className:"w-4 h-4 mr-1"}),"Leave Review"]}),p.chatId&&e.jsxs(u,{size:"sm",variant:"outline",children:[e.jsx(Ne,{className:"w-4 h-4 mr-1"}),"View Chat"]})]})]})})},p.id))})]})]})}function oi({isOpen:s,onClose:a,onSubmit:t,product:r,currentUser:o}){const[i,g]=d.useState({offerPrice:r.price,quantity:"1",message:"",deliveryAddress:"",deliveryNotes:"",paymentMethod:"cash"}),[b,n]=d.useState(!1);if(!s)return null;const v=async m=>{m.preventDefault(),n(!0);try{await t(i),a()}catch(x){console.error("Error submitting offer:",x)}finally{n(!1)}},f=i.offerPrice-r.price,N=(f/r.price*100).toFixed(1);return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(I,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(W,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-5 h-5"}),"Make an Offer"]}),e.jsx(u,{variant:"ghost",size:"sm",onClick:a,children:e.jsx(Pe,{className:"w-4 h-4"})})]}),e.jsxs(R,{className:"space-y-6",children:[e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:r.name}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mt-2",children:[e.jsxs("span",{children:["Seller: ",r.sellerName]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Location: ",r.location]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("span",{className:"text-lg font-bold",children:["Original Price: ",r.price.toLocaleString()," MMK"]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["per ",r.unit]})]})]}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"offerPrice",children:"Your Offer Price (MMK)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(J,{id:"offerPrice",type:"number",value:i.offerPrice,onChange:m=>g({...i,offerPrice:Number(m.target.value)}),className:"pl-10",min:"0",step:"1000",required:!0})]}),f!==0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsxs($,{variant:f<0?"destructive":"default",children:[f<0?"↓":"↑"," ",Math.abs(f).toLocaleString()," MMK"]}),e.jsxs("span",{className:"text-muted-foreground",children:["(",N,"% ",f<0?"below":"above"," original)"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"quantity",children:"Quantity"}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(J,{id:"quantity",value:i.quantity,onChange:m=>g({...i,quantity:m.target.value}),className:"pl-10",placeholder:"e.g., 5 bags, 10 kg",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"message",children:"Message to Seller"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ne,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(_e,{id:"message",value:i.message,onChange:m=>g({...i,message:m.target.value}),className:"pl-10 min-h-[80px]",placeholder:"Tell the seller about your offer, delivery preferences, or any questions..."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"deliveryAddress",children:"Delivery Address"}),e.jsx(_e,{id:"deliveryAddress",value:i.deliveryAddress,onChange:m=>g({...i,deliveryAddress:m.target.value}),placeholder:"Enter your delivery address...",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"deliveryNotes",children:"Delivery Notes (Optional)"}),e.jsx(_e,{id:"deliveryNotes",value:i.deliveryNotes,onChange:m=>g({...i,deliveryNotes:m.target.value}),placeholder:"Any special delivery instructions..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"paymentMethod",children:"Preferred Payment Method"}),e.jsxs("select",{id:"paymentMethod",value:i.paymentMethod,onChange:m=>g({...i,paymentMethod:m.target.value}),className:"w-full p-2 border rounded-md",children:[e.jsx("option",{value:"cash",children:"Cash on Delivery"}),e.jsx("option",{value:"bank_transfer",children:"Bank Transfer"}),e.jsx("option",{value:"mobile_payment",children:"Mobile Payment"}),e.jsx("option",{value:"advance",children:"50% Advance, 50% on Delivery"})]})]}),e.jsxs("div",{className:"bg-primary/10 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold",children:"Total Offer Amount:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:[(i.offerPrice*parseFloat(i.quantity)||0).toLocaleString()," MMK"]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[i.quantity," × ",i.offerPrice.toLocaleString()," MMK"]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(u,{type:"button",variant:"outline",onClick:a,className:"flex-1",disabled:b,children:"Cancel"}),e.jsx(u,{type:"submit",className:"flex-1",disabled:b,children:b?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending Offer..."]}):"Send Offer"})]})]})]})]})})}function ci({isOpen:s,onClose:a,onSubmit:t,transaction:r,currentUser:o}){const[i,g]=d.useState({rating:5,comment:"",wouldRecommend:!0,deliveryRating:5,communicationRating:5,qualityRating:5}),[b,n]=d.useState(!1);if(!s)return null;const v=async N=>{N.preventDefault(),n(!0);try{await t(i),a()}catch(m){console.error("Error submitting review:",m)}finally{n(!1)}},f=(N,m,x)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{children:x}),e.jsxs("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(c=>e.jsx("button",{type:"button",onClick:()=>m(c),className:"p-1 hover:scale-110 transition-transform",children:e.jsx(He,{className:`w-6 h-6 ${c<=N?"text-yellow-400 fill-yellow-400":"text-gray-300"}`})},c)),e.jsxs("span",{className:"ml-2 text-sm text-muted-foreground",children:[N,"/5"]})]})]});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(I,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(W,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(He,{className:"w-5 h-5"}),"Leave a Review"]}),e.jsx(u,{variant:"ghost",size:"sm",onClick:a,children:e.jsx(Pe,{className:"w-4 h-4"})})]}),e.jsxs(R,{className:"space-y-6",children:[e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Transaction Details"}),e.jsxs("div",{className:"space-y-2 mt-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Product:"}),e.jsx("span",{className:"font-medium",children:r.productName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:r.otherPartyType==="seller"?"Seller:":"Buyer:"}),e.jsx("span",{className:"font-medium",children:r.otherPartyName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Amount:"}),e.jsxs("span",{className:"font-medium",children:[r.dealAmount.toLocaleString()," MMK"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Completed:"}),e.jsx("span",{className:"font-medium",children:new Date(r.completedAt).toLocaleDateString()})]})]})]}),e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold",children:"Overall Experience"}),f(i.rating,N=>g({...i,rating:N}),"How would you rate this transaction overall?")]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold",children:"Detailed Ratings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[f(i.qualityRating,N=>g({...i,qualityRating:N}),"Product Quality"),f(i.communicationRating,N=>g({...i,communicationRating:N}),"Communication"),f(i.deliveryRating,N=>g({...i,deliveryRating:N}),"Delivery")]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(O,{children:["Would you recommend this ",r.otherPartyType,"?"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(u,{type:"button",variant:i.wouldRecommend?"default":"outline",onClick:()=>g({...i,wouldRecommend:!0}),className:"flex items-center gap-2",children:[e.jsx(nr,{className:"w-4 h-4"}),"Yes"]}),e.jsxs(u,{type:"button",variant:i.wouldRecommend?"outline":"destructive",onClick:()=>g({...i,wouldRecommend:!1}),className:"flex items-center gap-2",children:[e.jsx(lr,{className:"w-4 h-4"}),"No"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"comment",children:"Your Review (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ne,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(_e,{id:"comment",value:i.comment,onChange:N=>g({...i,comment:N.target.value}),className:"pl-10 min-h-[100px]",placeholder:"Share your experience with this transaction. What went well? What could be improved?"})]})]}),e.jsxs("div",{className:"bg-primary/10 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Review Summary"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Overall Rating:"}),e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(N=>e.jsx(He,{className:`w-4 h-4 ${N<=i.rating?"text-yellow-400 fill-yellow-400":"text-gray-300"}`},N))})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Recommendation:"}),e.jsx($,{variant:i.wouldRecommend?"default":"destructive",children:i.wouldRecommend?"Yes":"No"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Quality:"}),e.jsxs("span",{children:[i.qualityRating,"/5"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Communication:"}),e.jsxs("span",{children:[i.communicationRating,"/5"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Delivery:"}),e.jsxs("span",{children:[i.deliveryRating,"/5"]})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(u,{type:"button",variant:"outline",onClick:a,className:"flex-1",disabled:b,children:"Cancel"}),e.jsx(u,{type:"submit",className:"flex-1",disabled:b,children:b?"Submitting...":"Submit Review"})]})]})]})]})})}function fa({className:s,...a}){return e.jsx(qt,{"data-slot":"avatar",className:G("relative flex size-10 shrink-0 overflow-hidden rounded-full",s),...a})}function ja({className:s,...a}){return e.jsx(Bt,{"data-slot":"avatar-fallback",className:G("bg-muted flex size-full items-center justify-center rounded-full",s),...a})}function di({...s}){return e.jsx(zt,{"data-slot":"dropdown-menu",...s})}function mi({...s}){return e.jsx(Vt,{"data-slot":"dropdown-menu-trigger",...s})}function ui({className:s,sideOffset:a=4,...t}){return e.jsx(Ot,{children:e.jsx($t,{"data-slot":"dropdown-menu-content",sideOffset:a,className:G("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",s),...t})})}function Ze({className:s,inset:a,variant:t="default",...r}){return e.jsx(Yt,{"data-slot":"dropdown-menu-item","data-inset":a,"data-variant":t,className:G("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...r})}function xi({className:s,inset:a,...t}){return e.jsx(Ut,{"data-slot":"dropdown-menu-label","data-inset":a,className:G("px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",s),...t})}function va({className:s,...a}){return e.jsx(Wt,{"data-slot":"dropdown-menu-separator",className:G("bg-border -mx-1 my-1 h-px",s),...a})}function hi({user:s,onLogout:a,onViewStorefront:t,onUpdateUser:r,onGoToDashboard:o,onShowVerification:i,onEditProfile:g,onViewProfile:b,onViewMessages:n,onShowAdminVerification:v}){const[f,N]=d.useState(!1),m=c=>{switch(Ke(c)){case"business-verified":return{status:"verified",color:"text-green-600 dark:text-green-400",bgColor:"bg-green-50 dark:bg-green-900/20",borderColor:"border-green-200 dark:border-green-800",dotColor:"bg-green-600"};case"id-verified":return{status:"verified",color:"text-green-600 dark:text-green-400",bgColor:"bg-green-50 dark:bg-green-900/20",borderColor:"border-green-200 dark:border-green-800",dotColor:"bg-green-600"};case"under-review":return{status:"under-review",color:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-50 dark:bg-blue-900/20",borderColor:"border-blue-200 dark:border-blue-800",dotColor:"bg-blue-600"};case"phone-verified":return{status:"in-progress",color:"text-yellow-600 dark:text-yellow-400",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",borderColor:"border-yellow-200 dark:border-yellow-800",dotColor:"bg-yellow-600"};default:return{status:"not-started",color:"text-red-600 dark:text-red-400",bgColor:"bg-red-50 dark:bg-red-900/20",borderColor:"border-red-200 dark:border-red-800",dotColor:"bg-red-600"}}},x=c=>c.split(" ").map(y=>y[0]).join("").toUpperCase().slice(0,2);return f?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-card rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"My Profile"}),e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>N(!1),children:"×"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(fa,{className:"w-20 h-20 mx-auto mb-4",children:s.profileImage||s.avatar?e.jsx(Es,{src:s.profileImage||s.avatar,alt:`${s.name}'s profile`,className:"w-full h-full object-cover rounded-full"}):e.jsx(ja,{className:"text-lg",children:x(s.name)})}),e.jsx("h3",{className:"text-lg font-medium",children:s.name}),e.jsx(xs,{userType:s.userType,accountType:ms(s),verificationLevel:Ke(s),size:"sm"}),e.jsxs("div",{className:"mt-2",children:[s.userType==="admin"&&e.jsxs("div",{className:"flex items-center justify-center gap-1 text-sm text-primary",children:[e.jsx(ae,{className:"w-4 h-4"}),"Platform Administrator"]}),s.userType!=="admin"&&s.verified&&e.jsxs("div",{className:"flex items-center justify-center gap-1 text-sm text-green-600",children:[e.jsx(ae,{className:"w-4 h-4"}),"Verified Account"]}),s.userType!=="admin"&&s.verificationStatus==="under_review"&&e.jsxs("div",{className:"flex items-center justify-center gap-1 text-sm text-amber-600",children:[e.jsx(Ue,{className:"w-4 h-4"}),"Verification Under Review"]}),s.userType!=="admin"&&!s.verified&&s.verificationStatus!=="under_review"&&e.jsxs("div",{className:"flex items-center justify-center gap-1 text-sm text-muted-foreground",children:[e.jsx(ae,{className:"w-4 h-4"}),"Verification Available"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"Contact Information"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{children:s.location})]}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(qe,{className:"w-4 h-4"}),e.jsx("span",{children:s.phone})]})]})]}),s.businessName&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4"}),"Business Information"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Business Name:"}),e.jsx("div",{className:"text-muted-foreground",children:s.businessName})]}),s.businessDescription&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Description:"}),e.jsx("div",{className:"text-muted-foreground",children:s.businessDescription})]}),s.experience&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Experience:"}),e.jsx("div",{className:"text-muted-foreground",children:s.experience})]}),s.specialization&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Specialization:"}),e.jsx("div",{className:"text-muted-foreground capitalize",children:s.specialization})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"Account Stats"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center p-3 bg-muted rounded-lg",children:[e.jsx("div",{className:"font-medium",children:"Member Since"}),e.jsx("div",{className:"text-muted-foreground",children:zs(s.joinedDate)})]}),e.jsxs("div",{className:"text-center p-3 bg-muted rounded-lg",children:[e.jsx("div",{className:"font-medium",children:"Rating"}),e.jsx("div",{className:"text-muted-foreground",children:s.rating>0?`${s.rating}/5`:"No ratings yet"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[(s.userType==="farmer"||s.userType==="trader"||s.userType==="buyer")&&o&&e.jsxs(u,{variant:"outline",className:"w-full justify-start gap-2",onClick:()=>{N(!1),o()},children:[e.jsx(Rs,{className:"w-4 h-4"}),"Dashboard"]}),s.userType==="admin"&&o&&e.jsxs(u,{variant:"outline",className:"w-full justify-start gap-2",onClick:()=>{N(!1),o()},children:[e.jsx(ae,{className:"w-4 h-4"}),"Admin Panel"]}),s.userType==="admin"&&v&&e.jsxs(u,{variant:"outline",className:"w-full justify-start gap-2",onClick:()=>{N(!1),v()},children:[e.jsx(as,{className:"w-4 h-4"}),"Verification Requests"]}),e.jsxs(u,{variant:"outline",className:"w-full justify-start gap-2",onClick:()=>{N(!1),n?.()},children:[e.jsx(Ne,{className:"w-4 h-4"}),"Messages"]}),e.jsxs(u,{variant:"outline",className:"w-full justify-start gap-2",onClick:()=>{N(!1),i?.()},children:[e.jsx(ae,{className:`w-4 h-4 ${m(s).color}`}),s.verified?"Verification Status":s.verificationStatus==="under_review"?"Verification":s.verificationSubmitted?"Verification Status":"Get Verified",m(s).status==="under-review"&&e.jsx($,{variant:"secondary",className:`ml-auto text-xs ${m(s).bgColor} ${m(s).color} ${m(s).borderColor}`,children:s.verificationStatus==="under_review"||s.verificationSubmitted?"Under Review":"Reviewing"}),m(s).status==="verified"&&e.jsx($,{variant:"secondary",className:`ml-auto text-xs ${m(s).bgColor} ${m(s).color} ${m(s).borderColor}`,children:"Verified"}),m(s).status==="in-progress"&&e.jsx($,{variant:"secondary",className:`ml-auto text-xs ${m(s).bgColor} ${m(s).color} ${m(s).borderColor}`,children:"Phone Verified"}),m(s).status==="not-started"&&e.jsx($,{variant:"secondary",className:"ml-auto text-xs",children:"Available"})]}),e.jsxs(u,{variant:"outline",className:"w-full justify-start gap-2",children:[e.jsx(Ba,{className:"w-4 h-4"}),"Notification Settings"]}),e.jsxs(u,{variant:"outline",className:"w-full justify-start gap-2 text-destructive hover:text-destructive",onClick:()=>{N(!1),a()},children:[e.jsx(da,{className:"w-4 h-4"}),"Sign Out"]})]})]})]})}):e.jsx("div",{children:e.jsxs(di,{children:[e.jsx(mi,{className:"relative h-9 w-9 md:h-10 md:w-10 rounded-full hover:bg-accent/50 transition-colors cursor-pointer focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",children:e.jsx(fa,{className:"h-9 w-9 md:h-10 md:w-10",children:s.profileImage||s.avatar?e.jsx(Es,{src:s.profileImage||s.avatar,alt:`${s.name}'s profile`,className:"w-full h-full object-cover rounded-full"}):e.jsx(ja,{className:"text-sm",children:x(s.name)})})}),e.jsxs(ui,{className:"w-56",align:"end",forceMount:!0,children:[e.jsx(xi,{className:"font-normal",children:e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:s.name}),e.jsxs($,{variant:"outline",className:`text-xs px-2 py-0.5 font-medium flex items-center gap-1 ${s.userType==="farmer"?"bg-green-600 text-white border-green-600":s.userType==="trader"?"bg-orange-600 text-white border-orange-600":s.userType==="buyer"?"bg-blue-50 text-blue-700 border-blue-200 dark:bg-blue-900/20 dark:text-blue-400 dark:border-blue-800":"bg-gray-50 text-gray-700 border-gray-200 dark:bg-gray-900/20 dark:text-gray-300 dark:border-gray-800"}`,children:[ms(s)==="business"?e.jsx(Je,{className:`w-3 h-3 ${s.userType==="farmer"||s.userType==="trader"?"text-white":s.userType==="buyer"?"text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300"}`}):e.jsx(ve,{className:`w-3 h-3 ${s.userType==="farmer"||s.userType==="trader"?"text-white":s.userType==="buyer"?"text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300"}`}),s.userType==="farmer"&&"Farmer",s.userType==="trader"&&"Trader",s.userType==="buyer"&&"Buyer",s.userType==="admin"&&"Admin"]})]}),e.jsx("p",{className:"text-xs leading-none text-muted-foreground",children:s.email})]})}),e.jsx(va,{}),e.jsxs(Ze,{onClick:b,children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Profile"})]}),(s.userType==="farmer"||s.userType==="trader"||s.userType==="buyer")&&o&&e.jsxs(Ze,{onClick:o,children:[e.jsx(Rs,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Dashboard"})]}),s.userType==="admin"&&o&&e.jsxs(Ze,{onClick:o,children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Admin Panel"})]}),s.userType==="admin"&&v&&e.jsxs(Ze,{onClick:v,children:[e.jsx(as,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Verification Requests"})]}),(s.userType==="farmer"||s.userType==="trader")&&e.jsxs(Ze,{onClick:()=>t?.(s.id),children:[e.jsx(Ye,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"My Storefront"})]}),e.jsxs(Ze,{onClick:n,children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Messages"})]}),e.jsxs(Ze,{onClick:()=>i?.(),children:[e.jsx(ae,{className:`mr-2 h-4 w-4 ${m(s).color}`}),e.jsx("span",{children:s.verified?"Verification Status":s.verificationStatus==="under_review"?"Verification":s.verificationSubmitted?"Verification Status":"Get Verified"}),m(s).status==="under-review"&&e.jsx("div",{className:`ml-auto w-2 h-2 rounded-full ${m(s).dotColor}`,title:"Under Review"}),m(s).status==="verified"&&e.jsx("div",{className:`ml-auto w-2 h-2 rounded-full ${m(s).dotColor}`,title:"Verified"}),m(s).status==="in-progress"&&e.jsx("div",{className:`ml-auto w-2 h-2 rounded-full ${m(s).dotColor}`,title:"Phone Verified - ID Verification Still Needed"}),m(s).status==="not-started"&&e.jsx("div",{className:`ml-auto w-2 h-2 rounded-full ${m(s).dotColor}`,title:"Verification Available"})]}),e.jsx(va,{}),e.jsxs(Ze,{onClick:a,children:[e.jsx(da,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Log out"})]})]})]})})}function pi({currentView:s,currentUser:a,onBackToMarketplace:t,onGoToDashboard:r,onGoToLogin:o,onGoToRegister:i,onLogout:g,onViewStorefront:b,onUpdateUser:n,onShowVerification:v,onEditProfile:f,onViewProfile:N,onViewMessages:m,onShowAdminVerification:x,editingProduct:c}){return e.jsx("header",{className:"sticky top-0 z-40 border-b bg-card",children:e.jsx("div",{className:"w-full max-w-5xl mx-auto px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:t,className:"flex items-center gap-3 hover:opacity-80 transition-opacity duration-200 cursor-pointer",children:[e.jsx("div",{className:"w-10 h-10 md:w-12 md:h-12 bg-primary rounded-lg flex items-center justify-center shadow-md",children:e.jsx(Oe,{className:"w-5 h-5 md:w-6 md:h-6 text-primary-foreground"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg md:text-xl font-semibold",children:"AgriLink"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground hidden sm:block",children:"Linking agriculture to opportunity"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[e.jsx("div",{className:"flex md:hidden items-center gap-1",children:s!=="marketplace"&&e.jsx(u,{variant:"ghost",onClick:t,className:"px-2 h-8 text-sm",children:"Home"})}),e.jsxs("div",{className:"hidden md:flex items-center gap-2",children:[e.jsx(u,{variant:s==="marketplace"?"default":"ghost",className:"h-9 px-4 text-sm",onClick:t,children:"Marketplace"}),a&&e.jsxs(e.Fragment,{children:[(a.userType==="farmer"||a.userType==="trader"||a.userType==="buyer")&&e.jsx(u,{variant:s==="dashboard"?"default":"ghost",className:"h-9 px-4 text-sm",onClick:r,children:"Dashboard"}),a.userType==="admin"&&e.jsx(u,{variant:s==="marketplace"?"default":"ghost",className:"h-9 px-4 text-sm",onClick:r,children:"Admin Panel"}),s==="profile"&&e.jsx(u,{variant:"default",size:"sm",disabled:!0,children:"Profile"}),s==="add-listing"&&e.jsx(u,{variant:"default",size:"sm",disabled:!0,children:c?"Edit Listing":"Add Listing"}),s==="messages"&&e.jsx(u,{variant:"default",size:"sm",disabled:!0,children:"Messages"}),s==="verification"&&e.jsx(u,{variant:"default",size:"sm",disabled:!0,children:"Verification"}),s==="admin-verification"&&e.jsx(u,{variant:"default",size:"sm",disabled:!0,children:"Admin Verification"})]}),!a&&s==="forgot-password"&&e.jsx(u,{variant:"ghost",size:"sm",disabled:!0,children:"Reset Password"})]}),a?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm text-muted-foreground hidden lg:inline font-medium",children:["Welcome, ",a.name.split(" ")[0]]}),e.jsx(hi,{user:a,onLogout:g,onViewStorefront:b,onUpdateUser:n,onGoToDashboard:r,onShowVerification:v,onEditProfile:f,onViewProfile:N,onViewMessages:m,onShowAdminVerification:x})]}):e.jsxs("div",{className:"flex items-center gap-1 md:gap-2",children:[e.jsx(u,{variant:s==="login"?"default":"outline",onClick:o,className:"md:hidden px-2 h-8",children:e.jsx(ma,{className:"w-4 h-4"})}),e.jsx(u,{variant:s==="register"?"default":"outline",onClick:i,className:"md:hidden px-2 h-8",children:e.jsx(ua,{className:"w-4 h-4"})}),e.jsxs(u,{variant:s==="login"?"default":"outline",onClick:o,className:"hidden md:flex h-9 px-4 text-sm",children:[e.jsx(ma,{className:"w-4 h-4 mr-2"}),"Sign In"]}),e.jsxs(u,{variant:s==="register"?"default":"outline",onClick:i,className:"hidden md:flex h-9 px-4 text-sm",children:[e.jsx(ua,{className:"w-4 h-4 mr-2"}),"Register"]})]})]})]})})})}function gi({onShowAboutUs:s,onShowContactUs:a,onShowFAQ:t}){return e.jsxs("footer",{className:"border-t bg-card mt-8",children:[e.jsxs("div",{className:"w-full max-w-5xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx(Oe,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm md:text-base font-semibold",children:"Connecting Myanmar's Agricultural Community"})]}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground max-w-xl mx-auto",children:"Transparent pricing • Direct connections • Quality products • Trusted marketplace"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-0",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(Cs,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-medium text-sm md:text-base",children:"For Farmers"})]}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Direct sales • Fair pricing • Wider market reach"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(We,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-medium text-sm md:text-base",children:"For Traders"})]}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Quality sourcing • Efficient distribution • Network growth"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(Qs,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-medium text-sm md:text-base",children:"For Buyers"})]}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Quality sourcing • Efficient distribution • Network growth"})]})]})]}),e.jsx("div",{className:"border-t"}),e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs md:text-sm text-muted-foreground text-center md:text-left",children:e.jsx("p",{children:"© 2025 AgriLink - Academic Project developed in partnership with Infinity Success Co. Ltd."})}),e.jsxs("div",{className:"flex items-center gap-4 text-xs md:text-sm",children:[e.jsx("button",{onClick:s,className:"text-muted-foreground hover:text-primary transition-colors duration-200",children:"About Us"}),e.jsx("span",{className:"text-muted-foreground",children:"•"}),e.jsx("button",{onClick:a,className:"text-muted-foreground hover:text-primary transition-colors duration-200",children:"Contact Us"}),e.jsx("span",{className:"text-muted-foreground",children:"•"}),e.jsx("button",{onClick:t,className:"text-muted-foreground hover:text-primary transition-colors duration-200",children:"FAQ"})]})]})})]})}function fi({currentUser:s,allProducts:a,onGoToRegister:t,onGoToLogin:r,onShowAddListing:o}){return e.jsxs("section",{className:"relative py-8 lg:py-12 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/15 via-amber-900/8 to-stone-600/12"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-tr from-transparent via-primary/8 to-transparent"}),e.jsx("div",{className:"absolute top-6 right-6 w-32 h-32 bg-primary/20 rounded-full blur-2xl"}),e.jsx("div",{className:"absolute bottom-6 left-6 w-40 h-40 bg-amber-900/25 rounded-full blur-2xl"}),e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-stone-700/15 rounded-full blur-3xl"}),e.jsxs("div",{className:"relative max-w-5xl mx-auto text-center space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h1",{className:"text-3xl lg:text-4xl font-bold tracking-tight",children:[e.jsxs("span",{className:"text-foreground",children:["Connect."," "]}),e.jsxs("span",{className:"text-primary",children:["Discover."," "]}),e.jsx("span",{className:"text-foreground",children:"Thrive."})]}),e.jsx("p",{className:"text-lg text-muted-foreground max-w-3xl mx-auto",children:"Connecting producers, distributors, businesses, and consumers across Myanmar. Quality products, transparent pricing, and trusted partnerships for all."})]}),s?e.jsxs("div",{className:"bg-card border rounded-2xl p-4 max-w-2xl mx-auto",children:[e.jsxs("p",{className:"text-foreground mb-2",children:["Welcome back,"," ",e.jsx("span",{className:"font-semibold text-primary",children:s.name.split(" ")[0]}),"!"]}),e.jsx("p",{className:"text-muted-foreground mb-3 text-sm",children:s.userType==="farmer"?"Ready to share your fresh products with customers across Myanmar?":s.userType==="trader"?"Ready to connect buyers with quality agricultural products?":"Discover fresh products and connect directly with local farmers and suppliers."}),(s.userType==="farmer"||s.userType==="trader")&&e.jsxs(u,{size:"lg",onClick:o,className:"px-6 py-3 rounded-xl",children:["List Your Products"," ",e.jsx(Ms,{className:"ml-2 w-4 h-4"})]})]}):e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center items-center",children:[e.jsxs(u,{size:"lg",onClick:t,className:"px-6 py-4 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300",children:["Get Started"," ",e.jsx(Ms,{className:"ml-2 w-4 h-4"})]}),e.jsx(u,{size:"lg",variant:"outline",onClick:r,className:"px-6 py-4 rounded-xl",children:"Sign In"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 max-w-4xl mx-auto pt-6",children:[e.jsxs("div",{className:"bg-card border rounded-xl p-3 text-center",children:[e.jsxs("div",{className:"text-xl font-bold text-foreground",children:[a.length,"+"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Fresh Products"})]}),e.jsxs("div",{className:"bg-card border rounded-xl p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold text-foreground",children:"Connected"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Supply Network"})]}),e.jsxs("div",{className:"bg-card border rounded-xl p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold text-foreground",children:"Fair"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Transparent Pricing"})]}),e.jsxs("div",{className:"bg-card border rounded-xl p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold text-foreground",children:"Local"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Myanmar Grown"})]})]})]})]})}class ji extends Ht.Component{constructor(a){super(a),this.state={hasError:!1}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,t){console.error("AgriLink Error Boundary caught an error:",a,t)}handleRetry=()=>{this.setState({hasError:!1,error:void 0})};render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs(I,{className:"max-w-md mx-auto",children:[e.jsxs(W,{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-destructive/10 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Is,{className:"w-8 h-8 text-destructive"})}),e.jsx(Y,{children:"Something went wrong"})]}),e.jsxs(R,{className:"space-y-4 text-center",children:[e.jsx("p",{className:"text-muted-foreground",children:"AgriLink encountered an unexpected error. Don't worry, your data is safe."}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(u,{onClick:this.handleRetry,className:"w-full",children:[e.jsx(za,{className:"w-4 h-4 mr-2"}),"Try Again"]}),e.jsx(u,{variant:"outline",onClick:()=>window.location.reload(),className:"w-full",children:"Refresh Page"})]}),!1]})]})}):this.props.children}}const vi=({...s})=>{const{theme:a="system"}=or();return e.jsx(cr,{theme:a,className:"toaster group",style:{"--normal-bg":"var(--popover)","--normal-text":"var(--popover-foreground)","--normal-border":"var(--border)"},...s})},yi=(s,a,t)=>{const r=d.useMemo(()=>s.filter(i=>{const g=!a.search||i.name.toLowerCase().includes(a.search.toLowerCase())||i.sellerName.toLowerCase().includes(a.search.toLowerCase());let b=!0;a.region&&a.region!=="all"&&(b=Nr(i.location)===a.region),a.city&&a.city!=="all"&&(b=i.location===a.city),a.location&&a.location!=="all"&&(b=i.location===a.location);const n=!a.sellerType||a.sellerType==="all"||i.sellerType===a.sellerType;let v=!0;if(a.verifiedStatus&&a.verifiedStatus!=="all"&&t){const m=t(i.sellerId);a.verifiedStatus==="verified"?v=m:a.verifiedStatus==="unverified"&&(v=!m)}const f=!a.category||a.category==="all"||i.name.toLowerCase().includes(a.category.toLowerCase());let N=!0;if(a.priceRange&&a.priceRange!=="all"){const m=i.price;switch(a.priceRange){case"0-50000":N=m>=0&&m<=5e4;break;case"50000-100000":N=m>5e4&&m<=1e5;break;case"100000-200000":N=m>1e5&&m<=2e5;break;case"200000+":N=m>2e5;break}}return g&&b&&n&&v&&f&&N}).sort((i,g)=>{switch(a.sortBy){case"price-low":return i.price-g.price;case"price-high":return g.price-i.price;case"location":return i.location.localeCompare(g.location);case"newest":default:return new Date(g.lastUpdated).getTime()-new Date(i.lastUpdated).getTime()}}),[s,a,t]),o=d.useMemo(()=>{let i=0;return a.search&&a.search.trim()!==""&&i++,a.category&&a.category!==""&&a.category!=="all"&&i++,(a.city&&a.city!==""&&a.city!=="all"||a.region&&a.region!==""&&a.region!=="all"||a.location&&a.location!==""&&a.location!=="all")&&i++,a.sellerType&&a.sellerType!==""&&a.sellerType!=="all"&&i++,a.verifiedStatus&&a.verifiedStatus!==""&&a.verifiedStatus!=="all"&&i++,a.priceRange&&a.priceRange!==""&&a.priceRange!=="all"&&i++,i},[a]);return{filteredProducts:r,getActiveFiltersCount:o}},bi=()=>{const[s,a]=d.useState(null),[t,r]=d.useState(!1),o=d.useCallback(async n=>{if(!z)throw new Error("Supabase not available");r(!0);try{console.log("🔄 Clean signup process started for:",n.email),console.log("📋 Form data received:"),console.log("  - Name:",n.name),console.log("  - UserType:",n.userType),console.log("  - AccountType:",n.accountType),console.log("  - Location:",n.location),console.log("  - Region:",n.region);const{data:v,error:f}=await z.auth.signUp({email:n.email,password:n.password});if(f)throw console.error("❌ Auth signup failed:",f),f;if(!v.user)throw new Error("Failed to create user account");console.log("✅ Auth user created:",v.user.id),console.log("📧 Auth user email:",v.user.email),console.log("📧 Auth user metadata:",v.user.user_metadata);const N={id:v.user.id,email:n.email,name:n.name,user_type:n.userType,account_type:n.accountType||"individual",location:n.location,region:n.region,phone:n.phone,business_name:n.businessName,business_description:n.businessDescription,verified:!1,phone_verified:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};console.log("📝 Creating profile with data:"),console.log("  - Name:",N.name),console.log("  - User Type:",N.user_type),console.log("  - Account Type:",N.account_type),console.log("  - Location:",N.location);let m;const{data:x,error:c}=await z.from("users").insert(N).select().single();if(c&&(console.error("❌ Profile insert error:",c),console.error("❌ Error code:",c.code),console.error("❌ Error message:",c.message)),c&&c.code==="23505"){console.log("⚠️ User already exists, updating with new form data");const{data:y,error:l}=await z.from("users").update({name:N.name,user_type:N.user_type,account_type:N.account_type,location:N.location,phone:N.phone,business_name:N.business_name,business_description:N.business_description,updated_at:new Date().toISOString()}).eq("id",v.user.id).select().single();if(l)throw console.error("❌ Profile update failed:",l),new Error(`Profile update failed: ${l.message}`);m=y,console.log("✅ Profile updated with new form data")}else{if(c)throw console.error("❌ Profile creation failed:",c),new Error(`Profile creation failed: ${c.message}`);m=x,console.log("✅ New profile created successfully"),console.log("📋 Created profile data:",m)}return console.log("🎉 Signup completed successfully!"),console.log("👤 Auth user:",v.user.email),console.log("📋 Profile user:",m?.email),{user:v.user,session:v.session,profile:m}}catch(v){throw console.error("❌ Signup failed:",v),v}finally{r(!1)}},[]),i=d.useCallback(async(n,v)=>{if(!z)throw new Error("Supabase not available");r(!0);try{const{data:f,error:N}=await z.auth.signInWithPassword({email:n,password:v});if(N)throw N;return f}catch(f){throw console.error("❌ Signin failed:",f),r(!1),f}},[]),g=d.useCallback(async()=>{if(z)try{const{error:n}=await z.auth.signOut();if(n)throw n;a(null)}catch(n){throw console.error("❌ Signout failed:",n),n}},[]),b=d.useCallback(async n=>{if(!(!s||!z))try{const v={updated_at:new Date().toISOString()};n.accountType!==void 0&&(v.account_type=n.accountType),n.userType!==void 0&&(v.user_type=n.userType),n.phoneVerified!==void 0&&(v.phone_verified=n.phoneVerified),n.businessName!==void 0&&(v.business_name=n.businessName),n.businessDescription!==void 0&&(v.business_description=n.businessDescription),n.businessLicenseNumber!==void 0&&(v.business_license_number=n.businessLicenseNumber),n.joinedDate!==void 0&&(v.created_at=n.joinedDate),n.totalReviews!==void 0&&(v.total_reviews=n.totalReviews),n.name!==void 0&&(v.name=n.name),n.email!==void 0&&(v.email=n.email),n.location!==void 0&&(v.location=n.location),n.region!==void 0&&(v.region=n.region),n.phone!==void 0&&(v.phone=n.phone),n.verified!==void 0&&(v.verified=n.verified),n.verificationStatus!==void 0&&(v.verification_status=n.verificationStatus),n.verificationDocuments!==void 0&&(v.verification_documents=n.verificationDocuments),n.agriLinkVerificationRequested!==void 0&&(v.verification_submitted=n.agriLinkVerificationRequested),n.phoneVerifiedAt!==void 0&&(v.phone_verified_at=n.phoneVerifiedAt),n.verifiedAt!==void 0&&(v.verified_at=n.verifiedAt),n.agriLinkVerificationRequestedAt!==void 0&&(v.agri_link_verification_requested_at=n.agriLinkVerificationRequestedAt);const{data:f,error:N}=await z.from("users").update(v).eq("id",s.id).select().single();if(N)throw console.error("❌ Database update error:",N),N;const m={...s,...n};return a(m),f}catch(v){throw console.error("❌ Profile update failed:",v),v}},[s]);return d.useEffect(()=>{let n=!0,v=!1;const f=setTimeout(()=>{n&&(console.log("⚠️ Auth loading timeout - setting loading to false"),r(!1),v=!1)},2e4),N=async l=>{if(v){console.log("⚠️ Already loading user data, skipping...");return}if(!n){console.log("⚠️ Component unmounted, skipping user data load...");return}v=!0,r(!0);try{const p=z.from("users").select(`
            id,
            email,
            name,
            user_type,
            account_type,
            location,
            phone,
            verified,
            phone_verified,
            created_at,
            verification_documents,
            verification_status,
            verification_submitted,
            phone_verified_at,
            verified_at,
            agri_link_verification_requested_at
          `).eq("id",l).single(),P=new Promise((C,F)=>setTimeout(()=>F(new Error("Database query timeout")),15e3)),{data:w,error:h}=await Promise.race([p,P]);if(h){if(console.error("❌ Profile fetch failed:",h),h.code==="PGRST116"){const{data:C}=await z.auth.getUser();if(C?.user){const{error:F}=await z.from("users").insert([{id:C.user.id,email:C.user.email,name:C.user.user_metadata?.full_name||C.user.user_metadata?.name||C.user.email?.split("@")[0]||"User",user_type:C.user.user_metadata?.user_type||"buyer",account_type:C.user.user_metadata?.account_type||"individual",location:C.user.user_metadata?.location||null,verified:!1,phone_verified:!1,created_at:new Date().toISOString()}]);if(F){console.error("❌ Failed to create user profile:",F),n&&a(null);return}const{data:S,error:j}=await z.from("users").select(`
                  id,
                  email,
                  name,
                  user_type,
                  account_type,
                  location,
                  verified,
                  phone_verified,
                  created_at
                `).eq("id",l).single();if(j||!S){console.error("❌ Retry failed:",j),n&&a(null);return}const L={id:S.id,email:S.email,name:S.name,userType:S.user_type,accountType:S.account_type,location:S.location,phone:S.phone,verified:S.verified,phoneVerified:S.phone_verified,experience:"Unknown",joinedDate:S.created_at,totalReviews:0,verificationStatus:S.verification_status||"not_started",verificationDocuments:S.verification_documents||{},phoneVerifiedAt:S.phone_verified_at,verifiedAt:S.verified_at,agriLinkVerificationRequested:S.verification_submitted||!1,agriLinkVerificationRequestedAt:S.agri_link_verification_requested_at};n&&(a(L),console.log("✅ User profile loaded from database:",L.email));return}}n&&a(null);return}if(!w){console.error("❌ No profile found for user:",l),n&&a(null);return}const k={id:w.id,email:w.email,name:w.name,userType:w.user_type,accountType:w.account_type,location:w.location,phone:w.phone,verified:w.verified,phoneVerified:w.phone_verified,experience:"Unknown",joinedDate:w.created_at,totalReviews:0,verificationStatus:w.verification_status||"not_started",verificationDocuments:w.verification_documents||{},phoneVerifiedAt:w.phone_verified_at,verifiedAt:w.verified_at,agriLinkVerificationRequested:w.verification_submitted||!1,agriLinkVerificationRequestedAt:w.agri_link_verification_requested_at};n&&a(k)}catch(p){console.error("❌ Error loading user data:",p),console.error("❌ Database query failed with error:",p),console.error("❌ Error message:",p.message),console.error("❌ Error details:",p),n&&(a(null),r(!1));return}finally{n&&r(!1),v=!1,console.log("🏁 loadUserData completed")}},{data:{subscription:m}}=z.auth.onAuthStateChange(async(l,p)=>{n&&(console.log("🔄 Auth state change:",l,p?.user?.id),l==="SIGNED_IN"&&p?.user?(console.log("🔄 SIGNED_IN event - loading user data for:",p.user.id),await N(p.user.id)):l==="SIGNED_OUT"?(a(null),r(!1),v=!1,console.log("✅ User signed out")):l==="INITIAL_SESSION"?(console.log("🔄 INITIAL_SESSION event:",{hasSession:!!p,userId:p?.user?.id}),p?.user?localStorage.getItem("agrilink_auto_login")==="true"?(console.log("🔄 Auto-login enabled - loading user data for:",p.user.id),await N(p.user.id)):(console.log("🔄 Auto-login disabled - signing out user"),await z.auth.signOut(),a(null),r(!1),v=!1):(a(null),r(!1),v=!1,console.log("✅ No initial session - user not logged in"))):l==="TOKEN_REFRESHED"&&(console.log("🔄 Token refreshed, ensuring user data is loaded"),p?.user&&!s&&(console.log("🔄 Loading user data after token refresh"),await N(p.user.id))))}),x=async()=>{if(!n)return;console.log("🔄 Window focused - checking session status");const{data:{session:l},error:p}=await z.auth.getSession();if(p){console.error("❌ Session check error on focus:",p);return}console.log("🔍 Window focus session check:",{hasSession:!!l,userId:l?.user?.id,hasUser:!!s}),l?.user&&!s?(console.log("🔄 Session exists but user not loaded - reloading user data"),await N(l.user.id)):!l?.user&&s&&(console.log("🔄 No session but user loaded - signing out"),a(null),r(!1),v=!1)},c=()=>{console.log("🔄 Window blurred")};window.addEventListener("focus",x),window.addEventListener("blur",c);const y=setInterval(async()=>{if(!n||!s)return;const{data:{session:l},error:p}=await z.auth.getSession();if(p){console.error("❌ Periodic session check error:",p);return}!l?.user&&s&&(console.log("🔄 Session expired during periodic check - signing out"),a(null),r(!1),v=!1)},3e4);return()=>{n=!1,v=!1,clearTimeout(f),clearInterval(y),m.unsubscribe(),window.removeEventListener("focus",x),window.removeEventListener("blur",c)}},[]),d.useEffect(()=>{if(!s?.id)return;console.log("🔄 Setting up real-time subscription for user:",s.id);const n=z.channel("user-verification-updates").on("postgres_changes",{event:"UPDATE",schema:"public",table:"users",filter:`id=eq.${s.id}`},v=>{console.log("🔄 User verification status updated:",v),console.log("🔄 Payload details:",{event:v.eventType,table:v.table,schema:v.schema,new:v.new,old:v.old}),(async N=>{try{console.log("🔄 Reloading user data after verification update...");const{data:m,error:x}=await z.from("users").select(`
                  id,
                  email,
                  name,
                  user_type,
                  account_type,
                  location,
                  region,
                  verified,
                  phone_verified,
                  phone,
                  business_name,
                  business_description,
                  created_at,
                  total_reviews,
                  verification_status,
                  verification_documents,
                  verification_submitted,
                  phone_verified_at,
                  verified_at,
                  agri_link_verification_requested_at,
                  business_details_completed
                `).eq("id",N).single();if(x){console.error("❌ Error reloading user data:",x);return}if(m){const c={id:m.id,email:m.email,name:m.name,userType:m.user_type,accountType:m.account_type,location:m.location,region:m.region,verified:m.verified,phoneVerified:m.phone_verified,phone:m.phone,businessName:m.business_name,businessDescription:m.business_description,experience:"Unknown",joinedDate:m.created_at,totalReviews:m.total_reviews||0,verificationStatus:m.verification_status||"not_started",verificationDocuments:m.verification_documents||{},phoneVerifiedAt:m.phone_verified_at,verifiedAt:m.verified_at,agriLinkVerificationRequested:m.verification_submitted||!1,agriLinkVerificationRequestedAt:m.agri_link_verification_requested_at};a(c),console.log("✅ User data reloaded after verification update:",c.email)}}catch(m){console.error("❌ Error reloading user data:",m)}})(s.id)}).subscribe();return()=>{console.log("🔄 Cleaning up user verification subscription"),n.unsubscribe()}},[s?.id]),{user:s,loading:t,signUp:o,signIn:i,signOut:g,updateProfile:b}},ss=()=>{if(!z)throw new Error("Supabase client not available");return z},gs={getAll:async()=>{try{const s=ss(),{data:a,error:t}=await s.from("products").select("*").order("created_at",{ascending:!1});if(t)throw t;return a||[]}catch(s){throw console.error("Fetch products API error:",s),s}},create:async s=>{try{const a=ss(),{data:{session:t},error:r}=await a.auth.getSession();if(r||!t?.user)throw new Error("Not authenticated");const{data:o,error:i}=await a.from("products").insert({...s,seller_id:t.user.id,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(i)throw i;return o}catch(a){throw console.error("Create product API error:",a),a}},update:async(s,a)=>{try{const t=ss(),{data:{session:r},error:o}=await t.auth.getSession();if(o||!r?.user)throw new Error("Not authenticated");const{data:i,error:g}=await t.from("products").update({...a,updated_at:new Date().toISOString()}).eq("id",s).eq("seller_id",r.user.id).select().single();if(g)throw g;return i}catch(t){throw console.error("Update product API error:",t),t}},delete:async s=>{try{const a=ss(),{data:{session:t},error:r}=await a.auth.getSession();if(r||!t?.user)throw new Error("Not authenticated");const{error:o}=await a.from("products").delete().eq("id",s).eq("seller_id",t.user.id);if(o)throw o;return{success:!0}}catch(a){throw console.error("Delete product API error:",a),a}},getUserProducts:async s=>{try{const a=ss(),{data:t,error:r}=await a.from("products").select("*").eq("seller_id",s).order("created_at",{ascending:!1});if(r)throw r;return t||[]}catch(a){throw console.error("Fetch user products API error:",a),a}}},Ni={subscribeToMessages:(s,a)=>{try{return ss().channel(`messages:${s}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`conversation_id=eq.${s}`},a).subscribe()}catch(t){return console.error("Subscribe to messages API error:",t),{unsubscribe:()=>{}}}},subscribeToProducts:s=>{try{return ss().channel("products").on("postgres_changes",{event:"*",schema:"public",table:"products"},s).subscribe()}catch(a){return console.error("Subscribe to products API error:",a),{unsubscribe:()=>{}}}}},wi=()=>{const[s,a]=d.useState([]),[t,r]=d.useState(!0),[o,i]=d.useState(null),g=d.useCallback(async()=>{try{if(r(!0),i(null),!Ve.isSupabaseConfigured()){console.log("❌ Supabase not configured"),a([]),r(!1);return}console.log("🔄 Fetching products from Supabase...");const c=(await gs.getAll()).map(b);a(c),console.log("✅ Products loaded:",c.length)}catch(x){console.error("Fetch products error:",x),i(x instanceof Error?x.message:"Failed to fetch products"),a([])}finally{r(!1)}},[]),b=x=>(console.log("💾 Backend product debug:",{id:x.id,name:x.name,price:x.price,priceType:typeof x.price,unit:x.unit,quantity:x.quantity,seller_name:x.seller_name,fullBackendProduct:x}),{id:x.id,sellerId:x.seller_id,name:x.name,price:Number(x.price),unit:x.unit,location:x.location,region:x.region,sellerType:x.seller_type,sellerName:x.seller_name,image:x.image||x.images?.[0],images:x.images||[],quantity:x.quantity,minimumOrder:x.minimum_order||"1 unit",availableQuantity:x.available_quantity||x.quantity,deliveryOptions:x.delivery_options||["Pickup"],paymentTerms:x.payment_terms||["Cash on delivery"],category:x.category,description:x.description,additionalNotes:x.additional_notes,priceChange:x.price_change||0,lastUpdated:x.last_updated||new Date().toISOString()}),n=x=>{const c={name:x.name||"",description:x.description||"",category:x.category||"agriculture",price:x.price||0,unit:x.unit||"",location:x.location||"",region:x.region||null,seller_type:x.sellerType||"farmer",seller_name:x.sellerName||"Unknown Seller",quantity:x.quantity||"",minimum_order:x.minimumOrder||"1 unit",available_quantity:x.availableQuantity||x.quantity||"",delivery_options:x.deliveryOptions||["Pickup"],payment_terms:x.paymentTerms||["Cash on delivery"],additional_notes:x.additionalNotes||null,price_change:x.priceChange||0,image:x.images?.[0]||x.image||null,images:x.images&&x.images.length>0?x.images:x.image?[x.image]:[],last_updated:new Date().toISOString(),is_active:!0};return console.log("🔄 Frontend to backend transform (matches table schema):",c),console.log("🖼️ Images debug:",{"frontendProduct.images":x.images,"frontendProduct.image":x.image,"transformed.images":c.images,images_length:c.images?.length||0}),c},v=d.useCallback(async x=>{try{if(!Ve.isSupabaseConfigured())throw new Error("Supabase not configured");console.log("➕ Creating product in Supabase:",x.name);const c=n(x);console.log("🚀 Sending to Supabase:",c);const y=await gs.create(c),l=b(y);return console.log("✅ Product created successfully in Supabase"),a(p=>[l,...p]),l}catch(c){throw console.error("❌ Create product error:",c),c}},[]),f=d.useCallback(async(x,c)=>{try{if(!Ve.isSupabaseConfigured())throw new Error("Supabase not configured");console.log("🔄 Updating product in Supabase:",x),console.log("📝 Update data:",c);const y=n(c);console.log("🚀 Sending to Supabase:",y);const l=await gs.update(x,y),p=b(l);return console.log("✅ Product updated successfully in Supabase"),a(P=>P.map(w=>w.id===x?p:w)),p}catch(y){throw console.error("❌ Update product error:",y),y}},[]),N=d.useCallback(async x=>{try{await gs.delete(x),a(c=>c.filter(y=>y.id!==x))}catch(c){throw console.error("Delete product error:",c),c}},[]),m=d.useCallback(async x=>{try{return(await gs.getUserProducts(x)).map(b)}catch(c){return console.error("Get user products error:",c),[]}},[]);return d.useEffect(()=>{console.log("🔄 useProducts - Initial fetch starting..."),g()},[g]),d.useEffect(()=>{if(Ve.isSupabaseConfigured())try{const x=Ni.subscribeToProducts(c=>{if(console.log("Real-time product update:",c),c.eventType==="INSERT"){const y=b(c.new);a(l=>[y,...l])}else if(c.eventType==="UPDATE"){const y=b(c.new);a(l=>l.map(p=>p.id===y.id?y:p))}else c.eventType==="DELETE"&&a(y=>y.filter(l=>l.id!==c.old.id))});return()=>{x.unsubscribe()}}catch(x){console.log("Real-time subscription failed:",x)}},[]),{products:s,loading:t,error:o,fetchProducts:g,createProduct:v,updateProduct:f,deleteProduct:N,getUserProducts:m}};function ki({currentView:s,currentUser:a,setCurrentView:t,setSelectedProductId:r,setSelectedChat:o,setSelectedSellerId:i,setVerificationInitialStep:g,previousView:b,setPreviousView:n}){const v=d.useCallback(()=>{console.log("Marketplace button clicked"),r(null),o(null),t("marketplace")},[r,o,t]),f=d.useCallback(()=>{n&&n(s),r(null),o(null),i(null),a?.userType==="farmer"||a?.userType==="trader"||a?.userType==="buyer"?t("dashboard"):a?.userType==="admin"?t("admin-dashboard"):t("marketplace")},[s,n,a,r,o,i,t]),N=d.useCallback(()=>{b&&b!==s?t(b):a?.userType==="farmer"||a?.userType==="trader"||a?.userType==="buyer"?t("dashboard"):t("marketplace")},[b,s,a,t]),m=d.useCallback(()=>{n&&n(s),t("profile")},[s,n,t]),x=d.useCallback(()=>{n&&n(s),t("messages")},[s,n,t]),c=d.useCallback((D=1)=>{n&&n(s),g(D),t("verification")},[s,n,g,t]),y=d.useCallback(()=>{n&&n(s),t("admin-verification")},[s,n,t]),l=d.useCallback(()=>{n&&n(s),t("about-us")},[s,n,t]),p=d.useCallback(()=>{n&&n(s),t("contact-us")},[s,n,t]),P=d.useCallback(()=>{n&&n(s),t("faq")},[s,n,t]),w=d.useCallback(()=>{t("profile"),window.scrollTo({top:0,behavior:"smooth"})},[t]),h=d.useCallback(()=>{t("register")},[t]),k=d.useCallback(()=>{t("login")},[t]),C=d.useCallback(()=>{t("forgot-password")},[t]),F=d.useCallback(D=>{n&&n(s),r(D),t("product-details")},[s,n,r,t]),S=d.useCallback(D=>{r(D),t("price-comparison")},[r,t]),j=d.useCallback(()=>{s==="price-comparison"?t("product-details"):v()},[s,v,t]),L=d.useCallback(D=>{n&&n(s),i(D),t("seller-storefront")},[s,n,i,t]),q=d.useCallback(()=>{t("seller-storefront")},[t]);return{handleBackToMarketplace:v,handleBackToPrevious:N,handleGoToDashboard:f,handleViewProfile:m,handleViewMessages:x,handleShowVerification:c,handleShowAdminVerification:y,handleShowAboutUs:l,handleShowContactUs:p,handleShowFAQ:P,handleBackToProfile:w,handleGoToRegister:h,handleGoToLogin:k,handleGoToForgotPassword:C,handleViewDetails:F,handlePriceCompare:S,handleBackToProductDetails:j,handleViewStorefront:L,handleBackToStorefront:q}}function Ci({currentUser:s,createProduct:a,updateProduct:t,deleteProduct:r,setEditingProduct:o,setCurrentView:i,setPreviousView:g,setAuthModal:b,currentView:n,previousView:v,allProducts:f}){const N=d.useCallback(async l=>{try{console.log("🚀 handleAddListing called with:",{productId:l.id,productName:l.name,price:l.price,priceType:typeof l.price,isEditing:l.isEditing,hasImage:!!l.image,imageSize:l.image?.length||0,totalSize:JSON.stringify(l).length}),console.log("🌐 Using Supabase API");const p={...l};delete p.isEditing,l.isEditing?(console.log("✏️ Updating existing product via Supabase:",l.id),console.log("📝 Product update data:",{id:l.id,name:l.name,price:l.price,location:l.location}),await t(l.id,p),ee.success("Product updated successfully!")):(console.log("➕ Creating new product via Supabase"),await a(p),ee.success("Product added successfully!")),console.log("🧹 Clearing editing state and navigating back to:",v),console.log("🧹 Clearing editing state and navigating back to:",v),o(null),setTimeout(()=>{console.log("📱 Navigating to:",v),i(v),console.log("✅ Navigation completed")},100)}catch(p){throw console.error("❌ Product operation failed:",p),p instanceof Error?ee.error(`Failed to save product: ${p.message}`):ee.error("Failed to save product. Please try again."),p}},[a,t,v,s,o,i]),m=d.useCallback((l,p)=>{if(console.log("✏️ Edit Product:",l.id),!s){b("login");return}if(s.userType==="buyer")return;const P=p.find(w=>w.id===l.id);if(!P){console.error("❌ Product not found:",l.id),ee.error("Product not found. Please refresh and try again.");return}console.log("📦 Product to edit:",{id:P.id,name:P.name,description:P.description?.substring(0,50)+"..."||"None",category:P.category||"None",hasImage:!!P.image}),console.log("💰 Price debug - Product to edit:",{price:P.price,priceType:typeof P.price}),o(P),g(n),i("add-listing")},[s,b,o,g,i,n]),x=d.useCallback(()=>{if(console.log("🚀 handleShowAddListing called"),console.log("Current user:",s?.email,s?.userType),console.log("Current view:",n),!s){console.log("❌ No current user - showing login modal"),b("login");return}if(s.userType==="buyer"){console.log("❌ User is buyer - cannot create listings");return}console.log("✅ Setting up add listing form"),o(null),g(n),i("add-listing"),console.log("✅ View changed to add-listing")},[n,s,b,o,g,i]),c=d.useCallback(async l=>{console.log("🗑️ Deleting product:",l);try{console.log("🌐 Deleting product via Supabase:",l),await r(l),ee.success("Product deleted successfully")}catch(p){throw console.error("❌ Delete product failed:",p),ee.error("Failed to delete product"),p}},[r]),y=d.useCallback(()=>{o(null),i(v)},[v,o,i]);return{handleAddListing:N,handleEditListing:m,handleShowAddListing:x,handleDeleteListing:c,handleBackFromAddListing:y}}function Si({currentUser:s,allProducts:a,startConversation:t,setSelectedChat:r,setAuthModal:o}){return{handleChat:d.useCallback(async g=>{if(!s){o("login");return}try{const b=a.find(n=>n.id===g);b&&(await t(s.id,b.sellerId,g),r(g))}catch(b){console.error("Failed to start conversation:",b),b instanceof Error&&!b.message.includes("Not authenticated")&&ee.error("Failed to start conversation. Please try again.")}},[s,a,t,r,o])}}function As(s,a){if(a&&s===a.id){const t=a.verified||!1,r=a.businessVerified||!1,o=a.verificationStatus||"unverified";return{idVerified:t,businessVerified:r,verified:t,trustLevel:r?"business-verified":t?"id-verified":o==="under_review"?"under-review":"unverified",tierLabel:r?"Business Verified":t?"Verified":o==="under_review"?"Under Review":"Unverified",levelBadge:r?"Tier 2":t?"Tier 1":o==="under_review"?"Under Review":"Unverified",level:r?2:t?1:0,userType:a.userType,accountType:a.accountType}}try{const r=JSON.parse(localStorage.getItem("agriconnect-myanmar-users")||"[]").find(o=>o.id===s);if(r){const o=r.verified||!1,i=r.businessVerified||!1,g=r.verificationStatus||"unverified";return{idVerified:o,businessVerified:i,verified:o,trustLevel:i?"business-verified":o?"id-verified":g==="under_review"?"under-review":"unverified",tierLabel:i?"Business Verified":o?"Verified":g==="under_review"?"Under Review":"Unverified",levelBadge:i?"Tier 2":o?"Tier 1":g==="under_review"?"Under Review":"Unverified",level:i?2:o?1:0,userType:r.userType,accountType:r.accountType}}}catch(t){console.error("Error checking seller verification status:",t)}return{idVerified:!1,businessVerified:!1,verified:!1,trustLevel:"unverified",tierLabel:"Unverified",levelBadge:"Unverified",level:0,userType:void 0,accountType:void 0}}function _i(s,a){return As(s,a).verified}function Ti(){const[s,a]=d.useState(null);if(d.useRef(0),s)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4 max-w-md",children:[e.jsx("div",{className:"w-16 h-16 bg-destructive rounded-lg flex items-center justify-center mx-auto",children:e.jsx(Oe,{className:"w-8 h-8 text-destructive-foreground"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Application Error"}),e.jsx("p",{className:"text-muted-foreground",children:s}),e.jsx(u,{onClick:()=>window.location.reload(),children:"Refresh Page"})]})});const[t,r]=d.useState("marketplace"),[o,i]=d.useState(null),[g,b]=d.useState(null),[n,v]=d.useState(null),[f,N]=d.useState(null),[m,x]=d.useState(null),[c,y]=d.useState("marketplace"),[l,p]=d.useState(1),[P,w]=d.useState(!1),[h,k]=d.useState(!1),[C,F]=d.useState({show:!1,feature:"chat"}),[S,j]=d.useState(!1),[L,q]=d.useState(null),[D,M]=d.useState(!1),[V,oe]=d.useState(null),[me,he]=d.useState([]),{user:_,signUp:T,signIn:E,signOut:X,updateProfile:Ie}=bi(),{products:H,loading:re,createProduct:ie,updateProduct:we,deleteProduct:es}=wi(),{startConversation:Qe}=ea(),[be,rs]=d.useState({search:"",category:"",location:"",region:"",city:"",sellerType:"",verifiedStatus:"",priceRange:"",sortBy:"newest"}),ue=d.useMemo(()=>{try{return H||[]}catch(U){return console.error("Error in allProducts calculation:",U),a("Failed to load products. Please refresh the page."),[]}},[H,re]),A=ki({currentView:t,currentUser:_,setCurrentView:r,setSelectedProductId:b,setSelectedChat:i,setSelectedSellerId:v,setVerificationInitialStep:p,previousView:c,setPreviousView:y}),K=Ci({currentUser:_,createProduct:ie,updateProduct:we,deleteProduct:es,setEditingProduct:x,setCurrentView:r,setPreviousView:y,setAuthModal:N,currentView:t,previousView:c,allProducts:ue}),se=Si({currentUser:_?.id?_:null,allProducts:ue,startConversation:Qe,setSelectedChat:i,setAuthModal:N}),Be=d.useRef(!1);d.useEffect(()=>{Be.current||(t!=="marketplace"&&r("marketplace"),Be.current=!0)},[]),d.useEffect(()=>{t!=="seller-storefront"&&w(!1)},[t]),d.useEffect(()=>{["faq","about-us","contact-us","profile","verification","admin-verification","add-listing","messages","deals"].includes(t)&&window.scrollTo({top:0,behavior:"smooth"})},[t]),d.useEffect(()=>{},[]);const ke=yi(ue,be,_i),{filteredProducts:ze,getActiveFiltersCount:hs}=ke||{filteredProducts:ue,getActiveFiltersCount:()=>0},Ce=d.useMemo(()=>{const U=o?ue.find(Q=>Q.id===o):null;return console.log("🔍 App.tsx - selectedProduct calculation:",{selectedChat:o,allProductsLength:ue.length,foundProduct:U?{id:U.id,name:U.name,price:U.price,quantity:U.quantity}:null}),U},[o,ue.length]),te=d.useMemo(()=>g?ue.find(U=>U.id===g):null,[g,ue.length]),Za=d.useCallback(async(U,Q)=>{try{await E(U,Q),N(null)}catch(Te){throw console.error("Login failed:",Te),Te}},[E]),ta=d.useCallback(async U=>{try{await T(U),ee.success("Registration successful! Welcome to AgriLink Marketplace!",{duration:4e3}),r("login"),N(null)}catch(Q){throw console.error("Registration failed:",Q),Q}},[T,r]),Xa=d.useCallback(async()=>{try{await X(),i(null),r("marketplace")}catch(U){console.error("Logout failed:",U)}},[X]),is=d.useCallback(async U=>{try{await Ie(U)}catch(Q){throw console.error("Profile update failed:",Q),Q}},[Ie]),ra=d.useCallback(()=>{console.log("Edit profile clicked - using inline editing")},[]),et=d.useCallback(async()=>{const U=document.createElement("input");U.type="file",U.accept="image/*",U.onchange=async Q=>{const Te=Q.target.files?.[0];if(!(!Te||!_))try{const ns=URL.createObjectURL(Te);await is({..._,storefrontImage:ns}),console.log("Storefront image updated successfully")}catch(ns){console.error("Failed to update storefront image:",ns)}},U.click()},[_,is]),st=d.useCallback(async(U,Q)=>{if(!_){ee.error("Please log in to save products");return}try{const{data:Te,error:ns}=await z.from("saved_products").upsert({user_id:_.id,product_id:U,price_when_saved:Q,price_alert:!0,stock_alert:!1},{onConflict:"user_id,product_id"});if(ns){console.error("Failed to save product:",ns),ee.error("Failed to save product");return}ee.success("Product saved for price tracking")}catch(Te){console.error("Failed to save product:",Te),ee.error("Failed to save product")}},[_]);d.useCallback(U=>{if(!_){ee.error("Please log in to make offers");return}if(_.userType!=="buyer"){ee.error("Only buyers can make offers");return}q(U),j(!0)},[_]);const at=d.useCallback(async U=>{if(!(!_||!L))try{const{OffersService:Q}=await ls(async()=>{const{OffersService:Te}=await Promise.resolve().then(()=>Fr);return{OffersService:Te}},void 0);await Q.createOffer({conversationId:"",productId:L.id,buyerId:_.id,sellerId:L.sellerId,price:U.price,quantity:U.quantity,unit:U.unit||L.unit,description:U.description,deliveryTerms:U.deliveryTerms,deliveryLocation:U.deliveryLocation,validUntil:U.validUntil||new Date(Date.now()+10080*60*1e3).toISOString(),status:"pending",notes:U.notes}),ee.success("Offer sent successfully!"),j(!1),q(null)}catch(Q){console.error("Error submitting offer:",Q),ee.error("Failed to send offer. Please try again.")}},[_,L]),tt=d.useCallback(async U=>{if(!(!_||!V))try{ee.success("Review submitted successfully!"),M(!1),oe(null)}catch(Q){console.error("Error submitting review:",Q),ee.error("Failed to submit review. Please try again.")}},[_,V]),rt=d.useMemo(()=>te?(te.price,ue.filter(Q=>Q.name===te.name).map(Q=>({id:Q.id,sellerName:Q.sellerName,sellerType:Q.sellerType,price:Q.price,location:Q.location,quantity:Q.quantity,lastUpdated:Q.lastUpdated}))):[],[te?.id,te?.name,te?.price,ue.length]);return e.jsx(ji,{children:e.jsx(e.Fragment,{children:e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx(pi,{currentView:t,currentUser:_,onBackToMarketplace:A.handleBackToMarketplace,onGoToDashboard:A.handleGoToDashboard,onGoToLogin:A.handleGoToLogin,onGoToRegister:A.handleGoToRegister,onLogout:Xa,onViewStorefront:A.handleViewStorefront,onUpdateUser:is,onShowVerification:A.handleShowVerification,onEditProfile:ra,onViewProfile:A.handleViewProfile,onViewMessages:A.handleViewMessages,onShowAdminVerification:A.handleShowAdminVerification,editingProduct:m}),e.jsx("main",{className:`w-full max-w-5xl mx-auto px-4 ${t==="marketplace"||t==="dashboard"||t==="add-listing"||t==="seller-storefront"||t==="product-details"||t==="price-comparison"||t==="messages"||t==="deals"||t==="admin-verification"||t==="about-us"||t==="contact-us"||t==="faq"?"flex-grow":"flex-grow-0"}`,children:e.jsxs("div",{className:"pt-8 pb-16",children:[t==="login"&&e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsx(zr,{onLogin:Za,onSwitchToRegister:A.handleGoToRegister,onForgotPassword:A.handleGoToForgotPassword,onClose:A.handleBackToMarketplace})}),t==="register"&&e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsx(pa,{onRegister:ta,onSwitchToLogin:A.handleGoToLogin,onClose:A.handleBackToMarketplace})}),t==="forgot-password"&&e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsx(Or,{onBack:A.handleGoToLogin,onReturnToLogin:A.handleGoToLogin})}),t==="profile"&&_&&e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx(Jr,{user:_,onBack:A.handleBackToPrevious,onEditProfile:ra,onShowVerification:A.handleShowVerification,onUpdate:is,onViewStorefront:A.handleViewStorefront})}),t==="add-listing"&&_&&e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx($r,{currentUser:_,onBack:K.handleBackFromAddListing,onSave:K.handleAddListing,editingProduct:m})}),t==="dashboard"&&_&&(_.userType==="farmer"||_.userType==="trader")&&e.jsx(Wr,{user:_,userProducts:ue.filter(U=>U.sellerId===_.id),onAddListing:K.handleShowAddListing,onEditListing:U=>K.handleEditListing(U,ue),onDeleteListing:K.handleDeleteListing,onViewStorefront:()=>A.handleViewStorefront(_.id),onGoToMarketplace:A.handleBackToMarketplace,onViewProduct:A.handleViewDetails,onShowVerification:A.handleShowVerification,onViewMessages:A.handleViewMessages}),t==="dashboard"&&_&&_.userType==="buyer"&&e.jsx(Yr,{user:_,allProducts:ue,savedProducts:me,onGoToMarketplace:A.handleBackToMarketplace,onViewProduct:A.handleViewDetails,onStartChat:se.handleChat,onViewMessages:A.handleViewMessages}),t==="messages"&&_&&e.jsx("div",{className:"max-w-5xl mx-auto",children:e.jsx(Gr,{currentUser:_,onBack:A.handleBackToPrevious,onStartChat:se.handleChat})}),t==="deals"&&_&&e.jsx("div",{className:"max-w-5xl mx-auto",children:e.jsx(li,{currentUserId:_.id,currentUserName:_.name,currentUserType:_.userType,onBack:A.handleBackToPrevious})}),t==="verification"&&_&&e.jsx("div",{className:"max-w-4xl mx-auto pt-8",children:e.jsx(Kr,{currentUser:_,onClose:A.handleBackToProfile,onUpdate:is})}),t==="admin-verification"&&_&&_.userType==="admin"&&e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsx(Zr,{currentAdmin:_,onBack:A.handleBackToPrevious})}),t==="admin-dashboard"&&_&&_.userType==="admin"&&e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx(Xr,{currentAdmin:_,onBack:A.handleBackToPrevious,onNavigateToVerification:()=>A.handleShowAdminVerification()})}),t==="about-us"&&e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx(ei,{onBack:A.handleBackToPrevious})}),t==="contact-us"&&e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx(si,{onBack:A.handleBackToPrevious,currentUser:_})}),t==="faq"&&e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx(ni,{onBack:A.handleBackToPrevious,onShowContactUs:A.handleShowContactUs})}),t==="marketplace"&&e.jsxs("div",{className:"space-y-8",children:[e.jsx(fi,{currentUser:_,allProducts:ue,onGoToRegister:A.handleGoToRegister,onGoToLogin:A.handleGoToLogin,onShowAddListing:K.handleShowAddListing}),e.jsxs("section",{className:"space-y-6",children:[_?.userType==="admin"&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-sm font-medium text-primary",children:"🛠️ Admin Dashboard - Product Management Mode Active"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"You have administrator privileges to manage all products on the platform"})]})}),e.jsx(wr,{filters:be,onFiltersChange:rs,activeFiltersCount:hs},JSON.stringify(be)),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:re?Array.from({length:6}).map((U,Q)=>e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"bg-gray-200 rounded-lg h-64"})},Q)):ze.length>0?ze.map(U=>{const Q=As(U.sellerId,_);return e.jsx(vr,{product:U,onChat:se.handleChat,onViewDetails:A.handleViewDetails,onViewStorefront:A.handleViewStorefront,onDelete:_?.userType==="admin"?K.handleDeleteListing:void 0,onSaveProduct:_?.userType==="buyer"?st:void 0,currentUserId:_?.id,currentUserType:_?.userType,sellerVerified:Q.verified,sellerVerificationStatus:Q,adminMode:_?.userType==="admin",savedProductIds:me.map(Te=>Te.productId)},U.id)}):e.jsxs("div",{className:"col-span-1 md:col-span-2 lg:col-span-3 text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-muted rounded-lg flex items-center justify-center mx-auto mb-4",children:e.jsx(Oe,{className:"w-8 h-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Products Available"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:_?"There are no products listed yet. Be the first to add a product!":"There are no products listed yet. Sign up to add your first product!"}),e.jsx("div",{className:"flex justify-center items-center space-x-2",children:_?e.jsx(u,{onClick:K.handleShowAddListing,children:"Add Your First Product"}):e.jsxs(e.Fragment,{children:[e.jsx(u,{onClick:A.handleGoToRegister,children:"Sign Up to Add Products"}),e.jsx(u,{variant:"outline",onClick:A.handleGoToLogin,children:"Sign In"})]})})]})})]})]}),t==="product-details"&&te&&(()=>{const U=As(te.sellerId,_);let Q=null;return te.sellerId===_?.id?Q={id:_.id,name:_.businessName||_.name,businessName:_.businessName,userType:_.userType,location:_.location,experience:_.experience,joinedDate:_.joinedDate||"Recently",rating:_.rating||4.2,totalReviews:_.totalReviews||12,yearsActive:_.experience?parseInt(_.experience.split(" ")[0])||1:3,responseTime:_.responseTime||(_.userType==="farmer"?"3 hours":"1 hour"),phone:_.phone||"",openingHours:_.openingHours||(_.userType==="farmer"?"9 AM - 6 PM":"8 AM - 7 PM")}:Q={id:te.sellerId,name:te.sellerName||"Seller",businessName:te.sellerName||"Seller",userType:te.sellerType||"farmer",location:te.location||"Unknown",experience:"3 years",joinedDate:"Recently",rating:4.5,totalReviews:15,yearsActive:3,responseTime:te.sellerType==="farmer"?"3 hours":"1 hour",phone:"",openingHours:te.sellerType==="farmer"?"9 AM - 6 PM":"8 AM - 7 PM"},e.jsx(Er,{product:te,onBack:A.handleBackToMarketplace,onChat:se.handleChat,onPriceCompare:A.handlePriceCompare,onViewStorefront:A.handleViewStorefront,onEditProduct:Te=>K.handleEditListing(Te,ue),currentUserId:c==="seller-storefront"&&te.sellerId===_?.id?null:_?.id,isUserVerified:_?.verified||!1,userType:_?.userType,isPhoneVerified:_?.phoneVerified||!1,sellerVerified:U.verified,sellerVerificationStatus:U,sellerProfile:Q})})(),t==="price-comparison"&&te&&e.jsx(kr,{productName:te.name,priceData:rt,unit:te.unit,onBack:A.handleBackToProductDetails,isOwnProduct:_?.id===te.sellerId}),t==="seller-storefront"&&n&&(()=>{let U=null;return n===_?.id?U={id:_.id,name:_.businessName||_.name,type:_.userType,accountType:_.accountType,location:_.location,description:_.businessDescription||`${_.userType} in ${_.location}`,image:_.storefrontImage||"https://images.unsplash.com/photo-1500382017468-9049fed747ef?w=400&h=300&fit=crop",rating:_.rating||0,totalReviews:_.totalReviews||0,yearsActive:parseInt(_.experience?.split(" ")[0]||"1"),responseTime:_.responseTime||(_.userType==="farmer"?"3 hours":"1 hour"),certifications:_.qualityCertifications||[],joinedDate:_.joinedDate||"Recently",verified:_.verified||!1,phone:_.phone||"",email:_.email||"",website:_.website||"",facebook:_.facebook||"",instagram:_.instagram||"",telegram:_.telegram||"",businessHours:_.businessHours||"9 AM - 6 PM, Mon-Sat",specialties:_.specialties||[],policies:_.policies||{returns:"",delivery:"",payment:""}}:U={id:n,name:"Seller",type:"farmer",accountType:"individual",location:"Unknown",description:"Seller in Unknown",image:"https://images.unsplash.com/photo-1500382017468-9049fed747ef?w=400&h=300&fit=crop",rating:0,totalReviews:0,yearsActive:1,responseTime:"3 hours",certifications:[],joinedDate:"Recently",verified:!1,phone:"",email:"",website:"",facebook:"",instagram:"",telegram:"",businessHours:"9 AM - 6 PM, Mon-Sat",specialties:[],policies:{returns:"",delivery:"",payment:""}},U?e.jsx(qr,{seller:U,products:ue.filter(Q=>Q.sellerId===n),onBack:A.handleBackToPrevious,onViewProduct:A.handleViewDetails,onChat:se.handleChat,isOwnStorefront:n===_?.id,onEditStorefrontImage:n===_?.id?et:void 0,onUpdateStorefront:n===_?.id?is:void 0,previewMode:P,onTogglePreviewMode:n===_?.id?w:void 0}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Seller not found."}),e.jsx(u,{onClick:A.handleBackToMarketplace,children:"Back to Marketplace"})]})})()]})}),o&&Ce&&(()=>{const U=Ce.sellerId===_?.id?_:null,Q=As(Ce.sellerId,_);return e.jsx(e.Fragment,{children:e.jsx("div",{className:"fixed right-0 bottom-0 h-[500px] w-96 bg-card shadow-2xl border-l border-t z-50 transition-transform duration-300",children:e.jsx(Hs,{sellerName:Ce.sellerName,sellerType:Ce.sellerType,sellerLocation:Ce.location,currentUser:_,sellerRating:4.5,productName:Ce.name,productId:Ce.id,sellerId:Ce.sellerId,product:Ce,onClose:()=>i(null),sellerVerified:U?.verified||!1,currentUserVerified:_?.verified||!1,currentUserType:_?.userType,sellerVerificationStatus:Q},"desktop-chat")})})})(),f==="register"&&e.jsx(pa,{onRegister:ta,onSwitchToLogin:A.handleGoToLogin,onClose:()=>N(null)}),C.show&&e.jsx(Qr,{feature:C.feature,sellerName:C.sellerName,userType:_?.userType,onClose:()=>F({show:!1,feature:"chat"}),onStartVerification:()=>{F({show:!1,feature:"chat"}),A.handleShowVerification()}}),e.jsx(gi,{onShowAboutUs:A.handleShowAboutUs,onShowContactUs:A.handleShowContactUs,onShowFAQ:A.handleShowFAQ}),S&&L&&_&&e.jsx(oi,{isOpen:S,onClose:()=>{j(!1),q(null)},onSubmit:at,product:{id:L.id,name:L.name,price:L.price,unit:L.unit,sellerName:L.sellerName,location:L.location},currentUser:{id:_.id,name:_.name}}),D&&V&&_&&e.jsx(ci,{isOpen:D,onClose:()=>{M(!1),oe(null)},onSubmit:tt,transaction:V,currentUser:{id:_.id,name:_.name}}),e.jsx(vi,{position:"top-right"})]})})})}mr.createRoot(document.getElementById("root")).render(e.jsx(Ti,{}));
