const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ProductDetails-_O32jt8C.js","assets/ui-CrM3Hg5W.js","assets/vendor-BWX1YzKK.js","assets/icons-Duv7h_B3.js","assets/supabase-BRe8iXyT.js","assets/utils--BulIq_u.js","assets/components-B9TP8a8L.js","assets/VerificationPrompt-gtVzF782.js","assets/AboutUs-CXntuA7n.js","assets/ContactUsPage-C0Xg_HzQ.js","assets/FAQ-DqXYqsIc.js","assets/DealsManagement-DCkrTn2F.js","assets/OfferModal-nF9xU2f6.js","assets/ReviewModal-CoY_sFm7.js"])))=>i.map(i=>d[i]);
import{r as n,j as e,S as ka,b as et,T as st,I as at,V as tt,P as rt,C as it,c as nt,d as lt,e as ot,f as ct,g as dt,h as mt,i as Ca,k as ut,l as ht,m as xt,n as ft,o as pt,p as gt,q as vt,s as jt,t as yt,A as bt,u as Sa,v as Js,O as _a,w as Ta,x as Pa,D as Da,y as Nt,z as wt,B as kt,E as Ct,F as St,G as _t,R as js,H as Tt,J as Pt,K as Dt,L as Lt,M as It,N as At,Q as Rt,U as Et,W as Ft}from"./ui-CrM3Hg5W.js";import{a as Mt}from"./vendor-BWX1YzKK.js";import{c as Vt,_ as Se}from"./supabase-BRe8iXyT.js";import{t as La,c as Ia,a as Ws}from"./utils--BulIq_u.js";import{B as es,S as ae,a as Ys,T as We,b as Ks,U as Pe,A as ls,C as ee,c as Ce,P as qe,d as Ae,M as pe,L as Be,e as Ps,f as As,H as Ss,g as Xe,h as he,i as Qs,j as Zs,k as Aa,l as Ra,m as Ea,F as Bs,X as Le,n as Oe,D as os,o as Rs,p as $e,q as _s,E as ge,r as Ds,s as zt,t as cs,u as Os,v as ys,w as qt,x as bs,y as is,z as Fa,G as Bt,I as Ve,J as Xs,K as se,N as be,O as ns,Q as Ot,R as $t,V as la,W as oa,Y as Ke,Z as ca,_ as rs,$ as ea,a0 as $s,a1 as Ut,a2 as Ht,a3 as Gt,a4 as Us,a5 as Ma,a6 as gs,a7 as Jt,a8 as Wt,a9 as Va,aa as za,ab as da,ac as Yt,ad as Kt,ae as ma,af as ua,ag as ha,ah as xa,ai as fa,aj as Qt,ak as Zt}from"./icons-Duv7h_B3.js";import{t as H,z as Xt,T as er}from"./components-B9TP8a8L.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const c of l)if(c.type==="childList")for(const h of c.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function t(l){const c={};return l.integrity&&(c.integrity=l.integrity),l.referrerPolicy&&(c.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?c.credentials="include":l.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(l){if(l.ep)return;l.ep=!0;const c=t(l);fetch(l.href,c)}})();var ws={},pa;function sr(){if(pa)return ws;pa=1;var s=Mt();return ws.createRoot=s.createRoot,ws.hydrateRoot=s.hydrateRoot,ws}var ar=sr();function Q(...s){return La(Ia(s))}const tr=Ws("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9 rounded-md"}},defaultVariants:{variant:"default",size:"default"}}),f=n.forwardRef(({className:s,variant:a,size:t,asChild:r=!1,...l},c)=>{const h=r?ka:"button";return e.jsx(h,{"data-slot":"button",className:Q(tr({variant:a,size:t,className:s})),ref:c,...l})});f.displayName="Button";const rr=Ws("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}}),U=n.forwardRef(({className:s,variant:a,asChild:t=!1,...r},l)=>{const c=t?ka:"span";return e.jsx(c,{ref:l,"data-slot":"badge",className:Q(rr({variant:a}),s),...r})});U.displayName="Badge";function oe(...s){return La(Ia(s))}const Ls={farmer:{key:"farmer",label:"Farmer",shortLabel:"Farmer",icon:Ks,description:"Grows and harvests agricultural products",color:"text-white dark:text-white",bgColor:"bg-green-600 dark:bg-green-600",borderColor:"border-green-600 dark:border-green-600"},trader:{key:"trader",label:"Trader",shortLabel:"Trader",icon:We,description:"Distributes and trades agricultural products",color:"text-white dark:text-white",bgColor:"bg-orange-600 dark:bg-orange-600",borderColor:"border-orange-600 dark:border-orange-600"},buyer:{key:"buyer",label:"Buyer",shortLabel:"Buyer",icon:Ys,description:"Purchases agricultural products for business or personal use",color:"text-blue-700 dark:text-blue-400",bgColor:"bg-blue-50 dark:bg-blue-900/20",borderColor:"border-blue-200 dark:border-blue-800"},admin:{key:"admin",label:"Admin",shortLabel:"Admin",icon:ae,description:"AgriLink platform administrator",color:"text-gray-700 dark:text-gray-300",bgColor:"bg-gray-50 dark:bg-gray-900/20",borderColor:"border-gray-200 dark:border-gray-800"}},ir={individual:{key:"individual",label:"Individual Account",shortLabel:"Individual",description:"Personal account perfect for small-scale farmers and individual sellers. No business license required - just verify your identity with Myanmar ID/NRC."},business:{key:"business",label:"Business Account",shortLabel:"Business",description:"For formal businesses, cooperatives, and companies. Requires business registration and provides enhanced credibility for larger operations."}},ds={unverified:{key:"unverified",label:"Unverified",shortLabel:"Unverified",icon:Ae,description:"Basic account - verification not started",color:"text-red-600 dark:text-red-400",bgColor:"bg-red-50 dark:bg-red-900/20",borderColor:"border-red-200 dark:border-red-800",level:0,requirements:["Account registration","Email verification"],accountTypes:["individual","business"]},"phone-verified":{key:"phone-verified",label:"Phone Verified",shortLabel:"Phone Verified",icon:qe,description:"Phone verified - ID verification still needed",color:"text-yellow-600 dark:text-yellow-400",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",borderColor:"border-yellow-200 dark:border-yellow-800",level:.3,requirements:["Phone number verification","SMS confirmation"],accountTypes:["individual","business"]},"under-review":{key:"under-review",label:"Under Review",shortLabel:"Under Review",icon:Ce,description:"Documents submitted, awaiting verification",color:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-50 dark:bg-blue-900/20",borderColor:"border-blue-200 dark:border-blue-800",level:.5,requirements:["Documents uploaded","Awaiting admin review"],accountTypes:["individual","business"]},"id-verified":{key:"id-verified",label:"Verified",shortLabel:"Verified",icon:ee,description:"Individual verification complete - trusted member",color:"text-green-600 dark:text-green-400",bgColor:"bg-green-50 dark:bg-green-900/20",borderColor:"border-green-200 dark:border-green-800",level:1,requirements:["Valid Myanmar ID/NRC","Identity verification"],accountTypes:["individual"]},"business-verified":{key:"business-verified",label:"Business Verified",shortLabel:"Business ✓",icon:ls,description:"Business registration and ID verified - formal business",color:"text-primary dark:text-primary-foreground",bgColor:"bg-primary/10 dark:bg-primary/20",borderColor:"border-primary/30 dark:border-primary/40",level:2,requirements:["Valid Myanmar ID/NRC","Business registration","Business license"],accountTypes:["business"]}},nr={"organic-certified":{label:"Organic Certified",icon:Be,color:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200"},"export-ready":{label:"Export Quality",icon:ls,color:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200"},"local-champion":{label:"Local Champion",icon:pe,color:"text-purple-600",bgColor:"bg-purple-50",borderColor:"border-purple-200"},sustainable:{label:"Sustainable Practices",icon:Ks,color:"text-emerald-600",bgColor:"bg-emerald-50",borderColor:"border-emerald-200"}};function lr({verificationLevel:s="unverified",size:a="xs",className:t}){const r=ds[s]||ds.unverified,l={xs:"text-xs px-1.5 py-0.5",sm:"text-xs px-2 py-1"},c={xs:"w-3 h-3",sm:"w-3 h-3"};return e.jsxs(U,{variant:"outline",className:oe(l[a],r.color,r.bgColor,r.borderColor,"font-medium flex items-center gap-1 ml-1",t),children:[e.jsx(r.icon,{className:c[a]}),r.shortLabel]})}function or({verificationLevel:s="unverified",size:a="xs",className:t}){const r=ds[s]||ds.unverified,l={xs:"text-xs px-1.5 py-0.5",sm:"text-xs px-2 py-1"},c={xs:"w-3 h-3",sm:"w-3 h-3"};return e.jsxs(U,{variant:"outline",className:oe(l[a],r.color,r.bgColor,r.borderColor,"font-medium flex items-center gap-1 ml-1",t),children:[e.jsx(r.icon,{className:c[a]}),r.shortLabel]})}function Ns({userType:s,accountType:a,verificationLevel:t="unverified",specialties:r=[],size:l="md",showDescription:c=!1,className:h}){const v=Ls[s]||Ls.farmer,i=ds[t]||ds.unverified,d=a?ir[a]:null,b={sm:"text-xs px-2 py-1",md:"text-sm px-3 py-1.5",lg:"text-base px-4 py-2"},k={sm:"w-3 h-3",md:"w-4 h-4",lg:"w-5 h-5"},o=()=>l==="sm"?v.shortLabel:v.label,p=s==="farmer"?{className:oe(b[l],"font-medium flex items-center gap-1 bg-green-600 text-white border-green-600"),style:{backgroundColor:"#16a34a",color:"#ffffff",borderColor:"#16a34a"}}:s==="trader"?{className:oe(b[l],"font-medium flex items-center gap-1 bg-orange-600 text-white border-orange-600"),style:{backgroundColor:"#ea580c",color:"#ffffff",borderColor:"#ea580c"}}:{className:oe(b[l],s==="buyer"&&oe(v.color,v.bgColor,v.borderColor),s==="admin"&&oe(v.color,v.bgColor,v.borderColor),"font-medium flex items-center gap-1"),style:void 0},w=e.jsxs(U,{variant:"default",className:p.className,style:p.style,children:[a==="business"?e.jsx(es,{className:oe(k[l],s==="farmer"||s==="trader"?"text-white":v.color)}):e.jsx(Pe,{className:oe(k[l],s==="farmer"||s==="trader"?"text-white":v.color)}),o()]});return e.jsxs("div",{className:oe("flex flex-wrap items-center gap-2",h),children:[w,e.jsx(or,{verificationLevel:t,size:l==="lg"?"sm":"xs"}),r.map(x=>{const g=nr[x];return g?e.jsxs(U,{variant:"outline",className:oe(b[l],g.color,g.bgColor,g.borderColor,"font-medium flex items-center gap-1.5"),children:[e.jsx(g.icon,{className:k[l]}),l!=="lg"?"★":g.label]},x):null}),c&&l!=="sm"&&e.jsxs("div",{className:"text-xs text-muted-foreground max-w-xs",children:[v.description,d&&e.jsxs("span",{className:"block mt-1",children:["Account Type: ",d.description]}),t!=="unverified"&&e.jsx("span",{className:"block mt-1",children:i.description})]})]})}function qa({userType:s,accountType:a,size:t="sm",className:r}){const l=Ls[s]||Ls.farmer,c={sm:"text-xs px-2 py-1",md:"text-sm px-3 py-1.5",lg:"text-base px-4 py-2"},h={sm:"w-3 h-3",md:"w-4 h-4",lg:"w-5 h-5"},v=()=>t==="sm"?l.shortLabel:l.label,d=s==="farmer"?{className:oe(c[t],"font-medium flex items-center gap-1 bg-green-600 text-white border-green-600"),style:{backgroundColor:"#16a34a",color:"#ffffff",borderColor:"#16a34a"}}:s==="trader"?{className:oe(c[t],"font-medium flex items-center gap-1 bg-orange-600 text-white border-orange-600"),style:{backgroundColor:"#ea580c",color:"#ffffff",borderColor:"#ea580c"}}:{className:oe(c[t],s==="buyer"&&oe(l.color,l.bgColor,l.borderColor),s==="admin"&&oe(l.color,l.bgColor,l.borderColor),"font-medium flex items-center gap-1"),style:void 0};return e.jsxs(U,{variant:"default",className:oe(d.className,r),style:d.style,children:[a==="business"?e.jsx(es,{className:oe(h[t],s==="farmer"||s==="trader"?"text-white":l.color)}):e.jsx(Pe,{className:oe(h[t],s==="farmer"||s==="trader"?"text-white":l.color)}),v()]})}function Ye(s){return s.verificationStatus==="under_review"||s.verificationSubmitted&&s.verificationStatus!=="verified"?"under-review":s.accountType==="business"&&s.verified&&s.businessVerified?"business-verified":s.verified?"id-verified":s.phoneVerified?"phone-verified":"unverified"}function ms(s){return s.accountType||"individual"}function R({className:s,...a}){return e.jsx("div",{"data-slot":"card",className:Q("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border",s),...a})}function Y({className:s,...a}){return e.jsx("div",{"data-slot":"card-header",className:Q("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 pt-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",s),...a})}function K({className:s,...a}){return e.jsx("h4",{"data-slot":"card-title",className:Q("leading-none",s),...a})}function Je({className:s,...a}){return e.jsx("p",{"data-slot":"card-description",className:Q("text-muted-foreground",s),...a})}function E({className:s,...a}){return e.jsx("div",{"data-slot":"card-content",className:Q("px-6 [&:last-child]:pb-6",s),...a})}function Ba({className:s,...a}){return e.jsx("div",{"data-slot":"card-footer",className:Q("flex items-center px-6 pb-6 [.border-t]:pt-6",s),...a})}const cr=(s,a={})=>{if(!s||s.startsWith("data:"))return s;if(s.startsWith("http")){const t=new URL(s);return(t.hostname.includes("unsplash.com")||t.hostname.includes("images.unsplash.com"))&&(t.searchParams.set("w",(a.width||400).toString()),t.searchParams.set("q",(a.quality||80).toString())),t.toString()}return s},dr=(s,a={})=>{const[t,r]=n.useState(!1);return n.useEffect(()=>{const l=s.current;if(!l)return;const c=new IntersectionObserver(([h])=>{h.isIntersecting&&(r(!0),c.disconnect())},{threshold:.1,rootMargin:"50px",...a});return c.observe(l),()=>{c.disconnect()}},[s,a]),t},mr=n.memo(function({src:a,alt:t,className:r="",fallbackSrc:l="/placeholder-image.jpg",lazy:c=!0,quality:h=80,width:v=400,height:i=300,placeholder:d,onLoad:b,onError:k}){const[o,C]=n.useState(!0),[p,w]=n.useState(!1),[x,g]=n.useState(""),u=n.useRef(null),y=n.useRef(null),m=dr(y,{threshold:.1}),j=cr(a,{quality:h,width:v});n.useEffect(()=>{(!c||m)&&g(j)},[c,m,j]);const N=()=>{C(!1),w(!1),b?.()},M=()=>{C(!1),w(!0),x!==l?g(l):k?.()};return o&&!x?e.jsx("div",{ref:y,className:`bg-muted animate-pulse flex items-center justify-center ${r}`,style:{width:v,height:i},children:d?e.jsx("img",{src:d,alt:"Loading...",className:"w-full h-full object-cover opacity-50"}):e.jsx(Ps,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):e.jsxs("div",{ref:y,className:`relative ${r}`,children:[o&&e.jsx("div",{className:"absolute inset-0 bg-muted animate-pulse flex items-center justify-center z-10",children:e.jsx(Ps,{className:"w-6 h-6 animate-spin text-muted-foreground"})}),p&&x===l&&e.jsx("div",{className:"absolute inset-0 bg-muted flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx("div",{className:"w-12 h-12 bg-muted-foreground/20 rounded-lg flex items-center justify-center mx-auto mb-2",children:e.jsx("span",{className:"text-xs",children:"📷"})}),e.jsx("p",{className:"text-xs",children:"Image not available"})]})}),x&&e.jsx("img",{ref:u,src:x,alt:t,className:`w-full h-full object-cover transition-opacity duration-300 ${o?"opacity-0":"opacity-100"}`,onLoad:N,onError:M,loading:c?"lazy":"eager",decoding:"async"})]})}),ur=(s,a=800,t=600,r=.8)=>new Promise((l,c)=>{const h=document.createElement("canvas"),v=h.getContext("2d"),i=new Image;i.onload=()=>{let{width:d,height:b}=i;d>b?d>a&&(b=b*a/d,d=a):b>t&&(d=d*t/b,b=t),h.width=d,h.height=b,v?.drawImage(i,0,0,d,b);const k=h.toDataURL("image/jpeg",r);l(k)},i.onerror=c,i.src=URL.createObjectURL(s)});function Es(s){if(!s)return"Recently";if(!s.includes("T")&&!s.includes("-"))return s;try{const a=new Date(s);return isNaN(a.getTime())?"Recently":`${["January","February","March","April","May","June","July","August","September","October","November","December"][a.getMonth()]} ${a.getFullYear()}`}catch(a){return console.warn("Failed to parse date:",s,a),"Recently"}}function us(s){if(!s)return"Recently";try{let a;if(s.includes("T")||s.includes("Z"))a=new Date(s);else if(s.includes("-"))a=new Date(s+"T00:00:00");else return s;if(isNaN(a.getTime()))return"Recently";const t=new Date,r=t.getTime()-a.getTime();if(r<-6e4)return"Recently";if(r<0)return"Just now";const l=Math.floor(r/1e3),c=Math.floor(r/(1e3*60)),h=Math.floor(r/(1e3*60*60)),v=Math.floor(r/(1e3*60*60*24));if(l<30)return"Just now";if(c<1)return"Just now";if(c<60)return`${c} minute${c===1?"":"s"} ago`;if(h<24)return`${h} hour${h===1?"":"s"} ago`;if(v<30)return`${v} day${v===1?"":"s"} ago`;{const i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],d=a.getDate(),b=i[a.getMonth()],k=a.getFullYear(),o=t.getFullYear();return k===o?`${b} ${d}`:`${b} ${d}, ${k}`}}catch(a){return console.warn("Failed to parse date for relative time:",s,a),"Recently"}}const ks="kojgbqlxerixvckiraus",ga="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtvamdicWx4ZXJpeHZja2lyYXVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzNDIxOTIsImV4cCI6MjA3NDkxODE5Mn0.2nAVFSEZK4Je5LqI1H_otibVhpMarVOyiRBXmkxuAWM",hr={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function xr(){try{if(typeof import.meta<"u"&&hr)return{SUPABASE_URL:`https://${ks}.supabase.co`,SUPABASE_ANON_KEY:ga,SUPABASE_PROJECT_ID:ks,isVite:!0}}catch{console.log("Vite environment not available, using Supabase info")}return{SUPABASE_URL:`https://${ks}.supabase.co`,SUPABASE_ANON_KEY:ga,SUPABASE_PROJECT_ID:ks,isVite:!1}}const Cs=xr(),Ne={SUPABASE_URL:Cs.SUPABASE_URL,SUPABASE_ANON_KEY:Cs.SUPABASE_ANON_KEY,SUPABASE_PROJECT_ID:Cs.SUPABASE_PROJECT_ID,isVite:Cs.isVite,isSupabaseConfigured(){return!!(this.SUPABASE_URL&&this.SUPABASE_ANON_KEY)}},V=Vt(Ne.SUPABASE_URL,Ne.SUPABASE_ANON_KEY),fs=Object.freeze(Object.defineProperty({__proto__:null,supabase:V},Symbol.toStringTag,{value:"Module"})),Fs={getUserAnalytics:async s=>{try{if(!Ne.isSupabaseConfigured())throw new Error("Supabase not configured");const a=new Date,t=new Date(a.getFullYear(),a.getMonth(),1),r=new Date(a.getFullYear(),a.getMonth()-1,1),l=new Date(a.getFullYear(),a.getMonth(),0),{data:c,error:h}=await V.from("inquiries").select("id").eq("seller_id",s).gte("created_at",t.toISOString()),{data:v,error:i}=await V.from("inquiries").select("id").eq("seller_id",s).gte("created_at",r.toISOString()).lt("created_at",l.toISOString()),{data:d,error:b}=await V.from("profile_views").select("id").eq("viewed_user_id",s).gte("viewed_at",t.toISOString()),{data:k,error:o}=await V.from("profile_views").select("id").eq("viewed_user_id",s).gte("viewed_at",r.toISOString()).lt("viewed_at",l.toISOString()),{data:C,error:p}=await V.from("product_views").select("id, products!inner(seller_id)").eq("products.seller_id",s).gte("viewed_at",t.toISOString()),{data:w,error:x}=await V.from("product_views").select("id, products!inner(seller_id)").eq("products.seller_id",s).gte("viewed_at",r.toISOString()).lt("viewed_at",l.toISOString()),g=c?.length||0,u=v?.length||0,y=d?.length||0,m=k?.length||0,j=C?.length||0,N=w?.length||0,M=(P,F)=>F===0?P>0?100:0:Math.round((P-F)/F*100),_={inquiries:M(g,u),profileViews:M(y,m),productViews:M(j,N)};return{currentMonth:{monthlyInquiries:g,monthlyProfileViews:y,monthlyProductViews:j,totalInquiries:g,totalProfileViews:y,totalProductViews:j},lastMonth:{monthlyInquiries:u,monthlyProfileViews:m,monthlyProductViews:N,totalInquiries:0,totalProfileViews:0,totalProductViews:0},growth:_}}catch(a){throw console.error("Error fetching user analytics:",a),a}},trackProfileView:async(s,a)=>{try{if(!Ne.isSupabaseConfigured())return;const{error:t}=await V.from("profile_views").insert({viewed_user_id:s,viewer_user_id:a||null});t&&console.error("Error tracking profile view:",t)}catch(t){console.error("Error tracking profile view:",t)}},trackProductView:async(s,a)=>{try{if(!Ne.isSupabaseConfigured())return;const{error:t}=await V.from("product_views").insert({product_id:s,viewer_user_id:a||null});t&&console.error("Error tracking product view:",t)}catch(t){console.error("Error tracking product view:",t)}},trackInquiry:async(s,a,t,r="message")=>{try{if(!Ne.isSupabaseConfigured())throw new Error("Supabase not configured");const{data:l,error:c}=await V.from("inquiries").insert({product_id:s,buyer_id:a,seller_id:t,inquiry_type:r}).select("id").single();if(c)throw console.error("Error tracking inquiry:",c),c;return l.id}catch(l){throw console.error("Error tracking inquiry:",l),l}},getRecentInquiries:async(s,a=10)=>{try{if(!Ne.isSupabaseConfigured())return[];const{data:t,error:r}=await V.from("inquiries").select(`
          id,
          inquiry_type,
          created_at,
          is_read,
          products!inner(name, price),
          buyer:users!inquiries_buyer_id_fkey(name, user_type)
        `).eq("seller_id",s).order("created_at",{ascending:!1}).limit(a);return r?(console.error("Error fetching recent inquiries:",r),[]):t||[]}catch(t){return console.error("Error fetching recent inquiries:",t),[]}}};function fr(s,a,t){try{const r=localStorage.getItem("agriconnect-myanmar-current-user");if(r&&a===s){const h=JSON.parse(r);return{name:h.businessName||h.name||"Unknown Seller",location:h.location||"Location not set",lastUpdated:t?us(t):"Recently"}}const c=JSON.parse(localStorage.getItem("agriconnect-myanmar-users")||"[]").find(h=>h.id===s);if(c)return{name:c.businessName||c.name||"Unknown Seller",location:c.location||"Location not set",lastUpdated:t?us(t):"Recently"}}catch(r){console.error("Error fetching seller info:",r)}return null}const pr=n.memo(function({product:a,onChat:t,onViewDetails:r,onViewStorefront:l,onDelete:c,onSaveProduct:h,currentUserId:v,currentUserType:i,sellerVerified:d=!1,sellerVerificationStatus:b,adminMode:k=!1,savedProductIds:o=[]}){const C=v&&a.sellerId===v,p=o.includes(a.id);n.useEffect(()=>{(async()=>{if(!C)try{await Fs.trackProductView(a.id,v)}catch(N){console.error("❌ Error tracking product view:",N)}})()},[a.id,v,C]);const w=()=>a.price||0,x=()=>{h&&v&&!C&&h(a.id,w())},g=fr(a.sellerId,v,a.lastUpdated),u=g?.name||a.sellerName,y=g?.location||a.location,m=g?.lastUpdated||us(a.lastUpdated);return e.jsxs(R,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(E,{className:"p-3",children:[e.jsxs("div",{className:"relative mb-2",children:[e.jsx("div",{onClick:()=>r(a.id),children:e.jsx(mr,{src:a.images?.[0]||a.image,alt:a.name,className:"w-full h-48 rounded-lg cursor-pointer",fallbackSrc:"https://images.unsplash.com/photo-1500382017468-9049fed747ef?w=400&h=300&fit=crop",lazy:!0,quality:75,width:400,height:192,onLoad:()=>{}})}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(qa,{userType:a.sellerType,accountType:a.sellerVerificationStatus?.accountType||"individual",size:"sm"})}),k&&c&&e.jsx(f,{variant:"destructive",size:"sm",className:"absolute top-2 left-2 h-8 w-8 p-0 z-10",onClick:j=>{j.stopPropagation(),window.confirm(`Delete "${a.name}"?`)&&c(a.id)},children:e.jsx(As,{className:"w-4 h-4"})}),!C&&h&&v&&e.jsx(f,{variant:"ghost",size:"sm",className:"absolute top-2 left-2 h-8 w-8 p-0 z-10 bg-white/90 hover:bg-white shadow-sm",onClick:j=>{j.stopPropagation(),x()},children:e.jsx(Ss,{className:`w-4 h-4 ${p?"fill-red-500 text-red-500":"text-gray-600 hover:text-red-500"}`})})]}),e.jsx("h3",{className:"font-medium mb-1 text-sm line-clamp-2",children:a.name}),e.jsx("div",{className:"flex items-center gap-2 mb-1",children:a.price&&a.price>0?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-lg font-semibold",children:[a.price.toLocaleString()," MMK"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["per ",a.unit]})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-lg font-semibold",children:"Contact"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"for price"})]})}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground mb-1",children:[e.jsx(pe,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:y})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(Xe,{className:"w-3 h-3"}),e.jsx("button",{className:"text-primary hover:underline",onClick:()=>l(a.sellerId),children:u}),e.jsx(lr,{verificationLevel:a.sellerVerificationStatus?.trustLevel||"unverified",size:"xs"})]}),e.jsxs("p",{className:"truncate",children:["Updated: ",m]}),a.availableQuantity&&e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-primary",children:[e.jsx(he,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs font-medium",children:a.availableQuantity})]})]})]}),e.jsxs(Ba,{className:"p-3 pt-0 flex gap-2",children:[e.jsx(f,{size:"sm",className:`h-8 text-xs ${C?"w-full":"flex-1"}`,onClick:()=>r(a.id),children:"View Details"}),!C&&e.jsxs(f,{variant:"outline",size:"sm",className:"flex-1 h-8 text-xs",onClick:()=>t(a.id),children:[e.jsx(Qs,{className:"w-3 h-3 mr-1"}),v?"Chat":"Sign in to chat"]})]})]})});function W({className:s,type:a,...t}){return e.jsx("input",{type:a,"data-slot":"input",className:Q("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",s),...t})}function ce({...s}){return e.jsx(et,{"data-slot":"select",...s})}function de({...s}){return e.jsx(tt,{"data-slot":"select-value",...s})}function me({className:s,size:a="default",children:t,...r}){return e.jsxs(st,{"data-slot":"select-trigger","data-size":a,className:Q("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-full items-center justify-between gap-2 rounded-md border bg-input-background px-3 py-2 text-sm whitespace-nowrap transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...r,children:[t,e.jsx(at,{asChild:!0,children:e.jsx(Zs,{className:"size-4 opacity-50"})})]})}function ue({className:s,children:a,position:t="popper",...r}){return e.jsx(rt,{children:e.jsxs(it,{"data-slot":"select-content",className:Q("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:t,...r,children:[e.jsx(gr,{}),e.jsx(nt,{className:Q("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:a}),e.jsx(vr,{})]})})}function B({className:s,children:a,...t}){return e.jsxs(lt,{"data-slot":"select-item",className:Q("hover:bg-[rgba(164,131,91,0.15)] hover:text-foreground focus:bg-[rgba(164,131,91,0.2)] focus:text-foreground data-[highlighted]:bg-[rgba(164,131,91,0.2)] data-[highlighted]:text-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2 transition-colors duration-150",s),...t,children:[e.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:e.jsx(ot,{children:e.jsx(Aa,{className:"size-4"})})}),e.jsx(ct,{children:a})]})}function gr({className:s,...a}){return e.jsx(dt,{"data-slot":"select-scroll-up-button",className:Q("flex cursor-default items-center justify-center py-1",s),...a,children:e.jsx(Ra,{className:"size-4"})})}function vr({className:s,...a}){return e.jsx(mt,{"data-slot":"select-scroll-down-button",className:Q("flex cursor-default items-center justify-center py-1",s),...a,children:e.jsx(Zs,{className:"size-4"})})}const Ie={yangon:{name:"Yangon Region",cities:["Yangon","Thanlyin","Mingalardon","Insein","Hmawbi","Hlegu","Taikkyi"]},mandalay:{name:"Mandalay Region",cities:["Mandalay","Meiktila","Pyinoolwin","Kyaukse","Nyaung-U","Myingyan","Yamethin"]},naypyidaw:{name:"Naypyidaw Union Territory",cities:["Naypyidaw","Pyinmana","Lewe","Tatkon"]},ayeyarwady:{name:"Ayeyarwady Region",cities:["Pathein","Myaungmya","Bogalay","Pyapon","Labutta","Hinthada","Maubin"]},bago:{name:"Bago Region",cities:["Bago","Pyay","Taungoo","Thegon","Nyaunglebin","Kawa","Waw"]},magway:{name:"Magway Region",cities:["Magway","Pakokku","Minbu","Chauk","Yenangyaung","Thayet","Aunglan"]},sagaing:{name:"Sagaing Region",cities:["Sagaing","Monywa","Shwebo","Kale","Katha","Mawlaik","Ye-U"]},tanintharyi:{name:"Tanintharyi Region",cities:["Dawei","Myeik","Kawthaung","Bokpyin","Thayetchaung"]},mon:{name:"Mon State",cities:["Mawlamyine","Thaton","Mudon","Ye","Kyaikto","Paung","Chaungzon"]},kayin:{name:"Kayin State",cities:["Hpa-an","Kawkareik","Myawaddy","Kyainseikgyi","Thandaunggyi"]},kayah:{name:"Kayah State",cities:["Loikaw","Demoso","Hpruso","Bawlakhe"]},shan:{name:"Shan State",cities:["Taunggyi","Lashio","Kengtung","Hsipaw","Nyaungshwe","Kalaw","Pinlaung","Muse"]},chin:{name:"Chin State",cities:["Hakha","Falam","Tedim","Tonzang","Mindat"]},rakhine:{name:"Rakhine State",cities:["Sittwe","Kyaukpyu","Mrauk-U","Thandwe","Maungdaw","Buthidaung"]},kachin:{name:"Kachin State",cities:["Myitkyina","Bhamo","Putao","Mohnyin","Injangyang"]}};function jr(s){for(const[a,t]of Object.entries(Ie))if(t.cities.includes(s))return a;return null}function yr({filters:s,onFiltersChange:a,activeFiltersCount:t}){const[r,l]=n.useState(!1),c=(i,d)=>{a(i==="region"?{...s,[i]:d,city:""}:{...s,[i]:d})},h=()=>{a({search:"",category:"",location:"",region:"",city:"",sellerType:"",verifiedStatus:"",priceRange:"",sortBy:"newest"})},v=()=>!s.region||s.region==="all"?[]:Ie[s.region]?.cities||[];return e.jsx("div",{className:"bg-primary/5 border border-primary/10 rounded-xl p-4 mb-6 shadow-sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ea,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(W,{placeholder:"Search products, categories, or locations...",value:s.search,onChange:i=>c("search",i.target.value),className:"pl-10 h-11 bg-background border-primary/20"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsxs(ce,{value:s.category||"all",onValueChange:i=>c("category",i==="all"?"":i),children:[e.jsx(me,{className:"h-11 bg-background border-primary/20",children:e.jsx(de,{placeholder:"All Categories"})}),e.jsxs(ue,{position:"popper",side:"bottom",align:"start",sideOffset:4,children:[e.jsx(B,{value:"all",children:"All Categories"}),e.jsx(B,{value:"rice",children:"Rice & Grains"}),e.jsx(B,{value:"pulses",children:"Pulses & Beans"}),e.jsx(B,{value:"oilseeds",children:"Oilseeds"}),e.jsx(B,{value:"vegetables",children:"Vegetables"}),e.jsx(B,{value:"fruits",children:"Fruits"}),e.jsx(B,{value:"spices",children:"Spices & Herbs"}),e.jsx(B,{value:"traditional",children:"Traditional Crops"})]})]}),e.jsxs(ce,{value:s.region||"all",onValueChange:i=>c("region",i==="all"?"":i),children:[e.jsx(me,{className:"h-11 bg-background border-primary/20",children:e.jsx(de,{placeholder:"All Regions"})}),e.jsxs(ue,{className:"max-h-64 overflow-y-auto",position:"popper",side:"bottom",align:"start",sideOffset:4,children:[e.jsx(B,{value:"all",children:"All Regions"}),Object.entries(Ie).map(([i,d])=>e.jsx(B,{value:i,children:d.name},i))]})]}),e.jsxs(ce,{value:s.city||"all",onValueChange:i=>c("city",i==="all"?"":i),disabled:!s.region||s.region==="all",children:[e.jsx(me,{className:"h-11 bg-background border-primary/20",children:e.jsx(de,{placeholder:s.region?"All Cities":"Select Region First"})}),e.jsxs(ue,{className:"max-h-64 overflow-y-auto",position:"popper",side:"bottom",align:"start",sideOffset:4,children:[e.jsx(B,{value:"all",children:"All Cities"}),v().map(i=>e.jsx(B,{value:i,children:i},i))]})]}),e.jsxs(ce,{value:s.sortBy,onValueChange:i=>c("sortBy",i),children:[e.jsx(me,{className:"h-11 bg-background border-primary/20",children:e.jsx(de,{placeholder:"Sort By"})}),e.jsxs(ue,{position:"popper",side:"bottom",align:"start",sideOffset:4,children:[e.jsx(B,{value:"newest",children:"Newest First"}),e.jsx(B,{value:"price-low",children:"Price: Low to High"}),e.jsx(B,{value:"price-high",children:"Price: High to Low"}),e.jsx(B,{value:"location",children:"By Location"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(f,{variant:"ghost",size:"sm",onClick:()=>l(!r),className:"text-muted-foreground hover:text-foreground",children:[e.jsx(Bs,{className:"w-4 h-4 mr-2"}),"Advanced Filters",r?e.jsx(Ra,{className:"w-4 h-4 ml-2"}):e.jsx(Zs,{className:"w-4 h-4 ml-2"})]}),t>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(U,{variant:"secondary",className:"text-xs",children:[t," filter",t!==1?"s":""," active"]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:h,className:"h-8 px-3",children:[e.jsx(Le,{className:"w-3 h-3 mr-1"}),"Clear"]})]})]}),r&&e.jsx("div",{className:"space-y-3 pt-3 border-t border-border/50",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[e.jsxs(ce,{value:s.sellerType||"all",onValueChange:i=>c("sellerType",i==="all"?"":i),children:[e.jsx(me,{className:"h-10 bg-background border-primary/20",children:e.jsx(de,{placeholder:"All Sellers"})}),e.jsxs(ue,{position:"popper",side:"bottom",align:"start",sideOffset:4,children:[e.jsx(B,{value:"all",children:"All Sellers"}),e.jsx(B,{value:"farmer",children:"Farmers"}),e.jsx(B,{value:"trader",children:"Traders"})]})]}),e.jsxs(ce,{value:s.verifiedStatus||"all",onValueChange:i=>c("verifiedStatus",i==="all"?"":i),children:[e.jsx(me,{className:"h-10 bg-background border-primary/20",children:e.jsx(de,{placeholder:"Any Verification"})}),e.jsxs(ue,{position:"popper",side:"bottom",align:"start",sideOffset:4,children:[e.jsx(B,{value:"all",children:"Any Verification"}),e.jsx(B,{value:"verified",children:"Verified Sellers"}),e.jsx(B,{value:"business-verified",children:"Business Verified"}),e.jsx(B,{value:"unverified",children:"Unverified"})]})]}),e.jsxs(ce,{value:s.priceRange||"all",onValueChange:i=>c("priceRange",i==="all"?"":i),children:[e.jsx(me,{className:"h-10 bg-background border-primary/20",children:e.jsx(de,{placeholder:"Any Price Range"})}),e.jsxs(ue,{position:"popper",side:"bottom",align:"start",sideOffset:4,children:[e.jsx(B,{value:"all",children:"Any Price Range"}),e.jsx(B,{value:"0-50000",children:"Under 50,000 MMK"}),e.jsx(B,{value:"50000-100000",children:"50K - 100K MMK"}),e.jsx(B,{value:"100000-200000",children:"100K - 200K MMK"}),e.jsx(B,{value:"200000+",children:"200K+ MMK"})]})]})]})})]})})}function br({productName:s,priceData:a,unit:t,onBack:r,isOwnProduct:l}){const[c,h]=n.useState("all"),[v,i]=n.useState("all"),d=Array.from(new Set(a.map(o=>o.location))).sort(),k=[...a.filter(o=>{const C=c==="all"||o.location===c,p=v==="all"||o.sellerType===v;return C&&p})].sort((o,C)=>o.price-C.price);return e.jsxs("div",{className:"space-y-6",children:[r&&e.jsx(Oe,{className:"w-5 h-5 cursor-pointer text-muted-foreground hover:text-foreground transition-colors",onClick:r}),e.jsx("div",{className:"bg-gradient-to-r from-primary/5 to-primary/10 rounded-lg p-6 border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-primary mb-2",children:l?"Market Price Analysis":"Price Comparison"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-xl font-semibold",children:s}),e.jsxs(U,{variant:"secondary",className:"text-sm",children:["Per ",t]})]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:l?`See how your pricing compares to ${a.length} other sellers`:`Compare prices from ${a.length} sellers across Myanmar`})]}),k.length>0&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Price range"}),e.jsxs("p",{className:"text-lg font-semibold",children:[k[0]?.price?.toLocaleString()," - ",k[k.length-1]?.price?.toLocaleString()," MMK"]})]})]})}),e.jsxs(R,{children:[e.jsxs(Y,{children:[e.jsxs(K,{className:"flex items-center justify-between",children:[e.jsx("span",{children:l?"Market Competitors":"Available Sellers"}),e.jsxs(U,{variant:"outline",children:[k.length," of ",a.length," listings"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Bs,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Filter by:"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(ce,{value:c,onValueChange:h,children:[e.jsx(me,{className:"w-full sm:w-48",children:e.jsx(de,{placeholder:"All regions"})}),e.jsxs(ue,{children:[e.jsx(B,{value:"all",children:"All Regions"}),d.map(o=>e.jsx(B,{value:o,children:o},o))]})]}),e.jsxs(ce,{value:v,onValueChange:i,children:[e.jsx(me,{className:"w-full sm:w-40",children:e.jsx(de,{placeholder:"All types"})}),e.jsxs(ue,{children:[e.jsx(B,{value:"all",children:"All Types"}),e.jsx(B,{value:"farmer",children:"Farmers"}),e.jsx(B,{value:"trader",children:"Traders"})]})]})]})]})]}),e.jsxs(E,{children:[e.jsx("div",{className:"space-y-3",children:k.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Bs,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No sellers found matching your filters."}),e.jsx("p",{className:"text-sm mt-1",children:"Try adjusting your selection above."})]}):k.map((o,C)=>e.jsxs("div",{className:`p-4 rounded-lg border transition-colors hover:bg-muted/30 ${C===0?"bg-green-50 border-green-200":"bg-card"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(U,{variant:o.sellerType==="farmer"?"default":"secondary",className:"capitalize",children:o.sellerType}),e.jsx("h3",{className:"font-medium",children:o.sellerName}),C===0&&e.jsx(U,{variant:"outline",className:"text-green-600 bg-green-50 border-green-200",children:"Lowest Price"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-semibold text-primary",children:[o.price.toLocaleString()," MMK"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["per ",t]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{children:o.location})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(U,{variant:"outline",className:"text-xs",children:o.quantity})}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Ce,{className:"w-4 h-4"}),e.jsxs("span",{children:["Updated ",us(o.lastUpdated)]})]})]})]},o.id))}),k.length>0&&e.jsxs("div",{className:"mt-6 p-4 bg-muted/30 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:l?"Understanding Market Pricing":"How to Compare"}),e.jsx("div",{className:"text-sm text-muted-foreground space-y-1",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Market Position:"})," See where your prices stand against competitors"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Pricing Strategy:"})," Consider adjusting based on quality and service"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Location Advantage:"})," Your local market may support different pricing"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Value Proposition:"})," Highlight your unique selling points"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Farmers:"})," Usually offer lower prices, direct from source"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Traders:"})," May have higher prices but offer bulk quantities"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Location:"})," Consider transport costs and delivery options"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Quantity:"})," Check if available amount meets your needs"]})]})})]})]})]})]})}const Oa=n.forwardRef(({className:s,children:a,...t},r)=>e.jsxs(Ca,{ref:r,"data-slot":"scroll-area",className:Q("relative",s),...t,children:[e.jsx(ut,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:a}),e.jsx(Nr,{}),e.jsx(ht,{})]}));Oa.displayName=Ca.displayName;function Nr({className:s,orientation:a="vertical",...t}){return e.jsx(xt,{"data-slot":"scroll-area-scrollbar",orientation:a,className:Q("flex touch-none p-px transition-colors select-none",a==="vertical"&&"h-full w-2.5 border-l border-l-transparent",a==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent",s),...t,children:e.jsx(ft,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}function $a({delayDuration:s=0,...a}){return e.jsx(pt,{"data-slot":"tooltip-provider",delayDuration:s,...a})}function wr({...s}){return e.jsx($a,{children:e.jsx(gt,{"data-slot":"tooltip",...s})})}function kr({...s}){return e.jsx(vt,{"data-slot":"tooltip-trigger",...s})}function Cr({className:s,sideOffset:a=0,children:t,arrowClassName:r,...l}){const c=h=>h?h.includes("bg-green-700")?"bg-green-700 fill-green-700":h.includes("bg-amber-700")?"bg-amber-700 fill-amber-700":h.includes("bg-yellow-700")?"bg-yellow-700 fill-yellow-700":"bg-primary fill-primary":"bg-primary fill-primary";return e.jsx(jt,{children:e.jsxs(yt,{"data-slot":"tooltip-content",sideOffset:a,className:Q("bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",s),...l,children:[t,e.jsx(bt,{className:Q("z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]",r||c(s))})]})})}const sa=()=>{const[s,a]=n.useState([]),[t,r]=n.useState({}),[l,c]=n.useState(!1),[h,v]=n.useState(null),[i,d]=n.useState(new Map),b=n.useCallback(async p=>{if(!Ne.isSupabaseConfigured()){console.log("❌ Supabase not configured for chat"),a([]),c(!1);return}try{c(!0),v(null);const{supabase:w}=await Se(async()=>{const{supabase:j}=await Promise.resolve().then(()=>fs);return{supabase:j}},void 0),{data:{session:x},error:g}=await w.auth.getSession();if(g||!x?.access_token){console.log("❌ No valid session - authentication required for chat"),a([]),c(!1);return}const{data:u,error:y}=await w.from("conversations").select(`
          *,
          buyer:users!conversations_buyer_id_fkey(id, name, user_type, location),
          seller:users!conversations_seller_id_fkey(id, name, user_type, location),
          product:products!conversations_product_id_fkey(id, name, image)
        `).or(`buyer_id.eq.${p},seller_id.eq.${p}`).order("updated_at",{ascending:!1});if(y)throw y;const m=u?.map(j=>({id:j.id,buyerId:j.buyer_id,sellerId:j.seller_id,productId:j.product_id,productName:j.product?.name||"Unknown Product",productImage:j.product?.image||"https://images.unsplash.com/photo-1546470427-227c013b2b5f?w=400&h=300&fit=crop",buyerName:j.buyer?.name||"Unknown Buyer",buyerType:j.buyer?.user_type||"buyer",buyerLocation:j.buyer?.location||"Unknown Location",sellerName:j.seller?.name||"Unknown Seller",sellerType:j.seller?.user_type||"farmer",sellerLocation:j.seller?.location||"Unknown Location",lastMessage:j.last_message,lastMessageTime:j.last_message_time,unreadCount:j.unread_count||0,createdAt:j.created_at}))||[];a(m),console.log("✅ Conversations loaded from Supabase:",m.length)}catch(w){console.error("❌ Failed to load conversations:",w),v("Failed to load conversations"),a([])}finally{c(!1)}},[]),k=n.useCallback(async p=>{if(!Ne.isSupabaseConfigured()){r(w=>({...w,[p]:[]}));return}try{const{supabase:w}=await Se(async()=>{const{supabase:m}=await Promise.resolve().then(()=>fs);return{supabase:m}},void 0),{data:{session:x}}=await w.auth.getSession();if(!x?.access_token){console.log("❌ No valid session - authentication required for chat"),r(m=>({...m,[p]:[]}));return}const{data:g,error:u}=await w.from("messages").select("*").eq("conversation_id",p).order("created_at",{ascending:!0});if(u)throw u;const y=g?.map(m=>({id:m.id,conversationId:m.conversation_id,senderId:m.sender_id,content:m.content,timestamp:new Date(m.created_at).toISOString(),type:m.type||"text",isRead:m.is_read||!1,offerDetails:m.offer_details?JSON.parse(m.offer_details):void 0}))||[];if(r(m=>({...m,[p]:y})),!i.has(p)){const m=w.channel(`messages-${p}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`conversation_id=eq.${p}`},j=>{console.log("🔄 New message received via real-time:",j.new),console.log("🔄 Current messages before update:",t[p]?.length||0);const N={id:j.new.id,conversationId:j.new.conversation_id,senderId:j.new.sender_id,content:j.new.content,timestamp:new Date(j.new.created_at).toISOString(),type:j.new.type||"text",isRead:!1,offerDetails:j.new.offer_details?JSON.parse(j.new.offer_details):void 0};r(M=>{const _={...M,[p]:[...M[p]||[],N]};return console.log("🔄 Messages after update:",_[p]?.length||0),_})}).subscribe();d(j=>new Map([...j,[p,m]])),console.log("✅ Real-time subscription set up for conversation:",p)}console.log("✅ Messages loaded from Supabase:",y.length)}catch(w){console.error("❌ Failed to load messages:",w),r(x=>({...x,[p]:[]}))}},[i]),o=n.useCallback(async(p,w,x,g="text",u)=>{if(Ne.isSupabaseConfigured())try{const{supabase:y}=await Se(async()=>{const{supabase:_}=await Promise.resolve().then(()=>fs);return{supabase:_}},void 0),{data:{session:m}}=await y.auth.getSession();if(!m?.access_token){console.log("❌ No valid session - authentication required for chat");return}const{data:j,error:N}=await y.from("messages").insert({conversation_id:p,sender_id:x,content:w,type:g,offer_details:u?JSON.stringify(u):null}).select().single();if(N)throw N;const M={id:j.id,conversationId:j.conversation_id,senderId:j.sender_id,content:j.content,timestamp:new Date(j.created_at).toISOString(),type:j.type||"text",isRead:!1,offerDetails:j.offer_details?JSON.parse(j.offer_details):void 0};return r(_=>({..._,[p]:[..._[p]||[],M]})),await y.from("conversations").update({last_message:w,last_message_time:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",p),console.log("✅ Message sent to Supabase"),M}catch(y){throw console.error("❌ Failed to send message:",y),y}},[]),C=n.useCallback(async(p,w,x)=>{if(!Ne.isSupabaseConfigured())return null;try{const{supabase:g}=await Se(async()=>{const{supabase:F}=await Promise.resolve().then(()=>fs);return{supabase:F}},void 0),{data:{session:u}}=await g.auth.getSession();if(!u?.access_token)return console.log("❌ No valid session - authentication required for chat"),null;const{data:y}=await g.from("conversations").select("*").eq("buyer_id",p).eq("seller_id",w).eq("product_id",x).single();if(y)return console.log("✅ Existing conversation found:",y.id),{id:y.id,buyerId:y.buyer_id,sellerId:y.seller_id,productId:y.product_id,productName:y.product_name||"Unknown Product",buyerName:y.buyer_name||"Unknown Buyer",sellerName:y.seller_name||"Unknown Seller",lastMessage:y.last_message,lastMessageTime:y.last_message_time,unreadCount:y.unread_count||0,createdAt:y.created_at};const{data:m}=await g.from("products").select("name").eq("id",x).single(),{data:j}=await g.from("users").select("name").eq("id",p).single(),{data:N}=await g.from("users").select("name").eq("id",w).single(),{data:M,error:_}=await g.from("conversations").insert({buyer_id:p,seller_id:w,product_id:x,product_name:m?.name||"Unknown Product",buyer_name:j?.name||"Unknown Buyer",seller_name:N?.name||"Unknown Seller",last_message:"Conversation started",last_message_time:new Date().toISOString()}).select().single();if(_)throw _;const P={id:M.id,buyerId:M.buyer_id,sellerId:M.seller_id,productId:M.product_id,productName:M.product_name,buyerName:M.buyer_name,sellerName:M.seller_name,lastMessage:M.last_message,lastMessageTime:M.last_message_time,unreadCount:0,createdAt:M.created_at};return a(F=>[P,...F]),console.log("✅ New conversation created:",P.id),P}catch(g){return console.error("❌ Failed to start conversation:",g),null}},[]);return n.useEffect(()=>()=>{Ne.isSupabaseConfigured()&&Se(async()=>{const{supabase:p}=await Promise.resolve().then(()=>fs);return{supabase:p}},void 0).then(({supabase:p})=>{i.forEach((w,x)=>{console.log("🧹 Cleaning up subscription for conversation:",x),w&&typeof w.unsubscribe=="function"?w.unsubscribe():p.removeChannel(`messages-${x}`)})})},[i]),{conversations:s,messages:t,loading:l,error:h,loadConversations:b,loadMessages:k,sendMessage:o,startConversation:C}};function aa({...s}){return e.jsx(wt,{"data-slot":"dialog",...s})}const Ua=n.forwardRef(({...s},a)=>e.jsx(Sa,{ref:a,"data-slot":"dialog-trigger",...s}));Ua.displayName=Sa.displayName;function Sr({...s}){return e.jsx(Nt,{"data-slot":"dialog-portal",...s})}const _r=n.forwardRef(({...s},a)=>e.jsx(Js,{ref:a,"data-slot":"dialog-close",...s}));_r.displayName=Js.displayName;const Ha=n.forwardRef(({className:s,...a},t)=>e.jsx(_a,{ref:t,"data-slot":"dialog-overlay",className:Q("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",s),...a}));Ha.displayName=_a.displayName;const Ms=n.forwardRef(({className:s,children:a,...t},r)=>e.jsxs(Sr,{"data-slot":"dialog-portal",children:[e.jsx(Ha,{}),e.jsxs(Ta,{ref:r,"data-slot":"dialog-content",className:Q("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",s),...t,children:[a,e.jsxs(Js,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(Le,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Ms.displayName=Ta.displayName;function ta({className:s,...a}){return e.jsx("div",{"data-slot":"dialog-header",className:Q("flex flex-col gap-2 text-center sm:text-left",s),...a})}const Vs=n.forwardRef(({className:s,...a},t)=>e.jsx(Pa,{ref:t,"data-slot":"dialog-title",className:Q("text-lg leading-none font-semibold",s),...a}));Vs.displayName=Pa.displayName;const zs=n.forwardRef(({className:s,...a},t)=>e.jsx(Da,{ref:t,"data-slot":"dialog-description",className:Q("text-muted-foreground text-sm",s),...a}));zs.displayName=Da.displayName;function O({className:s,...a}){return e.jsx(kt,{"data-slot":"label",className:Q("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",s),...a})}function ze({className:s,...a}){return e.jsx("textarea",{"data-slot":"textarea",className:Q("resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),...a})}function Tr({isOpen:s,onClose:a,product:t,buyerId:r,buyerName:l,sellerId:c,sellerName:h,onCreateOffer:v}){console.log("🔍 CreateOfferModal product data:",{name:t.name,price:t.price,priceType:typeof t.price,quantity:t.quantity,unit:t.unit,category:t.category,hasPrice:"price"in t,priceIsNumber:typeof t.price=="number",priceIsValid:!isNaN(t.price)&&t.price>0,fullProduct:t});const[i,d]=n.useState(t.price||0),[b,k]=n.useState(1),[o,C]=n.useState(""),[p,w]=n.useState(""),[x,g]=n.useState("3"),[u,y]=n.useState(""),[m,j]=n.useState({}),N=D=>!D||isNaN(D)?"0 MMK":new Intl.NumberFormat("en-US").format(D)+" MMK",M=()=>{const D={};return i<=0&&(D.price="Price must be greater than 0"),b<=0&&(D.quantity="Quantity must be greater than 0"),o.trim()||(D.deliveryLocation="Delivery location is required"),p.trim()||(D.deliveryTerms="Delivery terms are required"),j(D),Object.keys(D).length===0},_=()=>{if(!M()){H.error("Please fix the errors in the form");return}console.log("🎯 CreateOfferModal - Creating offer with user details:",{buyerId:r,buyerName:l,sellerId:c,sellerName:h,productId:t.id,productName:t.name});const D=new Date;D.setDate(D.getDate()+parseInt(x));const S={conversationId:"",productId:t.id,productName:t.name,sellerId:c,sellerName:h,buyerId:r,buyerName:l,price:i,quantity:b,unit:t.unit||"units",description:t.description||"",deliveryTerms:`${p}${o?` | Location: ${o}`:""}`,deliveryLocation:o||"",validUntil:D.toISOString(),status:"pending",notes:u.trim()||""};console.log("✅ CreateOfferModal - Final offer object:",S),v(S),H.success("Formal offer sent successfully!"),a()},P=()=>{d(t.price||0),k(1),C(""),w(""),g("3"),y(""),j({}),a()},F=i*b;return e.jsx(aa,{open:s,onOpenChange:P,children:e.jsxs(Ms,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ta,{children:[e.jsxs(Vs,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5 text-primary"}),"Create Formal Offer"]}),e.jsx(zs,{children:"Create a formal offer for this product. Once submitted, the seller can accept, decline, or make a counter-offer."})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(R,{className:"bg-primary/5 border-primary/20",children:e.jsxs(E,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-medium",children:t.name}),e.jsx(U,{variant:"outline",children:t.category})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Listed Price"}),e.jsxs("p",{className:"font-medium",children:[N(t.price||0)," per ",t.unit||"unit"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Available"}),e.jsx("p",{className:"font-medium",children:t.quantity||"0 units"})]})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:"Seller"}),e.jsx("p",{className:"font-medium",children:h})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:"Buyer"}),e.jsx("p",{className:"font-medium",children:l})]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"flex items-center gap-2 font-medium",children:[e.jsx(os,{className:"w-4 h-4"}),"Offer Details"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(O,{htmlFor:"price",children:["Price per ",t.unit]}),e.jsx(W,{id:"price",type:"number",value:i,onChange:D=>d(Number(D.target.value)),className:m.price?"border-red-500":""}),m.price&&e.jsxs("p",{className:"text-red-500 text-sm flex items-center gap-1",children:[e.jsx(Ae,{className:"w-3 h-3"}),m.price]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(O,{htmlFor:"quantity",children:["Quantity (",t.unit||"units",")"]}),e.jsx(W,{id:"quantity",type:"number",value:b,onChange:D=>k(Number(D.target.value)),placeholder:"Enter quantity",className:m.quantity?"border-red-500":""}),m.quantity&&e.jsxs("p",{className:"text-red-500 text-sm flex items-center gap-1",children:[e.jsx(Ae,{className:"w-3 h-3"}),m.quantity]})]})]}),e.jsx("div",{className:"bg-muted/50 p-3 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Offer Value:"}),e.jsx("span",{className:"text-xl font-semibold text-primary",children:N(F)})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"flex items-center gap-2 font-medium",children:[e.jsx(We,{className:"w-4 h-4"}),"Delivery & Terms"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"deliveryLocation",children:"Delivery Location"}),e.jsx(W,{id:"deliveryLocation",value:o,onChange:D=>C(D.target.value),placeholder:"Where should the product be delivered?",className:m.deliveryLocation?"border-red-500":""}),m.deliveryLocation&&e.jsxs("p",{className:"text-red-500 text-sm flex items-center gap-1",children:[e.jsx(Ae,{className:"w-3 h-3"}),m.deliveryLocation]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"deliveryTerms",children:"Delivery Terms & Conditions"}),e.jsx(ze,{id:"deliveryTerms",value:p,onChange:D=>w(D.target.value),placeholder:"Delivery method, timing, payment terms, quality requirements, etc.",className:`min-h-[100px] ${m.deliveryTerms?"border-red-500":""}`}),m.deliveryTerms&&e.jsxs("p",{className:"text-red-500 text-sm flex items-center gap-1",children:[e.jsx(Ae,{className:"w-3 h-3"}),m.deliveryTerms]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"flex items-center gap-2 font-medium",children:[e.jsx(Rs,{className:"w-4 h-4"}),"Offer Validity"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"validity",children:"Valid for"}),e.jsxs(ce,{value:x,onValueChange:g,children:[e.jsx(me,{children:e.jsx(de,{})}),e.jsxs(ue,{children:[e.jsx(B,{value:"1",children:"1 day"}),e.jsx(B,{value:"3",children:"3 days"}),e.jsx(B,{value:"7",children:"1 week"}),e.jsx(B,{value:"14",children:"2 weeks"}),e.jsx(B,{value:"30",children:"1 month"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"notes",children:"Additional Notes (Optional)"}),e.jsx(ze,{id:"notes",value:u,onChange:D=>y(D.target.value),placeholder:"Any additional terms, requirements, or information...",className:"min-h-[80px]"})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[e.jsx(f,{variant:"outline",onClick:P,className:"flex-1",children:"Cancel"}),e.jsx(f,{onClick:_,className:"flex-1",children:"Send Formal Offer"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:["💡 ",e.jsx("strong",{children:"Tip:"})," A formal offer creates a structured deal with clear terms. Once accepted, both parties can track the deal progress and leave reviews upon completion."]})})]})]})})}function Pr({offer:s,currentUserId:a,onViewDetails:t,onQuickAction:r}){a&&s.sellerId&&s.sellerId,a&&s.buyerId&&s.buyerId;const l=s.validUntil?new Date(s.validUntil)<new Date:!1,c=b=>new Intl.NumberFormat("en-US").format(b)+" MMK",h=b=>{switch(b){case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"accepted":return"bg-green-100 text-green-800 border-green-200";case"in_progress":return"bg-blue-100 text-blue-800 border-blue-200";case"shipped":return"bg-purple-100 text-purple-800 border-purple-200";case"delivered":return"bg-indigo-100 text-indigo-800 border-indigo-200";case"completed":return"bg-emerald-100 text-emerald-800 border-emerald-200";case"cancelled":return"bg-red-100 text-red-800 border-red-200";case"disputed":return"bg-orange-100 text-orange-800 border-orange-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},v=b=>{switch(b){case"pending":return e.jsx(Ce,{className:"w-3 h-3"});case"accepted":return e.jsx(ee,{className:"w-3 h-3"});case"in_progress":return e.jsx(he,{className:"w-3 h-3"});case"shipped":return e.jsx(We,{className:"w-3 h-3"});case"delivered":return e.jsx(ee,{className:"w-3 h-3"});case"completed":return e.jsx(_s,{className:"w-3 h-3"});case"cancelled":return e.jsx($e,{className:"w-3 h-3"});case"disputed":return e.jsx($e,{className:"w-3 h-3"});default:return e.jsx(Ce,{className:"w-3 h-3"})}},i=b=>{switch(b){case"accepted":return 20;case"in_progress":return 40;case"shipped":return 70;case"delivered":return 90;case"completed":return 100;default:return 0}},d=()=>e.jsxs(f,{size:"sm",variant:"outline",className:"h-7 px-3 text-xs",onClick:b=>{b.stopPropagation(),t(s)},children:[e.jsx(ge,{className:"w-3 h-3 mr-1"}),"View Details"]});return e.jsx(R,{className:"mb-2 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>t(s),children:e.jsx(E,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs(U,{className:`${h(s.status)} flex items-center gap-1 text-xs`,children:[v(s.status),s.status.charAt(0).toUpperCase()+s.status.slice(1)]}),l&&s.status==="pending"&&e.jsx(U,{variant:"outline",className:"text-xs text-red-600",children:"Expired"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(os,{className:"w-3 h-3"}),e.jsx("span",{className:"font-medium",children:c(s.price)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(he,{className:"w-3 h-3"}),e.jsxs("span",{children:[s.quantity," ",s.unit]})]}),s.deliveryLocation&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate max-w-20",children:s.deliveryLocation})]})]}),["accepted","in_progress","shipped","delivered","completed"].includes(s.status)&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mb-1",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[i(s.status),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-green-500 h-1.5 rounded-full transition-all duration-300",style:{width:`${i(s.status)}%`}})})]})]}),e.jsx("div",{className:"flex items-center gap-2 ml-2",children:d()})]})})})}function Dr({offer:s,isOpen:a,onClose:t,currentUserId:r,onUpdateStatus:l}){const[c,h]=n.useState(!1),[v,i]=n.useState(s?.trackingNumber||""),[d,b]=n.useState(s?.deliveryAddress||""),[k,o]=n.useState(!1),[C,p]=n.useState(null);if(!s)return null;const w=r&&s.sellerId&&r===s.sellerId,x=r&&s.buyerId&&r===s.buyerId,g=s.validUntil?new Date(s.validUntil)<new Date:!1,u=P=>new Intl.NumberFormat("en-US").format(P)+" MMK",y=P=>new Date(P).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}),m=P=>{switch(P){case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"accepted":return"bg-green-100 text-green-800 border-green-200";case"in_progress":return"bg-blue-100 text-blue-800 border-blue-200";case"shipped":return"bg-purple-100 text-purple-800 border-purple-200";case"delivered":return"bg-indigo-100 text-indigo-800 border-indigo-200";case"completed":return"bg-emerald-100 text-emerald-800 border-emerald-200";case"cancelled":return"bg-red-100 text-red-800 border-red-200";case"disputed":return"bg-orange-100 text-orange-800 border-orange-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},j=P=>{switch(P){case"pending":return e.jsx(Ce,{className:"w-4 h-4"});case"accepted":return e.jsx(ee,{className:"w-4 h-4"});case"in_progress":return e.jsx(he,{className:"w-4 h-4"});case"shipped":return e.jsx(We,{className:"w-4 h-4"});case"delivered":return e.jsx(ee,{className:"w-4 h-4"});case"completed":return e.jsx(_s,{className:"w-4 h-4"});case"cancelled":return e.jsx($e,{className:"w-4 h-4"});case"disputed":return e.jsx($e,{className:"w-4 h-4"});default:return e.jsx(Ce,{className:"w-4 h-4"})}},N=async(P,F,D)=>{if(!l)return;const S=D||P.replace(/_/g," ");p(S),o(!0);try{await l(s.id,P,F),H.success(`✅ ${S} successful!`),setTimeout(()=>{t()},1e3)}catch{H.error(`❌ Failed to ${S.toLowerCase()}. Please try again.`)}finally{p(null),o(!1)}},M=()=>{v.trim()?(N("shipped",{trackingNumber:v.trim(),deliveryAddress:d.trim()||s.deliveryLocation}),h(!1)):H.error("Please enter a tracking number")},_=()=>{const P=[];if(w)switch(s.status){case"pending":g||P.push(e.jsxs(f,{onClick:()=>N("accepted",void 0,"Accept Offer"),className:"bg-green-600 hover:bg-green-700",disabled:k,children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),C==="Accept Offer"?"Accepting...":"Accept Offer"]},"accept"),e.jsxs(f,{variant:"outline",onClick:()=>N("cancelled",void 0,"Decline Offer"),disabled:k,children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),C==="Decline Offer"?"Declining...":"Decline Offer"]},"decline"));break;case"accepted":P.push(e.jsxs(f,{onClick:()=>N("in_progress",void 0,"Start Preparation"),disabled:k,children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),C==="Start Preparation"?"Starting...":"Start Preparation"]},"in_progress"));break;case"in_progress":P.push(e.jsxs(f,{onClick:()=>h(!0),disabled:k,children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Mark as Shipped"]},"shipped"));break;case"delivered":P.push(e.jsxs(f,{onClick:()=>N("completed",void 0,"Complete Transaction"),className:"bg-green-600 hover:bg-green-700",disabled:k,children:[e.jsx(_s,{className:"w-4 h-4 mr-2"}),C==="Complete Transaction"?"Completing...":"Complete Transaction"]},"completed"));break}if(x)switch(s.status){case"shipped":P.push(e.jsxs(f,{onClick:()=>N("delivered",void 0,"Confirm Delivery"),className:"bg-blue-600 hover:bg-blue-700",disabled:k,children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),C==="Confirm Delivery"?"Confirming...":"Confirm Delivery"]},"delivered"));break;case"delivered":P.push(e.jsxs(f,{onClick:()=>N("completed",void 0,"Complete Transaction"),className:"bg-green-600 hover:bg-green-700",disabled:k,children:[e.jsx(_s,{className:"w-4 h-4 mr-2"}),C==="Complete Transaction"?"Completing...":"Complete Transaction"]},"completed"));break}return["pending","accepted","in_progress"].includes(s.status)&&P.push(e.jsxs(f,{variant:"outline",onClick:()=>N("cancelled"),children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Cancel"]},"cancel")),P};return e.jsx(aa,{open:a,onOpenChange:t,children:e.jsxs(Ms,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ta,{children:[e.jsxs(Vs,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5"}),"Offer Details"]}),e.jsx(zs,{children:"View and manage offer details, track transaction status, and communicate with the other party."})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(R,{children:[e.jsx(Y,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(U,{className:`${m(s.status)} flex items-center gap-2`,children:[j(s.status),s.status.charAt(0).toUpperCase()+s.status.slice(1)]}),g&&s.status==="pending"&&e.jsxs(U,{variant:"outline",className:"text-red-600",children:[e.jsx(Ae,{className:"w-3 h-3 mr-1"}),"Expired"]})]})}),e.jsx(E,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(O,{className:"text-sm font-medium text-gray-500",children:"Product"}),e.jsx("p",{className:"text-lg font-semibold",children:s.productName||"Unknown Product"})]}),e.jsxs("div",{children:[e.jsx(O,{className:"text-sm font-medium text-gray-500",children:"Price"}),e.jsx("p",{className:"text-lg font-semibold text-green-600",children:u(s.price)})]}),e.jsxs("div",{children:[e.jsx(O,{className:"text-sm font-medium text-gray-500",children:"Quantity"}),e.jsxs("p",{className:"text-lg",children:[s.quantity," ",s.unit]})]}),e.jsxs("div",{children:[e.jsx(O,{className:"text-sm font-medium text-gray-500",children:"Valid Until"}),e.jsx("p",{className:"text-lg",children:y(s.validUntil)})]})]})})]}),e.jsxs(R,{children:[e.jsx(Y,{children:e.jsx(K,{className:"text-lg",children:"Parties"})}),e.jsx(E,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(O,{className:"text-sm font-medium text-gray-500",children:"Buyer"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Pe,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:s.buyerName||"Unknown Buyer"})]})]}),e.jsxs("div",{children:[e.jsx(O,{className:"text-sm font-medium text-gray-500",children:"Seller"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Pe,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:s.sellerName||"Unknown Seller"})]})]})]})})]}),e.jsxs(R,{children:[e.jsx(Y,{children:e.jsx(K,{className:"text-lg",children:"Delivery Details"})}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-3",children:[s.deliveryLocation&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(pe,{className:"w-4 h-4 text-gray-400 mt-1"}),e.jsxs("div",{children:[e.jsx(O,{className:"text-sm font-medium text-gray-500",children:"Location"}),e.jsx("p",{children:s.deliveryLocation})]})]}),s.deliveryTerms&&e.jsxs("div",{children:[e.jsx(O,{className:"text-sm font-medium text-gray-500",children:"Terms"}),e.jsx("p",{className:"mt-1",children:s.deliveryTerms})]}),s.trackingNumber&&e.jsxs("div",{children:[e.jsx(O,{className:"text-sm font-medium text-gray-500",children:"Tracking Number"}),e.jsx("p",{className:"mt-1 font-mono bg-gray-100 px-2 py-1 rounded",children:s.trackingNumber})]})]})})]}),s.notes&&e.jsxs(R,{children:[e.jsx(Y,{children:e.jsx(K,{className:"text-lg",children:"Notes"})}),e.jsx(E,{children:e.jsx("p",{className:"text-gray-700",children:s.notes})})]}),c&&e.jsxs(R,{className:"border-blue-200 bg-blue-50",children:[e.jsx(Y,{children:e.jsx(K,{className:"text-lg",children:"Add Tracking Information"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(O,{htmlFor:"tracking",children:"Tracking Number *"}),e.jsx(W,{id:"tracking",value:v,onChange:P=>i(P.target.value),placeholder:"Enter tracking number"})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"address",children:"Delivery Address"}),e.jsx(ze,{id:"address",value:d,onChange:P=>b(P.target.value),placeholder:"Enter delivery address",rows:2})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{onClick:M,children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Mark as Shipped"]}),e.jsx(f,{variant:"outline",onClick:()=>h(!1),children:"Cancel"})]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:_()})]})]})})}class Ts{static async createOffer(a){const{data:t,error:r}=await V.from("offers").insert({conversation_id:a.conversationId,product_id:a.productId,buyer_id:a.buyerId,seller_id:a.sellerId,price:a.price,quantity:a.quantity,unit:a.unit,description:a.description,delivery_terms:a.deliveryTerms,delivery_location:a.deliveryLocation,valid_until:a.validUntil,status:a.status,notes:a.notes}).select().single();if(r)throw console.error("❌ Failed to create offer:",r),r;return this.mapOfferFromDB(t)}static async getOffersForConversation(a){const{data:t,error:r}=await V.from("offers").select(`
        *,
        product:products!offers_product_id_fkey(id, name),
        buyer:users!offers_buyer_id_fkey(id, name),
        seller:users!offers_seller_id_fkey(id, name)
      `).eq("conversation_id",a).order("created_at",{ascending:!0});if(r)throw console.error("❌ Failed to fetch offers:",r),r;return t.map(l=>this.mapOfferFromDB(l))}static async getUserOffers(a){const{data:t,error:r}=await V.from("offers").select(`
        *,
        product:products!offers_product_id_fkey(id, name),
        buyer:users!offers_buyer_id_fkey(id, name),
        seller:users!offers_seller_id_fkey(id, name)
      `).or(`buyer_id.eq.${a},seller_id.eq.${a}`).order("created_at",{ascending:!1});if(r)throw console.error("❌ Failed to fetch user offers:",r),r;return t.map(l=>this.mapOfferFromDB(l))}static async deleteOffer(a){const{error:t}=await V.from("offers").delete().eq("id",a);if(t)throw console.error("❌ Failed to delete offer:",t),t}static async updateOfferStatus(a,t,r){const l={status:t,updated_at:new Date().toISOString()};switch(t){case"accepted":l.accepted_at=new Date().toISOString();break;case"shipped":l.shipped_at=new Date().toISOString();break;case"delivered":l.delivered_at=new Date().toISOString();break;case"completed":l.completed_at=new Date().toISOString();break}r&&(r.paymentStatus&&(l.payment_status=r.paymentStatus),r.shippingStatus&&(l.shipping_status=r.shippingStatus),r.trackingNumber&&(l.tracking_number=r.trackingNumber),r.deliveryAddress&&(l.delivery_address=r.deliveryAddress),r.paymentMethod&&(l.payment_method=r.paymentMethod));const{data:c,error:h}=await V.from("offers").update(l).eq("id",a).select().single();if(h)throw console.error("❌ Failed to update offer status:",h),h;return this.mapOfferFromDB(c)}static async getOffersByUser(a,t){let r=V.from("offers").select(`
        *,
        product:products(name),
        buyer:users!offers_buyer_id_fkey(id, name, email),
        seller:users!offers_seller_id_fkey(id, name, email)
      `).or(`buyer_id.eq.${a},seller_id.eq.${a}`).order("created_at",{ascending:!1});t?.status&&(r=r.eq("status",t.status)),t?.role&&(t.role==="buyer"?r=r.eq("buyer_id",a):r=r.eq("seller_id",a));const{data:l,error:c}=await r;if(c)throw console.error("❌ Failed to fetch user offers:",c),c;return l.map(h=>this.mapOfferFromDB(h))}static mapOfferFromDB(a){return console.log("🔍 Mapping offer from DB:",{id:a.id,product:a.product,buyer:a.buyer,seller:a.seller,price:a.price}),{id:a.id,conversationId:a.conversation_id,productId:a.product_id,productName:a.product?.name||"Unknown Product",buyerId:a.buyer_id,buyerName:a.buyer?.name||"Unknown Buyer",sellerId:a.seller_id,sellerName:a.seller?.name||"Unknown Seller",price:parseFloat(a.price),quantity:a.quantity,unit:a.unit,description:a.description,deliveryTerms:a.delivery_terms,deliveryLocation:a.delivery_location,validUntil:a.valid_until,status:a.status,notes:a.notes,paymentStatus:a.payment_status,shippingStatus:a.shipping_status,trackingNumber:a.tracking_number,deliveryAddress:a.delivery_address,paymentMethod:a.payment_method,acceptedAt:a.accepted_at,shippedAt:a.shipped_at,deliveredAt:a.delivered_at,completedAt:a.completed_at,createdAt:a.created_at,updatedAt:a.updated_at}}}const Lr=Object.freeze(Object.defineProperty({__proto__:null,OffersService:Ts},Symbol.toStringTag,{value:"Module"}));function Hs({sellerName:s,sellerType:a,sellerLocation:t,sellerRating:r,productName:l,productId:c,sellerId:h,conversationId:v,onClose:i,sellerVerified:d=!1,currentUserVerified:b=!1,currentUserType:k="buyer",sellerVerificationStatus:o,product:C,currentUser:p}){const w=n.useMemo(()=>p?.id?(console.log("✅ ChatInterface using passed user:",p.email||p.name),p):(console.log("❌ ChatInterface: No user passed from App.tsx"),null),[p?.id]);n.useEffect(()=>{},[p?.id,w?.id]);const{messages:x,sendMessage:g,startConversation:u,loadMessages:y}=sa(),[m,j]=n.useState(""),[N,M]=n.useState(v||null),[_,P]=n.useState(!1),F=n.useRef(null),[D,S]=n.useState(!1),[A,q]=n.useState([]),[re,ve]=n.useState(null),[je,T]=n.useState(!1),xe=n.useMemo(()=>N?x[N]||[]:[],[N,x[N||""]?.length]);n.useEffect(()=>{console.log("🔄 Conversation ID changed:",{conversationId:N,hasMessages:xe.length>0,timestamp:new Date().toISOString()})},[N,xe.length]);const L=n.useMemo(()=>!c||!h||!w?.id?null:`${c}-${h}-${w.id}`,[c,h,w?.id]);n.useEffect(()=>()=>{S(!1),P(!1)},[]),n.useEffect(()=>{if(_){const I=setTimeout(()=>{console.warn("Chat interface stuck in loading state, forcing recovery"),P(!1),H.warning("Chat recovered from loading state")},1e4);return()=>clearTimeout(I)}},[_]),n.useEffect(()=>{N&&w?.id?(async()=>{try{console.log("📋 Loading offers for conversation:",N);const G=await Ts.getOffersForConversation(N);console.log(`✅ Loaded ${G.length} offers for conversation`),q(G)}catch(G){console.error("❌ Failed to load offers:",G),q([])}})():q([])},[N,w?.id]),n.useEffect(()=>{(async()=>{if(!w||!c||!h){console.log("🔄 Chat initialization skipped - missing dependencies:",{hasUser:!!w,hasProductId:!!c,hasSellerId:!!h});return}if(N){console.log("✅ Chat already initialized:",N);return}try{if(console.log("🚀 Initializing chat:",{productId:c,sellerId:h,currentUserId:w.id,initialConversationId:v}),P(!0),v)console.log("📱 Using existing conversation:",v),M(v),await y(v);else{try{const Fe=localStorage.getItem("agriconnect-myanmar-conversations");if(Fe){const ke=JSON.parse(Fe).find(fe=>(fe.buyerId===w.id&&fe.sellerId===h||fe.sellerId===w.id&&fe.buyerId===h)&&fe.productId===c);if(ke){console.log("📱 Found existing conversation in localStorage:",ke.id),M(ke.id),await y(ke.id);return}}}catch(Fe){console.warn("Could not check for existing conversations:",Fe)}console.log("🆕 Starting new conversation");const G=w.id===h,X=G?h:w.id,Ee=G?w.id:h,we=await u(X,Ee,c);console.log("✅ New conversation created:",we.id),M(we.id)}}catch(G){console.error("❌ Failed to initialize chat:",G),H.error("Failed to start conversation")}finally{P(!1)}})()},[w?.id,c,h,v]),n.useEffect(()=>{if(F.current){const I=F.current.querySelector("[data-radix-scroll-area-viewport]");I&&(I.scrollTop=I.scrollHeight)}},[xe,A]);const z=async()=>{if(!m.trim()||!N||_||!w){console.log("⚠️ Cannot send message:",{hasMessage:!!m.trim(),hasConversationId:!!N,hasEffectiveUser:!!w,isLoading:_});return}const I=N,G=m.trim();console.log("📤 Sending message:",{conversationId:N,content:G,sender:w.name,userId:w.id}),j("");try{P(!0);const X=await g(I,G);console.log("✅ Message sent successfully:",X),console.log("🔍 Post-send conversation state:",{conversationId:N,messageCount:xe.length,isLoading:!1})}catch(X){console.error("❌ Failed to send message:",X),j(G),H.error("Failed to send message. Please try again.")}finally{P(!1),console.log("🔍 Final conversation check:",{conversationId:I,stillValid:!!I,messageCount:xe.length,timestamp:new Date().toISOString()}),setTimeout(()=>{if(F.current){const X=F.current.querySelector("[data-radix-scroll-area-viewport]");X&&(X.scrollTop=X.scrollHeight)}},100)}},Z=I=>{I.key==="Enter"&&!I.shiftKey&&(I.preventDefault(),z())},Re=I=>{if(!I)return"Just now";const G=new Date(I);if(isNaN(G.getTime()))return console.warn("Invalid timestamp:",I),"Just now";const Ee=new Date().getTime()-G.getTime(),we=Math.floor(Ee/6e4);if(we<1)return"Just now";if(we<60)return`${we}m ago`;const Fe=Math.floor(we/60);if(Fe<24)return`${Fe}h ago`;const xs=Math.floor(Fe/24);return xs<7?`${xs}d ago`:G.toLocaleDateString()},Ue=async I=>{console.log("🎯 Creating offer - conversation state before:",{conversationId:N,productId:c,sellerId:h,currentUserId:p?.id,conversationKey:L}),{...I,createdAt:new Date().toISOString()};try{const G=await Ts.createOffer({...I,conversationId:N,productId:c,buyerId:w.id,sellerId:h});console.log("💾 Offer saved to Supabase:",G.id),q(X=>(console.log("📝 Updating offers state - previous count:",X.length),X.find(we=>we.id===G.id)?(console.log("⚠️ Duplicate offer detected, skipping"),X):(console.log("✅ Adding new offer to state"),[...X,G]))),S(!1),H.success("Offer sent successfully!"),console.log("🎯 Offer creation complete - conversation state after:",{conversationId:N,productId:c,sellerId:h,currentUserId:p?.id,conversationKey:L}),setTimeout(()=>{if(F.current){const X=F.current.querySelector("[data-radix-scroll-area-viewport]");X&&(X.scrollTop=X.scrollHeight)}},100)}catch(G){console.error("❌ Failed to save offer:",G),H.error("Failed to create offer")}},ss=I=>{ye(I,"accepted",{acceptedAt:new Date().toISOString()})},le=I=>{ye(I,"declined")},De=(I,G)=>{switch(G){case"accept":ss(I);break;case"decline":le(I);break;case"in_progress":ye(I,"in_progress");break;case"shipped":ye(I,"shipped",{shippedAt:new Date().toISOString()});break;case"delivered":ye(I,"delivered",{deliveredAt:new Date().toISOString()});break;case"completed":ye(I,"completed",{completedAt:new Date().toISOString()});break;case"cancel":ye(I,"cancelled");break;default:console.warn("Unknown quick action:",G)}},hs=(I,G,X)=>{ye(I,G,X)},ye=async(I,G,X={})=>{try{await Ts.updateOfferStatus(I,G,X),q(Ee=>Ee.map(we=>we.id===I?{...we,status:G,...X}:we)),H.success(`Offer ${G}!`)}catch(Ee){console.error("Failed to update offer:",Ee),H.error("Failed to update offer")}},as=w&&C&&(w.userType==="buyer"||w.userType==="trader"&&w.id!==h),ie=w?.id===h;return console.log("🔍 ChatInterface Offer Button Debug:",{effectiveCurrentUser:w?.id,product:C?.id,sellerId:h,canCreateOffer:as,isSeller:ie,currentUserType:w?.userType}),e.jsxs(R,{className:"h-full flex flex-col border-0 rounded-none",children:[e.jsx(Y,{className:"flex-shrink-0 pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsxs(K,{className:"flex items-center gap-2",children:[s,e.jsx(qa,{userType:a,accountType:"individual",size:"sm",className:"mr-1"})]})}),e.jsxs("div",{className:"flex gap-2",children:[as&&e.jsx($a,{children:e.jsxs(wr,{children:[e.jsx(kr,{asChild:!0,children:e.jsxs(f,{size:"sm",className:"h-9 bg-green-600 hover:bg-green-700",onClick:()=>S(!0),children:[e.jsx(os,{className:"w-4 h-4 mr-2"}),"Make Offer"]})}),e.jsx(Cr,{children:e.jsx("p",{children:"Make an offer for this product"})})]})}),e.jsx(f,{variant:"outline",size:"sm",onClick:i,children:e.jsx(Le,{className:"w-4 h-4"})})]})]})}),e.jsxs(E,{className:"flex-1 flex flex-col p-0 min-h-0",children:[o&&e.jsx("div",{className:`mx-4 mt-3 p-3 rounded-lg border ${o.trustLevel!=="unverified"?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[!o.trustLevel!=="unverified"&&e.jsx(Ds,{className:"w-4 h-4 text-yellow-600 mt-0.5"}),o.trustLevel!=="unverified"&&e.jsx(ee,{className:"w-4 h-4 text-green-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[!o.trustLevel!=="unverified"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"Profile Not Confirmed"}),e.jsxs("p",{className:"text-xs text-yellow-700 mt-1",children:[e.jsx("span",{className:"font-medium",children:s})," has not completed profile verification yet. Exercise appropriate caution when sharing personal information."]})]}),o.trustLevel!=="unverified"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm font-medium text-green-800",children:["Verified ",a==="farmer"?"Farmer":a==="trader"?"Trader":"User"]}),e.jsxs("p",{className:"text-xs text-green-700 mt-1",children:[e.jsx("span",{className:"font-medium",children:s})," has completed profile verification and confirmed their identity."]})]})]})]})}),e.jsx(Oa,{ref:F,className:"h-[300px] p-4",children:e.jsx("div",{className:"space-y-4 pb-4",children:_&&xe.length===0&&A.length===0?e.jsx("div",{className:"text-center text-muted-foreground py-8",children:e.jsx("div",{className:"animate-pulse",children:"Starting conversation..."})}):xe.length===0&&A.length===0?e.jsx("div",{className:"text-center text-muted-foreground py-8",children:e.jsx("p",{children:"No messages yet. Say hello to start the conversation!"})}):e.jsxs(e.Fragment,{children:[xe.map(I=>e.jsx("div",{className:`flex ${I.senderId===w?.id?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] p-3 rounded-lg ${I.senderId===w?.id?"bg-primary text-primary-foreground":"bg-muted"}`,children:[e.jsx("p",{className:"text-sm",children:I.content}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx("p",{className:"text-xs opacity-70",children:Re(I.timestamp)}),I.senderId===w?.id&&I.status&&e.jsx("span",{className:"text-xs opacity-70 ml-2",children:I.status==="sending"?"⏳":I.status==="sent"?"✓":I.status==="delivered"||I.status==="read"?"✓✓":""})]})]})},I.id)),A.length>0&&e.jsx("div",{className:"space-y-2",children:A.map(I=>e.jsx(Pr,{offer:I,currentUserId:w?.id||"",onViewDetails:G=>{ve(G),T(!0)},onQuickAction:De},I.id))})]})})}),!1,e.jsxs("div",{className:"flex-shrink-0 p-4 border-t bg-card",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(W,{placeholder:N?_?"Sending...":"Type your message...":"Initializing...",value:m,onChange:I=>j(I.target.value),onKeyPress:Z,disabled:_||!N||!w,className:"flex-1",autoComplete:"off",maxLength:1e3}),e.jsx(f,{onClick:z,size:"sm",disabled:_||!N||!m.trim()||!w,className:"shrink-0",children:_?e.jsx("div",{className:"w-4 h-4 animate-spin rounded-full border-2 border-primary border-t-transparent"}):e.jsx(zt,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[!N&&w&&e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Setting up conversation..."}),!w&&e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Please log in to send messages"}),!1]})]})]}),D&&C&&w&&(console.log("🔍 ChatInterface - Rendering CreateOfferModal with user data:",{currentUserId:w.id,currentUserName:w.name,currentUserEmail:w.email,currentUserType:w.userType,sellerId:h,sellerName:s,productId:C.id,productName:C.name}),e.jsx(Tr,{isOpen:D,onClose:()=>S(!1),product:C,buyerId:w.id,buyerName:w.name,sellerId:h,sellerName:s,onCreateOffer:Ue})),e.jsx(Dr,{offer:re,isOpen:je,onClose:()=>{T(!1),ve(null)},currentUserId:w?.id||"",onUpdateStatus:hs})]})}const Ir=Ws("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function _e({className:s,variant:a,...t}){return e.jsx("div",{"data-slot":"alert",role:"alert",className:Q(Ir({variant:a}),s),...t})}function Te({className:s,...a}){return e.jsx("div",{"data-slot":"alert-description",className:Q("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",s),...a})}function va({onLogin:s,onSwitchToRegister:a,onForgotPassword:t,onClose:r}){const[l,c]=n.useState({email:"",password:""}),[h,v]=n.useState(!1),[i,d]=n.useState(""),[b,k]=n.useState(!1),o=async C=>{C.preventDefault(),d(""),k(!0);try{await s(l.email,l.password),r()}catch(p){console.error("Login failed:",p),d(p.message||"Login failed. Please try again.")}finally{k(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("h1",{className:"text-2xl font-semibold flex items-center justify-center gap-2 mb-2",children:[e.jsx(Be,{className:"w-6 h-6 text-primary"}),"Welcome Back"]}),e.jsx("p",{className:"text-muted-foreground",children:"Sign in to your AgriLink account"})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs(R,{className:"w-full max-w-md",children:[e.jsxs(Y,{className:"space-y-1",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("div",{className:"w-12 h-12 bg-primary rounded-lg flex items-center justify-center",children:e.jsx(Be,{className:"w-6 h-6 text-primary-foreground"})})}),e.jsx(K,{className:"text-2xl text-center",children:"Sign In"}),e.jsx(Je,{className:"text-center",children:"Access your agricultural marketplace account"})]}),e.jsxs(E,{className:"space-y-4",children:[i&&e.jsx(_e,{variant:"destructive",children:e.jsx(Te,{children:i})}),e.jsxs("form",{onSubmit:o,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"email",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(cs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(W,{id:"email",type:"email",placeholder:"Enter your email",value:l.email,onChange:C=>c(p=>({...p,email:C.target.value})),className:"pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Os,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(W,{id:"password",type:h?"text":"password",placeholder:"Enter your password",value:l.password,onChange:C=>c(p=>({...p,password:C.target.value})),className:"pl-10 pr-10",required:!0}),e.jsx("button",{type:"button",onClick:()=>v(!h),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground",children:h?e.jsx(ys,{className:"w-4 h-4"}):e.jsx(ge,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"text-left mb-2",children:e.jsx("button",{type:"button",onClick:t,className:"text-sm text-muted-foreground hover:text-primary hover:underline",children:"Forgot your password?"})})]}),e.jsx(f,{type:"submit",className:"w-full mt-6",disabled:b,children:b?"Signing In...":"Sign In"})]})]}),e.jsx(Ba,{className:"flex flex-col space-y-4 pt-0",children:e.jsxs("div",{className:"text-sm text-center text-muted-foreground",children:["Don't have an account?"," ",e.jsx("button",{onClick:a,className:"text-primary hover:underline font-medium",children:"Register here"})]})})]})})]})}function ja({className:s,...a}){return e.jsx(Ct,{"data-slot":"checkbox",className:Q("peer h-4 w-4 shrink-0 rounded border-2 border-primary/40 bg-white shadow focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground data-[state=checked]:border-primary hover:border-primary/60 transition-all",s),...a,children:e.jsx(St,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current",children:e.jsx(Aa,{className:"h-3 w-3 text-white"})})})}function Ar({currentUser:s,onBack:a,onSave:t,editingProduct:r}){const[l,c]=n.useState(""),[h,v]=n.useState(""),[i,d]=n.useState(!1),[b,k]=n.useState({}),o=n.useRef(null),C=n.useRef(null),[p,w]=n.useState(()=>{if(r){console.log("🔄 Initializing form with editing product:",{id:r.id,name:r.name,price:r.price,priceType:typeof r.price,description:r.description||"UNDEFINED",category:r.category||"UNDEFINED",hasImage:!!r.image||!!r.images?.length});const L={id:r.id,sellerId:r.sellerId,name:r.name||"",price:r.price||0,unit:r.unit||"",location:r.location||s?.location||"",region:r.region||s?.region||"yangon",sellerType:r.sellerType||s?.userType||"farmer",sellerName:r.sellerName||s?.name||"",image:r.image||"",images:r.images||(r.image?[r.image]:[]),quantity:r.quantity||"",minimumOrder:r.minimumOrder||"",availableQuantity:r.availableQuantity||"",deliveryOptions:r.deliveryOptions||[],paymentTerms:r.paymentTerms||[],lastUpdated:r.lastUpdated||new Date().toISOString(),category:r.category||"",description:r.description||"",additionalNotes:r.additionalNotes||"",priceChange:r.priceChange,isEditing:!0};return C.current={...L},L}return{id:"",sellerId:s?.id||"",name:"",price:0,unit:"",location:s?.location||"",region:s?.region||"yangon",sellerType:s?.userType||"farmer",sellerName:s?.name||"",image:"",images:[],quantity:"",minimumOrder:"",availableQuantity:"",deliveryOptions:[],paymentTerms:[],lastUpdated:new Date().toISOString(),category:"",description:"",additionalNotes:"",priceChange:void 0}}),x=n.useMemo(()=>{const L=["Pickup","Local Delivery (Within 10km)","Regional Delivery","Nationwide Shipping","Express Delivery","Cold Chain Transport"],z=localStorage.getItem("agriconnect-custom-delivery-options"),Z=z?JSON.parse(z):[];return[...L,...Z]},[]),g=n.useMemo(()=>{const L=localStorage.getItem("agriconnect-custom-delivery-options");return L?JSON.parse(L):[]},[]),u=n.useMemo(()=>{if(!r||!C.current)return!1;const L=C.current,Z=["name","price","unit","location","region","category","description","quantity","minimumOrder","availableQuantity","additionalNotes"].some(le=>String(p[le]||"")!==String(L[le]||"")),Re=JSON.stringify(p.deliveryOptions?.sort())!==JSON.stringify(L.deliveryOptions?.sort()),Ue=JSON.stringify(p.paymentTerms?.sort())!==JSON.stringify(L.paymentTerms?.sort()),ss=JSON.stringify(p.images?.sort())!==JSON.stringify(L.images?.sort());return Z||Re||Ue||ss},[p,r]),y=()=>r?u?{text:"Save Changes",disabled:!1,variant:"default"}:{text:"Update Product",disabled:!0,variant:"secondary"}:{text:"Publish Product",disabled:!1,variant:"default"},m=n.useCallback(L=>{localStorage.setItem("agriconnect-custom-delivery-options",JSON.stringify(L))},[]),j=n.useMemo(()=>{const L=["Cash on Delivery","Bank Transfer","Mobile Payment","Cash on Pickup","50% Advance, 50% on Delivery","30% Advance, 70% on Delivery"],z=localStorage.getItem("agriconnect-custom-payment-terms"),Z=z?JSON.parse(z):[];return[...L,...Z]},[]),N=n.useMemo(()=>{const L=localStorage.getItem("agriconnect-custom-payment-terms");return L?JSON.parse(L):[]},[]),M=n.useCallback(L=>{localStorage.setItem("agriconnect-custom-payment-terms",JSON.stringify(L))},[]),_=n.useCallback(()=>{const L={};return p.name?.trim()||(L.name="Product name is required"),p.category?.trim()||(L.category="Category is required"),p.unit?.trim()||(L.unit='Quantity & unit is required (e.g., "50 kg", "25 bags")'),(!p.price||p.price<=0)&&(L.price="Valid price is required"),p.availableQuantity?.trim()||(L.availableQuantity="Available quantity is required"),p.minimumOrder?.trim()||(L.minimumOrder="Minimum order is required"),p.region?.trim()||(L.region="Region is required"),p.location?.trim()||(L.location="City/Location is required"),p.deliveryOptions.length===0&&(L.deliveryOptions="At least one delivery option is required"),p.paymentTerms.length===0&&(L.paymentTerms="At least one payment term is required"),k(L),Object.keys(L).length===0},[p]),P=n.useCallback(L=>{w(z=>({...z,deliveryOptions:z.deliveryOptions.includes(L)?z.deliveryOptions.filter(Z=>Z!==L):[...z.deliveryOptions,L]}))},[]),F=n.useCallback(L=>{w(z=>({...z,paymentTerms:z.paymentTerms.includes(L)?z.paymentTerms.filter(Z=>Z!==L):[...z.paymentTerms,L]}))},[]),D=n.useCallback(()=>{if(!l.trim())return;const L=[...g,l.trim()];m(L),c("")},[l,g,m]),S=n.useCallback(L=>{const z=g.filter(Z=>Z!==L);m(z),w(Z=>({...Z,deliveryOptions:Z.deliveryOptions.filter(Re=>Re!==L)}))},[g,m]),A=n.useCallback(()=>{if(!h.trim())return;const L=[...N,h.trim()];M(L),v("")},[h,N,M]),q=n.useCallback(L=>{const z=N.filter(Z=>Z!==L);M(z),w(Z=>({...Z,paymentTerms:Z.paymentTerms.filter(Re=>Re!==L)}))},[N,M]),re=n.useCallback(L=>{const z=Array.from(L.target.files||[]);if(z.length===0)return;const Z=10;if((p.images?.length||0)+z.length>Z){k(le=>({...le,images:`Maximum ${Z} images allowed`}));return}if(z.filter(le=>le.size>3*1024*1024).length>0){k(le=>({...le,images:"Each image must be smaller than 3MB"}));return}k(le=>{const De={...le};return delete De.images,De}),(async()=>{const le=[];for(const De of z)await new Promise(hs=>{const ye=new FileReader;ye.onload=as=>{const ie=as.target?.result;le.push(ie),hs()},ye.readAsDataURL(De)});w(De=>({...De,images:[...De.images||[],...le],image:De.images?.length===0&&le.length>0?le[0]:De.image}))})(),o.current&&(o.current.value="")},[p.images]),ve=n.useCallback(L=>{w(z=>{const Z=[...z.images||[]];return Z.splice(L,1),{...z,images:Z,image:Z.length>0?Z[0]:""}})},[]),je=n.useCallback(()=>{w(L=>({...L,images:[],image:""})),o.current&&(o.current.value="")},[]),T=n.useCallback(async()=>{if(console.log("🚀 Form submission started"),r&&!u){console.log("❌ No changes detected, skipping submission");return}if(console.log("Form data being validated:",{id:p.id,name:p.name,price:p.price,priceType:typeof p.price,category:p.category,description:p.description,isEditing:p.isEditing,hasImages:!!(p.images?.length||p.image),imagesCount:p.images?.length||(p.image?1:0),hasChanges:u}),!_()){console.log("❌ Validation failed:",b);return}d(!0);try{console.log("✅ Validation passed, calling onSave");const L={...p,quantity:p.availableQuantity,lastUpdated:new Date().toISOString(),isEditing:p.isEditing};await t(L),console.log("✅ onSave completed successfully")}catch(L){console.error("❌ Product save failed:",L),d(!1)}},[p,_,b,t,r,u]),xe=n.useCallback(async L=>{L.preventDefault(),await T()},[T]);return e.jsxs("form",{onSubmit:xe,className:"max-w-4xl mx-auto p-4 md:p-6 space-y-6 md:space-y-8",children:[e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsxs(f,{variant:"ghost",onClick:a,className:"h-9 px-3 -ml-3",children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:r?"Edit Product":"Add New Product"}),e.jsx("p",{className:"text-muted-foreground",children:r?"Update your product listing details":"Create a detailed product listing for buyers"})]})]}),!r&&e.jsxs(_e,{className:"border-primary/20 bg-primary/5",children:[e.jsx(qt,{className:"h-4 w-4 text-primary"}),e.jsxs(Te,{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-primary",children:"💡 Selling multiple sizes or variants?"}),e.jsx("br",{}),'Create separate product listings for each size/variant (e.g., "Rice - 25kg bag", "Rice - 50kg bag"). This makes it easier for buyers to find exactly what they need and helps with analytics.']})]}),Object.keys(b).length>0&&e.jsxs(_e,{variant:"destructive",children:[e.jsx(Ae,{className:"h-4 w-4"}),e.jsxs(Te,{children:["Please fix the following errors:",e.jsx("ul",{className:"mt-2 ml-4 list-disc",children:Object.entries(b).map(([L,z])=>e.jsx("li",{className:"text-sm",children:z},L))})]})]}),e.jsxs("div",{className:"space-y-6 md:space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 lg:items-start",children:[e.jsx("div",{className:"lg:col-span-2 lg:self-start",children:e.jsxs(R,{className:"h-[300px] lg:h-[320px] flex flex-col",children:[e.jsx(Y,{className:"flex-shrink-0 pb-4",children:e.jsxs(K,{className:"flex items-center gap-2 text-base md:text-lg",children:[e.jsx(he,{className:"w-5 h-5"}),"Product Information"]})}),e.jsxs(E,{className:"flex-grow flex flex-col space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"productName",children:"Product Name *"}),e.jsx(W,{id:"productName",placeholder:"e.g., Fresh Cabbage",value:p.name,onChange:L=>w(z=>({...z,name:L.target.value})),className:`h-10 ${b.name?"border-destructive":""}`})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"category",children:"Category *"}),e.jsxs(ce,{value:p.category,onValueChange:L=>w(z=>({...z,category:L})),children:[e.jsx(me,{className:`h-10 ${b.category?"border-destructive":""}`,children:e.jsx(de,{placeholder:"Pulses & Beans"})}),e.jsxs(ue,{children:[e.jsx(B,{value:"rice",children:"Rice"}),e.jsx(B,{value:"vegetables",children:"Vegetables"}),e.jsx(B,{value:"fruits",children:"Fruits"}),e.jsx(B,{value:"spices",children:"Spices & Herbs"}),e.jsx(B,{value:"pulses",children:"Pulses & Beans"}),e.jsx(B,{value:"grains",children:"Grains & Cereals"}),e.jsx(B,{value:"tea-coffee",children:"Tea & Coffee"}),e.jsx(B,{value:"nuts",children:"Nuts & Seeds"}),e.jsx(B,{value:"livestock",children:"Livestock"}),e.jsx(B,{value:"dairy",children:"Dairy Products"}),e.jsx(B,{value:"other",children:"Other"})]})]})]})]}),e.jsxs("div",{className:"space-y-2 flex-grow flex flex-col",children:[e.jsx(O,{htmlFor:"description",children:"Product Description"}),e.jsx(ze,{id:"description",placeholder:"Describe your product, quality, farming methods, and what makes it special...",value:p.description,onChange:L=>w(z=>({...z,description:L.target.value})),className:"flex-grow resize-none h-[100px] lg:h-[110px]"})]})]})]})}),e.jsx("div",{className:"lg:col-span-1 lg:self-end",children:e.jsxs(R,{className:"h-[300px] lg:h-[320px] flex flex-col",children:[e.jsx(Y,{className:"flex-shrink-0 pb-4",children:e.jsxs(K,{className:"flex items-center gap-2 text-base md:text-lg",children:[e.jsx(bs,{className:"w-5 h-5"}),"Product Photos"]})}),e.jsxs(E,{className:"flex-grow flex flex-col space-y-3",children:[p.images&&p.images.length>0?e.jsxs("div",{className:"flex-grow flex flex-col space-y-2",children:[e.jsx("div",{className:"flex-grow",children:e.jsx("div",{className:"grid grid-cols-2 gap-2 h-[120px] lg:h-[130px] overflow-y-auto",children:p.images.map((L,z)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:L,alt:`Product ${z+1}`,className:"w-full h-16 md:h-18 object-cover rounded-lg border hover:opacity-90 transition-opacity"}),e.jsx(f,{type:"button",variant:"destructive",size:"sm",onClick:()=>ve(z),className:"absolute top-1 right-1 h-5 w-5 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Le,{className:"w-2 h-2"})}),z===0&&e.jsx(U,{className:"absolute bottom-1 left-1 text-xs px-1 py-0 h-4",children:"Main"})]},z))})}),e.jsxs("div",{className:"flex-shrink-0 space-y-2",children:[p.images.length<10&&e.jsxs(f,{type:"button",variant:"outline",size:"sm",onClick:()=>o.current?.click(),className:"w-full h-9",children:[e.jsx(is,{className:"w-3 h-3 mr-1"}),"Add More (",p.images.length,"/10)"]}),p.images.length>1&&e.jsx(f,{type:"button",variant:"ghost",size:"sm",onClick:je,className:"w-full text-destructive hover:text-destructive h-9",children:"Remove All Photos"})]})]}):e.jsx("div",{className:"flex-grow flex items-center justify-center",children:e.jsxs("div",{className:"border-2 border-dashed border-muted rounded-lg p-3 text-center w-full",children:[e.jsx(bs,{className:"w-12 h-12 mx-auto text-muted-foreground mb-3"}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1 mb-3",children:[e.jsx("p",{children:"• Use high-quality photos"}),e.jsx("p",{children:"• Multiple photos help customers"}),e.jsx("p",{children:"• JPG, PNG up to 3MB each"})]}),e.jsxs(f,{type:"button",variant:"outline",size:"sm",onClick:()=>o.current?.click(),className:"h-9",children:[e.jsx(Fa,{className:"w-3 h-3 mr-1"}),"Upload Photos"]})]})}),e.jsx("input",{ref:o,type:"file",accept:"image/*",multiple:!0,onChange:re,className:"hidden"}),b.images&&e.jsx("p",{className:"text-sm text-destructive",children:b.images})]})]})})]}),e.jsxs(R,{children:[e.jsx(Y,{children:e.jsxs(K,{className:"flex items-center gap-2 text-base md:text-lg",children:[e.jsx(os,{className:"w-5 h-5"}),"Pricing & Quantity"]})}),e.jsxs(E,{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"unit",children:"Package Size *"}),e.jsx(W,{id:"unit",placeholder:"e.g., 50 kg, 25 bags, 1 basket",value:p.unit,onChange:L=>w(z=>({...z,unit:L.target.value})),className:`h-11 ${b.unit?"border-destructive":""}`})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"price",children:"Price (MMK) *"}),e.jsx(W,{id:"price",type:"number",placeholder:"0",value:p.price||"",onChange:L=>{const z=parseFloat(L.target.value)||0;console.log("💰 Price changed:",{inputValue:L.target.value,parsedValue:z,previousPrice:p.price}),w(Z=>({...Z,price:z}))},className:`h-11 ${b.price?"border-destructive":""}`})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"availableQuantity",children:"Available Stock *"}),e.jsx(W,{id:"availableQuantity",placeholder:"e.g., 100 bags available",value:p.availableQuantity,onChange:L=>w(z=>({...z,availableQuantity:L.target.value})),className:`h-11 ${b.availableQuantity?"border-destructive":""}`})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"minimumOrder",children:"Minimum Order *"}),e.jsx(W,{id:"minimumOrder",placeholder:"e.g., 5 bags minimum",value:p.minimumOrder,onChange:L=>w(z=>({...z,minimumOrder:L.target.value})),className:`h-11 ${b.minimumOrder?"border-destructive":""}`})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"region",children:"Region *"}),e.jsxs(ce,{value:p.region,onValueChange:L=>w(z=>({...z,region:L,location:""})),children:[e.jsx(me,{className:`h-11 ${b.region?"border-destructive":""}`,children:e.jsx(de,{placeholder:"Select your region"})}),e.jsx(ue,{className:"max-h-64 overflow-y-auto",children:Object.entries(Ie).map(([L,z])=>e.jsx(B,{value:L,children:z.name},L))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"location",children:"City/Location *"}),e.jsxs(ce,{value:p.location,onValueChange:L=>w(z=>({...z,location:L})),disabled:!p.region,children:[e.jsx(me,{className:`h-11 ${b.location?"border-destructive":""}`,children:e.jsx(de,{placeholder:p.region?"Select your city":"Select region first"})}),e.jsx(ue,{className:"max-h-64 overflow-y-auto",children:p.region&&Ie[p.region]?.cities.map(L=>e.jsx(B,{value:L,children:L},L))})]})]})]})]}),e.jsxs(R,{children:[e.jsx(Y,{children:e.jsxs(K,{className:"flex items-center gap-2 text-base md:text-lg",children:[e.jsx(We,{className:"w-5 h-5"}),"Delivery Options *"]})}),e.jsxs(E,{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:x.map(L=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ja,{id:`delivery-${L}`,checked:p.deliveryOptions.includes(L),onCheckedChange:()=>P(L)}),e.jsx(O,{htmlFor:`delivery-${L}`,className:"text-sm leading-5 cursor-pointer",children:L}),g.includes(L)&&e.jsx(f,{type:"button",variant:"ghost",size:"sm",onClick:()=>S(L),className:"h-6 w-6 p-0 ml-2 text-destructive hover:text-destructive",children:e.jsx(Le,{className:"w-3 h-3"})})]},L))}),b.deliveryOptions&&e.jsx("p",{className:"text-sm text-destructive",children:b.deliveryOptions}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(W,{placeholder:"Add custom delivery option",value:l,onChange:L=>c(L.target.value),className:"h-11",onKeyPress:L=>L.key==="Enter"&&D()}),e.jsx(f,{type:"button",variant:"outline",onClick:D,disabled:!l.trim(),className:"h-11 px-3",children:e.jsx(is,{className:"w-4 h-4"})})]})]})]}),e.jsxs(R,{children:[e.jsx(Y,{children:e.jsxs(K,{className:"flex items-center gap-2 text-base md:text-lg",children:[e.jsx(Bt,{className:"w-5 h-5"}),"Payment Terms *"]})}),e.jsxs(E,{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:j.map(L=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ja,{id:`payment-${L}`,checked:p.paymentTerms.includes(L),onCheckedChange:()=>F(L)}),e.jsx(O,{htmlFor:`payment-${L}`,className:"text-sm leading-5 cursor-pointer",children:L}),N.includes(L)&&e.jsx(f,{type:"button",variant:"ghost",size:"sm",onClick:()=>q(L),className:"h-6 w-6 p-0 ml-2 text-destructive hover:text-destructive",children:e.jsx(Le,{className:"w-3 h-3"})})]},L))}),b.paymentTerms&&e.jsx("p",{className:"text-sm text-destructive",children:b.paymentTerms}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(W,{placeholder:"Add custom payment term",value:h,onChange:L=>v(L.target.value),className:"h-11",onKeyPress:L=>L.key==="Enter"&&A()}),e.jsx(f,{type:"button",variant:"outline",onClick:A,disabled:!h.trim(),className:"h-11 px-3",children:e.jsx(is,{className:"w-4 h-4"})})]})]})]}),e.jsxs(R,{children:[e.jsx(Y,{children:e.jsxs(K,{className:"flex items-center gap-2 text-base md:text-lg",children:[e.jsx(Ve,{className:"w-5 h-5"}),"Additional Notes"]})}),e.jsx(E,{children:e.jsx(ze,{placeholder:"Any special conditions, harvest dates, certifications, or additional information...",value:p.additionalNotes,onChange:L=>w(z=>({...z,additionalNotes:L.target.value})),className:"min-h-20 resize-none"})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 sm:justify-end",children:[e.jsx(f,{variant:"outline",onClick:a,disabled:i,className:"h-11 sm:px-6 order-2 sm:order-1 min-h-11",children:"Cancel"}),e.jsx(f,{type:"submit",disabled:i||y().disabled,variant:y().variant,className:`h-11 flex-1 sm:flex-none sm:px-8 order-1 sm:order-2 min-h-11 ${y().disabled?"opacity-50 cursor-not-allowed bg-muted text-muted-foreground hover:bg-muted":""}`,children:i?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-4 h-4 mr-2 animate-spin"}),r?"Updating...":"Publishing..."]}):e.jsxs(e.Fragment,{children:[!r&&e.jsx(he,{className:"w-4 h-4 mr-2"}),y().text]})})]})]})]})}function Is({className:s,orientation:a="horizontal",decorative:t=!0,...r}){return e.jsx(_t,{"data-slot":"separator-root",decorative:t,orientation:a,className:Q("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",s),...r})}class Rr{static async getSellerStats(a){try{console.log("🔍 ReviewsService: Fetching stats for sellerId:",a);const{data:t,error:r}=await V.from("users").select("rating, total_reviews, response_time").eq("id",a).single();if(console.log("📊 ReviewsService: User data:",t,"Error:",r),r)return console.error("Error fetching user data:",r),this.getDefaultStats();const{data:l,error:c}=await V.from("reviews").select(`
          id,
          reviewer_id,
          reviewee_id,
          product_id,
          rating,
          comment,
          created_at,
          reviewer:users!reviews_reviewer_id_fkey(name)
        `).eq("reviewee_id",a).order("created_at",{ascending:!1}).limit(5);c&&console.error("Error fetching reviews:",c);const h=await this.calculateResponseTime(a),v={rating:t.rating||0,totalReviews:t.total_reviews||0,responseTime:h||t.response_time||"Within 24 hours",recentReviews:l?.map(i=>({id:i.id,reviewer_id:i.reviewer_id,reviewee_id:i.reviewee_id,product_id:i.product_id,rating:i.rating,comment:i.comment,created_at:i.created_at,reviewer_name:i.reviewer?.name||"Anonymous"}))||[]};return console.log("✅ ReviewsService: Final result:",v),v}catch(t){return console.error("Error in getSellerStats:",t),this.getDefaultStats()}}static async calculateResponseTime(a){try{const{data:t,error:r}=await V.from("messages").select(`
          created_at,
          sender_id,
          conversation_id
        `).eq("sender_id",a).order("created_at",{ascending:!1}).limit(50);if(r||!t||t.length===0)return"Within 24 hours";const l=[];for(const v of t){const{data:i}=await V.from("messages").select("created_at, sender_id").eq("conversation_id",v.conversation_id).lt("created_at",v.created_at).order("created_at",{ascending:!1}).limit(1).single();if(i&&i.sender_id!==a){const d=new Date(v.created_at).getTime()-new Date(i.created_at).getTime();l.push(d)}}if(l.length===0)return"Within 24 hours";const h=l.reduce((v,i)=>v+i,0)/l.length/(1e3*60*60);return h<1?"Within 1 hour":h<3?"Within 3 hours":h<6?"Within 6 hours":h<12?"Within 12 hours":h<24?"Within 24 hours":"Within 2 days"}catch(t){return console.error("Error calculating response time:",t),"Within 24 hours"}}static getDefaultStats(){return{rating:4,totalReviews:0,responseTime:"Within 24 hours",recentReviews:[]}}static async submitReview(a,t,r,l,c){try{const{error:h}=await V.from("reviews").insert({reviewer_id:a,reviewee_id:t,product_id:r,rating:l,comment:c});return h?(console.error("Error submitting review:",h),!1):(await this.updateUserStats(t),!0)}catch(h){return console.error("Error in submitReview:",h),!1}}static async updateUserStats(a){try{const{data:t,error:r}=await V.from("reviews").select("rating").eq("reviewee_id",a);if(r||!t){console.error("Error fetching reviews for stats update:",r);return}const l=t.length,c=l>0?t.reduce((v,i)=>v+i.rating,0)/l:0,{error:h}=await V.from("users").update({rating:Math.round(c*10)/10,total_reviews:l}).eq("id",a);h&&console.error("Error updating user stats:",h)}catch(t){console.error("Error in updateUserStats:",t)}}}function Er({seller:s,products:a,onBack:t,onViewProduct:r,onChat:l,onEditProduct:c,isOwnStorefront:h=!1,onEditStorefrontImage:v,onUpdateStorefront:i,previewMode:d=!1,onTogglePreviewMode:b,currentUser:k}){const[o,C]=n.useState(null),[p,w]=n.useState(null),[x,g]=n.useState(!0),[u,y]=n.useState(()=>({description:s.description||"",businessHours:s.businessHours||"",phone:s.phone||"",email:s.email||"",website:s.website||"",facebook:s.facebook||"",instagram:s.instagram||"",whatsapp:s.whatsapp||"",tiktok:s.tiktok||"",specialties:s.specialties||[],policies:s.policies||{returns:"",delivery:"",payment:""}}));n.useEffect(()=>{(async()=>{if(!(!s.id||h))try{await Fs.trackProfileView(s.id,k?.id),console.log("📊 Profile view tracked for:",s.name)}catch(S){console.error("❌ Error tracking profile view:",S)}})()},[s.id,h,k?.id]),n.useEffect(()=>{(async()=>{if(s.id){g(!0);try{console.log("🔍 SellerStorefront: Fetching stats for sellerId:",s.id);const S=await Rr.getSellerStats(s.id);console.log("📊 SellerStorefront: Seller stats received:",S),w(S)}catch(S){console.error("❌ SellerStorefront: Error fetching seller stats:",S)}finally{g(!1)}}})()},[s.id]),n.useEffect(()=>{const D={description:s.description||"",businessHours:s.businessHours||"",phone:s.phone||"",email:s.email||"",website:s.website||"",facebook:s.facebook||"",instagram:s.instagram||"",whatsapp:s.whatsapp||"",specialties:s.specialties||[],policies:s.policies||{returns:"",delivery:"",payment:""}};y(D)},[s]);const m=(D,S)=>{C({field:D,value:S})},j=()=>{C(null)},N=async(D,S)=>{try{const A={[D]:S};y(q=>({...q,[D]:S})),C(null),i&&await i(A)}catch(A){console.error("Failed to save:",A),y(q=>({...q,[D]:u[D]}))}},M=D=>{if(!D.trim()||u.specialties.includes(D.trim()))return;const S=[...u.specialties,D.trim()];y(A=>({...A,specialties:S})),C(null),i&&i({specialties:S})},_=D=>{const S=u.specialties.filter(A=>A!==D);y(A=>({...A,specialties:S})),i&&i({specialties:S})};if(!s||!s.name)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(f,{variant:"outline",size:"sm",onClick:t,children:e.jsx(Oe,{className:"w-4 h-4"})})}),e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Seller information not available."})})]});const P=D=>new Intl.NumberFormat("en-US").format(D),F=a.length;return a.length>0&&Math.round(a.reduce((D,S)=>D+S.price,0)/a.length),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Oe,{className:"w-5 h-5 cursor-pointer text-muted-foreground hover:text-foreground transition-colors",onClick:t}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:s.name}),e.jsxs("p",{className:"text-muted-foreground",children:[s.type==="farmer"?"Farm":"Trading"," Storefront"]})]})]}),h&&b&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Preview Mode"}),e.jsx("button",{onClick:()=>b(!d),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 ${d?"bg-primary":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${d?"translate-x-6":"translate-x-1"}`})})]}),d&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-primary/10 border border-primary/30 rounded-lg",children:[e.jsx(ge,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-primary",children:"Customer View"})]})]})]}),h&&d&&e.jsx("div",{className:"bg-primary/10 border border-primary/30 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-primary",children:"Customer Preview Mode"}),e.jsx("p",{className:"text-sm text-primary/80",children:"This is exactly how customers see your storefront. Toggle off to return to editing mode."})]})]})}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[e.jsx(R,{className:"border-primary/30",children:e.jsx(E,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:s.image,alt:s.name,className:"w-full h-48 object-cover rounded-lg"}),h&&!d&&v&&e.jsxs(f,{size:"sm",variant:"secondary",className:"absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity bg-white/90 hover:bg-white shadow-md",onClick:v,children:[e.jsx(bs,{className:"w-4 h-4 mr-1"}),"Edit Photo"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h2",{className:"text-xl font-semibold",children:s.name})}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(pe,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s.location})]}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:e.jsx(Ns,{userType:s.type,accountType:ms(s),verificationLevel:Ye(s),size:"sm"})})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("div",{className:"flex items-center",children:x?e.jsx("span",{className:"text-sm text-muted-foreground",children:"Loading..."}):e.jsxs(e.Fragment,{children:[[...Array(5)].map((D,S)=>e.jsx(Xs,{className:`w-4 h-4 ${S<Math.floor(p?.rating||0)?"text-yellow-400 fill-current":"text-gray-300"}`},S)),e.jsx("span",{className:"text-sm font-medium ml-2",children:p?.rating?p.rating.toFixed(1):"0.0"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",p?.totalReviews||0," ",p?.totalReviews===1?"review":"reviews",")"]})]})})}),e.jsx(Is,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Business Hours"})]}),h&&!d&&e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>m("businessHours",u.businessHours),className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",children:e.jsx(se,{className:"w-4 h-4"})})]}),o?.field==="businessHours"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{value:o.value,onChange:D=>C({...o,value:D.target.value}),placeholder:"e.g., 9 AM - 6 PM, Mon-Sat",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{size:"sm",onClick:()=>N("businessHours",o.value),children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsx(f,{size:"sm",variant:"outline",onClick:j,children:"Cancel"})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:u.businessHours||(h&&!d?"Add your business hours":"Business hours not specified")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Rs,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["Joined ",Es(s.joinedDate)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["Response time: ",x?"Loading...":p?.responseTime||"Within 24 hours"]})]})]})]})})}),(!d||u.phone||u.email||u.website)&&e.jsxs(R,{className:"border-primary/30",children:[e.jsx(Y,{children:e.jsxs(K,{className:"text-lg flex items-center gap-2",children:[e.jsx(qe,{className:"w-5 h-5"}),"Contact Information"]})}),e.jsxs(E,{className:"space-y-4",children:[(!d||u.phone)&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Phone"})]}),h&&!d&&e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>m("phone",u.phone),className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",children:e.jsx(se,{className:"w-4 h-4"})})]}),o?.field==="phone"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{value:o.value,onChange:D=>C({...o,value:D.target.value}),placeholder:"+95 9 xxx xxx xxx",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{size:"sm",onClick:()=>N("phone",o.value),children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsx(f,{size:"sm",variant:"outline",onClick:j,children:"Cancel"})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:u.phone||(h&&!d?"Add phone number":null)})]}),(!d||u.email)&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(cs,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Email"})]}),h&&!d&&e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>m("email",u.email),className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",children:e.jsx(se,{className:"w-4 h-4"})})]}),o?.field==="email"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{value:o.value,onChange:D=>C({...o,value:D.target.value}),placeholder:"business@example.com",type:"email",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{size:"sm",onClick:()=>N("email",o.value),children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsx(f,{size:"sm",variant:"outline",onClick:j,children:"Cancel"})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:u.email||(h&&!d?"Add email address":null)})]}),(u.website||h&&!d)&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ot,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Website"})]}),h&&!d&&e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>m("website",u.website),className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",children:e.jsx(se,{className:"w-4 h-4"})})]}),o?.field==="website"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{value:o.value,onChange:D=>C({...o,value:D.target.value}),placeholder:"https://example.com",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{size:"sm",onClick:()=>N("website",o.value),children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsx(f,{size:"sm",variant:"outline",onClick:j,children:"Cancel"})]})]}):u.website?e.jsx("a",{href:u.website,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline",children:u.website}):h&&!d&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add website URL"})]}),(u.facebook||u.instagram||u.whatsapp||u.tiktok||h&&!d)&&e.jsxs(e.Fragment,{children:[e.jsx(Is,{className:"my-4"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx($t,{className:"w-4 h-4"}),"Social Media & Online Presence"]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[(u.facebook||h&&!d)&&e.jsx(e.Fragment,{children:o?.field==="facebook"?e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(W,{value:o.value,onChange:D=>C({...o,value:D.target.value}),placeholder:"facebook.com/yourpage",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{size:"sm",onClick:()=>N("facebook",o.value),children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsx(f,{size:"sm",variant:"outline",onClick:j,children:"Cancel"})]})]}):u.facebook?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("a",{href:u.facebook.startsWith("http")?u.facebook:`https://facebook.com/${u.facebook.replace("facebook.com/","").replace("@","")}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center w-10 h-10 rounded-full bg-blue-50 hover:bg-blue-100 transition-colors group",children:e.jsx(la,{className:"w-5 h-5 text-blue-600 group-hover:text-blue-700"})}),h&&!d&&e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>m("facebook",u.facebook),className:"h-6 w-6 p-0 opacity-60 hover:opacity-100",children:e.jsx(se,{className:"w-3 h-3"})})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-blue-50 border border-blue-200",children:e.jsx(la,{className:"w-5 h-5 text-blue-600"})}),h&&!d&&e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>m("facebook",u.facebook||""),className:"h-6 w-6 p-0 opacity-60 hover:opacity-100",children:e.jsx(se,{className:"w-3 h-3"})})]})}),(u.instagram||h&&!d)&&e.jsx(e.Fragment,{children:o?.field==="instagram"?e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(W,{value:o.value,onChange:D=>C({...o,value:D.target.value}),placeholder:"instagram.com/yourprofile",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{size:"sm",onClick:()=>N("instagram",o.value),children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsx(f,{size:"sm",variant:"outline",onClick:j,children:"Cancel"})]})]}):u.instagram?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("a",{href:u.instagram.startsWith("http")?u.instagram:`https://instagram.com/${u.instagram.replace("instagram.com/","").replace("@","")}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center w-10 h-10 rounded-full bg-pink-50 hover:bg-pink-100 transition-colors group",children:e.jsx(oa,{className:"w-5 h-5 text-pink-600 group-hover:text-pink-700"})}),h&&!d&&e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>m("instagram",u.instagram),className:"h-6 w-6 p-0 opacity-60 hover:opacity-100",children:e.jsx(se,{className:"w-3 h-3"})})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-pink-50 border border-pink-200",children:e.jsx(oa,{className:"w-5 h-5 text-pink-600"})}),h&&!d&&e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>m("instagram",u.instagram||""),className:"h-6 w-6 p-0 opacity-60 hover:opacity-100",children:e.jsx(se,{className:"w-3 h-3"})})]})}),(u.whatsapp||h&&!d)&&e.jsx(e.Fragment,{children:o?.field==="whatsapp"?e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(W,{value:o.value,onChange:D=>C({...o,value:D.target.value}),placeholder:"+1234567890 or wa.me/1234567890",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{size:"sm",onClick:()=>N("whatsapp",o.value),children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsx(f,{size:"sm",variant:"outline",onClick:j,children:"Cancel"})]})]}):u.whatsapp?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("a",{href:u.whatsapp.startsWith("http")?u.whatsapp:`https://wa.me/${u.whatsapp.replace("+","").replace("whatsapp.com/","").replace("wa.me/","")}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center w-10 h-10 rounded-full bg-green-50 hover:bg-green-100 transition-colors group",children:e.jsx(Ke,{className:"w-5 h-5 text-green-600 group-hover:text-green-700"})}),h&&!d&&e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>m("whatsapp",u.whatsapp),className:"h-6 w-6 p-0 opacity-60 hover:opacity-100",children:e.jsx(se,{className:"w-3 h-3"})})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-green-50 border border-green-200",children:e.jsx(Ke,{className:"w-5 h-5 text-green-600"})}),h&&!d&&e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>m("whatsapp",u.whatsapp||""),className:"h-6 w-6 p-0 opacity-60 hover:opacity-100",children:e.jsx(se,{className:"w-3 h-3"})})]})}),(u.tiktok||h&&!d)&&e.jsx(e.Fragment,{children:o?.field==="tiktok"?e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(W,{value:o.value,onChange:D=>C({...o,value:D.target.value}),placeholder:"Enter TikTok username or URL",className:"text-sm"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{size:"sm",onClick:()=>N("tiktok"),children:[e.jsx(be,{className:"w-3 h-3 mr-1"}),"Save"]}),e.jsx(f,{size:"sm",variant:"outline",onClick:j,children:"Cancel"})]})]}):u.tiktok?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("a",{href:u.tiktok.startsWith("http")?u.tiktok:`https://tiktok.com/@${u.tiktok.replace("@","").replace("tiktok.com/","")}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center w-10 h-10 rounded-full bg-black hover:bg-gray-800 transition-colors group",children:e.jsx(ca,{className:"w-5 h-5 text-white group-hover:text-gray-200"})}),h&&!d&&e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>m("tiktok",u.tiktok),className:"h-6 w-6 p-0 opacity-60 hover:opacity-100",children:e.jsx(se,{className:"w-3 h-3"})})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-black border border-gray-300",children:e.jsx(ca,{className:"w-5 h-5 text-white"})}),h&&!d&&e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>m("tiktok",u.tiktok||""),className:"h-6 w-6 p-0 opacity-60 hover:opacity-100",children:e.jsx(se,{className:"w-3 h-3"})})]})})]})]})]}),h&&!d&&!u.phone&&!u.email&&!u.website&&!u.facebook&&!u.instagram&&!u.whatsapp&&!u.tiktok&&e.jsxs("div",{className:"text-center py-4 text-sm text-muted-foreground bg-muted/30 rounded-lg",children:[e.jsx(qe,{className:"w-8 h-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"font-medium",children:"Add contact information"}),e.jsx("p",{children:"Help customers reach you easily"})]})]})]}),(s.certifications.length>0||u.specialties.length>0||h&&!d)&&e.jsxs(R,{className:"border-primary/30",children:[e.jsx(Y,{children:e.jsxs(K,{className:"text-lg flex items-center gap-2",children:[e.jsx(ls,{className:"w-5 h-5"}),"Certifications & Specialties"]})}),e.jsxs(E,{className:"space-y-4",children:[s.certifications.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Certifications"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.certifications.map((D,S)=>e.jsxs(U,{variant:"outline",className:"text-xs",children:[e.jsx(ee,{className:"w-3 h-3 mr-1 text-green-600"}),D]},S))})]}),(u.specialties.length>0||h&&!d)&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Specialties"}),h&&!d&&e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>m("specialties",""),className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",title:"Add specialty",children:e.jsx(is,{className:"w-4 h-4"})})]}),o?.field==="specialties"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{value:o.value,onChange:D=>C({...o,value:D.target.value}),placeholder:"e.g., Organic Vegetables, Rice Varieties",autoFocus:!0,onKeyDown:D=>{D.key==="Enter"&&M(o.value),D.key==="Escape"&&j()}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{size:"sm",onClick:()=>M(o.value),disabled:!o.value.trim(),children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),"Add"]}),e.jsx(f,{size:"sm",variant:"outline",onClick:j,children:"Cancel"})]})]}):e.jsx("div",{className:"flex flex-wrap gap-2 min-h-[2rem] items-center",children:u.specialties.length>0?u.specialties.map((D,S)=>e.jsxs(U,{variant:"secondary",className:"text-xs flex items-center gap-1",children:[D,h&&!d&&e.jsx("button",{onClick:()=>_(D),className:"hover:text-destructive transition-colors",title:"Remove specialty",children:e.jsx(Le,{className:"w-3 h-3"})})]},S)):h&&!d&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add your specialties"})})]}),h&&!d&&s.certifications.length===0&&u.specialties.length===0&&e.jsxs("div",{className:"text-center py-4 text-sm text-muted-foreground bg-muted/30 rounded-lg",children:[e.jsx(ls,{className:"w-8 h-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"font-medium",children:"Showcase your expertise"}),e.jsx("p",{children:"Add certifications and specialties to build customer trust"})]})]})]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(R,{className:"border-primary/30",children:[e.jsx(Y,{children:e.jsxs(K,{className:"flex items-center justify-between",children:["About ",s.name,h&&!d&&e.jsxs(f,{size:"sm",variant:"ghost",onClick:()=>m("description",u.description),className:"opacity-60 hover:opacity-100",children:[e.jsx(se,{className:"w-4 h-4 mr-1"}),"Edit Description"]})]})}),e.jsx(E,{children:o?.field==="description"?e.jsxs("div",{className:"space-y-3",children:[e.jsx(ze,{value:o.value,onChange:D=>C({...o,value:D.target.value}),placeholder:"Tell customers about your business, experience, farming methods, quality standards, and what makes you unique...",rows:6,autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{onClick:()=>N("description",o.value),children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),"Save Description"]}),e.jsx(f,{variant:"outline",onClick:j,children:"Cancel"})]})]}):e.jsx("div",{className:"space-y-4",children:e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:u.description||(h&&!d?'Tell customers about your business. Click "Edit Description" to add information about your farming experience, quality standards, and what makes your products special.':"No description available.")})})})]}),(u.policies.delivery||u.policies.payment||u.policies.returns||h&&!d)&&e.jsxs(R,{className:"border-primary/30",children:[e.jsx(Y,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"w-5 h-5"}),"Business Policies"]})}),e.jsxs(E,{className:"space-y-4",children:[(u.policies.delivery||h&&!d)&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:"Delivery & Shipping"}),h&&!d&&e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>m("delivery",u.policies.delivery),className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",children:e.jsx(se,{className:"w-4 h-4"})})]}),o?.field==="delivery"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{value:o.value,onChange:D=>C({...o,value:D.target.value}),placeholder:"Describe your delivery options, areas covered, delivery times, and shipping costs...",rows:3,autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{size:"sm",onClick:()=>{y(D=>({...D,policies:{...D.policies,delivery:o.value}})),N("policies",{...u.policies,delivery:o.value})},children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsx(f,{size:"sm",variant:"outline",onClick:j,children:"Cancel"})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:u.policies.delivery||h&&!d&&"Add your delivery and shipping information"})]}),(u.policies.payment||h&&!d)&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:"Payment Methods"}),h&&!d&&e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>m("payment",u.policies.payment),className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",children:e.jsx(se,{className:"w-4 h-4"})})]}),o?.field==="payment"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{value:o.value,onChange:D=>C({...o,value:D.target.value}),placeholder:"List accepted payment methods: Cash on delivery, bank transfer, mobile payments, etc...",rows:3,autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{size:"sm",onClick:()=>{y(D=>({...D,policies:{...D.policies,payment:o.value}})),N("policies",{...u.policies,payment:o.value})},children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsx(f,{size:"sm",variant:"outline",onClick:j,children:"Cancel"})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:u.policies.payment||h&&!d&&"Add your accepted payment methods"})]}),(u.policies.returns||h&&!d)&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:"Returns & Quality Guarantee"}),h&&!d&&e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>m("returns",u.policies.returns),className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",children:e.jsx(se,{className:"w-4 h-4"})})]}),o?.field==="returns"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{value:o.value,onChange:D=>C({...o,value:D.target.value}),placeholder:"Describe your quality guarantee, return policy, and how you handle customer concerns...",rows:3,autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{size:"sm",onClick:()=>{y(D=>({...D,policies:{...D.policies,returns:o.value}})),N("policies",{...u.policies,returns:o.value})},children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsx(f,{size:"sm",variant:"outline",onClick:j,children:"Cancel"})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:u.policies.returns||h&&!d&&"Add your quality guarantee and return policy"})]}),h&&!d&&!u.policies.delivery&&!u.policies.payment&&!u.policies.returns&&e.jsxs("div",{className:"text-center py-4 text-sm text-muted-foreground bg-muted/30 rounded-lg",children:[e.jsx(rs,{className:"w-8 h-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"font-medium",children:"Build customer trust"}),e.jsx("p",{children:"Add your business policies to help customers understand your services"})]})]})]}),e.jsxs(R,{className:"border-primary/30",children:[e.jsx(Y,{children:e.jsxs(K,{children:["Products (",F," ",F===1?"item":"items",")"]})}),e.jsx(E,{children:a.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(he,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:h?"You haven't listed any products yet. Go to your Dashboard to add and manage products.":"No products available at the moment."})]}):e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:a.map(D=>e.jsx(R,{className:"hover:shadow-md transition-shadow border-primary/30 cursor-pointer",onClick:()=>r(D.id),children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("img",{src:D.image,alt:D.name,className:"w-20 h-20 object-cover rounded-lg"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:D.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-lg font-semibold",children:[P(D.price)," MMK"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["per ",D.unit]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(he,{className:"w-3 h-3"}),e.jsx("span",{children:D.quantity})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[D.priceChange>0?e.jsx(ea,{className:"w-3 h-3 text-green-600"}):e.jsx($s,{className:"w-3 h-3 text-red-600"}),e.jsxs("span",{className:`text-xs ${D.priceChange>0?"text-green-600":"text-red-600"}`,children:[D.priceChange>0?"+":"",D.priceChange,"%"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["• ",us(D.lastUpdated)]})]}),!h&&e.jsxs(f,{size:"sm",variant:"outline",className:"w-full h-8 text-xs mt-2",onClick:S=>{S.stopPropagation(),l(D.id)},children:[e.jsx(Qs,{className:"w-3 h-3 mr-1"}),k?"Chat with seller":"Sign in to chat"]}),h&&!d&&c&&e.jsxs(f,{size:"sm",variant:"outline",className:"w-full h-8 text-xs mt-2",onClick:S=>{S.stopPropagation(),c(D.id)},children:[e.jsx(se,{className:"w-3 h-3 mr-1"}),"Edit Product"]})]})]})})},D.id))})})]})]})]})]})}function Fr({selectedType:s,onTypeSelect:a,onBack:t,userType:r}){const l=[{id:"farmer",name:"Farmer",icon:Be,description:"Sell your agricultural products directly to buyers",features:["List products","Direct sales","Price setting","Customer management"],color:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200"},{id:"trader",name:"Trader",icon:es,description:"Distribute agricultural products to retailers and businesses",features:["Bulk trading","Supply chain","Wholesale pricing","Business partnerships"],color:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200"},{id:"buyer",name:"Buyer",icon:Ys,description:"Purchase agricultural products for your business or personal use",features:["Browse products","Price comparison","Direct contact","Order tracking"],color:"text-purple-600",bgColor:"bg-purple-50",borderColor:"border-purple-200"}];return e.jsxs("div",{className:"space-y-4",children:[t&&e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(f,{variant:"ghost",size:"sm",onClick:t,children:[e.jsx(Ut,{className:"w-4 h-4 mr-2"}),"Back"]})}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Choose Your Account Type"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select the type that best describes your role in the agricultural marketplace"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:l.map(c=>{const h=c.icon,v=s===c.id;return e.jsxs(R,{className:`cursor-pointer transition-all duration-200 hover:shadow-md ${v?`${c.borderColor} border-2 shadow-md`:"border hover:border-gray-300"}`,onClick:()=>a?.(c.id),children:[e.jsx(Y,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${c.bgColor}`,children:e.jsx(h,{className:`w-5 h-5 ${c.color}`})}),e.jsxs("div",{children:[e.jsx(K,{className:"text-base",children:c.name}),v&&e.jsx(U,{variant:"secondary",className:"mt-1",children:"Selected"})]})]})}),e.jsxs(E,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:c.description}),e.jsx("div",{className:"space-y-1",children:c.features.map((i,d)=>e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-muted-foreground",children:[e.jsx(ae,{className:"w-3 h-3"}),e.jsx("span",{children:i})]},d))})]})]},c.id)})}),e.jsx("div",{className:"bg-muted/50 rounded-lg p-4 text-center",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Note:"})," You can change your account type later in your profile settings. Different account types have different features and capabilities."]})})]})}function ya({onRegister:s,onSwitchToLogin:a,onClose:t}){const[r,l]=n.useState({name:"",email:"",password:"",confirmPassword:"",phone:"",userType:"",accountType:"",region:"",location:""}),[c,h]=n.useState(!1),[v,i]=n.useState(!1),[d,b]=n.useState(""),[k,o]=n.useState(!1),[C,p]=n.useState(!1);if(C)return e.jsx("div",{className:"absolute inset-0 bg-background",children:e.jsx(Fr,{onBack:()=>p(!1),userType:r.userType})});const w=()=>r.region?Ie[r.region]?.cities||[]:[],x=[{value:"farmer",label:"Farmer",description:"I grow and produce fresh agricultural products to sell",color:"bg-green-100 text-green-800 border-green-200"},{value:"trader",label:"Trader",description:"I connect farmers with buyers through distribution and trading",color:"bg-primary/10 text-primary border-primary/20"},{value:"buyer",label:"Buyer",description:"I purchase agricultural products for my business or personal consumption",color:"bg-purple-100 text-purple-800 border-purple-200"}],g=()=>!r.name||!r.email||!r.password?(b("Please fill in all required fields in the Personal Information section"),!1):r.password!==r.confirmPassword?(b("Passwords do not match"),!1):r.password.length<6?(b("Password must be at least 6 characters long"),!1):r.email.includes("@")?!r.userType||!r.accountType||!r.region||!r.location?(b("Please select your user role, account type, region, and city"),!1):!0:(b("Please enter a valid email address"),!1),u=async j=>{if(j.preventDefault(),b(""),!!g()&&!k){o(!0);try{const N={email:r.email,password:r.password,name:r.name,userType:r.userType,accountType:r.accountType,location:r.location,region:r.region,phone:r.phone,businessName:"",businessDescription:"",experience:"1 year",qualityCertifications:[],farmingMethods:r.userType==="farmer"?["Traditional"]:[]};await s(N)}catch(N){b(N.message||"Registration failed. Please try again.")}finally{o(!1)}}},y=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"name",children:"Full Name *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Pe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(W,{id:"name",placeholder:"Enter your full name",value:r.name,onChange:j=>l(N=>({...N,name:j.target.value})),className:"pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"email",children:"Email Address *"}),e.jsxs("div",{className:"relative",children:[e.jsx(cs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(W,{id:"email",type:"email",placeholder:"Enter your email",value:r.email,onChange:j=>l(N=>({...N,email:j.target.value})),className:"pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"phone",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(W,{id:"phone",placeholder:"+95 9 123 456 789",value:r.phone,onChange:j=>l(N=>({...N,phone:j.target.value})),className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"password",children:"Password *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Os,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(W,{id:"password",type:c?"text":"password",placeholder:"Create a password (min. 6 characters)",value:r.password,onChange:j=>l(N=>({...N,password:j.target.value})),className:"pl-10 pr-10",required:!0}),e.jsx("button",{type:"button",onClick:()=>h(!c),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground",children:c?e.jsx(ys,{className:"w-4 h-4"}):e.jsx(ge,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"confirmPassword",children:"Confirm Password *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Os,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(W,{id:"confirmPassword",type:v?"text":"password",placeholder:"Confirm your password",value:r.confirmPassword,onChange:j=>l(N=>({...N,confirmPassword:j.target.value})),className:"pl-10 pr-10",required:!0}),e.jsx("button",{type:"button",onClick:()=>i(!v),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground",children:v?e.jsx(ys,{className:"w-4 h-4"}):e.jsx(ge,{className:"w-4 h-4"})})]})]})]}),m=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(O,{children:"Your Role *"}),e.jsx("div",{className:"space-y-2",children:x.map(j=>e.jsx("div",{onClick:()=>l(N=>({...N,userType:j.value})),className:`p-4 rounded-lg border cursor-pointer transition-all ${r.userType===j.value?"border-primary/80 bg-primary/8":"border-primary/50 hover:border-primary/70"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-medium",children:j.label})}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:j.description})]}),e.jsx("div",{className:`w-4 h-4 rounded-full border-2 ${r.userType===j.value?"border-primary bg-primary":"border-primary/50"}`})]})},j.value))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(O,{children:"Account Type *"}),e.jsxs(f,{variant:"ghost",size:"sm",onClick:()=>p(!0),className:"text-primary hover:text-primary/80 h-auto p-1",children:[e.jsx(Ht,{className:"w-4 h-4 mr-1"}),"Learn More"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose the account type that best fits your operation and available documents."}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{onClick:()=>l(j=>({...j,accountType:"individual"})),className:`p-4 rounded-lg border cursor-pointer transition-all ${r.accountType==="individual"?"border-primary/80 bg-primary/8":"border-primary/50 hover:border-primary/70"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"font-medium",children:"Individual Account"})]}),e.jsx("div",{className:`w-5 h-5 rounded-full border-2 ${r.accountType==="individual"?"border-primary bg-primary":"border-primary/50"}`,children:r.accountType==="individual"&&e.jsx("div",{className:"w-full h-full rounded-full bg-white scale-50"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.userType==="buyer"?"Perfect for individual consumers, small restaurants, and personal purchases.":r.userType?"Perfect for individual farmers, small operations, and personal trading.":"Perfect for individual farmers, traders, and personal operations."})]}),e.jsxs("div",{onClick:()=>l(j=>({...j,accountType:"business"})),className:`p-4 rounded-lg border cursor-pointer transition-all ${r.accountType==="business"?"border-primary/80 bg-primary/8":"border-primary/50 hover:border-primary/70"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"font-medium",children:"Business Account"})]}),e.jsx("div",{className:`w-5 h-5 rounded-full border-2 ${r.accountType==="business"?"border-primary bg-primary":"border-primary/50"}`,children:r.accountType==="business"&&e.jsx("div",{className:"w-full h-full rounded-full bg-white scale-50"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.userType==="buyer"?"For hotels, restaurants, distributors, and large-scale purchasing operations.":(r.userType,"For registered businesses, companies, and formal operations.")})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(O,{children:"Location *"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4 z-10"}),e.jsxs(ce,{value:r.region,onValueChange:j=>l(N=>({...N,region:j,location:""})),children:[e.jsx(me,{className:"pl-10",children:e.jsx(de,{placeholder:"Select your region"})}),e.jsx(ue,{className:"max-h-64 overflow-y-auto",children:Object.entries(Ie).map(([j,N])=>e.jsx(B,{value:j,children:N.name},j))})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4 z-10"}),e.jsxs(ce,{value:r.location,onValueChange:j=>l(N=>({...N,location:j})),disabled:!r.region,children:[e.jsx(me,{className:"pl-10",children:e.jsx(de,{placeholder:"Select your city/town"})}),e.jsx(ue,{className:"max-h-64 overflow-y-auto",children:w().map(j=>e.jsx(B,{value:j,children:j},j))})]})]})]}),!r.region&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Please select a region first"})]})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("h1",{className:"text-2xl font-semibold flex items-center justify-center gap-2 mb-2",children:[e.jsx(Be,{className:"w-6 h-6 text-primary"}),"Join AgriLink"]}),e.jsx("p",{className:"text-muted-foreground",children:"Create your account to connect with Myanmar's agricultural community"})]}),e.jsxs("form",{onSubmit:u,className:"space-y-8",children:[d&&e.jsx(_e,{variant:"destructive",children:e.jsx(Te,{children:d})}),e.jsxs(R,{children:[e.jsx(Y,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5"}),"Personal Information"]})}),e.jsx(E,{className:"space-y-4",children:y()})]}),e.jsxs(R,{children:[e.jsx(Y,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5"}),"Role, Account Type & Location"]})}),e.jsx(E,{className:"space-y-4",children:m()})]}),e.jsx(R,{children:e.jsx(E,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(f,{type:"submit",className:"w-full",disabled:k,children:k?"Creating Account...":"Create Account"}),e.jsx("div",{className:"text-center",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Already have an account?"," ",e.jsx("button",{type:"button",onClick:a,className:"text-primary hover:underline font-medium",children:"Sign in here"})]})})]})})})]})]})}function Mr({onBack:s,onReturnToLogin:a}){const[t,r]=n.useState("email"),[l,c]=n.useState(""),[h,v]=n.useState(""),[i,d]=n.useState(""),[b,k]=n.useState(""),[o,C]=n.useState(!1),[p,w]=n.useState(!1),[x,g]=n.useState(!1),[u,y]=n.useState({}),m=async _=>{if(_.preventDefault(),y({}),!l){y({email:"Email is required"});return}if(!l.includes("@")){y({email:"Please enter a valid email address"});return}g(!0),await new Promise(P=>setTimeout(P,1500)),g(!1),r("verification")},j=async _=>{if(_.preventDefault(),y({}),!h){y({code:"Verification code is required"});return}if(h.length!==6){y({code:"Please enter the 6-digit code"});return}if(h!=="123456"&&!/^\d{6}$/.test(h)){y({code:"Invalid verification code. Try 123456 for demo."});return}g(!0),await new Promise(P=>setTimeout(P,1e3)),g(!1),r("password")},N=async _=>{if(_.preventDefault(),y({}),!i){y({password:"New password is required"});return}if(i.length<6){y({password:"Password must be at least 6 characters"});return}if(i!==b){y({confirmPassword:"Passwords do not match"});return}g(!0),await new Promise(P=>setTimeout(P,2e3)),g(!1),r("success")},M=async()=>{g(!0),await new Promise(_=>setTimeout(_,1e3)),g(!1)};return e.jsx("div",{className:"min-h-screen bg-background py-6 px-4",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("h1",{className:"text-2xl font-semibold flex items-center justify-center gap-2 mb-2",children:[e.jsx(Be,{className:"w-6 h-6 text-primary"}),"Reset Password"]}),e.jsx("p",{className:"text-muted-foreground",children:"Secure password recovery for your AgriLink account"})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-6",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${t==="email"||t!=="email"?"bg-primary":"bg-muted"}`}),e.jsx("div",{className:`w-8 h-1 ${t==="verification"||t==="code"||t==="password"||t==="success"?"bg-primary":"bg-muted"} rounded`}),e.jsx("div",{className:`w-3 h-3 rounded-full ${t==="verification"||t==="code"||t==="password"||t==="success"?"bg-primary":"bg-muted"}`}),e.jsx("div",{className:`w-8 h-1 ${t==="code"||t==="password"||t==="success"?"bg-primary":"bg-muted"} rounded`}),e.jsx("div",{className:`w-3 h-3 rounded-full ${t==="password"||t==="success"?"bg-primary":"bg-muted"}`}),e.jsx("div",{className:`w-8 h-1 ${t==="success"?"bg-primary":"bg-muted"} rounded`}),e.jsx("div",{className:`w-3 h-3 rounded-full ${t==="success"?"bg-primary":"bg-muted"}`})]}),e.jsxs(R,{className:"w-full",children:[e.jsxs(Y,{className:"space-y-1",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsxs("div",{className:"w-12 h-12 bg-primary rounded-lg flex items-center justify-center",children:[t==="email"&&e.jsx(cs,{className:"w-6 h-6 text-primary-foreground"}),(t==="verification"||t==="code")&&e.jsx(ae,{className:"w-6 h-6 text-primary-foreground"}),t==="password"&&e.jsx(ge,{className:"w-6 h-6 text-primary-foreground"}),t==="success"&&e.jsx(ee,{className:"w-6 h-6 text-primary-foreground"})]})}),e.jsxs(K,{className:"text-xl text-center",children:[t==="email"&&"Enter Your Email",t==="verification"&&"Check Your Email",t==="code"&&"Enter Verification Code",t==="password"&&"Set New Password",t==="success"&&"Password Reset Complete"]}),e.jsxs(Je,{className:"text-center",children:[t==="email"&&"We'll send you a verification code to reset your password",t==="verification"&&"We've sent a verification code to your email",t==="code"&&"Enter the 6-digit code from your email",t==="password"&&"Choose a strong new password for your account",t==="success"&&"Your password has been successfully updated"]})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsx(_e,{children:e.jsx(Te,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"🎭 Demo Mode Password Reset"}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[t==="email"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"• Enter any valid email address"}),e.jsx("p",{children:"• No actual email will be sent"})]}),(t==="verification"||t==="code")&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["• Use verification code: ",e.jsx("strong",{children:"123456"})]}),e.jsx("p",{children:"• Any 6-digit number will work"})]}),t==="password"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"• Choose any password (minimum 6 characters)"}),e.jsx("p",{children:"• This will simulate updating your password"})]}),t==="success"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"• Password reset simulation complete"}),e.jsx("p",{children:"• You can now sign in with any demo credentials"})]})]})]})})}),t==="email"&&e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(O,{htmlFor:"email",children:"Email Address"}),e.jsx(W,{id:"email",type:"email",value:l,onChange:_=>c(_.target.value),placeholder:"Enter your email address",className:u.email?"border-destructive":""}),u.email&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:u.email})]}),e.jsx(f,{type:"submit",className:"w-full h-11",disabled:x,children:x?"Sending...":"Send Verification Code"})]}),t==="verification"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-4 text-center",children:[e.jsx(cs,{className:"w-8 h-8 text-primary mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-primary",children:"Verification Email Sent!"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Check your email at ",e.jsx("strong",{children:l})]})]}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Didn't receive the email? Check your spam folder or"}),e.jsx(f,{variant:"ghost",size:"sm",onClick:M,disabled:x,children:x?"Resending...":"Resend Code"})]}),e.jsx(f,{onClick:()=>r("code"),className:"w-full h-11",children:"I Have the Code"})]}),t==="code"&&e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(O,{htmlFor:"code",children:"Verification Code"}),e.jsx(W,{id:"code",type:"text",value:h,onChange:_=>v(_.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"Enter 6-digit code",className:`text-center tracking-widest text-lg ${u.code?"border-destructive":""}`,maxLength:6}),u.code&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:u.code})]}),e.jsx("div",{className:"text-center",children:e.jsx(f,{type:"button",variant:"ghost",size:"sm",onClick:M,disabled:x,children:x?"Resending...":"Resend Code"})}),e.jsx(f,{type:"submit",className:"w-full h-11",disabled:x,children:x?"Verifying...":"Verify Code"})]}),t==="password"&&e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(O,{htmlFor:"new-password",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{id:"new-password",type:o?"text":"password",value:i,onChange:_=>d(_.target.value),placeholder:"Enter new password",className:u.password?"border-destructive pr-10":"pr-10"}),e.jsx(f,{type:"button",variant:"ghost",size:"sm",className:"absolute right-1 top-1 h-8 w-8 p-0",onClick:()=>C(!o),children:o?e.jsx(ys,{className:"w-4 h-4"}):e.jsx(ge,{className:"w-4 h-4"})})]}),u.password&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:u.password})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"confirm-password",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{id:"confirm-password",type:p?"text":"password",value:b,onChange:_=>k(_.target.value),placeholder:"Confirm new password",className:u.confirmPassword?"border-destructive pr-10":"pr-10"}),e.jsx(f,{type:"button",variant:"ghost",size:"sm",className:"absolute right-1 top-1 h-8 w-8 p-0",onClick:()=>w(!p),children:p?e.jsx(ys,{className:"w-4 h-4"}):e.jsx(ge,{className:"w-4 h-4"})})]}),u.confirmPassword&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:u.confirmPassword})]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsx("p",{children:"Password requirements:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[e.jsx("li",{className:i.length>=6?"text-primary":"",children:"At least 6 characters"}),e.jsx("li",{className:i!==b||!b?"":"text-primary",children:"Passwords match"})]})]}),e.jsx(f,{type:"submit",className:"w-full h-11",disabled:x,children:x?"Updating Password...":"Update Password"})]}),t==="success"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6 text-center",children:[e.jsx(ee,{className:"w-12 h-12 text-green-600 mx-auto mb-3"}),e.jsx("h3",{className:"font-medium text-green-800 mb-2",children:"Password Reset Successful!"}),e.jsx("p",{className:"text-sm text-green-700",children:"Your password has been updated successfully. You can now sign in with your new password."})]}),e.jsx(f,{onClick:a,className:"w-full h-11",children:"Return to Sign In"})]}),(t==="email"||t==="verification")&&e.jsx("div",{className:"pt-4 border-t",children:e.jsxs(f,{type:"button",variant:"ghost",onClick:s,className:"w-full",children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"Back to Sign In"]})}),(t==="code"||t==="password")&&e.jsx("div",{className:"pt-4 border-t",children:e.jsx("div",{className:"text-center",children:e.jsx(f,{type:"button",variant:"ghost",size:"sm",onClick:()=>r("email"),children:"Use Different Email"})})})]})]})]})})}function Vr(s){if(!s)return"unit";const a=s.toLowerCase(),t=["sack","sacks","bag","bags","basket","baskets","crate","crates","box","boxes","carton","cartons","bottle","bottles","jar","jars","can","cans","pack","packs","bundle","bundles","bunch","bunches"];for(const c of t)if(a.includes(c))return c.endsWith("s")?c:c+"s";const r=a.split(/[^\w]+/),l=r[r.length-1];return l&&l.length>1?l.endsWith("s")?l:l+"s":"units"}function zr({user:s,userProducts:a,onAddListing:t,onEditListing:r,onDeleteListing:l,onViewStorefront:c,onGoToMarketplace:h,onViewProduct:v,onShowVerification:i,onViewMessages:d}){const b=x=>{if(x.variations&&x.variations.length>0){const g=x.variations.filter(u=>u.price&&u.price>0);if(g.length===0)return{price:"Contact for price",unit:"",showUnit:!1};if(g.length===1){const u=g[0],y=u.quantity?`${u.quantity} ${u.unit}`:u.unit||Vr(u.name);return{price:`${new Intl.NumberFormat("en-US").format(u.price)} MMK`,unit:y,showUnit:!0}}else{const u=g.map(m=>m.price),y=Math.min(...u);return{price:`From ${new Intl.NumberFormat("en-US").format(y)} MMK`,unit:"multiple options",showUnit:!0}}}else return x.price&&x.price>0?{price:`${new Intl.NumberFormat("en-US").format(x.price)} MMK`,unit:x.unit,showUnit:!!x.unit}:{price:"Contact for price",unit:"",showUnit:!1}},k=a.length;a.slice(0,3);const[o,C]=n.useState(null),[p,w]=n.useState(!0);return n.useEffect(()=>{const x=async()=>{try{w(!0);const g=await Fs.getUserAnalytics(s.id);C(g)}catch(g){console.error("Error fetching analytics:",g),C({currentMonth:{monthlyInquiries:Math.floor(k*(s.verified?8:3)),monthlyProfileViews:Math.floor(k*(s.verified?25:12)),monthlyProductViews:Math.floor(k*(s.verified?15:8)),totalInquiries:0,totalProfileViews:0,totalProductViews:0},lastMonth:{monthlyInquiries:0,monthlyProfileViews:0,monthlyProductViews:0,totalInquiries:0,totalProfileViews:0,totalProductViews:0},growth:{inquiries:0,profileViews:0,productViews:0}})}finally{w(!1)}};s.id&&x()},[s.id,k,s.verified]),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary/10 via-primary/5 to-amber-900/10 rounded-xl p-6 border border-primary/30",children:e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold",children:["Welcome back, ",s.name.split(" ")[0],"!"]}),e.jsxs("p",{className:"text-muted-foreground flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),s.businessName||`${s.name}'s ${s.userType==="farmer"?"Farm":"Trading"}`," • ",s.location]})]})}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Rs,{className:"w-4 h-4"}),e.jsxs("span",{children:["Member since ",Es(s.joinedDate)]})]}),s.verified?e.jsxs(U,{variant:"secondary",className:"bg-emerald-100 text-emerald-800 border-emerald-300",children:[e.jsx(ee,{className:"w-3 h-3 mr-1"}),"Verified"]}):e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Ns,{userType:s.userType,accountType:ms(s),verificationLevel:Ye(s),size:"sm"})})]})]})})}),(()=>{const g=(()=>{if(s.verified)return"verified";if(s.verificationStatus==="under_review"||s.verificationSubmitted)return"under-review";const u=s.phoneVerified===!0,y=s.verificationDocuments?.idCard==="uploaded"||s.verificationDocuments?.idCard==="approved",m=s.businessDetailsCompleted;return console.log("🔍 Verification Progress Debug:",{userId:s.id,userType:s.userType,phoneVerified:s.phoneVerified,hasPhoneVerification:u,verificationStatus:s.verificationStatus,verificationSubmitted:s.verificationSubmitted,verificationDocuments:s.verificationDocuments,hasDocuments:y,hasBusinessDetails:m}),s.userType==="buyer"?s.accountType==="business"?u||y||m?"in-progress":"not-started":u?"verified":"not-started":u||y||m?"in-progress":"not-started"})();return g==="verified"?e.jsxs(_e,{className:"border-emerald-200 bg-gradient-to-r from-emerald-50 to-emerald-100",children:[e.jsx(ee,{className:"h-5 w-5",style:{color:"#059669"}}),e.jsx(Te,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"font-semibold text-emerald-700",children:"AgriLink Verification Complete"})}),e.jsx("p",{className:"text-sm text-emerald-600",children:"Your account is fully verified! You now have enhanced buyer trust and credibility on the platform."})]}),e.jsx("div",{className:"flex justify-end sm:justify-start",children:e.jsx(f,{size:"sm",variant:"outline",className:"border-emerald-300 text-emerald-700 hover:bg-emerald-50 shrink-0",onClick:()=>{console.log("👀 View Verification clicked"),i()},children:"View Details"})})]})})]}):g==="under-review"?e.jsxs(_e,{className:"border-blue-200 bg-gradient-to-r from-blue-50 to-blue-100",children:[e.jsx(ae,{className:"h-5 w-5",style:{color:"#2563eb"}}),e.jsx(Te,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"font-semibold text-blue-700",children:"Verification Under Review"})}),e.jsx("p",{className:"text-sm text-blue-600",children:"Your verification documents have been submitted. AgriLink team will review within 1-2 business days."})]}),e.jsx(f,{size:"sm",variant:"outline",className:"border-blue-300 text-blue-700 hover:bg-blue-50 shrink-0",onClick:()=>{console.log("🔍 Check Status clicked"),i()},children:"Check Status"})]})})]}):g==="in-progress"?e.jsxs(_e,{className:"border-amber-200 bg-gradient-to-r from-amber-50 to-amber-100",children:[e.jsx(ae,{className:"h-5 w-5",style:{color:"#d97706"}}),e.jsx(Te,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"font-semibold text-amber-700",children:"Complete Your Verification"})}),e.jsx("p",{className:"text-sm text-amber-600",children:"Your phone is verified! Complete ID verification to get the green verified badge and boost buyer trust."})]}),e.jsx(f,{size:"sm",className:"bg-amber-600 hover:bg-amber-700 text-white shrink-0",onClick:()=>{console.log("📋 Continue Verification clicked"),i()},children:"Continue Setup"})]})})]}):e.jsxs(_e,{className:"border-red-200 bg-gradient-to-r from-red-50 to-red-100",children:[e.jsx(ae,{className:"h-5 w-5",style:{color:"#dc2626"}}),e.jsx(Te,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"font-semibold text-red-700",children:"Boost Your Sales with Verification!"})}),e.jsxs("p",{className:"text-sm text-red-600",children:["Verified ",s.userType,"s get 3x more inquiries, featured listings, and buyer trust"]})]}),e.jsx(f,{size:"sm",className:"bg-red-600 hover:bg-red-700 text-white shrink-0",onClick:()=>{console.log("🚀 Start Verification clicked"),i()},children:"Start Verification"})]})})]})})(),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(R,{className:"hover:shadow-md transition-shadow border-primary/30",children:e.jsx(E,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Active Products"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:k}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:k>0?"Great inventory!":"Add your first product"})]}),e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(he,{className:"w-6 h-6 text-primary"})})]})})}),e.jsx(R,{className:"hover:shadow-md transition-shadow border-primary/30",children:e.jsx(E,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Monthly Inquiries"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:p?"...":o?.currentMonth.monthlyInquiries||0}),e.jsxs("p",{className:"text-xs text-primary/80 mt-1 flex items-center gap-1",children:[e.jsx(ea,{className:"w-3 h-3"}),p?"Loading...":o?.currentMonth.monthlyInquiries>0?o.growth.inquiries>0?`+${o.growth.inquiries}% this month`:o.growth.inquiries<0?`${o.growth.inquiries}% this month`:"Same as last month":"Add products to start"]})]}),e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(Ke,{className:"w-6 h-6 text-primary"})})]})})}),e.jsx(R,{className:"hover:shadow-md transition-shadow border-primary/30",children:e.jsx(E,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Profile Views"}),e.jsx("p",{className:"text-3xl font-bold text-primary",children:p?"...":o?.currentMonth.monthlyProfileViews||0}),e.jsxs("p",{className:"text-xs text-primary/80 mt-1 flex items-center gap-1",children:[e.jsx(ns,{className:"w-3 h-3"}),p?"Loading...":o?.currentMonth.monthlyProfileViews>0?o.growth.profileViews>0?`+${o.growth.profileViews}% this month`:o.growth.profileViews<0?`${o.growth.profileViews}% this month`:"Same as last month":"This month"]})]}),e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(ns,{className:"w-6 h-6 text-primary"})})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[e.jsxs(f,{onClick:x=>{x.preventDefault(),x.stopPropagation(),console.log("✨ Quick Add Product clicked - calling onAddListing"),console.log("onAddListing function:",typeof t);try{t(),console.log("✅ onAddListing called successfully")}catch(g){console.error("❌ Error calling onAddListing:",g)}},className:"h-12 justify-start gap-3 bg-primary hover:bg-primary/90",children:[e.jsx(is,{className:"w-5 h-5"}),"Add New Product"]}),e.jsxs(f,{onClick:()=>{console.log("👁️ View Storefront clicked"),c()},variant:"outline",className:"h-12 justify-start gap-3",children:[e.jsx(Xe,{className:"w-5 h-5"}),"View Storefront"]}),e.jsxs(f,{onClick:()=>{console.log("💬 Check Messages clicked"),d()},variant:"outline",className:"h-12 justify-start gap-3",children:[e.jsx(Ke,{className:"w-5 h-5"}),"Check Messages"]})]}),e.jsxs(R,{className:"border-primary/30",children:[e.jsx(Y,{children:e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:e.jsxs("div",{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5"}),"My Products (",k,")"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Manage your product listings and track performance"})]})})}),e.jsx(E,{children:k===0?e.jsxs("div",{className:"text-center py-12 space-y-6",children:[e.jsx("div",{className:"w-20 h-20 bg-muted/50 rounded-full flex items-center justify-center mx-auto",children:e.jsx(he,{className:"w-10 h-10 text-muted-foreground"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Ready to start selling?"}),e.jsxs("p",{className:"text-muted-foreground max-w-md mx-auto",children:["Add your first product to connect with buyers across Myanmar.",s.userType==="farmer"?" Share your fresh produce with customers who value quality.":" Start distributing quality agricultural products to retailers and businesses."]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(f,{onClick:x=>{x.preventDefault(),x.stopPropagation(),console.log("🎯 Add First Product clicked"),console.log("onAddListing function:",typeof t);try{t(),console.log("✅ First Product onAddListing called successfully")}catch(g){console.error("❌ Error calling first product onAddListing:",g)}},size:"lg",className:"h-12 px-8",children:[e.jsx(is,{className:"w-5 h-5 mr-2"}),"Add Your First Product"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Takes less than 5 minutes to create your first listing"})]})]}):e.jsxs("div",{className:"space-y-4",children:[a.map(x=>e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 p-4 border rounded-lg hover:bg-muted/30 transition-colors",children:[e.jsx("div",{className:"shrink-0",children:e.jsx("img",{src:x.image,alt:x.name,className:"w-full sm:w-20 h-48 sm:h-20 object-cover rounded-lg"})}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",children:x.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-primary text-base",children:b(x).price}),b(x).showUnit&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"/"}),e.jsx("span",{children:b(x).unit})]})]})]}),e.jsxs("div",{className:"flex gap-2 sm:shrink-0",children:[e.jsxs(f,{size:"sm",variant:"outline",onClick:()=>{console.log("👁️ View Product:",x.id),v(x.id)},className:"h-9",children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline ml-2",children:"View"})]}),e.jsxs(f,{size:"sm",variant:"outline",onClick:()=>{console.log("✏️ Edit Product:",x.id),r(x)},className:"h-9",children:[e.jsx(Gt,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline ml-2",children:"Edit"})]}),e.jsxs(f,{size:"sm",variant:"outline",onClick:()=>{console.log("🗑️ Delete Product:",x.id),confirm(`Are you sure you want to delete "${x.name}"?`)&&l(x.id)},className:"text-destructive hover:text-destructive h-9",children:[e.jsx(As,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline ml-2",children:"Delete"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(he,{className:"w-3 h-3"}),(()=>{if(x.variations&&x.variations.length>0){const g=x.variations.filter(u=>u.availableQuantity);if(g.length===1)return g[0].availableQuantity;if(g.length>1)return`${g.length} options`}return x.quantity||"Available"})()]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"w-3 h-3"}),x.location]}),e.jsxs("span",{children:["Updated ",us(x.lastUpdated)]})]})]})]},x.id)),k>5&&e.jsx("div",{className:"pt-4 border-t",children:e.jsxs(f,{variant:"outline",className:"w-full",onClick:()=>{console.log("🔍 View All Products clicked"),c()},children:["View All ",k," Products",e.jsx(Us,{className:"w-4 h-4 ml-2"})]})})]})})]})]})}function qr({user:s,allProducts:a,savedProducts:t,onGoToMarketplace:r,onViewProduct:l,onStartChat:c,onViewMessages:h}){const v=n.useMemo(()=>t.map(b=>{const k=a.find(w=>w.id===b.productId),o=k&&k.price!==b.priceWhenSaved,C=k&&k.price>b.priceWhenSaved,p=k&&k.price<b.priceWhenSaved;return{...b,product:k,priceChanged:o,priceIncrease:C,priceDecrease:p,currentPrice:k?.price||b.priceWhenSaved}}),[a,t]),i=n.useMemo(()=>{const b=t.length,k=t.filter(C=>C.alerts.priceAlert).length,o=v.filter(C=>C.priceDecrease&&C.alerts.priceAlert).length;return{savedProductsCount:b,priceAlertsActive:k,priceDropsDetected:o}},[t,v]),d=b=>new Intl.NumberFormat("en-US").format(b)+" MMK";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl md:text-3xl",children:["Welcome back, ",s.name,"!"]}),e.jsx("p",{className:"text-muted-foreground",children:"Your AgriLink buying dashboard"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(R,{children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(Ss,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Saved Products"}),e.jsx("p",{className:"text-xl",children:i.savedProductsCount})]})]})})}),e.jsx(R,{children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(Ma,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Price Alerts"}),e.jsx("p",{className:"text-xl text-orange-600",children:i.priceAlertsActive})]})]})})}),e.jsx(R,{children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx($s,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Price Drops"}),e.jsx("p",{className:"text-xl text-green-600",children:i.priceDropsDetected})]})]})})})]}),e.jsxs(R,{children:[e.jsxs(Y,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(Ss,{className:"w-5 h-5"}),"Your Saved Products (",v.length,")"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Track prices and get alerts on products you're interested in"})]}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-4",children:[v.map(b=>e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center space-y-3 md:space-y-0 md:space-x-4 p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"font-medium",children:b.product?.name||"Product Not Found"}),b.priceDecrease&&b.alerts.priceAlert&&e.jsxs(U,{variant:"secondary",className:"text-green-600",children:[e.jsx($s,{className:"w-3 h-3 mr-1"}),"Price Drop!"]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Saved at: ",d(b.priceWhenSaved)]}),e.jsx("span",{className:"hidden md:inline",children:"•"}),e.jsxs("span",{children:["Current: ",d(b.currentPrice)]}),b.priceChanged&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden md:inline",children:"•"}),e.jsxs("span",{className:b.priceDecrease?"text-green-600":"text-red-600",children:[b.priceDecrease?"↓":"↑"," ",d(Math.abs(b.currentPrice-b.priceWhenSaved))," change"]})]})]}),b.product&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Seller: ",b.product.sellerName," • ",b.product.location]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2",children:[e.jsxs(f,{variant:"outline",size:"sm",className:"w-full md:w-auto",onClick:()=>b.product&&l(b.productId),disabled:!b.product,children:[e.jsx(ge,{className:"w-4 h-4 mr-1"}),"View Product"]}),e.jsxs(f,{size:"sm",className:"w-full md:w-auto",onClick:()=>b.product&&c(b.productId,b.product.sellerId),disabled:!b.product,children:[e.jsx(Qs,{className:"w-4 h-4 mr-1"}),"Contact Seller"]})]})]},b.productId)),v.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ss,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No saved products yet"}),e.jsx("p",{className:"text-muted-foreground",children:"Start saving products to track their prices and get notified when prices drop. You can save products by clicking the heart icon on any product card in the marketplace."})]})]})})]})]})}class vs{static config=null;static async initialize(){try{this.config={accountSid:"supabase-managed",authToken:"supabase-managed",phoneNumber:"supabase-managed"},console.log("✅ Twilio service initialized with Supabase Edge Functions")}catch(a){console.error("❌ Failed to initialize Twilio service:",a)}}static async sendVerificationSMS(a){try{if(!V)throw new Error("Supabase not available");console.log("📱 Sending verification SMS via Supabase Edge Function..."),console.log("📱 Phone number being sent:",a);const{data:t,error:r}=await V.functions.invoke("send-verification-sms",{body:{phoneNumber:a}});if(r)throw console.error("❌ Supabase Edge Function error:",r),r;return console.log("✅ SMS sent successfully:",t),t}catch(t){throw console.error("❌ Error sending verification SMS:",t),t}}static async verifySMSCode(a,t){try{if(!V)throw new Error("Supabase not available");console.log("📱 Verifying SMS code via Supabase Edge Function...");const{data:r,error:l}=await V.functions.invoke("verify-sms-code",{body:{phoneNumber:a,code:t}});if(l)throw console.error("❌ Supabase Edge Function error:",l),l;return console.log("✅ SMS code verification result:",r),r}catch(r){throw console.error("❌ Error verifying SMS code:",r),r}}static async updateUserPhoneVerification(a,t,r=!0){try{if(!V)throw new Error("Supabase not available");const{error:l}=await V.from("users").update({phone:t,phone_verified:r,phone_verified_at:r?new Date().toISOString():null,updated_at:new Date().toISOString()}).eq("id",a);return l?(console.error("❌ Database update error:",l),{success:!1,error:l.message}):(console.log("✅ User phone verification status updated successfully"),{success:!0})}catch(l){return console.error("❌ Error updating user phone verification:",l),{success:!1,error:l.message}}}static isConfigured(){return!0}static async getVerificationStatus(a){try{if(!V)throw new Error("Supabase not available");const{data:t,error:r}=await V.from("users").select("phone, phone_verified, phone_verified_at").eq("id",a).single();return r?(console.error("❌ Error fetching verification status:",r),{phoneVerified:!1}):{phoneVerified:t.phone_verified||!1,phoneNumber:t.phone,phoneVerifiedAt:t.phone_verified_at}}catch(t){return console.error("❌ Error getting verification status:",t),{phoneVerified:!1}}}}vs.initialize();function Br({currentUser:s,onVerificationComplete:a,onBack:t}){const[r,l]=n.useState("phone"),[c,h]=n.useState(s.phone||"");n.useEffect(()=>{s.phone&&h(s.phone)},[s.phone]);const[v,i]=n.useState(""),[d,b]=n.useState(!1),[k,o]=n.useState(""),[C,p]=n.useState(0),[w,x]=n.useState(!1),[g,u]=n.useState(null),[y,m]=n.useState(!1);n.useEffect(()=>{x(vs.isConfigured())},[]);const j=()=>{p(60);const P=setInterval(()=>{p(F=>F<=1?(clearInterval(P),0):F-1)},1e3)},N=async()=>{if(!c.trim()){o("Please enter your phone number");return}if(!/^\+[1-9]\d{1,14}$/.test(c)){o("Please enter a valid phone number with country code (e.g., +959123456789)");return}b(!0),o("");try{console.log("📱 Sending verification SMS via Twilio...");const F=await vs.sendVerificationSMS(c);if(!F.success)throw new Error(F.message);u(F.verificationSid||null),H.success(F.message),l("otp"),j(),console.log("✅ Verification SMS sent successfully")}catch(F){console.error("❌ Send OTP error:",F),o(F.message||"Failed to send verification code. Please try again.")}finally{b(!1)}},M=async()=>{if(!v.trim()){o("Please enter the verification code");return}if(v.length!==6){o("Verification code must be 6 digits");return}b(!0),o("");try{console.log("📱 Verifying SMS code via Twilio...");const P=await vs.verifySMSCode(c,v);if(!P.success)throw new Error(P.message);console.log("📱 Updating user profile with phone verification:",{userId:s.id,phoneNumber:c});const F=await vs.updateUserPhoneVerification(s.id,c,!0);if(!F.success)throw new Error(F.error||"Failed to update user profile");console.log("✅ Phone verification completed successfully"),H.success("Phone number verified successfully!"),a(c)}catch(P){console.error("❌ Verify OTP error:",P),o(P.message||"Invalid verification code. Please try again.")}finally{b(!1)}},_=async()=>{C>0||(i(""),o(""),await N())};return e.jsxs(R,{className:"max-w-md mx-auto",children:[e.jsx(Y,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-5 h-5"}),"Phone Verification"]})}),e.jsx(E,{className:"space-y-4",children:r==="phone"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"phone",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{id:"phone",type:"tel",placeholder:c||"+959123456789",value:c,onChange:P=>h(P.target.value),disabled:d||!y,className:`pr-10 ${y?"":"bg-muted text-muted-foreground cursor-not-allowed"}`}),!y&&e.jsx(f,{type:"button",variant:"ghost",size:"sm",onClick:()=>m(!0),className:"absolute right-1 top-1/2 -translate-y-1/2 h-8 w-8 p-0 text-muted-foreground hover:text-foreground",children:e.jsx(se,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:y?"Enter your phone number with country code (e.g., +959 for Myanmar)":"Click the edit button to modify your phone number"})]}),e.jsxs(_e,{className:"border-green-200 bg-green-50",children:[e.jsx(ae,{className:"w-4 h-4 text-green-600"}),e.jsx(Te,{children:e.jsxs("span",{className:"text-green-800",children:[e.jsx("strong",{children:"Twilio Connected:"})," Real SMS verification enabled"]})})]}),k&&e.jsx(_e,{variant:"destructive",children:e.jsx(Te,{children:k})}),e.jsxs("div",{className:"flex gap-2",children:[t&&e.jsx(f,{variant:"outline",onClick:t,disabled:d,children:"Back"}),e.jsx(f,{onClick:N,disabled:d||!c.trim(),className:"flex-1",children:d?"Sending...":"Send Verification Code"}),y&&e.jsx(f,{variant:"outline",onClick:()=>{m(!1),h(s.phone||"")},className:"px-4",children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs(U,{variant:"outline",className:"bg-blue-50 text-blue-700",children:[e.jsx(Ce,{className:"w-3 h-3 mr-1"}),"Code Sent"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["We sent a 6-digit code to ",e.jsx("strong",{children:c})]}),!w&&e.jsx("p",{className:"text-xs text-yellow-600 font-medium",children:"Demo Mode: Use 123456 or any code ending in 00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"otp",children:"Verification Code"}),e.jsx(W,{id:"otp",type:"text",placeholder:"123456",value:v,onChange:P=>i(P.target.value.replace(/\D/g,"").slice(0,6)),disabled:d,className:"text-center text-lg tracking-widest",maxLength:6})]}),k&&e.jsx(_e,{variant:"destructive",children:e.jsx(Te,{children:k})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{onClick:M,disabled:d||v.length!==6,className:"w-full",children:d?"Verifying...":"Verify Phone Number"}),e.jsx("div",{className:"text-center",children:e.jsx(f,{variant:"ghost",size:"sm",onClick:_,disabled:C>0||d,children:C>0?`Resend in ${C}s`:"Resend Code"})}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>{l("phone"),i(""),o("")},className:"w-full",children:"Change Phone Number"})]})]})})]})}function Or({currentUser:s,onClose:a,onUpdate:t}){const[r,l]=n.useState(()=>{const S={};if(s.verificationDocuments){const A=s.verificationDocuments;A.idCard&&typeof A.idCard=="object"&&A.idCard.status&&A.idCard.status!=="pending"&&(S.idCard={file:null,url:"",name:A.idCard.name||"ID Card Document",verified:A.idCard.status==="verified",status:A.idCard.status}),A.businessLicense&&typeof A.businessLicense=="object"&&A.businessLicense.status&&A.businessLicense.status!=="pending"&&(S.businessLicense={file:null,url:"",name:A.businessLicense.name||"Business License Document",verified:A.businessLicense.status==="verified",status:A.businessLicense.status})}return S});n.useEffect(()=>{const S=s.verificationDocuments;S&&l(A=>{const q={...A};return S.idCard&&typeof S.idCard=="object"&&S.idCard.status&&S.idCard.status!=="pending"&&!A.idCard&&(q.idCard={file:null,url:"",name:S.idCard.name||"ID Card Document",verified:S.idCard.status==="verified",status:S.idCard.status}),S.businessLicense&&typeof S.businessLicense=="object"&&S.businessLicense.status&&S.businessLicense.status!=="pending"&&!A.businessLicense&&(q.businessLicense={file:null,url:"",name:S.businessLicense.name||"Business License Document",verified:S.businessLicense.status==="verified",status:S.businessLicense.status}),q})},[s.verificationDocuments]);const[c,h]=n.useState({businessName:s.businessName||"",businessDescription:s.businessDescription||"",businessLicenseNumber:s.businessLicenseNumber||""}),[v,i]=n.useState(!1);n.useEffect(()=>{h({businessName:s.businessName||"",businessDescription:s.businessDescription||"",businessLicenseNumber:s.businessLicenseNumber||""})},[s.businessName,s.businessDescription,s.businessLicenseNumber]);const[d,b]=n.useState(()=>{console.log("🔄 Initializing AgriLink verification state"),console.log("📋 User agriLinkVerificationRequested:",s.agriLinkVerificationRequested),console.log("📋 User verified:",s.verified);const S=s.agriLinkVerificationRequested,A=s.verified;return console.log("✅ AgriLink verification state:",S||A?"true":"false"),S||A}),[k,o]=n.useState(()=>{const S=s.agriLinkVerificationRequested,A=s.verificationStatus==="under_review",q=!s.verified;return console.log("🔄 Initializing success message state:",{hasRequestedVerification:S,isUnderReview:A,isNotYetVerified:q,shouldShow:S&&A&&q}),S&&A&&q}),[C,p]=n.useState(!1);n.useEffect(()=>{k&&(s.verified||s.verificationStatus==="rejected")&&o(!1)},[s.verified,s.verificationStatus,k]);const[w,x]=n.useState(!1),[g,u]=n.useState(!1),[y,m]=n.useState(!1),j=s.accountType==="business",N=n.useMemo(()=>{const S=s.verificationDocuments,A=r.idCard||S?.idCard&&S.idCard!=="pending";return{hasIdCard:A,hasBusinessLicense:!1,isComplete:A}},[r.idCard,s.verificationDocuments,j]),M=()=>{let S=0,A=j?4:3;s.phoneVerified&&S++;const q=s.verificationDocuments;if((r.idCard||q?.idCard&&q.idCard!=="pending")&&S++,j){const ve=s.businessName&&s.businessName.trim()!=="",je=s.verificationDocuments?.businessLicense&&s.verificationDocuments.businessLicense!=="pending";ve&&je&&S++}return s.verified&&S++,Math.round(S/A*100)},_=async(S,A)=>{const q=S.target.files?.[0];if(q){if(q.size>10*1024*1024){alert("File size must be less than 10MB");return}if(!q.type.startsWith("image/")){alert("Please upload an image file (JPG, PNG, etc.)");return}p(!0);try{const re=URL.createObjectURL(q);l(je=>({...je,[A]:{file:q,url:re,name:q.name,verified:!1,status:"uploaded"}})),await new Promise(je=>setTimeout(je,1500));const ve={...s.verificationDocuments||{},[A]:{status:"uploaded",name:q.name,size:q.size,type:q.type,uploadedAt:new Date().toISOString(),data:await new Promise(je=>{const T=new FileReader;T.onload=()=>je(T.result),T.readAsDataURL(q)})}};await t({...s,verificationDocuments:ve}),await new Promise(je=>setTimeout(je,100))}catch(re){console.error("Upload failed:",re),alert("Upload failed. Please try again.")}finally{p(!1)}}},P=S=>{l(A=>{const q={...A};return delete q[S],q})},F=async()=>{p(!0);const S=setTimeout(()=>{console.error("❌ Verification request timeout - stopping processing"),p(!1)},1e4);try{console.log("🛡️ Requesting AgriLink verification for user:",s.email);const A=s.verificationDocuments||{},q=A.idCard&&A.idCard.status==="uploaded",re=!j||A.businessLicense&&A.businessLicense.status==="uploaded",ve=q&&re;if(console.log("🔍 Debug - Document check results:"),console.log("  - hasIdCard:",q),console.log("  - hasBusinessLicense:",re),console.log("  - hasUploadedDocs:",ve),console.log("  - userDocs:",A),console.log("  - isBusinessAccount:",j),ve){const je={id:`req-${Date.now()}`,userId:s.id,userEmail:s.email,userName:s.name,userType:s.userType,accountType:s.accountType,requestType:"standard",status:"pending",submittedAt:new Date().toISOString(),documents:{nationalId:A.idCard?{status:A.idCard.status,name:A.idCard.name,uploadedAt:A.idCard.uploadedAt}:void 0,businessLicense:A.businessLicense?{status:A.businessLicense.status,name:A.businessLicense.name,uploadedAt:A.businessLicense.uploadedAt}:void 0},businessInfo:j?{businessName:s.businessName,businessDescription:s.businessDescription,businessLicenseNumber:s.businessLicenseNumber,location:s.location}:void 0,phoneVerified:s.phoneVerified};console.log("🔄 Inserting verification request into database..."),console.log("📋 Request data:",{user_id:s.id,user_email:s.email,user_name:s.name,user_type:s.userType,account_type:s.accountType,request_type:"standard",status:"under_review",submitted_at:new Date().toISOString(),verification_documents:A,business_info:j?{business_name:s.businessName,business_description:s.businessDescription,business_license_number:s.businessLicenseNumber,location:s.location}:null,phone_verified:s.phoneVerified});const{data:T,error:xe}=await V.from("verification_requests").insert([{user_id:s.id,user_email:s.email,user_name:s.name,user_type:s.userType,account_type:s.accountType,request_type:"standard",status:"under_review",submitted_at:new Date().toISOString(),verification_documents:A,business_info:j?{business_name:s.businessName,business_description:s.businessDescription,business_license_number:s.businessLicenseNumber,location:s.location}:null,phone_verified:s.phoneVerified}]).select();if(xe)throw console.error("❌ Error storing verification request:",xe),console.error("❌ Full error details:",xe),new Error("Failed to submit verification request");console.log("✅ Verification request inserted successfully:",T),await new Promise(z=>setTimeout(z,1500)),b(!0),o(!0),console.log("🔄 Updating user profile with verification request data...");const L={...s,agriLinkVerificationRequested:!0,agriLinkVerificationRequestedAt:new Date().toISOString(),verificationStatus:"under_review",verificationSubmittedAt:new Date().toISOString(),verificationDocuments:A};console.log("📋 User update data:",L);try{await t(L),console.log("✅ User profile updated successfully")}catch(z){console.error("❌ Error updating user profile:",z)}console.log("✅ AgriLink verification request submitted successfully:",je)}else alert("Please upload all required documents before requesting verification.")}catch(A){console.error("❌ Failed to request AgriLink verification:",A),alert("Failed to request verification. Please try again.")}finally{clearTimeout(S),p(!1)}},D=async()=>{if(!c.businessName.trim()){alert("Please enter your business name");return}if(!c.businessLicenseNumber.trim()){alert("Please enter your business license number");return}p(!0);try{console.log("💼 Saving business information:",{businessName:c.businessName,businessDescription:c.businessDescription,businessLicenseNumber:c.businessLicenseNumber}),await t({...s,businessName:c.businessName,businessDescription:c.businessDescription,businessLicenseNumber:c.businessLicenseNumber}),console.log("✅ Business information saved to user profile"),i(!1)}catch{alert("Failed to save business information. Please try again.")}finally{p(!1)}};return w?e.jsxs("div",{className:"max-w-2xl mx-auto space-y-4 md:space-y-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(qe,{className:"w-5 h-5 text-primary"})}),e.jsx("h1",{className:"text-xl font-semibold text-primary",children:"Phone Verification"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Verify your phone number with Supabase backend integration"})]})}),e.jsx(Br,{currentUser:s,onVerificationComplete:S=>{t({...s,phone:S,phoneVerified:!0,phoneVerificationDate:new Date().toISOString()}),x(!1)},onBack:()=>x(!1)})]}):g?e.jsxs("div",{className:"max-w-2xl mx-auto space-y-4 md:space-y-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(Ve,{className:"w-5 h-5 text-primary"})}),e.jsx("h1",{className:"text-xl font-semibold text-primary",children:"Identity Documents"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.verified?"Documents submitted for identity verification":"Upload your government-issued ID to verify your identity"})]})}),s.verified?e.jsx(R,{className:"bg-primary/5 border-primary/20",children:e.jsxs(E,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4 text-primary",children:"Submitted Documents"}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-muted rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ve,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"National ID Card"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Government-issued identification"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{variant:"secondary",className:"bg-primary/10 text-primary",children:"Verified"}),r.businessLicense&&e.jsxs(f,{variant:"ghost",size:"sm",onClick:()=>window.open(r.businessLicense.url,"_blank"),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(ge,{className:"w-4 h-4 mr-1"}),"View"]})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground mb-3",children:r.businessLicense?`Uploaded: ${r.businessLicense.name}`:"Document verified and stored securely"})]})}),e.jsxs("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4 mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ee,{className:"w-5 h-5 text-primary"}),e.jsx("p",{className:"font-medium text-primary",children:"Verification Complete"})]}),e.jsx("p",{className:"text-sm text-primary/80",children:"Your documents have been successfully verified. You now have full access to AgriLink platform features."})]})]})}):s.verificationStatus==="under_review"&&!d?e.jsx(R,{className:"bg-orange-50 border-orange-200",children:e.jsxs(E,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4 text-orange-800",children:"Documents Under Review"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ve,{className:"w-5 h-5 text-orange-600"}),e.jsx("p",{className:"font-medium text-orange-800",children:"Review in Progress"})]}),e.jsx("p",{className:"text-sm text-orange-700 mb-2",children:"We'll notify you once the review is complete, typically within 1-2 business days."}),s.verificationSubmittedAt&&e.jsxs("p",{className:"text-xs text-orange-600 mt-2",children:["Submitted on ",new Date(s.verificationSubmittedAt).toLocaleDateString()]})]}),r.idCard&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ve,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-orange-800",children:r.idCard.name}),e.jsx("p",{className:"text-xs text-orange-700",children:"Under Review"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(f,{variant:"ghost",size:"sm",onClick:()=>window.open(r.idCard.url,"_blank"),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(ge,{className:"w-4 h-4 mr-1"}),"View"]}),e.jsx(U,{variant:"secondary",className:"bg-orange-100 text-orange-700",children:"Under Review"})]})]})}),j&&r.businessLicense&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(rs,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-orange-800",children:r.businessLicense.name}),e.jsx("p",{className:"text-xs text-orange-700",children:"Under Review"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(f,{variant:"ghost",size:"sm",onClick:()=>window.open(r.businessLicense.url,"_blank"),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(ge,{className:"w-4 h-4 mr-1"}),"View"]}),e.jsx(U,{variant:"secondary",className:"bg-orange-100 text-orange-700",children:"Under Review"})]})]})})]})]})}):e.jsx(e.Fragment,{children:e.jsx(R,{className:"border-primary/20 bg-primary/2",children:e.jsx(E,{className:"p-6",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-primary/80 mb-4",children:"Please upload a clear photo of your government-issued ID (National ID card, passport, or driver's license)."}),e.jsxs("div",{className:"space-y-4",children:[!r.idCard&&!d&&e.jsxs("div",{className:"border-2 border-dashed border-primary/30 bg-primary/5 rounded-lg p-6 text-center hover:border-primary/50 hover:bg-primary/8 transition-all duration-200",children:[e.jsx(Ve,{className:"w-12 h-12 text-primary/70 mx-auto mb-4"}),e.jsx("p",{className:"text-sm font-medium mb-2 text-primary",children:"Upload Identity Document"}),e.jsx("p",{className:"text-xs text-primary/70 mb-4",children:"National ID, Passport, or Driver's License • JPG, PNG up to 10MB"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",id:"id-upload",onChange:S=>_(S,"idCard")}),e.jsx(f,{variant:"outline",size:"sm",asChild:!0,className:"border-primary/30 text-primary hover:bg-primary hover:text-primary-foreground",children:e.jsx("label",{htmlFor:"id-upload",className:"cursor-pointer",children:"Choose File"})})]}),r.idCard&&e.jsx("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ve,{className:"w-5 h-5 text-primary"}),e.jsx("div",{children:e.jsx("button",{onClick:()=>window.open(r.idCard.url,"_blank"),className:"text-sm font-medium text-primary hover:text-primary/80 hover:underline transition-colors text-left",children:r.idCard.name})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.verificationStatus!=="under_review"&&!s.verified&&!d&&e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>P("idCard"),className:"text-muted-foreground hover:text-foreground hover:bg-muted",children:e.jsx(Le,{className:"w-4 h-4"})}),e.jsx(U,{variant:"secondary",className:"bg-primary/10 text-primary",children:"Uploaded"})]})]})})]})]})})})})}),e.jsx("div",{className:"flex justify-start",children:e.jsxs(f,{variant:"ghost",size:"sm",onClick:()=>u(!1),className:"px-3 py-2 text-primary/70 hover:text-primary hover:bg-primary/10",children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"Back to Overview"]})})]}):y?e.jsxs("div",{className:"max-w-2xl mx-auto space-y-4 md:space-y-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Business Details"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.businessName?"Your business information":"Complete your business information"})]})}),e.jsx(R,{children:e.jsxs(E,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:v?"Update Business Information":"Business Information"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Business Name *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:c.businessName,onChange:S=>h(A=>({...A,businessName:S.target.value})),placeholder:"Enter your business name",className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary ${s.businessName&&!v?"bg-muted text-muted-foreground border-muted cursor-not-allowed":"border-muted bg-background text-foreground"}`,disabled:!!s.businessName&&!v}),s.businessName&&!v&&e.jsx(f,{type:"button",variant:"ghost",size:"sm",onClick:()=>i(!0),className:"absolute right-1 top-1/2 -translate-y-1/2 h-8 w-8 p-0 text-muted-foreground hover:text-foreground",children:e.jsx(se,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Business License Number *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:c.businessLicenseNumber,onChange:S=>h(A=>({...A,businessLicenseNumber:S.target.value})),placeholder:"Enter your business license number",className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary ${s.businessLicenseNumber&&!v?"bg-muted text-muted-foreground border-muted cursor-not-allowed":"border-muted bg-background text-foreground"}`,disabled:!!s.businessLicenseNumber&&!v}),s.businessLicenseNumber&&!v&&e.jsx(f,{type:"button",variant:"ghost",size:"sm",onClick:()=>i(!0),className:"absolute right-1 top-1/2 -translate-y-1/2 h-8 w-8 p-0 text-muted-foreground hover:text-foreground",children:e.jsx(se,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Business Description"}),e.jsx("textarea",{value:c.businessDescription,onChange:S=>h(A=>({...A,businessDescription:S.target.value})),placeholder:"Describe your business activities",rows:3,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary resize-none ${s.businessName&&!v?"bg-muted text-muted-foreground border-muted cursor-not-allowed":"border-muted bg-background text-foreground"}`,disabled:!!s.businessName&&!v})]}),s.businessName&&!v&&e.jsx("div",{className:"bg-muted/50 border border-muted rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Business information saved to your profile"})]})}),e.jsx("div",{className:"flex gap-2",children:v||!s.businessName?e.jsxs(e.Fragment,{children:[e.jsx(f,{onClick:D,disabled:C||s.verificationStatus==="under_review",className:"flex-1",children:C?"Saving...":"Save Business Info"}),v&&e.jsx(f,{variant:"outline",onClick:()=>{i(!1),h({businessName:s.businessName||"",businessDescription:s.businessDescription||"",businessLicenseNumber:s.businessLicenseNumber||""})},className:"px-4",children:"Cancel"})]}):e.jsx(f,{onClick:()=>i(!0),variant:"outline",className:"flex-1",children:"Edit Business Info"})})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h4",{className:"font-medium mb-4",children:"Business License Document *"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Upload your business registration or license document to complete your business verification. This is mandatory for business account verification."}),!r.businessLicense&&!d&&e.jsxs("div",{className:"border-2 border-dashed border-muted rounded-lg p-6 text-center",children:[e.jsx(rs,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-sm font-medium mb-2",children:"Upload Business Registration"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-4",children:"Business License or Registration • JPG, PNG up to 10MB"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",id:"business-detail-upload",onChange:S=>_(S,"businessLicense")}),e.jsx(f,{variant:"outline",size:"sm",asChild:!0,children:e.jsx("label",{htmlFor:"business-detail-upload",className:"cursor-pointer",children:"Choose File"})})]}),r.businessLicense&&e.jsx("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(rs,{className:"w-5 h-5 text-primary"}),e.jsx("div",{children:e.jsx("button",{onClick:()=>window.open(r.businessLicense.url,"_blank"),className:"text-sm font-medium text-primary hover:text-primary/80 hover:underline transition-colors text-left",children:r.businessLicense.name})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.verificationStatus!=="under_review"&&!s.verified&&!d&&e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>P("businessLicense"),className:"text-muted-foreground hover:text-foreground hover:bg-muted",children:e.jsx(Le,{className:"w-4 h-4"})}),e.jsx(U,{variant:"secondary",className:"bg-primary/10 text-primary",children:"Uploaded"})]})]})})]})]})]})}),e.jsx("div",{className:"flex justify-start",children:e.jsxs(f,{variant:"ghost",size:"sm",onClick:()=>m(!1),className:"px-3 py-2",children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"Back to Overview"]})})]}):e.jsxs("div",{className:"max-w-2xl mx-auto space-y-4 md:space-y-6 pb-20",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"AgriLink Verification"}),e.jsx(f,{variant:"outline",size:"sm",onClick:async()=>{console.log("🔄 Manual refresh triggered");try{const{data:S,error:A}=await V.from("users").select(`
                    id,
                    email,
                    name,
                    user_type,
                    account_type,
                    location,
                    region,
                    verified,
                    phone_verified,
                    phone,
                    business_name,
                    business_description,
                    business_license_number,
                    created_at,
                    total_reviews,
                    verification_status,
                    verification_documents,
                    verification_submitted,
                    phone_verified_at,
                    verified_at,
                    agri_link_verification_requested_at,
                    business_details_completed
                  `).eq("id",s.id).single();if(A){console.error("❌ Error refreshing user data:",A);return}if(S){const q={id:S.id,email:S.email,name:S.name,userType:S.user_type,accountType:S.account_type,location:S.location,region:S.region||void 0,verified:S.verified,phoneVerified:S.phone_verified,phone:S.phone,businessName:S.business_name,businessDescription:S.business_description,businessLicenseNumber:S.business_license_number,experience:"Unknown",joinedDate:S.created_at,totalReviews:S.total_reviews||0,verificationStatus:S.verification_status||"not_started",verificationDocuments:S.verification_documents||{},phoneVerifiedAt:S.phone_verified_at,verifiedAt:S.verified_at,agriLinkVerificationRequested:S.verification_submitted||!1,agriLinkVerificationRequestedAt:S.agri_link_verification_requested_at};console.log("✅ User data refreshed:",q.email),console.log("📋 Updated verification status:",q.verificationStatus),console.log("📋 Updated verified status:",q.verified),await t(q)}}catch(S){console.error("❌ Error refreshing user data:",S)}},children:"🔄 Refresh"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Complete your verification in ",j?"4":"3"," steps to build trust and credibility"]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2 mt-4",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-500",style:{width:`${M()}%`}})}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[M(),"% Complete"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(R,{className:(s.phoneVerified,"bg-primary/5 border-primary/20"),children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${s.phoneVerified?"bg-primary":"bg-primary/10 border-2 border-primary/40"}`,children:s.phoneVerified?e.jsx(ee,{className:"w-5 h-5 text-white"}):e.jsx(qe,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`font-medium truncate ${s.phoneVerified?"text-primary":"text-primary/90"}`,children:"Phone Verification"}),e.jsx("p",{className:`text-sm truncate ${s.phoneVerified?"text-primary/80":"text-primary"}`,children:s.phoneVerified?"Phone number verified":"Verify your phone number"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(U,{variant:"secondary",className:s.phoneVerified?"bg-green-100 text-green-700 border-green-200":"bg-red-100 text-red-700 border-red-200",children:s.phoneVerified?"Complete":"Required"}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>x(!0),className:`p-1 h-8 w-8 ${s.phoneVerified?"text-primary hover:bg-primary/10":"text-muted-foreground hover:bg-muted"}`,children:e.jsx(gs,{className:"w-4 h-4"})})]})]})})}),e.jsx(R,{className:(s.verified||N.isComplete,"bg-primary/5 border-primary/20"),children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${s.verified||N.isComplete?"bg-primary":"bg-primary/10 border-2 border-primary/40"}`,children:s.verified?e.jsx(ee,{className:"w-5 h-5 text-white"}):N.isComplete?e.jsx(ee,{className:"w-5 h-5 text-white"}):e.jsx(Ve,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`font-medium truncate ${s.verified||N.isComplete?"text-primary":"text-primary/90"}`,children:"Identity Documents"}),e.jsx("p",{className:`text-sm truncate ${s.verified||N.isComplete?"text-primary/80":"text-primary"}`,children:s.verified?"Documents verified":N.isComplete?"Documents uploaded":"Upload identity documents"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(U,{variant:"secondary",className:s.verified||N.isComplete?"bg-green-100 text-green-700 border-green-200":"bg-red-100 text-red-700 border-red-200",children:s.verified||N.isComplete?"Complete":"Required"}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>u(!0),className:`p-1 h-8 w-8 ${s.verified||N.isComplete,"text-primary hover:bg-primary/10"}`,children:e.jsx(gs,{className:"w-4 h-4"})})]})]})})}),j&&(()=>{const S=!!s.businessName,A=!!r.businessLicense||!!s.verificationDocuments?.businessLicense&&s.verificationDocuments?.businessLicense?.status!=="pending",q=s.verified||S&&A;return e.jsx(R,{className:"bg-primary/5 border-primary/20",children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${q?"bg-primary":"bg-primary/10 border-2 border-primary/40"}`,children:q?e.jsx(ee,{className:"w-5 h-5 text-white"}):e.jsx(rs,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`font-medium truncate ${q?"text-primary":"text-primary/90"}`,children:"Business Details"}),e.jsx("p",{className:`text-sm truncate ${q?"text-primary/80":"text-primary"}`,children:q?"Business information & license completed":S?"Business license needed":"Complete business information"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(U,{variant:"secondary",className:q?"bg-green-100 text-green-700 border-green-200":"bg-red-100 text-red-700 border-red-200",children:q?"Complete":"Required"}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>m(!0),className:"p-1 h-8 w-8 text-primary hover:bg-primary/10",children:e.jsx(gs,{className:"w-4 h-4"})})]})]})})})})(),s.verified?e.jsx(R,{className:"bg-emerald-50 border-emerald-200",children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-emerald-600 flex items-center justify-center flex-shrink-0",children:e.jsx(ee,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-emerald-700 truncate",children:"AgriLink Verification"}),e.jsx("p",{className:"text-sm text-emerald-600 truncate",children:"Your account is fully verified!"}),s.agriLinkVerificationDate&&e.jsxs("p",{className:"text-xs text-emerald-600 mt-1 truncate",children:["on ",new Date(s.agriLinkVerificationDate).toLocaleDateString()]})]})]}),e.jsx(U,{variant:"secondary",className:"bg-emerald-100 text-emerald-700 border-emerald-200 flex-shrink-0",children:"Verified"})]})})}):d?e.jsx(R,{className:"bg-blue-50 border-blue-200",children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center flex-shrink-0",children:e.jsx(ae,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-blue-800 truncate",children:"AgriLink Verification"}),e.jsx("p",{className:"text-sm text-blue-700 truncate",children:"Verification submitted for review"})]})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:e.jsx(f,{size:"sm",disabled:!0,variant:"secondary",className:"text-xs px-3 py-2 bg-blue-100 text-blue-700 border-blue-200",children:"Verification Requested"})})]})})}):e.jsx(R,{className:"bg-primary/5 border-primary/20",children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 border-2 border-primary/40 flex items-center justify-center flex-shrink-0",children:e.jsx(ae,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-primary/90 truncate",children:"AgriLink Verification"}),e.jsx("p",{className:"text-sm text-primary truncate",children:"Complete all steps to get verified"})]})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:(()=>{const S=!j||!!s.businessName,A=!j||!!r.businessLicense||!!s.verificationDocuments?.businessLicense&&s.verificationDocuments?.businessLicense?.status!=="pending";if(s.verified,s.phoneVerified&&r.idCard&&S&&A&&!d)return e.jsx(f,{size:"sm",onClick:F,disabled:C,className:"text-xs px-3 py-2",children:C?"Processing...":"Request Verification"});{const re=[];s.phoneVerified||re.push("phone verification"),r.idCard||re.push("ID documents"),j&&!S&&re.push("business information"),j&&!A&&re.push("business license");const ve=re.length>0?`Complete ${re.join(", ")} first`:"Complete required steps above";return e.jsx(f,{size:"sm",disabled:!0,variant:"outline",className:"text-xs px-3 py-2 opacity-60 cursor-not-allowed",title:ve,children:"Request Verification"})}})()})]})})}),s.verified&&e.jsx("p",{className:"text-sm text-emerald-600",children:"Congratulations! Your AgriLink verification is complete. You now have enhanced buyer trust and credibility."}),k&&e.jsx("p",{className:"text-sm text-blue-700",children:"AgriLink verification requested successfully! We will review your documents within 1-2 business days and notify you of the outcome."}),e.jsx("div",{className:"mt-8 pt-6",children:e.jsxs(f,{variant:"ghost",size:"sm",onClick:a,className:"px-3 py-2",children:[e.jsx(gs,{className:"w-4 h-4 mr-2 rotate-180"}),"Back to Profile"]})})]})]})}const $r="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODgiIGhlaWdodD0iODgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBvcGFjaXR5PSIuMyIgZmlsbD0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIzLjciPjxyZWN0IHg9IjE2IiB5PSIxNiIgd2lkdGg9IjU2IiBoZWlnaHQ9IjU2IiByeD0iNiIvPjxwYXRoIGQ9Im0xNiA1OCAxNi0xOCAzMiAzMiIvPjxjaXJjbGUgY3g9IjUzIiBjeT0iMzUiIHI9IjciLz48L3N2Zz4KCg==";function Gs(s){const[a,t]=n.useState(!1),r=()=>{t(!0)},{src:l,alt:c,style:h,className:v,...i}=s;return a?e.jsx("div",{className:`inline-block bg-gray-100 text-center align-middle ${v??""}`,style:h,children:e.jsx("div",{className:"flex items-center justify-center w-full h-full",children:e.jsx("img",{src:$r,alt:"Error loading image",...i,"data-original-url":l})})}):e.jsx("img",{src:l,alt:c,className:v,style:h,...i,onError:r})}function Ur({user:s,onBack:a,onEditProfile:t,onShowVerification:r,onUpdate:l,onViewStorefront:c}){if(!s)return e.jsx("div",{className:"max-w-4xl mx-auto p-4",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-muted-foreground",children:"User data not available"}),e.jsx(f,{onClick:a,className:"mt-4",children:"Go Back"})]})});const[h,v]=n.useState(null),[i,d]=n.useState(!1),[b,k]=n.useState(!1),[o,C]=n.useState(()=>s?{name:s.name||"",phone:s.phone||"",location:s.location||"",profileImage:s.profileImage||"",region:s.region||"",businessName:s.businessName||""}:{name:"",phone:"",location:"",profileImage:"",region:"",businessName:""}),p=n.useRef(null),w=n.useRef(null);n.useEffect(()=>{if(!s)return;if(!w.current||s.name!==w.current.name||s.phone!==w.current.phone||s.location!==w.current.location||s.profileImage!==w.current.profileImage||s.region!==w.current.region||s.businessName!==w.current.businessName||s.facebook!==w.current.facebook||s.instagram!==w.current.instagram||s.website!==w.current.website||s.telegram!==w.current.telegram){console.log("Profile: User data changed, updating form data");const P={name:s.name||"",phone:s.phone||"",location:s.location||"",profileImage:s.profileImage||"",region:s.region||"",businessName:s.businessName||"",facebook:s.facebook||"",instagram:s.instagram||"",website:s.website||"",telegram:s.telegram||""};C(P),w.current=s}},[s]);const x=async(_,P)=>{try{C(F=>({...F,[_]:P})),v(null),l&&await l({[_]:P})}catch(F){console.error("Failed to save:",F),C(D=>({...D,[_]:o[_]}))}},g=async _=>{if(!_.type.startsWith("image/")){alert("Please select a valid image file");return}if(_.size>10*1024*1024){alert("Image size must be less than 10MB");return}try{d(!1);const P=new FileReader,D=await new Promise(S=>{P.onload=()=>S(P.result),P.readAsDataURL(_)});if(console.log("Image compressed:",{originalSize:_.size,compressedSize:D.length,compressionRatio:(_.size/D.length).toFixed(2)}),l)try{await l({profileImage:D}),C(S=>({...S,profileImage:D})),console.log("✅ Profile image updated successfully in database")}catch(S){console.error("Failed to save profile image:",S),alert("Failed to save profile image. Please try again.")}else C(S=>({...S,profileImage:D}))}catch(P){console.error("Failed to process image:",P),alert("Failed to process image. Please try a different image."),d(!1)}},u=async()=>{try{d(!1),l?(await l({profileImage:""}),console.log("✅ Profile image removed successfully")):C(_=>({..._,profileImage:""}))}catch(_){console.error("Failed to remove profile image:",_)}},y=(_,P)=>{v({field:_,value:P})},m=()=>{v(null),d(!1)},j=()=>{if(!o.region)return[];const _=Ie[o.region];return _?_.cities:[]},N=async _=>{try{const P={region:_,location:""};C(F=>({...F,...P})),v(null),l&&await l(P)}catch(P){console.error("Failed to save region:",P),C(F=>({...F,region:o.region,location:o.location}))}},M=async _=>{try{C(P=>({...P,location:_})),v(null),l&&await l({location:_})}catch(P){console.error("Failed to save location:",P),C(F=>({...F,location:o.location}))}};return e.jsxs("div",{className:"space-y-6",children:[b&&e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5 text-amber-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-amber-800",children:"Storage Nearly Full"}),e.jsx("p",{className:"text-sm text-amber-700",children:"Your browser storage may be getting full. This can cause issues saving profile changes."})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{size:"sm",variant:"outline",onClick:()=>console.log("Storage management not needed with Supabase"),className:"border-amber-300 text-amber-700 hover:bg-amber-100",children:[e.jsx(Jt,{className:"w-4 h-4 mr-2"}),"Manage Storage"]}),e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>k(!1),className:"text-amber-700",children:e.jsx(Le,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(f,{variant:"ghost",onClick:a,className:"h-9 px-3 -ml-3",children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"Back"]}),h||i?e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(f,{variant:"outline",size:"sm",onClick:m,children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),"Cancel"]})}):null]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"My Profile"}),e.jsx("p",{className:"text-muted-foreground",children:"View and manage your account information"})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx(R,{className:"overflow-hidden border-primary/30",children:e.jsxs(Y,{className:"text-center pb-6",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsxs("div",{className:"relative group",children:[o.profileImage?e.jsx(Gs,{src:o.profileImage,alt:`${o.name}'s profile picture`,className:"w-28 h-28 rounded-full object-cover border-4 border-border shadow-lg"}):e.jsx("div",{className:"w-28 h-28 rounded-full border-4 border-border shadow-lg bg-muted flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mx-auto",children:e.jsx(Pe,{className:"w-6 h-6 text-primary"})})})}),e.jsx("div",{className:"absolute inset-0 bg-black/40 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer",onClick:()=>d(!0),children:e.jsx(bs,{className:"w-6 h-6 text-white"})}),s.verified&&e.jsx("div",{className:"absolute -bottom-1 -right-1 w-8 h-8 bg-green-500 rounded-full flex items-center justify-center border-2 border-card",children:e.jsx(ee,{className:"w-5 h-5 text-white"})})]})}),e.jsx("input",{ref:p,type:"file",accept:"image/*",onChange:_=>{const P=_.target.files?.[0];P&&g(P)},className:"hidden"}),i&&e.jsxs("div",{className:"mb-4 p-4 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Update your profile picture"}),e.jsxs("div",{className:"flex gap-2 justify-center flex-wrap",children:[e.jsxs(f,{size:"sm",onClick:()=>p.current?.click(),children:[e.jsx(bs,{className:"w-4 h-4 mr-2"}),"Choose Photo"]}),s.profileImage&&o.profileImage&&e.jsxs(f,{size:"sm",variant:"outline",onClick:u,className:"text-destructive hover:text-destructive",children:[e.jsx(As,{className:"w-4 h-4 mr-2"}),"Remove Photo"]}),e.jsx(f,{size:"sm",variant:"outline",onClick:()=>d(!1),children:"Cancel"})]})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[h?.field==="name"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{value:h.value,onChange:_=>v({...h,value:_.target.value}),className:"text-center text-xl font-bold",autoFocus:!0,onKeyDown:_=>{_.key==="Enter"&&x("name",h.value),_.key==="Escape"&&m()}}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsxs(f,{size:"sm",onClick:()=>x("name",h.value),children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsx(f,{size:"sm",variant:"outline",onClick:m,children:"Cancel"})]})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(K,{className:"text-2xl font-bold",children:o.name}),e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>y("name",o.name),className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",children:e.jsx(se,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex justify-center gap-2 flex-wrap",children:e.jsx(Ns,{userType:s.userType,accountType:ms(s),verificationLevel:Ye(s),size:"md"})})]}),s.userType!=="admin"&&e.jsx("div",{className:"space-y-3",children:e.jsxs(f,{variant:"outline",className:`w-full h-11 font-medium ${(()=>{switch(Ye(s)){case"business-verified":case"id-verified":return"text-green-600 border-green-300 hover:bg-green-50 hover:text-green-700 dark:text-green-400 dark:border-green-700 dark:hover:bg-green-900/20";case"under-review":return"text-blue-600 border-blue-300 hover:bg-blue-50 hover:text-blue-700 dark:text-blue-400 dark:border-blue-700 dark:hover:bg-blue-900/20";case"phone-verified":return"text-yellow-600 border-yellow-300 hover:bg-yellow-50 hover:text-yellow-700 dark:text-yellow-400 dark:border-yellow-700 dark:hover:bg-yellow-900/20";default:return"text-red-600 border-red-300 hover:bg-red-50 hover:text-red-700 dark:text-red-400 dark:border-red-700 dark:hover:bg-red-900/20"}})()}`,onClick:()=>r(1),children:[(()=>{switch(Ye(s)){case"business-verified":case"id-verified":return e.jsx(ae,{className:"w-4 h-4 mr-2 text-green-600 dark:text-green-400"});case"under-review":return e.jsx(ae,{className:"w-4 h-4 mr-2 text-blue-600 dark:text-blue-400"});case"phone-verified":return e.jsx(ae,{className:"w-4 h-4 mr-2 text-yellow-600 dark:text-yellow-400"});default:return e.jsx(ae,{className:"w-4 h-4 mr-2 text-red-600 dark:text-red-400"})}})(),"View Verification Details"]})})]})}),e.jsxs(R,{className:"mt-6 border-primary/30",children:[e.jsx(Y,{children:e.jsx(K,{className:"text-lg",children:"Account Stats"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Rs,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Member Since"})]}),e.jsx("span",{className:"text-sm font-medium",children:Es(s.joinedDate)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xs,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Rating"})]}),e.jsx("span",{className:"text-sm font-medium",children:s.rating>0?`${s.rating}/5 (${s.totalReviews} reviews)`:"No ratings yet"})]})]})]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(R,{className:"border-primary/30",children:[e.jsx(Y,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5"}),"Contact Information"]})}),e.jsx(E,{className:"space-y-6",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 md:gap-x-10 md:gap-y-8",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(cs,{className:"w-4 h-4"}),"Email Address"]}),e.jsx("p",{className:"font-medium",children:s.email})]}),(s.userType==="farmer"||s.userType==="trader")&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Xe,{className:"w-4 h-4"}),s.userType==="farmer"?"Farm Name":"Business Name"]}),h?.field==="businessName"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(W,{value:h.value,onChange:_=>v({...h,value:_.target.value}),placeholder:s.userType==="farmer"?"Enter your farm name":"Enter your business name",autoFocus:!0,onKeyDown:_=>{_.key==="Enter"&&x("businessName",h.value),_.key==="Escape"&&m()}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{size:"sm",onClick:()=>x("businessName",h.value),children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),"Save"]}),e.jsx(f,{size:"sm",variant:"outline",onClick:m,children:"Cancel"})]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium flex-1",children:o.businessName||`${o.name}'s ${s.userType==="farmer"?"Farm":"Trading"}`}),e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>y("businessName",o.businessName||""),className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",children:e.jsx(se,{className:"w-4 h-4"})})]}),!o.businessName&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:['Currently showing as "',o.name,"'s ",s.userType==="farmer"?"Farm":"Trading",'" - Click edit to customize']})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(qe,{className:"w-4 h-4"}),"Phone Number"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium flex-1",children:o.phone||"Add phone number"}),e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>{r(3)},className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",title:o.phone?"Update and verify phone number":"Add and verify phone number",children:e.jsx(se,{className:"w-4 h-4"})})]}),s.phoneVerified&&e.jsxs(U,{variant:"outline",className:"text-xs text-green-600 border-green-200",children:[e.jsx(ee,{className:"w-3 h-3 mr-1"}),"Verified"]}),!s.phoneVerified&&o.phone&&e.jsxs(U,{variant:"outline",className:"text-xs text-orange-600 border-orange-200",children:[e.jsx(Ae,{className:"w-3 h-3 mr-1"}),"Unverified"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(pe,{className:"w-4 h-4"}),"Location"]}),h?.field==="location"||h?.field==="region"?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{className:"text-sm",children:"Region"}),e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4 z-10"}),e.jsxs(ce,{value:o.region,onValueChange:N,children:[e.jsx(me,{className:"pl-10",children:e.jsx(de,{placeholder:"Select your region"})}),e.jsx(ue,{className:"max-h-64 overflow-y-auto",children:Object.entries(Ie).map(([_,P])=>e.jsx(B,{value:_,children:P.name},_))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{className:"text-sm",children:"City/Town"}),e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4 z-10"}),e.jsxs(ce,{value:o.location,onValueChange:M,disabled:!o.region,children:[e.jsx(me,{className:"pl-10",children:e.jsx(de,{placeholder:"Select your city/town"})}),e.jsx(ue,{className:"max-h-64 overflow-y-auto",children:j().map(_=>e.jsx(B,{value:_,children:_},_))})]})]}),!o.region&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Please select a region first"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(f,{size:"sm",variant:"outline",onClick:m,children:"Done"})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium flex-1",children:(()=>{if(console.log("Profile: Location display debug:",{location:o.location,region:o.region,regionData:o.region?Ie[o.region]:null}),o.location&&!o.region){const _=Object.entries(Ie).find(([P,F])=>F.cities.includes(o.location));if(_){console.log("Auto-detected region for",o.location,":",_[0]);const P={region:_[0]};return C(F=>({...F,...P})),l&&l(P).catch(F=>{console.error("Failed to auto-save region:",F),C(D=>({...D,region:""}))}),`${o.location}, ${_[1].name}`}}return o.location?`${o.location}${o.region?`, ${Ie[o.region]?.name||o.region}`:""}`:"Add location"})()}),e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>{v({field:"location",value:o.location})},className:"h-8 w-8 p-0 opacity-60 hover:opacity-100",children:e.jsx(se,{className:"w-4 h-4"})})]})]})]})})]}),(s.userType==="farmer"||s.userType==="trader")&&e.jsxs(R,{className:"border-primary/30",children:[e.jsx(Y,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"w-5 h-5"}),"Business Management"]})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 text-center space-y-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mx-auto",children:e.jsx(Xe,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Manage Your Storefront"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Set up your business description, product categories, and customer information in your dedicated storefront."})]}),e.jsx(f,{onClick:()=>{c&&s?.id&&c(s.id)},className:"w-full",children:"View My Storefront"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground bg-amber-50 border border-amber-200 rounded-lg p-3",children:[e.jsx("strong",{children:"💡 Business Focus:"})," Your profile is for account management. Use your storefront to showcase products, business information, and connect with customers."]})]})]})]})]})]})}function Hr({currentUser:s,onBack:a,onStartChat:t}){const[r,l]=n.useState(""),[c,h]=n.useState("all"),[v,i]=n.useState(null),d=s,{conversations:b,messages:k,loading:o,loadConversations:C,loadMessages:p,error:w}=sa();n.useEffect(()=>{d?.id&&C(d.id)},[d?.id,C]),n.useEffect(()=>{v&&d?.id&&p(v)},[v,d?.id,p]);const x=m=>{if(!m)return"Just now";const j=new Date(m);if(isNaN(j.getTime()))return console.warn("Invalid timestamp in Messages:",m),"Just now";const M=new Date().getTime()-j.getTime(),_=Math.floor(M/(1e3*60*60)),P=Math.floor(_/24);return _<1?"Just now":_<24?`${_}h ago`:P<7?`${P}d ago`:j.toLocaleDateString()},g=n.useMemo(()=>b?.length?b.map(m=>{const j=m.buyerId===d?.id?m.sellerId:m.buyerId,N=m.buyerId===d?.id?m.sellerName:m.buyerName,M=m.unreadCount||0,_=m.lastMessage;return{id:m.id,productId:m.productId,productName:m.productName||"Unknown Product",productImage:m.productImage||"https://images.unsplash.com/photo-1546470427-227c013b2b5f?w=400&h=300&fit=crop",otherParty:{id:j,name:N||"Unknown User",type:m.buyerId===d?.id?m.sellerType:m.buyerType,location:m.buyerId===d?.id?m.sellerLocation:m.buyerLocation||"Unknown Location",rating:m.buyerId===d?.id?m.sellerRating:m.buyerRating,verified:m.buyerId===d?.id?m.sellerVerified:m.buyerVerified},lastMessage:_?{content:_,timestamp:m.lastMessageTime||m.createdAt,isOwn:!1}:{content:"No messages yet",timestamp:m.lastMessageTime||m.createdAt,isOwn:!1},unreadCount:M,status:m.status==="active"?"active":"archived"}}):[],[b?.length,Object.keys(k).length,d?.id]),u=n.useMemo(()=>{let m=g;switch(r&&(m=m.filter(j=>j.otherParty.name.toLowerCase().includes(r.toLowerCase())||j.productName.toLowerCase().includes(r.toLowerCase())||j.lastMessage.content.toLowerCase().includes(r.toLowerCase()))),c){case"unread":m=m.filter(j=>j.unreadCount>0);break;case"active":m=m.filter(j=>j.status==="active");break;case"archived":m=m.filter(j=>j.status==="archived");break}return m.sort((j,N)=>new Date(N.lastMessage.timestamp).getTime()-new Date(j.lastMessage.timestamp).getTime())},[g,r,c]),y=g.reduce((m,j)=>m+j.unreadCount,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(f,{variant:"ghost",onClick:a,className:"h-9 px-3 -ml-3",children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"Back"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Messages"}),e.jsxs("p",{className:"text-muted-foreground",children:[y>0?`${y} unread messages`:"All caught up!",d?` • Logged in as ${d.name}`:" • Not authenticated"]})]})]}),w&&e.jsx(R,{className:"border-red-200 bg-red-50",children:e.jsxs(E,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(Ds,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Error loading conversations"})]}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:w}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>C(d?.id),className:"mt-2",children:"Retry"})]})}),!d&&e.jsx(R,{className:"border-amber-200 bg-amber-50",children:e.jsxs(E,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-amber-700",children:[e.jsx(Ds,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Authentication Issue"})]}),e.jsx("p",{className:"text-amber-600 text-sm mt-1",children:"No authenticated user found. Please log in to view messages."}),e.jsx(f,{variant:"outline",size:"sm",onClick:a,className:"mt-2",children:"Go Back"})]})}),e.jsx(R,{children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ea,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(W,{type:"text",placeholder:"Search conversations...",value:r,onChange:m=>l(m.target.value),className:"w-full pl-10"})]}),e.jsx("div",{className:"flex gap-2",children:[{key:"all",label:"All",count:g.length},{key:"unread",label:"Unread",count:y},{key:"active",label:"Active",count:g.filter(m=>m.status==="active").length}].map(m=>e.jsxs(f,{variant:c===m.key?"default":"outline",size:"sm",onClick:()=>h(m.key),className:"gap-2",children:[m.label,m.count>0&&e.jsx(U,{variant:"secondary",className:"text-xs px-1.5 py-0.5",children:m.count})]},m.key))})]})})}),e.jsx("div",{className:"space-y-4",children:u.length===0?e.jsx(R,{children:e.jsxs(E,{className:"p-12 text-center",children:[e.jsx(Ke,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"font-medium mb-2",children:"No conversations found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:r?`No conversations match "${r}"`:c==="unread"?"You're all caught up! No unread messages.":"Start chatting with sellers and buyers to see conversations here."}),!r&&c==="all"&&e.jsx(f,{variant:"outline",onClick:a,children:"Browse Products"})]})}):u.map(m=>e.jsx(R,{className:`cursor-pointer transition-all hover:shadow-md ${m.unreadCount>0?"ring-2 ring-primary/20":""}`,onClick:()=>i(m.id),children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:m.productImage,alt:m.productName,className:"w-16 h-16 rounded-lg object-cover",onError:j=>{const N=j.target;N.src="https://images.unsplash.com/photo-1546470427-227c013b2b5f?w=400&h=300&fit=crop"}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-medium truncate",children:m.otherParty.name}),e.jsx(Ns,{userType:m.otherParty.type,accountType:ms(m.otherParty),verificationLevel:Ye(m.otherParty),size:"sm"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(Ce,{className:"w-3 h-3"}),x(m.lastMessage.timestamp)]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-2",children:[e.jsx(he,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:m.productName}),e.jsx("span",{children:"•"}),e.jsx(pe,{className:"w-3 h-3"}),e.jsx("span",{children:m.otherParty.location}),m.otherParty.rating>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Xs,{className:"w-3 h-3 text-yellow-400 fill-current"}),e.jsx("span",{children:m.otherParty.rating.toFixed(1)})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-muted-foreground truncate flex-1 mr-4",children:[m.lastMessage.isOwn?"You: ":"",m.lastMessage.content||"No message content"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[m.unreadCount>0&&e.jsx(U,{variant:"default",className:"bg-primary text-primary-foreground px-2 py-1 text-xs",children:m.unreadCount}),e.jsx(f,{variant:"ghost",size:"sm",className:"p-1",children:e.jsx(Wt,{className:"w-4 h-4"})})]})]})]})]})})},m.id))}),g.length===0&&!o&&d&&e.jsx(R,{children:e.jsxs(E,{className:"p-12 text-center",children:[e.jsx(Ke,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No messages yet"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:"Start conversations with farmers, traders, and buyers by browsing products and clicking the chat button."}),e.jsx("div",{className:"flex justify-center",children:e.jsx(f,{onClick:a,children:"Browse Products"})})]})}),o&&e.jsx(R,{children:e.jsxs(E,{className:"p-12 text-center",children:[e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-muted rounded-full mx-auto"}),e.jsx("div",{className:"h-4 bg-muted rounded w-1/2 mx-auto"}),e.jsx("div",{className:"h-3 bg-muted rounded w-1/3 mx-auto"})]}),e.jsx("p",{className:"text-muted-foreground mt-4",children:"Loading conversations..."})]})}),v&&(()=>{const m=g.find(j=>j.id===v);return m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-card shadow-2xl border-l border-t z-50 transition-transform duration-300 md:hidden",children:e.jsx(Hs,{sellerName:m.otherParty.name,sellerType:m.otherParty.type,sellerLocation:m.otherParty.location,sellerRating:m.otherParty.rating,productName:m.productName,productId:m.productId,sellerId:m.otherParty.id,conversationId:m.id,onClose:()=>i(null),sellerVerified:m.otherParty.verified,currentUserVerified:d?.verified||!1,currentUserType:d?.userType,currentUser:d,sellerVerificationStatus:{trustLevel:m.otherParty.verified?"id-verified":"unverified",tierLabel:m.otherParty.verified?"Verified":"Unverified",levelBadge:m.otherParty.verified?"Tier 1":"Unverified"},product:{id:m.productId,name:m.productName,price:m.productPrice||0,quantity:m.productQuantity||0,unit:m.productUnit||"units",category:m.productCategory||"General",sellerId:m.otherParty.id,sellerName:m.otherParty.name,sellerType:m.otherParty.type,location:m.otherParty.location,image:m.productImage}})}),e.jsx("div",{className:"hidden md:block fixed right-0 bottom-0 h-[500px] w-96 bg-card shadow-2xl border-l border-t z-50 transition-transform duration-300",children:e.jsx(Hs,{sellerName:m.otherParty.name,sellerType:m.otherParty.type,sellerLocation:m.otherParty.location,sellerRating:m.otherParty.rating,productName:m.productName,productId:m.productId,sellerId:m.otherParty.id,conversationId:m.id,onClose:()=>i(null),sellerVerified:m.otherParty.verified,currentUserVerified:d?.verified||!1,currentUserType:d?.userType,currentUser:d,sellerVerificationStatus:{trustLevel:m.otherParty.verified?"id-verified":"unverified",tierLabel:m.otherParty.verified?"Verified":"Unverified",levelBadge:m.otherParty.verified?"Tier 1":"Unverified"},product:{id:m.productId,name:m.productName,price:m.productPrice||0,quantity:m.productQuantity||0,unit:m.productUnit||"units",category:m.productCategory||"General",sellerId:m.otherParty.id,sellerName:m.otherParty.name,sellerType:m.otherParty.type,location:m.otherParty.location,image:m.productImage}})})]}):null})()]})}function Gr({currentUser:s,onUpdate:a,onClose:t}){const[r,l]=n.useState(null),[c,h]=n.useState(null),[v,i]=n.useState(!1),[d,b]=n.useState(!1),[k,o]=n.useState(s.heroImage||null),C=n.useCallback(x=>{const g=x.target.files?.[0];if(!g)return;if(!g.type.startsWith("image/")){H.error("Please select a valid image file");return}if(g.size>5*1024*1024){H.error("Image size must be less than 5MB");return}l(g);const u=URL.createObjectURL(g);h(u)},[]),p=n.useCallback(async()=>{if(r){i(!0),b(!0);try{const x=await ur(r,1200,600,.8);b(!1),await a({heroImage:x}),o(x),c&&URL.revokeObjectURL(c),l(null),h(null),H.success("Hero image updated successfully!")}catch(x){console.error("Error uploading hero image:",x),H.error("Failed to upload hero image. Please try again.")}finally{i(!1),b(!1)}}},[r,a,c]),w=n.useCallback(async()=>{try{await a({heroImage:null}),o(null),H.success("Hero image removed successfully!")}catch(x){console.error("Error removing hero image:",x),H.error("Failed to remove hero image. Please try again.")}},[a]);return js.useEffect(()=>()=>{c&&URL.revokeObjectURL(c)},[c]),s.userType!=="admin"?e.jsxs(_e,{children:[e.jsx(Ae,{className:"h-4 w-4"}),e.jsx(Te,{children:"Only administrators can manage hero images."})]}):e.jsxs(R,{className:"w-full max-w-2xl mx-auto",children:[e.jsx(Y,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(Va,{className:"w-5 h-5"}),"Hero Section Image Manager"]}),e.jsx(f,{variant:"ghost",size:"sm",onClick:t,children:e.jsx(Le,{className:"w-4 h-4"})})]})}),e.jsxs(E,{className:"space-y-6",children:[k&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(O,{className:"text-sm font-medium",children:"Current Hero Image"}),e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:k,alt:"Current hero image",className:"w-full h-32 object-cover rounded-lg border"}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsxs(U,{variant:"secondary",className:"bg-green-100 text-green-800",children:[e.jsx(ee,{className:"w-3 h-3 mr-1"}),"Active"]})})]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:w,className:"w-full",children:[e.jsx(As,{className:"w-4 h-4 mr-2"}),"Remove Current Image"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(O,{className:"text-sm font-medium",children:k?"Replace Hero Image":"Upload Hero Image"}),e.jsx("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-muted rounded-lg flex items-center justify-center",children:e.jsx(Fa,{className:"w-6 h-6 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsxs(O,{htmlFor:"hero-image-upload",className:"cursor-pointer",children:[e.jsx("span",{className:"text-sm font-medium text-primary hover:text-primary/80",children:"Click to upload"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:" or drag and drop"})]}),e.jsx(W,{id:"hero-image-upload",type:"file",accept:"image/*",onChange:C,className:"hidden"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"PNG, JPG, GIF up to 5MB. Recommended: 1200x600px"})]})}),c&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(O,{className:"text-sm font-medium",children:"Preview"}),e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:c,alt:"Preview",className:"w-full h-32 object-cover rounded-lg border"}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsxs(U,{variant:"outline",className:"bg-blue-100 text-blue-800",children:[e.jsx(ge,{className:"w-3 h-3 mr-1"}),"Preview"]})})]})]}),r&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{onClick:p,disabled:v,className:"flex-1",children:v?e.jsxs(e.Fragment,{children:[e.jsx(Ps,{className:"w-4 h-4 mr-2 animate-spin"}),d?"Compressing...":"Uploading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Upload Image"]})}),e.jsx(f,{variant:"outline",onClick:()=>{l(null),c&&(URL.revokeObjectURL(c),h(null))},disabled:v,children:e.jsx(Le,{className:"w-4 h-4"})})]})]}),e.jsxs(_e,{children:[e.jsx(Ae,{className:"h-4 w-4"}),e.jsx(Te,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:"Hero Image Guidelines:"}),e.jsxs("ul",{className:"text-xs space-y-1 ml-4",children:[e.jsx("li",{children:"• Recommended size: 1200x600px (2:1 ratio)"}),e.jsx("li",{children:"• File size: Maximum 5MB"}),e.jsx("li",{children:"• Formats: PNG, JPG, GIF"}),e.jsx("li",{children:"• The image will be automatically compressed for optimal loading"}),e.jsx("li",{children:"• This image will be displayed in the hero section of the marketplace"})]})]})})]})]})]})}function Jr({currentAdmin:s,onBack:a,onNavigateToVerification:t,onUpdateUser:r}){const[l,c]=n.useState({totalUsers:0,pendingVerifications:0,totalProducts:0,activeTransactions:0,reportedContent:0,platformRevenue:0}),[h,v]=n.useState(!1),[i,d]=n.useState([]),[b,k]=n.useState(!0),[o]=n.useState([{id:"1",name:"Spam Product",seller:"Unknown",price:100,reportedCount:5},{id:"2",name:"Fake Listing",seller:"Suspicious",price:200,reportedCount:3}]),[C]=n.useState([{id:"1",amount:150,buyer:"John Doe",seller:"Jane Smith",date:"2 hours ago"},{id:"2",amount:300,buyer:"Mike Johnson",seller:"John Doe",date:"4 hours ago"}]),p=async()=>{try{k(!0);const{count:g}=await V.from("users").select("*",{count:"exact",head:!0}).neq("user_type","admin"),{data:u}=await V.from("users").select("verification_status, user_type").neq("user_type","admin");console.log("🔍 Debug - All verification statuses:",u?.map(N=>N.verification_status)),console.log("🔍 Debug - Under review count:",u?.filter(N=>N.verification_status==="under_review").length),console.log("🔍 Debug - Pending count:",u?.filter(N=>N.verification_status==="pending").length);const{count:y}=await V.from("users").select("*",{count:"exact",head:!0}).eq("verification_status","under_review").neq("user_type","admin"),{count:m}=await V.from("products").select("*",{count:"exact",head:!0}),{data:j}=await V.from("users").select("id, name, user_type, created_at, email").neq("user_type","admin").order("created_at",{ascending:!1}).limit(5);c({totalUsers:g||0,pendingVerifications:y||0,totalProducts:m||0,activeTransactions:156,reportedContent:8,platformRevenue:45670}),d(j||[])}catch(g){console.error("Error fetching admin data:",g)}finally{k(!1)}};n.useEffect(()=>{p()},[]),n.useEffect(()=>{const g=()=>{p()};return window.addEventListener("focus",g),()=>window.removeEventListener("focus",g)},[]);const w=(g,u)=>{console.log(`${u} product ${g}`)},x=g=>{const u=new Date(g),m=Math.floor((new Date().getTime()-u.getTime())/1e3);return m<60?"just now":m<3600?`${Math.floor(m/60)} minutes ago`:m<86400?`${Math.floor(m/3600)} hours ago`:`${Math.floor(m/86400)} days ago`};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Admin Dashboard"}),e.jsxs("p",{className:"text-gray-600",children:["Welcome back, ",s.name]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(f,{variant:"outline",size:"sm",onClick:p,disabled:b,className:"flex items-center gap-2",children:[e.jsx(za,{className:`h-4 w-4 ${b?"animate-spin":""}`}),"Refresh"]}),e.jsx(f,{variant:"outline",onClick:a,children:"← Back to App"})]})]}),e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(R,{children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ns,{className:"h-4 w-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold",children:b?"...":l.totalUsers.toLocaleString()})]})]})})}),e.jsx(R,{children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ce,{className:"h-4 w-4 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Verifications"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:b?"...":l.pendingVerifications})]})]})})}),e.jsx(R,{children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(he,{className:"h-4 w-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Products"}),e.jsx("p",{className:"text-2xl font-bold",children:b?"...":l.totalProducts.toLocaleString()})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(R,{children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(os,{className:"h-4 w-4 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Transactions"}),e.jsx("p",{className:"text-2xl font-bold",children:l.activeTransactions})]})]})})}),e.jsx(R,{children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(da,{className:"h-4 w-4 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Reported Content"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:l.reportedContent})]})]})})}),e.jsx(R,{children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ea,{className:"h-4 w-4 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Platform Revenue"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",l.platformRevenue.toLocaleString()]})]})]})})})]})]}),e.jsx("div",{className:"mb-8",children:e.jsxs(R,{children:[e.jsxs(Y,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(Yt,{className:"h-5 w-5"}),"Quick Actions"]}),e.jsx(Je,{children:"Common admin tasks"})]}),e.jsx(E,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs(f,{variant:"outline",className:"h-20 flex-col gap-2",onClick:()=>{t?t():window.location.href="/admin-verification"},children:[e.jsx(ae,{className:"h-6 w-6"}),e.jsx("span",{className:"text-sm",children:"Review Verifications"})]}),e.jsxs(f,{variant:"outline",className:"h-20 flex-col gap-2",children:[e.jsx(he,{className:"h-6 w-6"}),e.jsx("span",{className:"text-sm",children:"Moderate Products"})]}),e.jsxs(f,{variant:"outline",className:"h-20 flex-col gap-2",children:[e.jsx(ns,{className:"h-6 w-6"}),e.jsx("span",{className:"text-sm",children:"Manage Users"})]}),e.jsxs(f,{variant:"outline",className:"h-20 flex-col gap-2",children:[e.jsx(os,{className:"h-6 w-6"}),e.jsx("span",{className:"text-sm",children:"View Transactions"})]}),e.jsxs(f,{variant:"outline",className:"h-20 flex-col gap-2",onClick:()=>v(!0),children:[e.jsx(Va,{className:"h-6 w-6"}),e.jsx("span",{className:"text-sm",children:"Hero Image"})]})]})})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6 mb-6",children:[e.jsxs(R,{className:"border-l-4 border-l-yellow-500",children:[e.jsxs(Y,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5 text-yellow-600"}),"Verification Requests",e.jsxs(U,{variant:"destructive",className:"ml-2",children:[l.pendingVerifications," pending"]})]}),e.jsx(Je,{children:"User verification requests requiring review"})]}),e.jsx(E,{children:b?e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-gray-500",children:"Loading verification requests..."})}):l.pendingVerifications===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 mb-2",children:"✓"}),e.jsx("div",{className:"text-gray-500 mb-4",children:"No pending verification requests"}),e.jsx("div",{className:"text-sm text-gray-400",children:"All users are verified or no requests submitted"})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl font-bold text-yellow-600 mb-2",children:l.pendingVerifications}),e.jsxs("div",{className:"text-gray-600 mb-4",children:[l.pendingVerifications===1?"verification request":"verification requests"," pending review"]}),e.jsx(f,{className:"bg-yellow-600 hover:bg-yellow-700 text-white",onClick:()=>{t?t():window.location.href="/admin-verification"},children:"Review Verification Requests"})]})})]}),e.jsxs(R,{children:[e.jsxs(Y,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"h-5 w-5"}),"Recent Users"]}),e.jsx(Je,{children:"Latest user registrations"})]}),e.jsx(E,{children:e.jsx("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:b?e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-gray-500",children:"Loading recent users..."})}):i.length===0?e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-gray-500",children:"No recent users"})}):i.map(g=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:g.name}),e.jsx("p",{className:"text-sm text-gray-600 truncate",children:g.email}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(U,{variant:g.user_type==="farmer"?"default":"secondary",className:"text-xs",children:g.user_type}),e.jsxs("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(Ce,{className:"h-3 w-3"}),x(g.created_at)]})]})]}),e.jsxs("div",{className:"flex gap-1 ml-2",children:[e.jsx(f,{size:"sm",variant:"outline",className:"h-8 w-8 p-0",children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsx(f,{size:"sm",variant:"outline",className:"h-8 w-8 p-0",children:e.jsx(ae,{className:"h-4 w-4"})})]})]},g.id))})})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-1 gap-6",children:e.jsxs(R,{children:[e.jsxs(Y,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(da,{className:"h-5 w-5"}),"Reported Content"]}),e.jsx(Je,{children:"Items requiring attention"})]}),e.jsx(E,{children:e.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:o.map(g=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:g.name}),e.jsxs("p",{className:"text-sm text-gray-600 truncate",children:["by ",g.seller]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs(U,{variant:"destructive",className:"text-xs",children:[g.reportedCount," reports"]}),e.jsxs("span",{className:"text-sm text-gray-600",children:["$",g.price]})]})]}),e.jsxs("div",{className:"flex gap-1 ml-2",children:[e.jsx(f,{size:"sm",variant:"outline",className:"h-8 w-8 p-0",onClick:()=>w(g.id,"approve"),children:e.jsx(ee,{className:"h-4 w-4"})}),e.jsx(f,{size:"sm",variant:"outline",className:"h-8 w-8 p-0",onClick:()=>w(g.id,"remove"),children:e.jsx(Kt,{className:"h-4 w-4"})})]})]},g.id))})})]})})]})]}),h&&r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-background rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:e.jsx(Gr,{currentUser:s,onUpdate:r,onClose:()=>v(!1)})})})]})}function Wr({currentAdmin:s,onBack:a}){const[t,r]=n.useState([]),[l,c]=n.useState(null),[h,v]=n.useState(""),[i,d]=n.useState(!1);n.useEffect(()=>{const x=async()=>{try{const{data:u,error:y}=await V.from("verification_requests").select(`
            id,
            user_id,
            user_email,
            user_name,
            user_type,
            account_type,
            request_type,
            status,
            submitted_at,
            reviewed_at,
            reviewed_by,
            verification_documents,
            business_info,
            phone_verified,
            admin_notes,
            created_at,
            updated_at
          `).order("submitted_at",{ascending:!1});if(y)throw console.error("❌ Error fetching verification requests:",y),y;const j=(u||[]).map(N=>({id:N.id,userId:N.user_id,userEmail:N.user_email,userName:N.user_name,userType:N.user_type,accountType:N.account_type,verificationStatus:N.status==="under_review"?"under_review":N.status==="approved"?"verified":N.status==="rejected"?"rejected":"under_review",verificationSubmitted:!0,verificationDocuments:N.verification_documents||{},businessInfo:N.business_info||{},phoneVerified:N.phone_verified,submittedAt:N.submitted_at,type:N.account_type==="business"?"Business Account":"Individual Account",status:N.status,documents:N.verification_documents||{},businessType:N.account_type}));r(j)}catch(u){console.error("❌ Failed to load verification requests:",u),H.error("Failed to load verification requests")}};x();const g=setInterval(x,3e4);return()=>clearInterval(g)},[]);const b=async x=>{d(!0);try{const{data:g,error:u}=await V.from("users").select("id, email, user_type, name").eq("id",s.id).single(),{error:y}=await V.from("verification_requests").update({status:"approved",reviewed_at:new Date().toISOString(),reviewed_by:s.id,admin_notes:h||"Approved by admin"}).eq("id",x);if(y)throw y;const m=t.find(N=>N.id===x);if(m){const{data:N,error:M}=await V.from("users").select("id, email, verification_status, verified").eq("id",m.userId).single();if(M){console.error("❌ User not found in database:",M);return}const{data:_,error:P}=await V.from("users").update({verification_status:"verified",verified:!0,verified_at:new Date().toISOString()}).eq("id",m.userId).select("id, email, verification_status, verified, verified_at");P&&(console.error("❌ Error updating user status:",P),console.log("⚠️ This is likely due to RLS policies - admin cannot update other users directly"))}else console.error("❌ Request not found for ID:",x),console.error("❌ Available requests:",t.map(N=>({id:N.id,userId:N.userId})));await(async()=>{try{const{data:N,error:M}=await V.from("verification_requests").select(`
              id,
              user_id,
              user_email,
              user_name,
              user_type,
              account_type,
              request_type,
              status,
              submitted_at,
              reviewed_at,
              reviewed_by,
              verification_documents,
              business_info,
              phone_verified,
              admin_notes,
              created_at,
              updated_at
            `).order("submitted_at",{ascending:!1});if(M)throw M;const _=(N||[]).map(P=>({id:P.id,userId:P.user_id,userEmail:P.user_email,userName:P.user_name,userType:P.user_type,accountType:P.account_type,verificationStatus:P.status==="under_review"?"under_review":P.status==="approved"?"verified":P.status==="rejected"?"rejected":"under_review",verificationSubmitted:!0,verificationDocuments:P.verification_documents||{},businessInfo:P.business_info||{},phoneVerified:P.phone_verified,submittedAt:P.submitted_at,type:P.account_type==="business"?"Business Account":"Individual Account",status:P.status,documents:P.verification_documents||{},businessType:P.account_type}));r(_)}catch(N){console.error("❌ Failed to refresh requests:",N)}})(),c(null),v(""),H.success("Verification request approved")}catch(g){console.error("Error approving request:",g),H.error("Failed to approve request")}finally{d(!1)}},k=async x=>{d(!0);try{const{error:g}=await V.from("verification_requests").update({status:"rejected",reviewed_at:new Date().toISOString(),reviewed_by:s.id,admin_notes:h||"Rejected by admin"}).eq("id",x);if(g)throw g;const u=t.find(y=>y.id===x);if(u){const{error:y}=await V.from("users").update({verification_status:"rejected",verified:!1}).eq("id",u.userId);y&&console.error("Error updating user status:",y)}r(y=>y.map(m=>m.id===x?{...m,verificationStatus:"rejected",status:"rejected"}:m)),c(null),v(""),H.success("Verification request rejected")}catch(g){console.error("Error rejecting request:",g),H.error("Failed to reject request")}finally{d(!1)}},o=x=>{switch(x){case"under_review":return e.jsxs(U,{variant:"secondary",className:"bg-yellow-100 text-yellow-800",children:[e.jsx(Ce,{className:"w-3 h-3 mr-1"}),"Under Review"]});case"approved":case"verified":return e.jsxs(U,{variant:"secondary",className:"bg-green-100 text-green-800",children:[e.jsx(ee,{className:"w-3 h-3 mr-1"}),"Approved"]});case"rejected":return e.jsxs(U,{variant:"secondary",className:"bg-red-100 text-red-800",children:[e.jsx($e,{className:"w-3 h-3 mr-1"}),"Rejected"]});default:return e.jsxs(U,{variant:"secondary",className:"bg-gray-100 text-gray-800",children:[e.jsx(Ce,{className:"w-3 h-3 mr-1"}),"Pending"]})}},C=x=>x==="business"?e.jsx(es,{className:"w-4 h-4"}):e.jsx(Pe,{className:"w-4 h-4"}),p=t.filter(x=>x.verificationStatus==="under_review"),w=t.filter(x=>x.verificationStatus!=="under_review");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Verification Requests"}),e.jsx("p",{className:"text-gray-600",children:"Review and manage user verification requests"})]}),e.jsx(f,{variant:"outline",onClick:a,children:"← Back to Dashboard"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(R,{children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Requests"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.length})]}),e.jsx(ae,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(R,{children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Review"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:p.length})]}),e.jsx(Ce,{className:"h-8 w-8 text-yellow-600"})]})})}),e.jsx(R,{children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Approved"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:t.filter(x=>x.verificationStatus==="verified").length})]}),e.jsx(ee,{className:"h-8 w-8 text-green-600"})]})})}),e.jsx(R,{children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Rejected"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:t.filter(x=>x.verificationStatus==="rejected").length})]}),e.jsx($e,{className:"h-8 w-8 text-red-600"})]})})})]}),p.length>0&&e.jsxs(R,{children:[e.jsxs(Y,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5 text-yellow-600"}),"Pending Review (",p.length,")"]}),e.jsx(Je,{children:"Verification requests awaiting admin review"})]}),e.jsx(E,{children:e.jsx("div",{className:"space-y-4",children:p.map(x=>e.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[C(x.accountType),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:x.userName}),e.jsx("p",{className:"text-sm text-gray-600",children:x.userEmail}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[o(x.verificationStatus),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(x.submittedAt).toLocaleDateString()})]})]})]}),e.jsxs(aa,{children:[e.jsx(Ua,{asChild:!0,children:e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>c(x),children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Review"]})}),e.jsxs(Ms,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(ta,{children:[e.jsx(Vs,{children:"Review Verification Request"}),e.jsxs(zs,{children:["Review documents and information for ",x.userName]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(O,{className:"text-sm font-medium",children:"User Information"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm",children:x.userName})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Email:"}),e.jsx("span",{className:"text-sm",children:x.userEmail})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Type:"}),e.jsx("span",{className:"text-sm",children:x.type})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Phone Verified:"}),e.jsx("span",{className:"text-sm",children:x.phoneVerified?"Yes":"No"})]})]})]}),x.businessInfo&&e.jsxs("div",{children:[e.jsx(O,{className:"text-sm font-medium",children:"Business Information"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm",children:x.businessInfo.businessName})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm",children:x.businessInfo.location})]}),e.jsx("p",{className:"text-sm text-gray-600",children:x.businessInfo.businessDescription})]})]})]}),e.jsx(Is,{}),e.jsxs("div",{children:[e.jsx(O,{className:"text-sm font-medium",children:"Uploaded Documents"}),e.jsxs("div",{className:"mt-2 space-y-3",children:[x.verificationDocuments?.idCard&&e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium",children:"ID Card"}),e.jsx(U,{variant:"outline",className:"text-xs",children:x.verificationDocuments.idCard.status})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:x.verificationDocuments.idCard.name}),x.verificationDocuments.idCard.data?e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>{const g=document.createElement("a");g.href=x.verificationDocuments?.idCard?.data||"",g.download=x.verificationDocuments?.idCard?.name||"id-card",g.click()},children:[e.jsx(ma,{className:"w-3 h-3 mr-1"}),"Download"]}):e.jsx("div",{className:"text-xs text-gray-400",children:"File content not stored"})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Uploaded: ",x.verificationDocuments.idCard.uploadedAt?new Date(x.verificationDocuments.idCard.uploadedAt).toLocaleString():"Unknown"]})]}),x.verificationDocuments?.businessLicense&&e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Business License"}),e.jsx(U,{variant:"outline",className:"text-xs",children:x.verificationDocuments.businessLicense.status})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:x.verificationDocuments.businessLicense.name}),x.verificationDocuments.businessLicense.data?e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>{const g=document.createElement("a");g.href=x.verificationDocuments?.businessLicense?.data||"",g.download=x.verificationDocuments?.businessLicense?.name||"business-license",g.click()},children:[e.jsx(ma,{className:"w-3 h-3 mr-1"}),"Download"]}):e.jsx("div",{className:"text-xs text-gray-400",children:"File content not stored"})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Uploaded: ",x.verificationDocuments.businessLicense.uploadedAt?new Date(x.verificationDocuments.businessLicense.uploadedAt).toLocaleString():"Unknown"]})]})]})]}),e.jsx(Is,{}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"admin-notes",className:"text-sm font-medium",children:"Admin Notes (Optional)"}),e.jsx(ze,{id:"admin-notes",placeholder:"Add notes about this verification request...",value:h,onChange:g=>v(g.target.value),className:"mt-2"})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(f,{variant:"outline",onClick:()=>{c(null),v("")},children:"Cancel"}),e.jsxs(f,{variant:"destructive",onClick:()=>k(x.id),disabled:i,children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Reject"]}),e.jsxs(f,{onClick:()=>b(x.id),disabled:i,children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Approve"]})]})]})]})]})]})},x.id))})})]}),w.length>0&&e.jsxs(R,{children:[e.jsxs(Y,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-green-600"}),"Processed Requests (",w.length,")"]}),e.jsx(Je,{children:"Previously reviewed verification requests"})]}),e.jsx(E,{children:e.jsx("div",{className:"space-y-4",children:w.map(x=>e.jsx("div",{className:"border rounded-lg p-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[C(x.accountType),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:x.userName}),e.jsx("p",{className:"text-sm text-gray-600",children:x.userEmail}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[o(x.verificationStatus),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(x.submittedAt).toLocaleDateString()})]})]})]})})},x.id))})})]}),t.length===0&&e.jsx(R,{children:e.jsxs(E,{className:"p-8 text-center",children:[e.jsx(ae,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Verification Requests"}),e.jsx("p",{className:"text-gray-600",children:"No verification requests have been submitted yet."})]})})]})}function ba({className:s,...a}){return e.jsx(Tt,{"data-slot":"avatar",className:Q("relative flex size-10 shrink-0 overflow-hidden rounded-full",s),...a})}function Na({className:s,...a}){return e.jsx(Pt,{"data-slot":"avatar-fallback",className:Q("bg-muted flex size-full items-center justify-center rounded-full",s),...a})}function Yr({...s}){return e.jsx(Dt,{"data-slot":"dropdown-menu",...s})}function Kr({...s}){return e.jsx(Lt,{"data-slot":"dropdown-menu-trigger",...s})}function Qr({className:s,sideOffset:a=4,...t}){return e.jsx(It,{children:e.jsx(At,{"data-slot":"dropdown-menu-content",sideOffset:a,className:Q("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",s),...t})})}function He({className:s,inset:a,variant:t="default",...r}){return e.jsx(Ft,{"data-slot":"dropdown-menu-item","data-inset":a,"data-variant":t,className:Q("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...r})}function Zr({className:s,inset:a,...t}){return e.jsx(Rt,{"data-slot":"dropdown-menu-label","data-inset":a,className:Q("px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",s),...t})}function wa({className:s,...a}){return e.jsx(Et,{"data-slot":"dropdown-menu-separator",className:Q("bg-border -mx-1 my-1 h-px",s),...a})}function Xr({user:s,onLogout:a,onViewStorefront:t,onUpdateUser:r,onGoToDashboard:l,onShowVerification:c,onEditProfile:h,onViewProfile:v,onViewMessages:i,onShowAdminVerification:d}){const[b,k]=n.useState(!1),o=p=>{switch(Ye(p)){case"business-verified":return{status:"verified",color:"text-green-600 dark:text-green-400",bgColor:"bg-green-50 dark:bg-green-900/20",borderColor:"border-green-200 dark:border-green-800",dotColor:"bg-green-600"};case"id-verified":return{status:"verified",color:"text-green-600 dark:text-green-400",bgColor:"bg-green-50 dark:bg-green-900/20",borderColor:"border-green-200 dark:border-green-800",dotColor:"bg-green-600"};case"under-review":return{status:"under-review",color:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-50 dark:bg-blue-900/20",borderColor:"border-blue-200 dark:border-blue-800",dotColor:"bg-blue-600"};case"phone-verified":return{status:"in-progress",color:"text-yellow-600 dark:text-yellow-400",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",borderColor:"border-yellow-200 dark:border-yellow-800",dotColor:"bg-yellow-600"};default:return{status:"not-started",color:"text-red-600 dark:text-red-400",bgColor:"bg-red-50 dark:bg-red-900/20",borderColor:"border-red-200 dark:border-red-800",dotColor:"bg-red-600"}}},C=p=>p.split(" ").map(w=>w[0]).join("").toUpperCase().slice(0,2);return b?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-card rounded-lg p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"My Profile"}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>k(!1),children:"×"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(ba,{className:"w-20 h-20 mx-auto mb-4",children:s.profileImage||s.avatar?e.jsx(Gs,{src:s.profileImage||s.avatar,alt:`${s.name}'s profile`,className:"w-full h-full object-cover rounded-full"}):e.jsx(Na,{className:"text-lg",children:C(s.name)})}),e.jsx("h3",{className:"text-lg font-medium",children:s.name}),e.jsx(Ns,{userType:s.userType,accountType:ms(s),verificationLevel:Ye(s),size:"sm"}),s.userType!=="admin"&&e.jsxs("div",{className:"mt-2",children:[s.verified&&e.jsxs("div",{className:"flex items-center justify-center gap-1 text-sm text-green-600",children:[e.jsx(ae,{className:"w-4 h-4"}),"Verified Account"]}),s.verificationStatus==="under_review"&&e.jsxs("div",{className:"flex items-center justify-center gap-1 text-sm text-amber-600",children:[e.jsx(Ae,{className:"w-4 h-4"}),"Verification Under Review"]}),!s.verified&&s.verificationStatus!=="under_review"&&e.jsxs("div",{className:"flex items-center justify-center gap-1 text-sm text-muted-foreground",children:[e.jsx(ae,{className:"w-4 h-4"}),"Verification Available"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),"Contact Information"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsx("span",{children:s.location})]}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(qe,{className:"w-4 h-4"}),e.jsx("span",{children:s.phone})]})]})]}),s.businessName&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(Xe,{className:"w-4 h-4"}),"Business Information"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Business Name:"}),e.jsx("div",{className:"text-muted-foreground",children:s.businessName})]}),s.businessDescription&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Description:"}),e.jsx("div",{className:"text-muted-foreground",children:s.businessDescription})]}),s.experience&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Experience:"}),e.jsx("div",{className:"text-muted-foreground",children:s.experience})]}),s.specialization&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Specialization:"}),e.jsx("div",{className:"text-muted-foreground capitalize",children:s.specialization})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"Account Stats"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center p-3 bg-muted rounded-lg",children:[e.jsx("div",{className:"font-medium",children:"Member Since"}),e.jsx("div",{className:"text-muted-foreground",children:Es(s.joinedDate)})]}),e.jsxs("div",{className:"text-center p-3 bg-muted rounded-lg",children:[e.jsx("div",{className:"font-medium",children:"Rating"}),e.jsx("div",{className:"text-muted-foreground",children:s.rating>0?`${s.rating}/5`:"No ratings yet"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[(s.userType==="farmer"||s.userType==="trader"||s.userType==="buyer")&&l&&e.jsxs(f,{variant:"outline",className:"w-full justify-start gap-2",onClick:()=>{k(!1),l()},children:[e.jsx(ua,{className:"w-4 h-4"}),"Dashboard"]}),s.userType==="admin"&&l&&e.jsxs(f,{variant:"outline",className:"w-full justify-start gap-2",onClick:()=>{k(!1),l()},children:[e.jsx(ae,{className:"w-4 h-4"}),"Admin Panel"]}),s.userType==="admin"&&d&&e.jsxs(f,{variant:"outline",className:"w-full justify-start gap-2",onClick:()=>{k(!1),d()},children:[e.jsx(ls,{className:"w-4 h-4"}),"Verification Requests"]}),s.userType!=="admin"&&e.jsxs(f,{variant:"outline",className:"w-full justify-start gap-2",onClick:()=>{k(!1),i?.()},children:[e.jsx(Ke,{className:"w-4 h-4"}),"Messages"]}),s.userType!=="admin"&&e.jsxs(f,{variant:"outline",className:"w-full justify-start gap-2",onClick:()=>{k(!1),c?.()},children:[e.jsx(ae,{className:`w-4 h-4 ${o(s).color}`}),s.verified?"Verification Status":s.verificationStatus==="under_review"?"Verification":s.verificationSubmitted?"Verification Status":"Get Verified",o(s).status==="under-review"&&e.jsx(U,{variant:"secondary",className:`ml-auto text-xs ${o(s).bgColor} ${o(s).color} ${o(s).borderColor}`,children:s.verificationStatus==="under_review"||s.verificationSubmitted?"Under Review":"Reviewing"}),o(s).status==="verified"&&e.jsx(U,{variant:"secondary",className:`ml-auto text-xs ${o(s).bgColor} ${o(s).color} ${o(s).borderColor}`,children:"Verified"}),o(s).status==="in-progress"&&e.jsx(U,{variant:"secondary",className:`ml-auto text-xs ${o(s).bgColor} ${o(s).color} ${o(s).borderColor}`,children:"Phone Verified"}),o(s).status==="not-started"&&e.jsx(U,{variant:"secondary",className:"ml-auto text-xs",children:"Available"})]}),e.jsxs(f,{variant:"outline",className:"w-full justify-start gap-2",children:[e.jsx(Ma,{className:"w-4 h-4"}),"Notification Settings"]}),e.jsxs(f,{variant:"outline",className:"w-full justify-start gap-2 text-destructive hover:text-destructive",onClick:()=>{k(!1),a()},children:[e.jsx(ha,{className:"w-4 h-4"}),"Sign Out"]})]})]})]})}):e.jsx("div",{children:e.jsxs(Yr,{children:[e.jsx(Kr,{className:"relative h-9 w-9 md:h-10 md:w-10 rounded-full hover:bg-accent/50 transition-colors cursor-pointer focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",children:e.jsx(ba,{className:"h-9 w-9 md:h-10 md:w-10",children:s.profileImage||s.avatar?e.jsx(Gs,{src:s.profileImage||s.avatar,alt:`${s.name}'s profile`,className:"w-full h-full object-cover rounded-full"}):e.jsx(Na,{className:"text-sm",children:C(s.name)})})}),e.jsxs(Qr,{className:"w-56",align:"end",forceMount:!0,children:[e.jsx(Zr,{className:"font-normal",children:e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-medium leading-none",children:s.name}),e.jsxs(U,{variant:"outline",className:`text-xs px-2 py-0.5 font-medium flex items-center gap-1 ${s.userType==="farmer"?"bg-green-600 text-white border-green-600":s.userType==="trader"?"bg-orange-600 text-white border-orange-600":s.userType==="buyer"?"bg-blue-50 text-blue-700 border-blue-200 dark:bg-blue-900/20 dark:text-blue-400 dark:border-blue-800":"bg-gray-50 text-gray-700 border-gray-200 dark:bg-gray-900/20 dark:text-gray-300 dark:border-gray-800"}`,children:[ms(s)==="business"?e.jsx(es,{className:`w-3 h-3 ${s.userType==="farmer"||s.userType==="trader"?"text-white":s.userType==="buyer"?"text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300"}`}):e.jsx(Pe,{className:`w-3 h-3 ${s.userType==="farmer"||s.userType==="trader"?"text-white":s.userType==="buyer"?"text-blue-700 dark:text-blue-400":"text-gray-700 dark:text-gray-300"}`}),s.userType==="farmer"&&"Farmer",s.userType==="trader"&&"Trader",s.userType==="buyer"&&"Buyer",s.userType==="admin"&&"Admin"]})]}),e.jsx("p",{className:"text-xs leading-none text-muted-foreground",children:s.email})]})}),e.jsx(wa,{}),s.userType!=="admin"&&e.jsxs(He,{onClick:v,children:[e.jsx(Pe,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Profile"})]}),(s.userType==="farmer"||s.userType==="trader"||s.userType==="buyer")&&l&&e.jsxs(He,{onClick:l,children:[e.jsx(ua,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Dashboard"})]}),s.userType==="admin"&&l&&e.jsxs(He,{onClick:l,children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Admin Panel"})]}),s.userType==="admin"&&d&&e.jsxs(He,{onClick:d,children:[e.jsx(ls,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Verification Requests"})]}),(s.userType==="farmer"||s.userType==="trader")&&e.jsxs(He,{onClick:()=>t?.(s.id),children:[e.jsx(Xe,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"My Storefront"})]}),s.userType!=="admin"&&e.jsxs(He,{onClick:i,children:[e.jsx(Ke,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Messages"})]}),s.userType!=="admin"&&e.jsxs(He,{onClick:()=>c?.(),children:[e.jsx(ae,{className:`mr-2 h-4 w-4 ${o(s).color}`}),e.jsx("span",{children:s.verified?"Verification Status":s.verificationStatus==="under_review"?"Verification":s.verificationSubmitted?"Verification Status":"Get Verified"}),o(s).status==="under-review"&&e.jsx("div",{className:`ml-auto w-2 h-2 rounded-full ${o(s).dotColor}`,title:"Under Review"}),o(s).status==="verified"&&e.jsx("div",{className:`ml-auto w-2 h-2 rounded-full ${o(s).dotColor}`,title:"Verified"}),o(s).status==="in-progress"&&e.jsx("div",{className:`ml-auto w-2 h-2 rounded-full ${o(s).dotColor}`,title:"Phone Verified - ID Verification Still Needed"}),o(s).status==="not-started"&&e.jsx("div",{className:`ml-auto w-2 h-2 rounded-full ${o(s).dotColor}`,title:"Verification Available"})]}),e.jsx(wa,{}),e.jsxs(He,{onClick:a,children:[e.jsx(ha,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Log out"})]})]})]})})}function ei({currentView:s,currentUser:a,onBackToMarketplace:t,onGoToDashboard:r,onGoToLogin:l,onGoToRegister:c,onLogout:h,onViewStorefront:v,onUpdateUser:i,onShowVerification:d,onEditProfile:b,onViewProfile:k,onViewMessages:o,onShowAdminVerification:C,editingProduct:p}){return e.jsx("header",{className:"sticky top-0 z-40 border-b bg-card",children:e.jsx("div",{className:"w-full max-w-5xl mx-auto px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:t,className:"flex items-center gap-3 hover:opacity-80 transition-opacity duration-200 cursor-pointer",children:[e.jsx("div",{className:"w-10 h-10 md:w-12 md:h-12 bg-primary rounded-lg flex items-center justify-center shadow-md",children:e.jsx(Be,{className:"w-5 h-5 md:w-6 md:h-6 text-primary-foreground"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h1",{className:"text-lg md:text-xl font-semibold",children:"AgriLink"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground hidden sm:block",children:"Linking agriculture to opportunity"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[e.jsx("div",{className:"flex md:hidden items-center gap-1",children:s!=="marketplace"&&e.jsx(f,{variant:"ghost",onClick:t,className:"px-2 h-8 text-sm",children:"Home"})}),e.jsxs("div",{className:"hidden md:flex items-center gap-2",children:[e.jsx(f,{variant:s==="marketplace"?"default":"ghost",className:"h-9 px-4 text-sm",onClick:t,children:"Marketplace"}),a&&e.jsxs(e.Fragment,{children:[(a.userType==="farmer"||a.userType==="trader"||a.userType==="buyer")&&e.jsx(f,{variant:s==="dashboard"?"default":"ghost",className:"h-9 px-4 text-sm",onClick:r,children:"Dashboard"}),a.userType==="admin"&&e.jsx(f,{variant:s==="dashboard"?"default":"ghost",className:"h-9 px-4 text-sm",onClick:r,children:"Admin Panel"}),s==="profile"&&e.jsx(f,{variant:"default",size:"sm",disabled:!0,children:"Profile"}),s==="add-listing"&&e.jsx(f,{variant:"default",size:"sm",disabled:!0,children:p?"Edit Listing":"Add Listing"}),s==="messages"&&e.jsx(f,{variant:"default",size:"sm",disabled:!0,children:"Messages"}),s==="verification"&&e.jsx(f,{variant:"default",size:"sm",disabled:!0,children:"Verification"}),s==="admin-verification"&&e.jsx(f,{variant:"default",size:"sm",disabled:!0,children:"Admin Verification"})]}),!a&&s==="forgot-password"&&e.jsx(f,{variant:"ghost",size:"sm",disabled:!0,children:"Reset Password"})]}),a?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm text-muted-foreground hidden lg:inline font-medium",children:["Welcome, ",a.name.split(" ")[0]]}),e.jsx(Xr,{user:a,onLogout:h,onViewStorefront:v,onUpdateUser:i,onGoToDashboard:r,onShowVerification:d,onEditProfile:b,onViewProfile:k,onViewMessages:o,onShowAdminVerification:C})]}):e.jsxs("div",{className:"flex items-center gap-1 md:gap-2",children:[e.jsx(f,{variant:s==="login"?"default":"outline",onClick:l,className:"md:hidden px-2 h-8",children:e.jsx(xa,{className:"w-4 h-4"})}),e.jsx(f,{variant:s==="register"?"default":"outline",onClick:c,className:"md:hidden px-2 h-8",children:e.jsx(fa,{className:"w-4 h-4"})}),e.jsxs(f,{variant:s==="login"?"default":"outline",onClick:l,className:"hidden md:flex h-9 px-4 text-sm",children:[e.jsx(xa,{className:"w-4 h-4 mr-2"}),"Sign In"]}),e.jsxs(f,{variant:s==="register"?"default":"outline",onClick:c,className:"hidden md:flex h-9 px-4 text-sm",children:[e.jsx(fa,{className:"w-4 h-4 mr-2"}),"Register"]})]})]})]})})})}function si({onShowAboutUs:s,onShowContactUs:a,onShowFAQ:t}){return e.jsxs("footer",{className:"border-t bg-card mt-8",children:[e.jsxs("div",{className:"w-full max-w-5xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx(Be,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm md:text-base font-semibold",children:"Connecting Myanmar's Agricultural Community"})]}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground max-w-xl mx-auto",children:"Transparent pricing • Direct connections • Quality products • Trusted marketplace"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-0",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(Ks,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-medium text-xs md:text-sm",children:"For Farmers"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Direct sales • Fair pricing • Wider market reach"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(We,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-medium text-xs md:text-sm",children:"For Traders"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Quality sourcing • Efficient distribution • Network growth"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(Ys,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-medium text-xs md:text-sm",children:"For Buyers"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Fresh products • Direct from source • Transparent pricing"})]})]})]}),e.jsx("div",{className:"border-t"}),e.jsx("div",{className:"w-full max-w-5xl mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs text-muted-foreground text-center md:text-left",children:e.jsx("p",{children:"© 2025 AgriLink - Academic Project developed in partnership with Infinity Success Co. Ltd."})}),e.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[e.jsx("button",{onClick:s,className:"text-muted-foreground hover:text-primary transition-colors duration-200",children:"About Us"}),e.jsx("span",{className:"text-muted-foreground",children:"•"}),e.jsx("button",{onClick:a,className:"text-muted-foreground hover:text-primary transition-colors duration-200",children:"Contact Us"}),e.jsx("span",{className:"text-muted-foreground",children:"•"}),e.jsx("button",{onClick:t,className:"text-muted-foreground hover:text-primary transition-colors duration-200",children:"FAQ"})]})]})})]})}function ai({currentUser:s,allProducts:a,onGoToRegister:t,onGoToLogin:r,onShowAddListing:l,heroImage:c}){return e.jsxs("section",{className:"relative py-8 lg:py-12 overflow-hidden",children:[c&&e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("img",{src:c,alt:"Hero background",className:"w-full h-full object-cover opacity-20"}),e.jsx("div",{className:"absolute inset-0 bg-black/30"})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/15 via-amber-900/8 to-stone-600/12"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-tr from-transparent via-primary/8 to-transparent"}),e.jsx("div",{className:"absolute top-6 right-6 w-32 h-32 bg-primary/20 rounded-full blur-2xl"}),e.jsx("div",{className:"absolute bottom-6 left-6 w-40 h-40 bg-amber-900/25 rounded-full blur-2xl"}),e.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-stone-700/15 rounded-full blur-3xl"}),e.jsxs("div",{className:"relative max-w-5xl mx-auto text-center space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h1",{className:"text-3xl lg:text-4xl font-bold tracking-tight",children:[e.jsxs("span",{className:"text-foreground",children:["Connect."," "]}),e.jsxs("span",{className:"text-primary",children:["Discover."," "]}),e.jsx("span",{className:"text-foreground",children:"Thrive."})]}),e.jsx("p",{className:"text-lg text-muted-foreground max-w-3xl mx-auto",children:"Connecting producers, distributors, businesses, and consumers across Myanmar. Quality products, transparent pricing, and trusted partnerships for all."})]}),s?e.jsxs("div",{className:"bg-card border rounded-2xl p-4 max-w-2xl mx-auto",children:[e.jsxs("p",{className:"text-foreground mb-2",children:["Welcome back,"," ",e.jsx("span",{className:"font-semibold text-primary",children:s.name.split(" ")[0]}),"!"]}),e.jsx("p",{className:"text-muted-foreground mb-3 text-sm",children:s.userType==="farmer"?"Ready to share your fresh products with customers across Myanmar?":s.userType==="trader"?"Ready to connect buyers with quality agricultural products?":"Discover fresh products and connect directly with local farmers and suppliers."}),(s.userType==="farmer"||s.userType==="trader")&&e.jsxs(f,{size:"lg",onClick:l,className:"px-6 py-3 rounded-xl",children:["List Your Products"," ",e.jsx(Us,{className:"ml-2 w-4 h-4"})]})]}):e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center items-center",children:[e.jsxs(f,{size:"lg",onClick:t,className:"px-6 py-4 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300",children:["Get Started"," ",e.jsx(Us,{className:"ml-2 w-4 h-4"})]}),e.jsx(f,{size:"lg",variant:"outline",onClick:r,className:"px-6 py-4 rounded-xl",children:"Sign In"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 max-w-4xl mx-auto pt-6",children:[e.jsxs("div",{className:"bg-card border rounded-xl p-3 text-center",children:[e.jsxs("div",{className:"text-xl font-bold text-foreground",children:[a.length,"+"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Fresh Products"})]}),e.jsxs("div",{className:"bg-card border rounded-xl p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold text-foreground",children:"Connected"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Supply Network"})]}),e.jsxs("div",{className:"bg-card border rounded-xl p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold text-foreground",children:"Fair"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Transparent Pricing"})]}),e.jsxs("div",{className:"bg-card border rounded-xl p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold text-foreground",children:"Local"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Myanmar Grown"})]})]})]})]})}class ti extends js.Component{constructor(a){super(a),this.state={hasError:!1}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,t){console.error("AgriLink Error Boundary caught an error:",a,t)}handleRetry=()=>{this.setState({hasError:!1,error:void 0})};render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs(R,{className:"max-w-md mx-auto",children:[e.jsxs(Y,{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-destructive/10 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Ds,{className:"w-8 h-8 text-destructive"})}),e.jsx(K,{children:"Something went wrong"})]}),e.jsxs(E,{className:"space-y-4 text-center",children:[e.jsx("p",{className:"text-muted-foreground",children:"AgriLink encountered an unexpected error. Don't worry, your data is safe."}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(f,{onClick:this.handleRetry,className:"w-full",children:[e.jsx(za,{className:"w-4 h-4 mr-2"}),"Try Again"]}),e.jsx(f,{variant:"outline",onClick:()=>window.location.reload(),className:"w-full",children:"Refresh Page"})]}),!1]})]})}):this.props.children}}function ri({currentPage:s,totalPages:a,totalItems:t,itemsPerPage:r,onPageChange:l,onItemsPerPageChange:c,itemsPerPageOptions:h=[6,12,24,48],showItemsPerPageSelector:v=!0,className:i=""}){const d=(s-1)*r+1,b=Math.min(s*r,t),o=(()=>{const C=[];if(a<=5)for(let w=1;w<=a;w++)C.push(w);else{C.push(1);let w=Math.max(2,s-1),x=Math.min(a-1,s+1);s<=3&&(x=Math.min(a-1,4)),s>=a-2&&(w=Math.max(2,a-3)),w>2&&C.push("...");for(let g=w;g<=x;g++)C.push(g);x<a-1&&C.push("..."),a>1&&C.push(a)}return C})();return a<=1&&!v?null:e.jsxs("div",{className:`flex flex-col sm:flex-row items-center justify-between gap-4 ${i}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[v&&c&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Show:"}),e.jsxs(ce,{value:r.toString(),onValueChange:C=>c(parseInt(C)),children:[e.jsx(me,{className:"w-20 h-8",children:e.jsx(de,{})}),e.jsx(ue,{children:h.map(C=>e.jsx(B,{value:C.toString(),children:C},C))})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",d,"-",b," of ",t," products"]})]}),a>1&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(f,{variant:"outline",size:"sm",onClick:()=>l(1),disabled:s===1,className:"h-8 w-8 p-0",children:e.jsx(Qt,{className:"h-4 w-4"})}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>l(s-1),disabled:s===1,className:"h-8 w-8 p-0",children:e.jsx(Oe,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex items-center gap-1",children:o.map((C,p)=>e.jsx("div",{children:C==="..."?e.jsx("span",{className:"px-2 py-1 text-muted-foreground",children:"..."}):e.jsx(f,{variant:s===C?"default":"outline",size:"sm",onClick:()=>l(C),className:"h-8 w-8 p-0",children:C})},p))}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>l(s+1),disabled:s===a,className:"h-8 w-8 p-0",children:e.jsx(gs,{className:"h-4 w-4"})}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>l(a),disabled:s===a,className:"h-8 w-8 p-0",children:e.jsx(Zt,{className:"h-4 w-4"})})]})]})}const ii=({...s})=>{const{theme:a="system"}=Xt();return e.jsx(er,{theme:a,className:"toaster group",style:{"--normal-bg":"var(--popover)","--normal-text":"var(--popover-foreground)","--normal-border":"var(--border)"},...s})};function ni({items:s,itemsPerPage:a=12,initialPage:t=1}){const[r,l]=n.useState(t),[c,h]=n.useState(a),v=s.length,i=Math.ceil(v/c),d=(r-1)*c,b=Math.min(d+c,v),k=n.useMemo(()=>s.slice(d,b),[s,d,b]),o=r<i,C=r>1,p=n.useCallback(y=>{const m=Math.max(1,Math.min(y,i));l(m)},[i]),w=n.useCallback(()=>{o&&l(y=>y+1)},[o]),x=n.useCallback(()=>{C&&l(y=>y-1)},[C]),g=n.useCallback(()=>{l(1)},[]),u=n.useCallback(y=>{h(y),l(1)},[]);return n.useMemo(()=>{r>i&&i>0&&l(1)},[i,r]),{currentPage:r,totalPages:i,totalItems:v,itemsPerPage:c,currentItems:k,startIndex:d,endIndex:b,hasNextPage:o,hasPreviousPage:C,goToPage:p,nextPage:w,previousPage:x,setItemsPerPage:u,resetToFirstPage:g}}const li=(s,a,t)=>{const r=n.useMemo(()=>s.filter(c=>{const h=!a.search||c.name.toLowerCase().includes(a.search.toLowerCase())||c.sellerName.toLowerCase().includes(a.search.toLowerCase());let v=!0;a.region&&a.region!=="all"&&(v=jr(c.location)===a.region),a.city&&a.city!=="all"&&(v=c.location===a.city),a.location&&a.location!=="all"&&(v=c.location===a.location);const i=!a.sellerType||a.sellerType==="all"||c.sellerType===a.sellerType;let d=!0;if(a.verifiedStatus&&a.verifiedStatus!=="all"&&t){const o=t(c.sellerId);a.verifiedStatus==="verified"?d=o:a.verifiedStatus==="unverified"&&(d=!o)}const b=!a.category||a.category==="all"||c.category&&c.category.toLowerCase().includes(a.category.toLowerCase());let k=!0;if(a.priceRange&&a.priceRange!=="all"){const o=c.price;switch(a.priceRange){case"0-50000":k=o>=0&&o<=5e4;break;case"50000-100000":k=o>5e4&&o<=1e5;break;case"100000-200000":k=o>1e5&&o<=2e5;break;case"200000+":k=o>2e5;break}}return h&&v&&i&&d&&b&&k}).sort((c,h)=>{switch(a.sortBy){case"price-low":return c.price-h.price;case"price-high":return h.price-c.price;case"location":return c.location.localeCompare(h.location);case"newest":default:return new Date(h.lastUpdated).getTime()-new Date(c.lastUpdated).getTime()}}),[s,a,t]),l=n.useMemo(()=>{let c=0;return a.search&&a.search.trim()!==""&&c++,a.category&&a.category!==""&&a.category!=="all"&&c++,(a.city&&a.city!==""&&a.city!=="all"||a.region&&a.region!==""&&a.region!=="all"||a.location&&a.location!==""&&a.location!=="all")&&c++,a.sellerType&&a.sellerType!==""&&a.sellerType!=="all"&&c++,a.verifiedStatus&&a.verifiedStatus!==""&&a.verifiedStatus!=="all"&&c++,a.priceRange&&a.priceRange!==""&&a.priceRange!=="all"&&c++,c},[a]);return{filteredProducts:r,getActiveFiltersCount:l}},oi=()=>{const[s,a]=n.useState(null),[t,r]=n.useState(!1),l=n.useCallback(async i=>{if(!V)throw new Error("Supabase not available");r(!0);try{console.log("🔄 Clean signup process started for:",i.email),console.log("📋 Form data received:"),console.log("  - Name:",i.name),console.log("  - UserType:",i.userType),console.log("  - AccountType:",i.accountType),console.log("  - Location:",i.location),console.log("  - Region:",i.region);const{data:d,error:b}=await V.auth.signUp({email:i.email,password:i.password});if(b)throw console.error("❌ Auth signup failed:",b),b;if(!d.user)throw new Error("Failed to create user account");console.log("✅ Auth user created:",d.user.id),console.log("📧 Auth user email:",d.user.email),console.log("📧 Auth user metadata:",d.user.user_metadata);const k={id:d.user.id,email:i.email,name:i.name,user_type:i.userType,account_type:i.accountType||"individual",location:i.location,region:i.region,phone:i.phone,business_name:i.businessName,business_description:i.businessDescription,verified:!1,phone_verified:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};console.log("📝 Creating profile with data:"),console.log("  - Name:",k.name),console.log("  - User Type:",k.user_type),console.log("  - Account Type:",k.account_type),console.log("  - Location:",k.location);let o;const{data:C,error:p}=await V.from("users").insert(k).select().single();if(p&&(console.error("❌ Profile insert error:",p),console.error("❌ Error code:",p.code),console.error("❌ Error message:",p.message)),p&&p.code==="23505"){console.log("⚠️ User already exists, updating with new form data");const{data:w,error:x}=await V.from("users").update({name:k.name,user_type:k.user_type,account_type:k.account_type,location:k.location,phone:k.phone,business_name:k.business_name,business_description:k.business_description,updated_at:new Date().toISOString()}).eq("id",d.user.id).select().single();if(x)throw console.error("❌ Profile update failed:",x),new Error(`Profile update failed: ${x.message}`);o=w,console.log("✅ Profile updated with new form data")}else{if(p)throw console.error("❌ Profile creation failed:",p),new Error(`Profile creation failed: ${p.message}`);o=C,console.log("✅ New profile created successfully"),console.log("📋 Created profile data:",o)}return console.log("🎉 Signup completed successfully!"),console.log("👤 Auth user:",d.user.email),console.log("📋 Profile user:",o?.email),{user:d.user,session:d.session,profile:o}}catch(d){throw console.error("❌ Signup failed:",d),d}finally{r(!1)}},[]),c=n.useCallback(async(i,d)=>{if(!V)throw new Error("Supabase not available");r(!0);try{const{data:b,error:k}=await V.auth.signInWithPassword({email:i,password:d});if(k)throw k;return b}catch(b){throw console.error("❌ Signin failed:",b),r(!1),b}},[]),h=n.useCallback(async()=>{if(V)try{const{error:i}=await V.auth.signOut();if(i)throw i;a(null)}catch(i){throw console.error("❌ Signout failed:",i),i}},[]),v=n.useCallback(async i=>{if(!(!s||!V))try{const d={updated_at:new Date().toISOString()};i.accountType!==void 0&&(d.account_type=i.accountType),i.userType!==void 0&&(d.user_type=i.userType),i.phoneVerified!==void 0&&(d.phone_verified=i.phoneVerified),i.businessName!==void 0&&(d.business_name=i.businessName),i.businessDescription!==void 0&&(d.business_description=i.businessDescription),i.businessLicenseNumber!==void 0&&(d.business_license_number=i.businessLicenseNumber),i.joinedDate!==void 0&&(d.created_at=i.joinedDate),i.totalReviews!==void 0&&(d.total_reviews=i.totalReviews),i.name!==void 0&&(d.name=i.name),i.email!==void 0&&(d.email=i.email),i.location!==void 0&&(d.location=i.location),i.region!==void 0&&(d.region=i.region),i.phone!==void 0&&(d.phone=i.phone),i.verified!==void 0&&(d.verified=i.verified),i.profileImage!==void 0&&(d.profile_image=i.profileImage),i.storefrontImage!==void 0&&(d.storefront_image=i.storefrontImage),i.heroImage!==void 0&&(d.hero_image=i.heroImage),i.verificationStatus!==void 0&&(d.verification_status=i.verificationStatus),i.verificationDocuments!==void 0&&(d.verification_documents=i.verificationDocuments),i.agriLinkVerificationRequested!==void 0&&(d.verification_submitted=i.agriLinkVerificationRequested),i.phoneVerifiedAt!==void 0&&(d.phone_verified_at=i.phoneVerifiedAt),i.verifiedAt!==void 0&&(d.verified_at=i.verifiedAt),i.agriLinkVerificationRequestedAt!==void 0&&(d.agri_link_verification_requested_at=i.agriLinkVerificationRequestedAt);const{data:b,error:k}=await V.from("users").update(d).eq("id",s.id).select().single();if(k)throw console.error("❌ Database update error:",k),k;const o={...s,...i};return a(o),b}catch(d){throw console.error("❌ Profile update failed:",d),d}},[s]);return n.useEffect(()=>{let i=!0,d=!1;const b=setTimeout(()=>{i&&(console.log("⚠️ Auth loading timeout - setting loading to false"),r(!1),d=!1)},2e4),k=async x=>{if(d){console.log("⚠️ Already loading user data, skipping...");return}if(!i){console.log("⚠️ Component unmounted, skipping user data load...");return}d=!0,r(!0);try{const g=V.from("users").select(`
            id,
            email,
            name,
            user_type,
            account_type,
            location,
            phone,
            verified,
            phone_verified,
            created_at,
            verification_documents,
            verification_status,
            verification_submitted,
            phone_verified_at,
            verified_at,
            agri_link_verification_requested_at,
            profile_image,
            storefront_image,
            hero_image
          `).eq("id",x).single(),u=new Promise((N,M)=>setTimeout(()=>M(new Error("Database query timeout")),15e3)),{data:y,error:m}=await Promise.race([g,u]);if(m){if(console.error("❌ Profile fetch failed:",m),m.code==="PGRST116"){const{data:N}=await V.auth.getUser();if(N?.user){const{error:M}=await V.from("users").insert([{id:N.user.id,email:N.user.email,name:N.user.user_metadata?.full_name||N.user.user_metadata?.name||N.user.email?.split("@")[0]||"User",user_type:N.user.user_metadata?.user_type||"buyer",account_type:N.user.user_metadata?.account_type||"individual",location:N.user.user_metadata?.location||null,verified:!1,phone_verified:!1,created_at:new Date().toISOString()}]);if(M){console.error("❌ Failed to create user profile:",M),i&&a(null);return}const{data:_,error:P}=await V.from("users").select(`
                  id,
                  email,
                  name,
                  user_type,
                  account_type,
                  location,
                  verified,
                  phone_verified,
                  created_at
                `).eq("id",x).single();if(P||!_){console.error("❌ Retry failed:",P),i&&a(null);return}const F={id:_.id,email:_.email,name:_.name,userType:_.user_type,accountType:_.account_type,location:_.location,phone:_.phone,verified:_.verified,phoneVerified:_.phone_verified,experience:"Unknown",joinedDate:_.created_at,totalReviews:0,verificationStatus:_.verification_status||"not_started",verificationDocuments:_.verification_documents||{},phoneVerifiedAt:_.phone_verified_at,verifiedAt:_.verified_at,agriLinkVerificationRequested:_.verification_submitted||!1,agriLinkVerificationRequestedAt:_.agri_link_verification_requested_at,profileImage:_.profile_image||"",storefrontImage:_.storefront_image||"",heroImage:_.hero_image||""};i&&(a(F),console.log("✅ User profile loaded from database:",F.email));return}}i&&a(null);return}if(!y){console.error("❌ No profile found for user:",x),i&&a(null);return}const j={id:y.id,email:y.email,name:y.name,userType:y.user_type,accountType:y.account_type,location:y.location,phone:y.phone,verified:y.verified,phoneVerified:y.phone_verified,experience:"Unknown",joinedDate:y.created_at,totalReviews:0,verificationStatus:y.verification_status||"not_started",verificationDocuments:y.verification_documents||{},phoneVerifiedAt:y.phone_verified_at,verifiedAt:y.verified_at,agriLinkVerificationRequested:y.verification_submitted||!1,agriLinkVerificationRequestedAt:y.agri_link_verification_requested_at,profileImage:y.profile_image||"",storefrontImage:y.storefront_image||"",heroImage:y.hero_image||""};i&&a(j)}catch(g){console.error("❌ Error loading user data:",g),console.error("❌ Database query failed with error:",g),console.error("❌ Error message:",g.message),console.error("❌ Error details:",g),i&&(a(null),r(!1));return}finally{i&&r(!1),d=!1,console.log("🏁 loadUserData completed")}},{data:{subscription:o}}=V.auth.onAuthStateChange(async(x,g)=>{i&&(console.log("🔄 Auth state change:",x,g?.user?.id),x==="SIGNED_IN"&&g?.user?(console.log("🔄 SIGNED_IN event - loading user data for:",g.user.id),await k(g.user.id)):x==="SIGNED_OUT"?(a(null),r(!1),d=!1,console.log("✅ User signed out")):x==="INITIAL_SESSION"?(console.log("🔄 INITIAL_SESSION event:",{hasSession:!!g,userId:g?.user?.id}),g?.user?localStorage.getItem("agrilink_auto_login")==="true"?(console.log("🔄 Auto-login enabled - loading user data for:",g.user.id),await k(g.user.id)):(console.log("🔄 Auto-login disabled - signing out user"),await V.auth.signOut(),a(null),r(!1),d=!1):(a(null),r(!1),d=!1,console.log("✅ No initial session - user not logged in"))):x==="TOKEN_REFRESHED"&&(console.log("🔄 Token refreshed, ensuring user data is loaded"),g?.user&&!s&&(console.log("🔄 Loading user data after token refresh"),await k(g.user.id))))}),C=async()=>{if(!i)return;console.log("🔄 Window focused - checking session status");const{data:{session:x},error:g}=await V.auth.getSession();if(g){console.error("❌ Session check error on focus:",g);return}console.log("🔍 Window focus session check:",{hasSession:!!x,userId:x?.user?.id,hasUser:!!s}),x?.user&&!s?(console.log("🔄 Session exists but user not loaded - reloading user data"),await k(x.user.id)):!x?.user&&s&&(console.log("🔄 No session but user loaded - signing out"),a(null),r(!1),d=!1)},p=()=>{console.log("🔄 Window blurred")};window.addEventListener("focus",C),window.addEventListener("blur",p);const w=setInterval(async()=>{if(!i||!s)return;const{data:{session:x},error:g}=await V.auth.getSession();if(g){console.error("❌ Periodic session check error:",g);return}!x?.user&&s&&(console.log("🔄 Session expired during periodic check - signing out"),a(null),r(!1),d=!1)},3e4);return()=>{i=!1,d=!1,clearTimeout(b),clearInterval(w),o.unsubscribe(),window.removeEventListener("focus",C),window.removeEventListener("blur",p)}},[]),n.useEffect(()=>{if(!s?.id)return;console.log("🔄 Setting up real-time subscription for user:",s.id);const i=V.channel("user-verification-updates").on("postgres_changes",{event:"UPDATE",schema:"public",table:"users",filter:`id=eq.${s.id}`},d=>{console.log("🔄 User verification status updated:",d),console.log("🔄 Payload details:",{event:d.eventType,table:d.table,schema:d.schema,new:d.new,old:d.old}),(async k=>{try{console.log("🔄 Reloading user data after verification update...");const{data:o,error:C}=await V.from("users").select(`
                  id,
                  email,
                  name,
                  user_type,
                  account_type,
                  location,
                  region,
                  verified,
                  phone_verified,
                  phone,
                  business_name,
                  business_description,
                  created_at,
                  total_reviews,
                  verification_status,
                  verification_documents,
                  verification_submitted,
                  phone_verified_at,
                  verified_at,
                  agri_link_verification_requested_at,
                  business_details_completed
                `).eq("id",k).single();if(C){console.error("❌ Error reloading user data:",C);return}if(o){const p={id:o.id,email:o.email,name:o.name,userType:o.user_type,accountType:o.account_type,location:o.location,region:o.region,verified:o.verified,phoneVerified:o.phone_verified,phone:o.phone,businessName:o.business_name,businessDescription:o.business_description,experience:"Unknown",joinedDate:o.created_at,totalReviews:o.total_reviews||0,verificationStatus:o.verification_status||"not_started",verificationDocuments:o.verification_documents||{},phoneVerifiedAt:o.phone_verified_at,verifiedAt:o.verified_at,agriLinkVerificationRequested:o.verification_submitted||!1,agriLinkVerificationRequestedAt:o.agri_link_verification_requested_at};a(p),console.log("✅ User data reloaded after verification update:",p.email)}}catch(o){console.error("❌ Error reloading user data:",o)}})(s.id)}).subscribe();return()=>{console.log("🔄 Cleaning up user verification subscription"),i.unsubscribe()}},[s?.id]),{user:s,loading:t,signUp:l,signIn:c,signOut:h,updateProfile:v}},Ze=()=>{if(!V)throw new Error("Supabase client not available");return V},ps={getAll:async()=>{try{const s=Ze(),{data:a,error:t}=await s.from("products").select(`
          *,
          users!products_seller_id_fkey (
            verified,
            phone_verified,
            verification_status,
            account_type
          )
        `).order("created_at",{ascending:!1});if(t)throw t;return a||[]}catch(s){throw console.error("Fetch products API error:",s),s}},create:async s=>{try{const a=Ze(),{data:{session:t},error:r}=await a.auth.getSession();if(r||!t?.user)throw new Error("Not authenticated");const{data:l,error:c}=await a.from("products").insert({...s,seller_id:t.user.id,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(c)throw c;return l}catch(a){throw console.error("Create product API error:",a),a}},update:async(s,a)=>{try{const t=Ze(),{data:{session:r},error:l}=await t.auth.getSession();if(l||!r?.user)throw new Error("Not authenticated");const{data:c,error:h}=await t.from("products").update({...a,updated_at:new Date().toISOString()}).eq("id",s).eq("seller_id",r.user.id).select().single();if(h)throw h;return c}catch(t){throw console.error("Update product API error:",t),t}},delete:async s=>{try{const a=Ze(),{data:{session:t},error:r}=await a.auth.getSession();if(r||!t?.user)throw new Error("Not authenticated");const{error:l}=await a.from("products").delete().eq("id",s).eq("seller_id",t.user.id);if(l)throw l;return{success:!0}}catch(a){throw console.error("Delete product API error:",a),a}},getUserProducts:async s=>{try{const a=Ze(),{data:t,error:r}=await a.from("products").select("*").eq("seller_id",s).order("created_at",{ascending:!1});if(r)throw r;return t||[]}catch(a){throw console.error("Fetch user products API error:",a),a}}},ci={subscribeToMessages:(s,a)=>{try{return Ze().channel(`messages:${s}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`conversation_id=eq.${s}`},a).subscribe()}catch(t){return console.error("Subscribe to messages API error:",t),{unsubscribe:()=>{}}}},subscribeToProducts:s=>{try{return Ze().channel("products").on("postgres_changes",{event:"*",schema:"public",table:"products"},s).subscribe()}catch(a){return console.error("Subscribe to products API error:",a),{unsubscribe:()=>{}}}}};class di{cache=new Map;maxSize;defaultTTL;constructor(a={}){this.defaultTTL=a.ttl||300*1e3,this.maxSize=a.maxSize||100}set(a,t,r){if(this.cache.size>=this.maxSize){const h=this.cache.keys().next().value;this.cache.delete(h)}const l=Date.now(),c=l+(r||this.defaultTTL);this.cache.set(a,{data:t,timestamp:l,expiresAt:c})}get(a){const t=this.cache.get(a);return t?Date.now()>t.expiresAt?(this.cache.delete(a),null):t.data:null}has(a){const t=this.cache.get(a);return t?Date.now()>t.expiresAt?(this.cache.delete(a),!1):!0:!1}delete(a){this.cache.delete(a)}clear(){this.cache.clear()}size(){return this.cache.size}getStats(){const a=Date.now();let t=0;for(const[r,l]of this.cache.entries())a>l.expiresAt&&t++;return{total:this.cache.size,expired:t,valid:this.cache.size-t,maxSize:this.maxSize}}}const ts=new di({ttl:300*1e3,maxSize:200}),mi=(s,a,t={})=>{const[r,l]=n.useState(null),[c,h]=n.useState(!1),[v,i]=n.useState(null),d=n.useRef(null),b=n.useRef(0),k=n.useCallback(async(p=!1)=>{const w=Date.now();if(!p&&w-b.current<1e3){console.log("🚫 Debouncing rapid fetch call for key:",s);return}if(b.current=w,d.current&&d.current.abort(),!p&&ts.has(s)){const x=ts.get(s);if(x)return l(x),i(null),x}d.current=new AbortController;try{h(!0),i(null);const x=await a();return d.current?.signal.aborted?void 0:(ts.set(s,x,t.ttl),l(x),x)}catch(x){if(d.current?.signal.aborted)return;const g=x instanceof Error?x.message:"Failed to fetch data";if(i(g),x&&typeof x=="object"&&"code"in x&&x.code==="57014"?console.log(`⏱️ Database timeout for key "${s}" - this is normal for slow queries`):console.error(`Cache fetch error for key "${s}":`,x),x&&typeof x=="object"&&"code"in x&&x.code==="57014")return null;throw x}finally{h(!1)}},[s,a,t.ttl]),o=n.useCallback(()=>{ts.delete(s),l(null)},[s]),C=n.useCallback(()=>k(!0),[k]);return js.useEffect(()=>{!r&&!c&&!ts.has(s)&&k()},[r,c,k,s]),js.useEffect(()=>()=>{d.current&&d.current.abort()},[]),{data:r,loading:c,error:v,fetchData:k,invalidate:o,refresh:C,isCached:ts.has(s)}},ui=()=>{const[s,a]=n.useState([]),[t,r]=n.useState(!0),[l,c]=n.useState(null),{data:h,loading:v,error:i,fetchData:d,invalidate:b}=mi("products",async()=>{if(!Ne.isSupabaseConfigured())return console.log("❌ Supabase not configured"),[];console.log("🔄 Fetching products from Supabase...");const y=(await ps.getAll()).map(o);return console.log("✅ Products loaded:",y.length),y},{ttl:120*1e3}),k=n.useCallback(async()=>{try{r(!0),c(null);const u=await d(!0);u&&a(u)}catch(u){console.error("Fetch products error:",u),c(u instanceof Error?u.message:"Failed to fetch products"),a([])}finally{r(!1)}},[d]),o=u=>{const y=u.users,m=y?.verified||!1,j=y?.verified&&y?.account_type==="business",N=y?.verification_status||"unverified";return{id:u.id,sellerId:u.seller_id,name:u.name,price:Number(u.price),unit:u.unit,location:u.location,region:u.region,sellerType:u.seller_type,sellerName:u.seller_name,image:u.image||u.images?.[0],images:u.images||[],quantity:u.quantity,minimumOrder:u.minimum_order||"1 unit",availableQuantity:u.available_quantity||u.quantity,deliveryOptions:u.delivery_options||["Pickup"],paymentTerms:u.payment_terms||["Cash on delivery"],category:u.category,description:u.description,additionalNotes:u.additional_notes,priceChange:u.price_change||0,lastUpdated:u.last_updated||new Date().toISOString(),sellerVerified:m,sellerVerificationStatus:{idVerified:m,businessVerified:j,verified:m,trustLevel:j?"business-verified":m?"id-verified":N==="under_review"?"under-review":"unverified",tierLabel:j?"Business Verified":m?"Verified":N==="under_review"?"Under Review":"Unverified",levelBadge:j?"Tier 2":m?"Tier 1":N==="under_review"?"Under Review":"Unverified",level:j?2:m?1:0,userType:u.seller_type,accountType:y?.account_type}}},C=u=>({name:u.name||"",description:u.description||"",category:u.category||"agriculture",price:u.price||0,unit:u.unit||"",location:u.location||"",region:u.region||null,seller_type:u.sellerType||"farmer",seller_name:u.sellerName||"Unknown Seller",quantity:u.quantity||"",minimum_order:u.minimumOrder||"1 unit",available_quantity:u.availableQuantity||u.quantity||"",delivery_options:u.deliveryOptions||["Pickup"],payment_terms:u.paymentTerms||["Cash on delivery"],additional_notes:u.additionalNotes||null,price_change:u.priceChange||0,image:u.images?.[0]||u.image||null,images:u.images&&u.images.length>0?u.images:u.image?[u.image]:[],last_updated:new Date().toISOString(),is_active:!0}),p=n.useCallback(async u=>{try{if(!Ne.isSupabaseConfigured())throw new Error("Supabase not configured");console.log("➕ Creating product in Supabase:",u.name);const y=C(u);console.log("🚀 Sending to Supabase:",y);const m=await ps.create(y),j=o(m);return console.log("✅ Product created successfully in Supabase"),a(N=>[j,...N]),j}catch(y){throw console.error("❌ Create product error:",y),y}},[]),w=n.useCallback(async(u,y)=>{try{if(!Ne.isSupabaseConfigured())throw new Error("Supabase not configured");console.log("🔄 Updating product in Supabase:",u),console.log("📝 Update data:",y);const m=C(y);console.log("🚀 Sending to Supabase:",m);const j=await ps.update(u,m),N=o(j);return console.log("✅ Product updated successfully in Supabase"),a(M=>M.map(_=>_.id===u?N:_)),N}catch(m){throw console.error("❌ Update product error:",m),m}},[]),x=n.useCallback(async u=>{try{await ps.delete(u),a(y=>y.filter(m=>m.id!==u))}catch(y){throw console.error("Delete product error:",y),y}},[]),g=n.useCallback(async u=>{try{return(await ps.getUserProducts(u)).map(o)}catch(y){return console.error("Get user products error:",y),[]}},[]);return n.useEffect(()=>{h?(a(h),r(!1),c(null)):i?i.includes("timeout")||i.includes("57014")?(console.log("⏱️ Database timeout - showing empty state"),a([]),r(!1),c(null)):(c(i),r(!1)):v&&r(!0)},[h,v,i]),n.useEffect(()=>{!h&&!v&&(console.log("🔄 useProducts - Initial fetch starting..."),d())},[h,v,d]),n.useEffect(()=>{if(Ne.isSupabaseConfigured())try{const u=ci.subscribeToProducts(y=>{if(console.log("Real-time product update:",y),y.eventType==="INSERT"){const m=o(y.new);a(j=>[m,...j]),b()}else if(y.eventType==="UPDATE"){const m=o(y.new);a(j=>j.map(N=>N.id===m.id?m:N)),b()}else y.eventType==="DELETE"&&(a(m=>m.filter(j=>j.id!==y.old.id)),b())});return()=>{u.unsubscribe()}}catch(u){console.log("Real-time subscription failed:",u)}},[]),{products:s,loading:t,error:l,fetchProducts:k,createProduct:p,updateProduct:w,deleteProduct:x,getUserProducts:g}};function hi({currentView:s,currentUser:a,setCurrentView:t,setSelectedProductId:r,setSelectedChat:l,setSelectedSellerId:c,setVerificationInitialStep:h,previousView:v,setPreviousView:i}){const d=n.useCallback(()=>{console.log("Marketplace button clicked"),r(null),l(null),t("marketplace")},[r,l,t]),b=n.useCallback(()=>{i&&i(s),r(null),l(null),c(null),a?.userType==="farmer"||a?.userType==="trader"||a?.userType==="buyer"?t("dashboard"):a?.userType==="admin"?t("admin-dashboard"):t("marketplace")},[s,i,a,r,l,c,t]),k=n.useCallback(()=>{v&&v!==s?t(v):a?.userType==="farmer"||a?.userType==="trader"||a?.userType==="buyer"?t("dashboard"):t("marketplace")},[v,s,a,t]),o=n.useCallback(()=>{i&&i(s),t("profile")},[s,i,t]),C=n.useCallback(()=>{i&&i(s),t("messages")},[s,i,t]),p=n.useCallback((S=1)=>{i&&i(s),h(S),t("verification")},[s,i,h,t]),w=n.useCallback(()=>{i&&i(s),t("admin-verification")},[s,i,t]),x=n.useCallback(()=>{i&&i(s),t("about-us")},[s,i,t]),g=n.useCallback(()=>{i&&i(s),t("contact-us")},[s,i,t]),u=n.useCallback(()=>{i&&i(s),t("faq")},[s,i,t]),y=n.useCallback(()=>{t("profile"),window.scrollTo({top:0,behavior:"smooth"})},[t]),m=n.useCallback(()=>{t("register")},[t]),j=n.useCallback(()=>{t("login")},[t]),N=n.useCallback(()=>{t("forgot-password")},[t]),M=n.useCallback(S=>{i&&i(s),r(S),t("product-details")},[s,i,r,t]),_=n.useCallback(S=>{r(S),t("price-comparison")},[r,t]),P=n.useCallback(()=>{s==="price-comparison"?t("product-details"):d()},[s,d,t]),F=n.useCallback(S=>{i&&i(s),c(S),t("seller-storefront")},[s,i,c,t]),D=n.useCallback(()=>{t("seller-storefront")},[t]);return{handleBackToMarketplace:d,handleBackToPrevious:k,handleGoToDashboard:b,handleViewProfile:o,handleViewMessages:C,handleShowVerification:p,handleShowAdminVerification:w,handleShowAboutUs:x,handleShowContactUs:g,handleShowFAQ:u,handleBackToProfile:y,handleGoToRegister:m,handleGoToLogin:j,handleGoToForgotPassword:N,handleViewDetails:M,handlePriceCompare:_,handleBackToProductDetails:P,handleViewStorefront:F,handleBackToStorefront:D}}function xi({currentUser:s,createProduct:a,updateProduct:t,deleteProduct:r,setEditingProduct:l,setCurrentView:c,setPreviousView:h,setAuthModal:v,currentView:i,previousView:d,allProducts:b}){const k=n.useCallback(async x=>{try{console.log("🚀 handleAddListing called with:",{productId:x.id,productName:x.name,price:x.price,priceType:typeof x.price,isEditing:x.isEditing,hasImage:!!x.image,imageSize:x.image?.length||0,totalSize:JSON.stringify(x).length}),console.log("🌐 Using Supabase API");const g={...x};delete g.isEditing,x.isEditing?(console.log("✏️ Updating existing product via Supabase:",x.id),console.log("📝 Product update data:",{id:x.id,name:x.name,price:x.price,location:x.location}),await t(x.id,g),H.success("Product updated successfully!")):(console.log("➕ Creating new product via Supabase"),await a(g),H.success("Product added successfully!")),console.log("🧹 Clearing editing state and navigating back to:",d),l(null),console.log("📱 Navigating to:",d),c(d),console.log("✅ Navigation completed")}catch(g){throw console.error("❌ Product operation failed:",g),g instanceof Error?H.error(`Failed to save product: ${g.message}`):H.error("Failed to save product. Please try again."),g}},[a,t,d,s,l,c]),o=n.useCallback((x,g)=>{if(console.log("✏️ Edit Product:",x.id),!s){v("login");return}if(s.userType==="buyer")return;const u=g.find(y=>y.id===x.id);if(!u){console.error("❌ Product not found:",x.id),H.error("Product not found. Please refresh and try again.");return}console.log("📦 Product to edit:",{id:u.id,name:u.name,description:u.description?.substring(0,50)+"..."||"None",category:u.category||"None",hasImage:!!u.image}),console.log("💰 Price debug - Product to edit:",{price:u.price,priceType:typeof u.price}),l(u),h(i),c("add-listing")},[s,v,l,h,c,i]),C=n.useCallback(()=>{if(console.log("🚀 handleShowAddListing called"),console.log("Current user:",s?.email,s?.userType),console.log("Current view:",i),!s){console.log("❌ No current user - showing login modal"),v("login");return}if(s.userType==="buyer"){console.log("❌ User is buyer - cannot create listings");return}console.log("✅ Setting up add listing form"),l(null),h(i),c("add-listing"),console.log("✅ View changed to add-listing")},[i,s,v,l,h,c]),p=n.useCallback(async x=>{console.log("🗑️ Deleting product:",x);try{console.log("🌐 Deleting product via Supabase:",x),await r(x),H.success("Product deleted successfully")}catch(g){throw console.error("❌ Delete product failed:",g),H.error("Failed to delete product"),g}},[r]),w=n.useCallback(()=>{l(null),c(d)},[d,l,c]);return{handleAddListing:k,handleEditListing:o,handleShowAddListing:C,handleDeleteListing:p,handleBackFromAddListing:w}}function fi({currentUser:s,allProducts:a,startConversation:t,setSelectedChat:r,setCurrentView:l}){return{handleChat:n.useCallback(async h=>{if(!s){l("login");return}try{const v=a.find(i=>i.id===h);if(v){try{await Fs.trackInquiry(h,s.id,v.sellerId,"chat"),console.log("📊 Inquiry tracked for product:",v.name)}catch(i){console.error("❌ Error tracking inquiry:",i)}await t(s.id,v.sellerId,h),r(h)}}catch(v){console.error("Failed to start conversation:",v),v instanceof Error&&!v.message.includes("Not authenticated")&&H.error("Failed to start conversation. Please try again.")}},[s,a,t,r,l])}}function pi(s,a){if(a&&s===a.id){const t=a.verified||!1,r=a.businessVerified||!1,l=a.verificationStatus||"unverified";return{idVerified:t,businessVerified:r,verified:t,trustLevel:r?"business-verified":t?"id-verified":l==="under_review"?"under-review":"unverified",tierLabel:r?"Business Verified":t?"Verified":l==="under_review"?"Under Review":"Unverified",levelBadge:r?"Tier 2":t?"Tier 1":l==="under_review"?"Under Review":"Unverified",level:r?2:t?1:0,userType:a.userType,accountType:a.accountType}}try{const r=JSON.parse(localStorage.getItem("agriconnect-myanmar-users")||"[]").find(l=>l.id===s);if(r){const l=r.verified||!1,c=r.businessVerified||!1,h=r.verificationStatus||"unverified";return{idVerified:l,businessVerified:c,verified:l,trustLevel:c?"business-verified":l?"id-verified":h==="under_review"?"under-review":"unverified",tierLabel:c?"Business Verified":l?"Verified":h==="under_review"?"Under Review":"Unverified",levelBadge:c?"Tier 2":l?"Tier 1":h==="under_review"?"Under Review":"Unverified",level:c?2:l?1:0,userType:r.userType,accountType:r.accountType}}}catch(t){console.error("Error checking seller verification status in localStorage:",t)}return{idVerified:!1,businessVerified:!1,verified:!1,trustLevel:"unverified",tierLabel:"Unverified",levelBadge:"Unverified",level:0,userType:void 0,accountType:void 0}}function gi(s,a){return pi(s,a).verified}const vi=n.lazy(()=>Se(()=>import("./ProductDetails-_O32jt8C.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),ji=n.lazy(()=>Se(()=>import("./VerificationPrompt-gtVzF782.js"),__vite__mapDeps([7,1,2,3,4,5,6]))),yi=n.lazy(()=>Se(()=>import("./AboutUs-CXntuA7n.js"),__vite__mapDeps([8,1,2,3,4,5,6]))),bi=n.lazy(()=>Se(()=>import("./ContactUsPage-C0Xg_HzQ.js"),__vite__mapDeps([9,1,2,6,3,4,5]))),Ni=n.lazy(()=>Se(()=>import("./FAQ-DqXYqsIc.js"),__vite__mapDeps([10,1,2,3,4,5,6]))),wi=n.lazy(()=>Se(()=>import("./DealsManagement-DCkrTn2F.js"),__vite__mapDeps([11,1,2,3,4,5,6]))),ki=n.lazy(()=>Se(()=>import("./OfferModal-nF9xU2f6.js"),__vite__mapDeps([12,1,2,3,4,5,6]))),Ci=n.lazy(()=>Se(()=>import("./ReviewModal-CoY_sFm7.js"),__vite__mapDeps([13,1,2,3,4,5,6]))),Ge=()=>e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ps,{className:"w-6 h-6 animate-spin"}),e.jsx("span",{className:"text-muted-foreground",children:"Loading..."})]})}),Si=js.memo(()=>{const[s,a]=n.useState(null);if(n.useRef(0),s)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4 max-w-md",children:[e.jsx("div",{className:"w-16 h-16 bg-destructive rounded-lg flex items-center justify-center mx-auto",children:e.jsx(Be,{className:"w-8 h-8 text-destructive-foreground"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Application Error"}),e.jsx("p",{className:"text-muted-foreground",children:s}),e.jsx(f,{onClick:()=>window.location.reload(),children:"Refresh Page"})]})});const[t,r]=n.useState("marketplace"),[l,c]=n.useState(null),[h,v]=n.useState(null),[i,d]=n.useState(null),[b,k]=n.useState(null),[o,C]=n.useState(null),[p,w]=n.useState("marketplace"),[x,g]=n.useState(1),[u,y]=n.useState(!1),[m,j]=n.useState(!1),[N,M]=n.useState({show:!1,feature:"chat"}),[_,P]=n.useState(!1),[F,D]=n.useState(null),[S,A]=n.useState(!1),[q,re]=n.useState(null),[ve,je]=n.useState([]),{user:T,signUp:xe,signIn:L,signOut:z,updateProfile:Z}=oi(),{products:Re,loading:Ue,createProduct:ss,updateProduct:le,deleteProduct:De}=ui(),{startConversation:hs}=sa(),[ye,as]=n.useState({search:"",category:"",location:"",region:"",city:"",sellerType:"",verifiedStatus:"",priceRange:"",sortBy:"newest"}),ie=n.useMemo(()=>{try{return Re||[]}catch($){return console.error("Error in allProducts calculation:",$),a("Failed to load products. Please refresh the page."),[]}},[Re,Ue]),I=hi({currentView:t,currentUser:T,setCurrentView:r,setSelectedProductId:v,setSelectedChat:c,setSelectedSellerId:d,setVerificationInitialStep:g,previousView:p,setPreviousView:w}),G=xi({currentUser:T,createProduct:ss,updateProduct:le,deleteProduct:De,setEditingProduct:C,setCurrentView:r,setPreviousView:w,setAuthModal:k,currentView:t,previousView:p,allProducts:ie}),X=fi({currentUser:T?.id?T:null,allProducts:ie,startConversation:hs,setSelectedChat:c,setCurrentView:r}),Ee=n.useRef(!1);n.useEffect(()=>{Ee.current||(t!=="marketplace"&&r("marketplace"),Ee.current=!0)},[]),n.useEffect(()=>{t!=="seller-storefront"&&y(!1)},[t]),n.useEffect(()=>{["faq","about-us","contact-us","profile","verification","admin-verification","add-listing","messages","deals"].includes(t)&&window.scrollTo({top:0,behavior:"smooth"})},[t]),n.useEffect(()=>{},[]);const we=li(ie,ye,gi),{filteredProducts:Fe,getActiveFiltersCount:xs}=we||{filteredProducts:ie,getActiveFiltersCount:()=>0},ke=ni({items:Fe,itemsPerPage:12,initialPage:1});n.useEffect(()=>{ke.resetToFirstPage()},[ye,ke.resetToFirstPage]);const fe=n.useMemo(()=>l?ie.find(J=>J.id===l):null,[l,ie.length]),te=n.useMemo(()=>h?ie.find($=>$.id===h):null,[h,ie.length]),ra=n.useCallback(async($,J)=>{try{await L($,J),k(null)}catch(ne){throw console.error("Login failed:",ne),ne}},[L]),ia=n.useCallback(async $=>{try{await xe($),H.success("Registration successful! Welcome to AgriLink Marketplace!",{duration:4e3}),r("login"),k(null)}catch(J){throw console.error("Registration failed:",J),J}},[xe,r]),Ga=n.useCallback(async()=>{try{await z(),c(null),r("marketplace")}catch($){console.error("Logout failed:",$)}},[z]),Qe=n.useCallback(async $=>{try{await Z($)}catch(J){throw console.error("Profile update failed:",J),J}},[Z]),na=n.useCallback(()=>{console.log("Edit profile clicked - using inline editing")},[]),Ja=n.useCallback(async()=>{const $=document.createElement("input");$.type="file",$.accept="image/*",$.onchange=async J=>{const ne=J.target.files?.[0];if(!(!ne||!T)){if(!ne.type.startsWith("image/")){H.error("Please select a valid image file");return}if(ne.size>10*1024*1024){H.error("Image size must be less than 10MB");return}try{const Me=new FileReader,qs=await new Promise((Za,Xa)=>{Me.onload=()=>Za(Me.result),Me.onerror=Xa,Me.readAsDataURL(ne)});console.log("Storefront image converted to base64:",{originalSize:ne.size,base64Size:qs.length,compressionRatio:(ne.size/qs.length).toFixed(2)}),await Qe({...T,storefrontImage:qs}),H.success("Storefront image updated successfully!"),console.log("✅ Storefront image updated successfully in database")}catch(Me){console.error("❌ Failed to update storefront image:",Me),H.error("Failed to update storefront image. Please try again.")}}},$.click()},[T,Qe]),Wa=n.useCallback(async($,J)=>{if(!T){H.error("Please log in to save products");return}try{const{data:ne,error:Me}=await V.from("saved_products").upsert({user_id:T.id,product_id:$,price_when_saved:J,price_alert:!0,stock_alert:!1},{onConflict:"user_id,product_id"});if(Me){console.error("Failed to save product:",Me),H.error("Failed to save product");return}H.success("Product saved for price tracking")}catch(ne){console.error("Failed to save product:",ne),H.error("Failed to save product")}},[T]);n.useCallback($=>{if(!T){H.error("Please log in to make offers");return}if(T.userType!=="buyer"){H.error("Only buyers can make offers");return}D($),P(!0)},[T]);const Ya=n.useCallback(async $=>{if(!(!T||!F))try{const{OffersService:J}=await Se(async()=>{const{OffersService:ne}=await Promise.resolve().then(()=>Lr);return{OffersService:ne}},void 0);await J.createOffer({conversationId:"",productId:F.id,buyerId:T.id,sellerId:F.sellerId,price:$.price,quantity:$.quantity,unit:$.unit||F.unit,description:$.description,deliveryTerms:$.deliveryTerms,deliveryLocation:$.deliveryLocation,validUntil:$.validUntil||new Date(Date.now()+10080*60*1e3).toISOString(),status:"pending",notes:$.notes}),H.success("Offer sent successfully!"),P(!1),D(null)}catch(J){console.error("Error submitting offer:",J),H.error("Failed to send offer. Please try again.")}},[T,F]),Ka=n.useCallback(async $=>{if(!(!T||!q))try{H.success("Review submitted successfully!"),A(!1),re(null)}catch(J){console.error("Error submitting review:",J),H.error("Failed to submit review. Please try again.")}},[T,q]),Qa=n.useMemo(()=>te?(te.price,ie.filter(J=>J.name===te.name).map(J=>({id:J.id,sellerName:J.sellerName,sellerType:J.sellerType,price:J.price,location:J.location,quantity:J.quantity,lastUpdated:J.lastUpdated}))):[],[te?.id,te?.name,te?.price,ie.length]);return e.jsx(ti,{children:e.jsx(e.Fragment,{children:e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx(ei,{currentView:t,currentUser:T,onBackToMarketplace:I.handleBackToMarketplace,onGoToDashboard:I.handleGoToDashboard,onGoToLogin:I.handleGoToLogin,onGoToRegister:I.handleGoToRegister,onLogout:Ga,onViewStorefront:I.handleViewStorefront,onUpdateUser:Qe,onShowVerification:I.handleShowVerification,onEditProfile:na,onViewProfile:I.handleViewProfile,onViewMessages:I.handleViewMessages,onShowAdminVerification:I.handleShowAdminVerification,editingProduct:o}),e.jsx("main",{className:`w-full max-w-5xl mx-auto px-4 ${t==="marketplace"||t==="dashboard"||t==="add-listing"||t==="seller-storefront"||t==="product-details"||t==="price-comparison"||t==="messages"||t==="deals"||t==="admin-verification"||t==="about-us"||t==="contact-us"||t==="faq"?"flex-grow":"flex-grow-0"}`,children:e.jsxs("div",{className:"pt-8 pb-16",children:[t==="login"&&e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsx(va,{onLogin:ra,onSwitchToRegister:I.handleGoToRegister,onForgotPassword:I.handleGoToForgotPassword,onClose:I.handleBackToMarketplace})}),t==="register"&&e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsx(ya,{onRegister:ia,onSwitchToLogin:I.handleGoToLogin,onClose:I.handleBackToMarketplace})}),t==="forgot-password"&&e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsx(Mr,{onBack:I.handleGoToLogin,onReturnToLogin:I.handleGoToLogin})}),t==="profile"&&T&&e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx(Ur,{user:T,onBack:I.handleBackToPrevious,onEditProfile:na,onShowVerification:I.handleShowVerification,onUpdate:Qe,onViewStorefront:I.handleViewStorefront})}),t==="add-listing"&&T&&e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx(Ar,{currentUser:T,onBack:G.handleBackFromAddListing,onSave:G.handleAddListing,editingProduct:o})}),t==="dashboard"&&T&&(T.userType==="farmer"||T.userType==="trader")&&e.jsx(zr,{user:T,userProducts:ie.filter($=>$.sellerId===T.id),onAddListing:G.handleShowAddListing,onEditListing:$=>G.handleEditListing($,ie),onDeleteListing:G.handleDeleteListing,onViewStorefront:()=>I.handleViewStorefront(T.id),onGoToMarketplace:I.handleBackToMarketplace,onViewProduct:I.handleViewDetails,onShowVerification:I.handleShowVerification,onViewMessages:I.handleViewMessages}),t==="dashboard"&&T&&T.userType==="buyer"&&e.jsx(qr,{user:T,allProducts:ie,savedProducts:ve,onGoToMarketplace:I.handleBackToMarketplace,onViewProduct:I.handleViewDetails,onStartChat:X.handleChat,onViewMessages:I.handleViewMessages}),t==="messages"&&T&&e.jsx("div",{className:"max-w-5xl mx-auto",children:e.jsx(Hr,{currentUser:T,onBack:I.handleBackToPrevious,onStartChat:X.handleChat})}),t==="deals"&&T&&e.jsx("div",{className:"max-w-5xl mx-auto",children:e.jsx(n.Suspense,{fallback:e.jsx(Ge,{}),children:e.jsx(wi,{currentUserId:T.id,currentUserName:T.name,currentUserType:T.userType,onBack:I.handleBackToPrevious})})}),t==="verification"&&T&&e.jsx("div",{className:"max-w-4xl mx-auto pt-8",children:e.jsx(Or,{currentUser:T,onClose:I.handleBackToProfile,onUpdate:Qe})}),t==="admin-verification"&&T&&T.userType==="admin"&&e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsx(Wr,{currentAdmin:T,onBack:I.handleBackToPrevious})}),t==="admin-dashboard"&&T&&T.userType==="admin"&&e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx(Jr,{currentAdmin:T,onBack:I.handleBackToPrevious,onNavigateToVerification:()=>I.handleShowAdminVerification(),onUpdateUser:Qe})}),t==="about-us"&&e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx(n.Suspense,{fallback:e.jsx(Ge,{}),children:e.jsx(yi,{onBack:I.handleBackToPrevious})})}),t==="contact-us"&&e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx(n.Suspense,{fallback:e.jsx(Ge,{}),children:e.jsx(bi,{onBack:I.handleBackToPrevious,currentUser:T})})}),t==="faq"&&e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx(n.Suspense,{fallback:e.jsx(Ge,{}),children:e.jsx(Ni,{onBack:I.handleBackToPrevious,onShowContactUs:I.handleShowContactUs})})}),t==="marketplace"&&e.jsxs("div",{className:"space-y-8",children:[e.jsx(ai,{currentUser:T,allProducts:ie,onGoToRegister:I.handleGoToRegister,onGoToLogin:I.handleGoToLogin,onShowAddListing:G.handleShowAddListing,heroImage:T?.heroImage}),e.jsxs("section",{className:"space-y-6",children:[T?.userType==="admin"&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-sm font-medium text-primary",children:"🛠️ Admin Dashboard - Product Management Mode Active"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"You have administrator privileges to manage all products on the platform"})]})}),e.jsx(yr,{filters:ye,onFiltersChange:as,activeFiltersCount:xs},JSON.stringify(ye)),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Ue?Array.from({length:6}).map(($,J)=>e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"bg-gray-200 rounded-lg h-64"})},J)):ke.currentItems.length>0?ke.currentItems.map($=>{const J=$.sellerVerificationStatus||{idVerified:!1,businessVerified:!1,verified:!1,trustLevel:"unverified",tierLabel:"Unverified",levelBadge:"Unverified",level:0,userType:$.sellerType,accountType:"individual"};return e.jsx(pr,{product:$,onChat:X.handleChat,onViewDetails:I.handleViewDetails,onViewStorefront:I.handleViewStorefront,onDelete:T?.userType==="admin"?G.handleDeleteListing:void 0,onSaveProduct:T?.userType==="buyer"?Wa:void 0,currentUserId:T?.id,currentUserType:T?.userType,sellerVerified:J.verified,sellerVerificationStatus:J,adminMode:T?.userType==="admin",savedProductIds:ve.map(ne=>ne.productId)},$.id)}):e.jsxs("div",{className:"col-span-1 md:col-span-2 lg:col-span-3 text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-muted rounded-lg flex items-center justify-center mx-auto mb-4",children:e.jsx(Be,{className:"w-8 h-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Products Available"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:T?"There are no products listed yet. Be the first to add a product!":"There are no products listed yet. Sign up to add your first product!"}),e.jsx("div",{className:"flex justify-center items-center space-x-2",children:T?e.jsx(f,{onClick:G.handleShowAddListing,children:"Add Your First Product"}):e.jsxs(e.Fragment,{children:[e.jsx(f,{onClick:I.handleGoToRegister,children:"Sign Up to Add Products"}),e.jsx(f,{variant:"outline",onClick:I.handleGoToLogin,children:"Sign In"})]})})]})}),!Ue&&Fe.length>0&&e.jsx("div",{className:"mt-8",children:e.jsx(ri,{currentPage:ke.currentPage,totalPages:ke.totalPages,totalItems:ke.totalItems,itemsPerPage:ke.itemsPerPage,onPageChange:ke.goToPage,onItemsPerPageChange:ke.setItemsPerPage,itemsPerPageOptions:[6,12,24,48],showItemsPerPageSelector:!0,className:"border-t pt-6"})})]})]}),t==="product-details"&&te&&e.jsx(n.Suspense,{fallback:e.jsx(Ge,{}),children:(()=>{const $=te.sellerVerificationStatus||{idVerified:!1,businessVerified:!1,verified:!1,trustLevel:"unverified",tierLabel:"Unverified",levelBadge:"Unverified",level:0,userType:te.sellerType,accountType:"individual"};let J=null;return te.sellerId===T?.id?J={id:T.id,name:T.businessName||T.name,businessName:T.businessName,userType:T.userType,location:T.location,experience:T.experience,joinedDate:T.joinedDate||"Recently",rating:T.rating||4.2,totalReviews:T.totalReviews||12,yearsActive:T.experience?parseInt(T.experience.split(" ")[0])||1:3,responseTime:T.responseTime||(T.userType==="farmer"?"3 hours":"1 hour"),phone:T.phone||"",openingHours:T.openingHours||(T.userType==="farmer"?"9 AM - 6 PM":"8 AM - 7 PM")}:J={id:te.sellerId,name:te.sellerName||"Seller",businessName:te.sellerName||"Seller",userType:te.sellerType||"farmer",location:te.location||"Unknown",experience:"3 years",joinedDate:"Recently",rating:4.5,totalReviews:15,yearsActive:3,responseTime:te.sellerType==="farmer"?"3 hours":"1 hour",phone:"",openingHours:te.sellerType==="farmer"?"9 AM - 6 PM":"8 AM - 7 PM"},e.jsx(vi,{product:te,onBack:I.handleBackToMarketplace,onChat:X.handleChat,onPriceCompare:I.handlePriceCompare,onViewStorefront:I.handleViewStorefront,onEditProduct:ne=>G.handleEditListing(ne,ie),currentUserId:p==="seller-storefront"&&te.sellerId===T?.id?null:T?.id,isUserVerified:T?.verified||!1,userType:T?.userType,isPhoneVerified:T?.phoneVerified||!1,sellerVerified:$.verified,sellerVerificationStatus:$,sellerProfile:J})})()}),t==="price-comparison"&&te&&e.jsx(br,{productName:te.name,priceData:Qa,unit:te.unit,onBack:I.handleBackToProductDetails,isOwnProduct:T?.id===te.sellerId}),t==="seller-storefront"&&i&&(()=>{let $=null;return i===T?.id?$={id:T.id,name:T.businessName||T.name,type:T.userType,accountType:T.accountType,location:T.location,description:T.businessDescription||`${T.userType} in ${T.location}`,image:T.storefrontImage||"https://images.unsplash.com/photo-1500382017468-9049fed747ef?w=400&h=300&fit=crop",rating:T.rating||0,totalReviews:T.totalReviews||0,yearsActive:parseInt(T.experience?.split(" ")[0]||"1"),responseTime:T.responseTime||(T.userType==="farmer"?"3 hours":"1 hour"),certifications:T.qualityCertifications||[],joinedDate:T.joinedDate||"Recently",verified:T.verified||!1,phone:T.phone||"",email:T.email||"",website:T.website||"",facebook:T.facebook||"",instagram:T.instagram||"",telegram:T.telegram||"",businessHours:T.businessHours||"9 AM - 6 PM, Mon-Sat",specialties:T.specialties||[],policies:T.policies||{returns:"",delivery:"",payment:""}}:$={id:i,name:"Seller",type:"farmer",accountType:"individual",location:"Unknown",description:"Seller in Unknown",image:"https://images.unsplash.com/photo-1500382017468-9049fed747ef?w=400&h=300&fit=crop",rating:0,totalReviews:0,yearsActive:1,responseTime:"3 hours",certifications:[],joinedDate:"Recently",verified:!1,phone:"",email:"",website:"",facebook:"",instagram:"",telegram:"",businessHours:"9 AM - 6 PM, Mon-Sat",specialties:[],policies:{returns:"",delivery:"",payment:""}},$?e.jsx(Er,{seller:$,products:ie.filter(J=>J.sellerId===i),onBack:I.handleBackToPrevious,onViewProduct:I.handleViewDetails,onChat:X.handleChat,onEditProduct:i===T?.id?J=>{const ne=ie.find(Me=>Me.id===J);ne&&(C(ne),r("add-listing"))}:void 0,isOwnStorefront:i===T?.id,currentUser:T,onEditStorefrontImage:i===T?.id?Ja:void 0,onUpdateStorefront:i===T?.id?Qe:void 0,previewMode:u,onTogglePreviewMode:i===T?.id?y:void 0}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Seller not found."}),e.jsx(f,{onClick:I.handleBackToMarketplace,children:"Back to Marketplace"})]})})()]})}),l&&fe&&(()=>{const $=fe.sellerId===T?.id?T:null,J=fe.sellerVerificationStatus||{idVerified:!1,businessVerified:!1,verified:!1,trustLevel:"unverified",tierLabel:"Unverified",levelBadge:"Unverified",level:0,userType:fe.sellerType,accountType:"individual"};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"fixed right-0 bottom-0 h-[500px] w-96 bg-card shadow-2xl border-l border-t z-50 transition-transform duration-300",children:e.jsx(Hs,{sellerName:fe.sellerName,sellerType:fe.sellerType,sellerLocation:fe.location,currentUser:T,sellerRating:4.5,productName:fe.name,productId:fe.id,sellerId:fe.sellerId,product:fe,onClose:()=>c(null),sellerVerified:$?.verified||!1,currentUserVerified:T?.verified||!1,currentUserType:T?.userType,sellerVerificationStatus:J},"desktop-chat")})})})(),b==="login"&&e.jsx(va,{onLogin:ra,onSwitchToRegister:I.handleGoToRegister,onClose:()=>k(null)}),b==="register"&&e.jsx(ya,{onRegister:ia,onSwitchToLogin:I.handleGoToLogin,onClose:()=>k(null)}),N.show&&e.jsx(n.Suspense,{fallback:e.jsx(Ge,{}),children:e.jsx(ji,{feature:N.feature,sellerName:N.sellerName,userType:T?.userType,onClose:()=>M({show:!1,feature:"chat"}),onStartVerification:()=>{M({show:!1,feature:"chat"}),I.handleShowVerification()}})}),e.jsx(si,{onShowAboutUs:I.handleShowAboutUs,onShowContactUs:I.handleShowContactUs,onShowFAQ:I.handleShowFAQ}),_&&F&&T&&e.jsx(n.Suspense,{fallback:e.jsx(Ge,{}),children:e.jsx(ki,{isOpen:_,onClose:()=>{P(!1),D(null)},onSubmit:Ya,product:{id:F.id,name:F.name,price:F.price,unit:F.unit,sellerName:F.sellerName,location:F.location},currentUser:{id:T.id,name:T.name}})}),S&&q&&T&&e.jsx(n.Suspense,{fallback:e.jsx(Ge,{}),children:e.jsx(Ci,{isOpen:S,onClose:()=>{A(!1),re(null)},onSubmit:Ka,transaction:q,currentUser:{id:T.id,name:T.name}})}),e.jsx(ii,{position:"top-right"})]})})})});ar.createRoot(document.getElementById("root")).render(e.jsx(Si,{}));export{_e as A,f as B,R as C,W as I,O as L,Rr as R,Is as S,ze as T,Ns as U,E as a,Y as b,K as c,U as d,Je as e,Te as f,us as g,ce as h,me as i,de as j,ue as k,B as l,Q as m};
