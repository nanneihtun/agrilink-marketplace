import{r,j as e}from"./ui-CrM3Hg5W.js";import{R as U,B as x,C as f,a as N,S as h,g as ie,b as w,c as b,d as A,U as re}from"./index-cRR29Qlm.js";import{n as B,a6 as ce,$ as me,a0 as de,h as u,M as P,o as oe,K as xe,af as H,i as q,I as z,c as T,G as he,T as ge,a2 as je,U as fe,g as J,J as Ne,P as ue}from"./icons-Duv7h_B3.js";import"./vendor-BWX1YzKK.js";import"./supabase-BRe8iXyT.js";import"./utils--BulIq_u.js";import"./components-B9TP8a8L.js";function De({product:s,onBack:K,onChat:Q,onPriceCompare:S,onViewStorefront:C,onEditProduct:k,currentUserId:I,isUserVerified:ve=!1,userType:pe,isPhoneVerified:ye=!1,sellerVerified:we=!1,sellerVerificationStatus:v,sellerProfile:l}){const[j,G]=r.useState(null),[p,O]=r.useState(!0);r.useEffect(()=>{(async()=>{if(s.sellerId){O(!0);try{console.log("🔍 Fetching seller stats for:",s.sellerId);const t=await U.getSellerStats(s.sellerId);console.log("📊 Seller stats received:",t),G(t)}catch(t){console.error("❌ Error fetching seller stats:",t)}finally{O(!1)}}})()},[s.sellerId]);const V=a=>new Intl.NumberFormat("en-US").format(a),D={description:s.description||`High-quality ${s.name.toLowerCase()} sourced ${s.sellerType==="farmer"?"directly from our farm":"from trusted farmers"} in ${s.location}. ${s.sellerType==="farmer"?"Grown using sustainable farming practices.":"Carefully selected and stored to ensure freshness."}`,harvestDate:s.sellerType==="farmer"?"January 15, 2024":"January 10-20, 2024",minimumOrder:s.minimumOrder||"10 "+s.unit.split("(")[0].trim()+"s",deliveryOptions:s.deliveryOptions&&s.deliveryOptions.length>0?s.deliveryOptions:["Nationwide Shipping","Express Delivery","Local Delivery (Within 10km)","Pickup","Regional Delivery"],paymentTerms:s.paymentTerms&&s.paymentTerms.length>0?s.paymentTerms.join(", "):"Cash on Pickup, Bank Transfer, 50% Advance, 50% on Delivery, Mobile Payment"},g={rating:j?.rating||l?.rating||4,totalReviews:j?.totalReviews||l?.totalReviews||0,yearsActive:l?.yearsActive||(l?.experience?parseInt(l.experience.split(" ")[0])||1:s.sellerType==="farmer"?5:8),responseTime:j?.responseTime||l?.responseTime||"Within 24 hours"};console.log("🔍 Seller details calculation:",{sellerStats:j,sellerProfile:l,finalDetails:g,loadingStats:p,productSellerId:s.sellerId}),r.useEffect(()=>{console.log("🧪 Testing ReviewsService directly..."),U.getSellerStats("test-id").then(a=>{console.log("🧪 ReviewsService test result:",a)}).catch(a=>{console.log("🧪 ReviewsService test error:",a)})},[]);const R=I&&s.sellerId===I,[c,y]=r.useState(0),[i,d]=r.useState(0),n=s.images&&s.images.length>0?s.images:s.image?[s.image]:[],m=5,$=()=>{y(a=>a===0?n.length-1:a-1)},E=()=>{y(a=>a===n.length-1?0:a+1)},W=a=>{y(a),a<i?d(a):a>=i+m&&d(a-m+1)},X=()=>{d(a=>Math.max(0,a-1))},Y=()=>{d(a=>Math.min(n.length-m,a+1))},[L,Z]=r.useState(null),[F,M]=r.useState(null),_=a=>{M(null),Z(a.targetTouches[0].clientX)},ee=a=>{M(a.targetTouches[0].clientX)},se=()=>{if(!L||!F)return;const a=L-F,t=a>50,o=a<-50;n.length>1&&(t&&E(),o&&$())};return r.useEffect(()=>{c<i?d(c):c>=i+m&&d(Math.max(0,c-m+1))},[c,i,m]),r.useEffect(()=>{const a=t=>{n.length>1&&(t.key==="ArrowLeft"?(t.preventDefault(),$()):t.key==="ArrowRight"&&(t.preventDefault(),E()))};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[n.length]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs(x,{variant:"ghost",onClick:K,className:"h-9 px-3 -ml-3",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-bold",children:s.name}),e.jsx("p",{className:"text-muted-foreground",children:"Product Details"})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-4 lg:gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-3 lg:space-y-4",children:[e.jsx(f,{className:"border-primary/30",children:e.jsx(N,{className:"p-3 lg:p-4",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 lg:gap-6",children:[e.jsx("div",{children:n.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:n[c],alt:`${s.name} - Image ${c+1}`,className:"w-full h-64 object-cover rounded-lg cursor-pointer select-none",onTouchStart:_,onTouchMove:ee,onTouchEnd:se,draggable:!1}),n.length>1&&e.jsxs("div",{className:"absolute bottom-3 right-3 bg-black/70 text-white text-xs px-2 py-1 rounded-md",children:[c+1," / ",n.length]})]}),n.length>1&&e.jsx("div",{className:"space-y-2",children:e.jsx("div",{className:"relative",children:e.jsx("div",{className:"flex gap-2 overflow-hidden",children:n.slice(i,i+m).map((a,t)=>{const o=i+t,ae=t===0,te=t===m-1,le=i>0,ne=i+m<n.length;return e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("img",{src:a,alt:`${s.name} - View ${o+1}`,className:`w-16 h-16 object-cover rounded border-2 cursor-pointer transition-all ${o===c?"border-primary ring-2 ring-primary/20":"border-border hover:border-primary"}`,onClick:()=>W(o)}),ae&&le&&e.jsx("button",{onClick:X,className:"absolute left-1 top-1/2 -translate-y-1/2 w-5 h-5 bg-white/90 hover:bg-white border border-black/20 rounded-sm shadow-sm flex items-center justify-center transition-all duration-200 z-10",children:e.jsx(B,{className:"w-3 h-3 text-gray-700"})}),te&&ne&&e.jsx("button",{onClick:Y,className:"absolute right-1 top-1/2 -translate-y-1/2 w-5 h-5 bg-white/90 hover:bg-white border border-black/20 rounded-sm shadow-sm flex items-center justify-center transition-all duration-200 z-10",children:e.jsx(ce,{className:"w-3 h-3 text-gray-700"})})]},o)})})})})]}):e.jsx("div",{className:"w-full h-64 bg-muted rounded-lg flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No images available"})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:s.price&&s.price>0?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-xl md:text-2xl font-bold",children:[V(s.price)," MMK"]}),e.jsxs("span",{className:"text-muted-foreground",children:["per ",s.unit]})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xl md:text-2xl font-bold",children:"Contact"}),e.jsx("span",{className:"text-muted-foreground",children:"for price"})]})}),s.priceChange!==void 0&&e.jsxs("div",{className:"flex items-center gap-2",children:[s.priceChange>0?e.jsx(me,{className:"w-4 h-4 text-green-600"}):e.jsx(de,{className:"w-4 h-4 text-red-600"}),e.jsxs("span",{className:`text-sm ${s.priceChange>0?"text-green-600":"text-red-600"}`,children:[s.priceChange>0?"+":"",s.priceChange,"% from last week"]})]})]}),e.jsx(h,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["Available: ",s.quantity]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:s.location})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm",children:["Updated ",ie(s.lastUpdated)]})]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-2",children:R?e.jsxs(e.Fragment,{children:[k&&e.jsxs(x,{onClick:()=>k(s),className:"flex-1 h-9 text-sm",children:[e.jsx(xe,{className:"w-3 h-3 mr-1"}),"Edit Product"]}),e.jsxs(x,{variant:"outline",onClick:()=>S(s.id),className:"flex-1 h-9 text-sm",children:[e.jsx(H,{className:"w-3 h-3 mr-1"}),"See Market Prices"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(x,{onClick:()=>Q(s.id),className:"flex-1 h-9 text-sm",children:[e.jsx(q,{className:"w-3 h-3 mr-1"}),"Contact Seller"]}),e.jsxs(x,{variant:"outline",onClick:()=>S(s.id),className:"flex-1 h-9 text-sm",children:[e.jsx(H,{className:"w-3 h-3 mr-1"}),"Compare Prices"]})]})})]})]})})}),D.description&&e.jsxs(f,{className:"border-primary/30",children:[e.jsx(w,{children:e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),"Product Description"]})}),e.jsx(N,{children:e.jsx("p",{className:"text-foreground leading-relaxed",children:D.description})})]}),e.jsxs(f,{className:"border-primary/30",children:[e.jsx(w,{children:e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-5 h-5"}),"Order & Delivery Information"]})}),e.jsxs(N,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[s.availableQuantity&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4 text-muted-foreground"}),"Available Stock"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.availableQuantity})]}),s.minimumOrder&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4 text-muted-foreground"}),"Minimum Order"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.minimumOrder})]})]}),s.paymentTerms&&s.paymentTerms.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(h,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4 text-muted-foreground"}),"Payment Terms"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.paymentTerms.map((a,t)=>e.jsx(A,{variant:"secondary",className:"text-xs",children:a},t))})]})]}),s.deliveryOptions&&s.deliveryOptions.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(h,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4 text-muted-foreground"}),"Delivery Options"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.deliveryOptions.map((a,t)=>e.jsx(A,{variant:"outline",className:"text-xs",children:a},t))})]})]}),s.additionalNotes&&e.jsxs(e.Fragment,{children:[e.jsx(h,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4 text-muted-foreground"}),"Additional Information"]}),e.jsx("div",{className:"p-3 bg-muted/30 rounded-md border border-dashed border-muted-foreground/20",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(z,{className:"w-4 h-4 mt-0.5 text-muted-foreground flex-shrink-0"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.additionalNotes})]})})]})]}),!s.availableQuantity&&!s.minimumOrder&&(!s.paymentTerms||s.paymentTerms.length===0)&&(!s.deliveryOptions||s.deliveryOptions.length===0)&&!s.additionalNotes&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(u,{className:"w-8 h-8 mx-auto mb-2 text-muted-foreground/50"}),e.jsx("p",{children:"Contact seller for detailed order information"}),e.jsx("p",{className:"text-sm",children:"Payment terms and delivery options available upon inquiry"})]})]})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(f,{className:"border-primary/30",children:[e.jsx(w,{children:e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5"}),"Seller Information"]})}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(J,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("button",{className:"font-medium text-primary hover:underline",onClick:()=>C(s.sellerId),children:s.sellerName})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(re,{userType:s.sellerType,accountType:v?.accountType||"individual",verificationLevel:v?v.trustLevel:"unverified",size:"sm"})})]}),e.jsx(h,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:s.location})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{className:"text-sm",children:p?"Loading...":`${g.rating.toFixed(1)} (${g.totalReviews} review${g.totalReviews!==1?"s":""})`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:p?"Loading...":`Usually responds within ${g.responseTime}`})]})]}),e.jsx(h,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Contact Information"}),l?.phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:l.phone})]}),l?.openingHours&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(T,{className:"w-4 h-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:"Business Hours"}),e.jsx("div",{className:"text-muted-foreground",children:l.openingHours})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[l?.email&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:l.email})]}),!R&&e.jsxs(x,{onClick:()=>C(s.sellerId),variant:"outline",size:"sm",className:"w-full",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"View Full Storefront"]})]})]})]})})]})]})}export{De as ProductDetails};
